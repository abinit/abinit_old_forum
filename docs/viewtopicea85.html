<!DOCTYPE html>
<html dir="ltr" lang="en-gb">

<!-- Mirrored from forum.abinit.org/viewtopic.php?f=9&t=3988&view=print by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 20 Sep 2024 19:25:23 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="robots" content="noindex" />

<title>ABINIT Discussion Forums &bull; Improving calculation performance?</title>

<link href="styles/flat-style/theme/print.css" rel="stylesheet">
<link href="styles/flat-style/theme/bidi.css" rel="stylesheet">
</head>
<body id="phpbb" class="ltr">
<div id="wrap" class="wrap">
	<a id="top" class="top-anchor" accesskey="t"></a>

	<div id="page-header">
		<h1>ABINIT Discussion Forums</h1>
		<p>The meeting place for ABINIT users and developers<br /><a href="index.html">https://forum.abinit.org/</a></p>

		<h2>Improving calculation performance?</h2>
		<p><a href="viewtopicb7d9.html?f=9&amp;t=3988">https://forum.abinit.org/viewtopic.php?f=9&amp;t=3988</a></p>
	</div>

	<div id="page-body" class="page-body">
		<div class="page-number">Page <strong>1</strong> of <strong>1</strong></div>
					<div class="post">
				<h3>Improving calculation performance?</h3>
				<div class="date">Posted: <strong>Thu Dec 06, 2018 9:55 am</strong></div>
				<div class="author">by <strong>ryne60</strong></div>
				<div class="content">Hi All,<br /><br />I'm a new member in the forum; thanks for providing this forum.<br /><br />Currently, I'm trying to do a ground-state calculation for a nanoribbon system consisting of 30 atoms per cell with the following SCF-related parameter setup:<br /><br /># SCF cycle parameters<br />ecut 12.<br />pawecutdg 30.<br />nstep 300<br />nband 150<br />toldfe 1.0d-9<br />iprcel 44<br /><br /># K-points and sym<br />ngkpt 11 1 1<br />nshiftk 1<br />shiftk 0.0 0.0 0.0<br /><br />occopt 7<br />prtdos 0<br /><br />autoparal 1<br /><br />For the potential I'm using PAW potential (this potential is a &quot;must&quot; currently for my study). The problem with my calculation is that it's running so slow. I compared the calculation with VASP using a comparable parameter setup and it's finished in less than 10 minutes, but my calculation with ABINIT has been running for about 12 hours now. <br /><br />Did I miss some parameters in my setup so it's running so slow? Or is there a way to improve the performance of my calculation? I would appreciate it if someone could give some suggestion regarding this issue. Thanks!<br /><br />PS. Below I also put the Build-Information of my ABINIT (in case needed for further analysis):<br /><br />++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++<br /><br /> === Build Information ===<br />  Version       : 8.6.1<br />  Build target  : x86_64_linux_gnu4.8<br />  Build date    : 20180123<br /><br /> === Compiler Suite ===<br />  C compiler       : gnu4.8<br />  C++ compiler     : gnu4.8<br />  Fortran compiler : gnu4.8<br />  CFLAGS           :  -g -O2 -mtune=native -march=native<br />  CXXFLAGS         :  -g -O2 -mtune=native -march=native<br />  FCFLAGS          :  -g -ffree-line-length-none<br />  FC_LDFLAGS       :<br /><br /> === Optimizations ===<br />  Debug level        : basic<br />  Optimization level : standard<br />  Architecture       : intel_xeon<br /><br /> === Multicore ===<br />  Parallel build : yes<br />  Parallel I/O   : auto<br />  openMP support : no<br />  GPU support    : no<br /><br /> === Connectors / Fallbacks ===<br />  Connectors on : yes<br />  Fallbacks on  : yes<br />  DFT flavor    : libxc-fallback+atompaw-fallback+wannier90-fallback<br />  FFT flavor    : none<br />  LINALG flavor : netlib-fallback<br />  MATH flavor   : none<br />  TIMER flavor  : abinit<br />  TRIO flavor   : none<br /><br /> === Experimental features ===<br />  Bindings            : @enable_bindings@<br />  Exports             : no<br />  GW double-precision : no<br /><br /> ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++<br /><br /> ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++<br /> Default optimizations:<br />   -O2 -mtune=native -march=native<br /><br /> Optimizations for 20_datashare:<br />   -O0<br /><br /> ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++<br /> ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++<br /> CPP options activated during the build:<br /><br />                    CC_GNU                   CXX_GNU                    FC_GNU<br /><br />              HAVE_ATOMPAW HAVE_FC_ALLOCATABLE_DT...             HAVE_FC_ASYNC<br /><br />         HAVE_FC_BACKTRACE  HAVE_FC_COMMAND_ARGUMENT      HAVE_FC_COMMAND_LINE<br /><br />        HAVE_FC_CONTIGUOUS           HAVE_FC_CPUTIME              HAVE_FC_EXIT<br /><br />             HAVE_FC_FLUSH             HAVE_FC_GAMMA            HAVE_FC_GETENV<br /><br />          HAVE_FC_INT_QUAD             HAVE_FC_IOMSG     HAVE_FC_ISO_C_BINDING<br /><br />  HAVE_FC_ISO_FORTRAN_2008        HAVE_FC_LONG_LINES        HAVE_FC_MOVE_ALLOC<br /><br />           HAVE_FC_PRIVATE         HAVE_FC_PROTECTED         HAVE_FC_STREAM_IO<br /><br />            HAVE_FC_SYSTEM          HAVE_FORTRAN2003        HAVE_LIBPAW_ABINIT<br /><br />      HAVE_LIBTETRA_ABINIT                HAVE_LIBXC                  HAVE_MPI<br /><br />                 HAVE_MPI2       HAVE_MPI_IALLREDUCE        HAVE_MPI_IALLTOALL<br /><br />       HAVE_MPI_IALLTOALLV        HAVE_MPI_INTEGER16               HAVE_MPI_IO<br /><br /> HAVE_MPI_TYPE_CREATE_S...                HAVE_NUMPY             HAVE_OS_LINUX<br /><br />         HAVE_TIMER_ABINIT            HAVE_WANNIER90              USE_MACROAVE<br /><br /> ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Improving calculation performance?</h3>
				<div class="date">Posted: <strong>Fri Dec 07, 2018 12:23 pm</strong></div>
				<div class="author">by <strong>woffermans</strong></div>
				<div class="content">Dear Ryne60 and ABINIT friends,<br /><br />If you state that the calculation is slow, then please specify what you mean with slow. Is it the convergence speed? Or do you need approx. the same amount of cycles, but each cycle is taken more time? Or something else? <br /><br />In my case, the convergence speed of ABINIT was pretty slow. It took many steps to converge to the ground electronic state and I could improve the convergence speed by a factor of 2 by changing occopt to 7.<br />Unfortunately you already have set occopt to 7.<br /><br />toldfe 1.0d-9 is pretty harsh. Please check if you specified the same value in VASP. If this is the case, then this should not be the problem.<br /><br />Furthermore, it might help if you specify (or upload) your PAW potential file. As far as I understood, the convergence also depends on the PAW potential.</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Improving calculation performance?</h3>
				<div class="date">Posted: <strong>Fri Dec 07, 2018 3:17 pm</strong></div>
				<div class="author">by <strong>ryne60</strong></div>
				<div class="content">Hi Woffermans,<br /><br />Thanks for the reply! The calculation is slow in terms of time per SCF-cycle and convergence speed; it took around 2 hours per SCF-cycle and the calculation isn't converged after 300 cycles. <br /><br />Also please kindly find attached the PAW potential I use! And any further suggestion is welcome!<br /><br />PS. I renamed the file from Bi.GGA_PBE-JTH.xml to BiPAW.in since apparently files are not allowed for attachment except those with suffix .in or .out</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Improving calculation performance?</h3>
				<div class="date">Posted: <strong>Sun Dec 09, 2018 2:37 am</strong></div>
				<div class="author">by <strong>onion2440</strong></div>
				<div class="content">I think set toldfe 1e-9 is too expensive and generally speaking it's no need to use a so strict criterion. Some times even for calculate the phonon dispersions, most people will set toldfe 1e-7. Maybe help you.</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Improving calculation performance?</h3>
				<div class="date">Posted: <strong>Mon Dec 10, 2018 10:06 am</strong></div>
				<div class="author">by <strong>ryne60</strong></div>
				<div class="content">Hi onion2440,<br /><br />after 300 cycles the maximum energy diff is around 10 Ha, which is &gt;&gt; 1e-9 Ha. So even if I increase toldfe to, let's say, 1e-7, the overall calculation is still very expensive. Maybe any clue how to improve/speed-up the calculation time per cycle?</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Improving calculation performance?</h3>
				<div class="date">Posted: <strong>Tue Dec 11, 2018 10:31 am</strong></div>
				<div class="author">by <strong>woffermans</strong></div>
				<div class="content">Hello ryne60, onion2440 and ABINIT friends,<br /><br />The point is not the values of the parameters.<br /><br />The point is the comparison with VASP calculation.<br /><br />If the VASP input is equivalent to the ABINIT input, then the question remains why calculation speed of VASP and ABINIT is so different.<br /><br />If I understand you correctly, then you need more time per electronic cycle as well as more cycles for your ABINIT calculation, compared to VASP. Moreover the difference is significant. It is not just a couple of minutes and 3 cycles less or more.<br /><br />Though benchmarking is always very tricky. You need equal conditions for the VASP and ABINIT calculation. You need equal input for both calculations. Otherwise you compare apples with pears.<br /><br />I think you need also to upload your VASP input. Experienced users can then have a look to both input and judge if input for ABINIT and VASP is equal. <br /><br />The best would be, if someone would reproduce your comparison on a different machine/cluster. Just to be sure, that it is not the environment, who's playing tricks on you.<br /><br />I guess that the developers of ABINIT are doing benchmarks all the time. So I would expect a statement from their site as well. Maybe this is already known and taken into account.</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Improving calculation performance?</h3>
				<div class="date">Posted: <strong>Thu Dec 13, 2018 9:05 am</strong></div>
				<div class="author">by <strong>ryne60</strong></div>
				<div class="content">Hi woffermans,<br /><br /><blockquote><div><cite>woffermans wrote:</cite>If I understand you correctly, then you need more time per electronic cycle as well as more cycles for your ABINIT calculation, compared to VASP. Moreover the difference is significant. It is not just a couple of minutes and 3 cycles less or more.</div></blockquote><br /><br />Yes, that's correct; for the comparison, the VASP calculation needed only about 98s per cycle and 40 cycles to converge.<br /><br />I used the following minimal setup for the VASP calculation:<br /><br />PREC = Accurate<br />LREAL = .FALSE.<br />ISMEAR = -5  # tetrahedron method with Blöchl corrections<br />NBANDS = 150<br />NSW = 0 # static calculation<br />EDIFF = 1.0d-7 # in eV<br />NEDOS = 801<br />NPAR = 4<br />ENCUT = 340 eV<br /><br />In both cases I used 11 kpoints. I can't attach the potcar file because it's a copyright item but if you have access to the VASP POTCAR database I used the POTCAR with the following title: TITEL  = PAW_PBE Bi08Apr2002 . So I guess both calculations have comparable setups but I still I don't know why the ABINIT calculation took much more time per cycle (and number of cycles).</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Improving calculation performance?</h3>
				<div class="date">Posted: <strong>Thu Dec 13, 2018 10:37 am</strong></div>
				<div class="author">by <strong>woffermans</strong></div>
				<div class="content">Dear ryne60 and ABINIT friends,<br /><br />Is ISMEAR = -5 comparable with occopt 7?</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Improving calculation performance?</h3>
				<div class="date">Posted: <strong>Thu Dec 13, 2018 2:27 pm</strong></div>
				<div class="author">by <strong>ryne60</strong></div>
				<div class="content">Hi woffermans,<br /><br />I also tried with both calculations using the Fermi smearing (ISMEAR -1 &amp; occopt 3) and the conclusion regarding the calculations' speed doesn't not change much!</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Improving calculation performance?</h3>
				<div class="date">Posted: <strong>Fri Dec 14, 2018 4:00 pm</strong></div>
				<div class="author">by <strong>ebousquet</strong></div>
				<div class="content">Dear ryne60,<br />Another remark: Why do you use iprcel 44? Did you check if default preconditioning is working?<br />another remark is that autoparal=1 might not be efficient, I usually recommend to do it by hand such that you control everything and often the result is more efficient, see for example:<br /><a href="viewtopicaeb9.html?f=8&amp;t=3837" class="postlink">https://forum.abinit.org/viewtopic.php?f=8&amp;t=3837</a><br />Best wishes,<br />Eric</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Improving calculation performance?</h3>
				<div class="date">Posted: <strong>Fri Dec 14, 2018 5:47 pm</strong></div>
				<div class="author">by <strong>ryne60</strong></div>
				<div class="content">Hi Eric,<br /><br />I made some trial calculations with similar kind of systems but with a lot smaller size of unit cell; i.e. still 2D systems with 2 atoms per unit-cell, and thus the timing was a lot faster. In these cases, the setup with iprcel 44 finished faster than cases with other iprcel values. So I just setup the same value for bigger systems. Moreover, according to the manual iprcel 45 will more likely give a large improvement, and since iprcel 44 is just 1 number lower, so I thought it would give a similar performance as 45. But I also tried using the default value; the conclusion about the speed per cycle is still more less the same; i.e. much slower than VASP's speed per cycle.<br /><br />Regarding autopar, before I set this parameter out, I got some message from abinit that my setup was not optimal and it recommended &quot;autopar&quot;  in the input file. I also again did some test of this parameter on systems with smaller sizes, and autopar 1 resulted in the fastest timing. So I just put it in the setup of my real system.<br /><br />Anyway, thanks for recommendation. I'll do more tests with autopar.</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Improving calculation performance?</h3>
				<div class="date">Posted: <strong>Wed Jan 09, 2019 3:12 pm</strong></div>
				<div class="author">by <strong>woffermans</strong></div>
				<div class="content">Dear ryne60 and ABINIT friends,<br /><br />Please don't forget to report on your findings. It is of interest of all ABINIT friends, if we can close the thread in some conclusive way.</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Improving calculation performance?</h3>
				<div class="date">Posted: <strong>Fri Jan 11, 2019 1:02 pm</strong></div>
				<div class="author">by <strong>ryne60</strong></div>
				<div class="content">Hi woffermans,<br /><br />it seems the culprit was iprcel; because of this, the first few SCF cycles took so many hours. In my opinion, somehow the following note about iprcel in the online manual is a bit misleading:  <br /><br /><blockquote class="uncited"><div>For non-homogeneous relatively large cells iprcel = 45 will likely give a large improvement over iprcel = 0.</div></blockquote><br /><br />Certainly the running time is not improved (or even much worse) compared to the setup without iprcel.<br /><br />Some other factor that has led to a different performance is the cut off energy of wavefunctions suggested by pseudopotentials, I don't know how it is possible, but in most PAW cases suggested cut off energies are much lower in VASP than in ABINIT. However, if both are set up with comparable cut off energy, the running time becomes comparable too.<br /><br />Other than this, I think the performance of ABINIT is quite comparable to VASP.<br /><br />I hope the info can be useful to others.<br /><br />Thanks again!</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Improving calculation performance?</h3>
				<div class="date">Posted: <strong>Thu Apr 25, 2019 11:10 am</strong></div>
				<div class="author">by <strong>ketong</strong></div>
				<div class="content"><blockquote><div><cite>ryne60 wrote:</cite>Hi woffermans,<br /><br />it seems the culprit was iprcel; because of this, the first few SCF cycles took so many hours. In my opinion, somehow the following note about iprcel in the online manual is a bit misleading:  <br /><br /><blockquote class="uncited"><div>For non-homogeneous relatively large cells iprcel = 45 will likely give a large improvement over iprcel = 0.</div></blockquote><br /><br />Certainly the running time is not improved (or even much worse) compared to the setup without iprcel.<br /><br />Some other factor that has led to a different performance is the cut off energy of wavefunctions suggested by pseudopotentials, I don't know how it is possible, but in most PAW cases suggested cut off energies are much lower in VASP than in ABINIT. However, if both are set up with comparable cut off energy, the running time becomes comparable too.<br /><br />Other than this, I think the performance of ABINIT is quite comparable to VASP.<br /><br />I hope the info can be useful to others.<br /><br />Thanks again!</div></blockquote><br /><br />Hi ryne60,<br /><br />  In your latest reply, you thought the culprit was &quot;iprcel&quot;. So it means that in your &quot;in&quot; file, the line including &quot;iprcel&quot; was deleted and the calculation with ABINIT finished in less than 10 minutes? Is it right?</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Improving calculation performance?</h3>
				<div class="date">Posted: <strong>Thu Apr 25, 2019 12:46 pm</strong></div>
				<div class="author">by <strong>ryne60</strong></div>
				<div class="content">Hi ketong,<br /><br />Yes, it's been deleted since then! But, since my systems are big, the calculation time (scfcv time) is still long but now &quot;comparable&quot; to VASP because the first few scf cycles now take significantly less time.</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Improving calculation performance?</h3>
				<div class="date">Posted: <strong>Fri Apr 26, 2019 6:44 am</strong></div>
				<div class="author">by <strong>ketong</strong></div>
				<div class="content">Dear ryne60,<br /><br />    Thank you for your information. <br /><br />    In addition, do you have some suggestions or tricks about the setting of &quot;iprcel&quot;, &quot;diemac&quot; and &quot;diemix&quot;?<br /><br />    Thanks again!</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Improving calculation performance?</h3>
				<div class="date">Posted: <strong>Fri Apr 26, 2019 10:58 am</strong></div>
				<div class="author">by <strong>ryne60</strong></div>
				<div class="content">Hi ketong,<br /><br /><blockquote><div><cite>ketong wrote:</cite>    In addition, do you have some suggestions or tricks about the setting of &quot;iprcel&quot;, &quot;diemac&quot; and &quot;diemix&quot;?<br /></div></blockquote><br /><br />unfortunately, I don't! Sorry, I didn't do much test for those parameters. Since my systems are too big, testing those parameters will be time consuming. I've been using default values, instead.</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Improving calculation performance?</h3>
				<div class="date">Posted: <strong>Tue Apr 30, 2019 4:33 am</strong></div>
				<div class="author">by <strong>ketong</strong></div>
				<div class="content">Hi ryne60,<br /><br />    Anyway, thank you very much!</div>
			</div>
			<hr />
			</div>

	<div id="page-footer" class="page-footer">
		<div class="page-number">All times are <span title="Europe/Brussels">UTC+02:00</span><br />Page <strong>1</strong> of <strong>1</strong></div>
			<div class="copyright">
				<p>Powered by <a href="https://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Limited
				</p>
							</div>
	</div>
</div>

</body>

<!-- Mirrored from forum.abinit.org/viewtopic.php?f=9&t=3988&view=print by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 20 Sep 2024 19:25:23 GMT -->
</html>
