<!DOCTYPE html>
<html dir="ltr" lang="en-gb">

<!-- Mirrored from forum.abinit.org/viewtopic.php?f=12&t=3589&view=print by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 20 Sep 2024 21:03:24 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="robots" content="noindex" />

<title>ABINIT Discussion Forums &bull; cut3d error when extracting wave functions from _WFK file</title>

<link href="styles/flat-style/theme/print.css" rel="stylesheet">
<link href="styles/flat-style/theme/bidi.css" rel="stylesheet">
</head>
<body id="phpbb" class="ltr">
<div id="wrap" class="wrap">
	<a id="top" class="top-anchor" accesskey="t"></a>

	<div id="page-header">
		<h1>ABINIT Discussion Forums</h1>
		<p>The meeting place for ABINIT users and developers<br /><a href="index.html">https://forum.abinit.org/</a></p>

		<h2>cut3d error when extracting wave functions from _WFK file</h2>
		<p><a href="viewtopic37a7.html?f=12&amp;t=3589">https://forum.abinit.org/viewtopic.php?f=12&amp;t=3589</a></p>
	</div>

	<div id="page-body" class="page-body">
		<div class="page-number">Page <strong>1</strong> of <strong>1</strong></div>
					<div class="post">
				<h3>cut3d error when extracting wave functions from _WFK file</h3>
				<div class="date">Posted: <strong>Sun May 07, 2017 5:49 pm</strong></div>
				<div class="author">by <strong>boubacar</strong></div>
				<div class="content">Hi all,<br /><br />I would like to extract wavefunctions at specific k points from abinit _WFK file using cut3d. However, cut3d issues error at the stage where I enter spinor component that I am interested in.<br />I am using abinit8.2.2 and it is the first time that I encounter this problem. <br /><br />Below is the error message. Does anyone have any idea what could possibly be the problem?<br />----<br /><br />  This file is a WF file. <br /> <br /> For which k-points? (1 to    2)<br />1<br />  =&gt; Your k-point is :            1<br /> <br /> <br /> For which band ? (1 to  1620)<br />1592<br />  =&gt; Your band number is :         1592<br /> <br />  =&gt; Your spin polarisation number is :            1<br /> <br />  nspinor =            2<br /> <br />  For which spinor component ?<br />1<br />  =&gt; Your spinor component is :            1<br /> <br />[login3:20504:0] Caught signal 11 (Segmentation fault)<br />==== backtrace ====<br /> 2 0x00000000000686ec mxm_handle_error()  /var/tmp/OFED_topdir/BUILD/mxm-3.5.3093/src/mxm/util/debug/debug.c:641<br /> 3 0x0000000000068c3c mxm_error_signal_handler()  /var/tmp/OFED_topdir/BUILD/mxm-3.5.3093/src/mxm/util/debug/debug.c:616<br /> 4 0x0000000000035250 killpg()  ??:0<br /> 5 0x00000000000421b0 __intel_avx_rep_memcpy()  ??:0<br /> 6 0x00000000000310e4 ADIOI_GEN_ReadStrided()  /gestconf/project/hpcdelivery/build/current_SCS5R1/obj/x86_64_rhel7_r1/topdir/BUILD/openmpi-2.0.1/ompi/mca/io/romio314/romio/adio/common/ad_read_str.c:299<br /> 7 0x000000000000d6b3 MPIOI_File_read()  /gestconf/project/hpcdelivery/build/current_SCS5R1/obj/x86_64_rhel7_r1/topdir/BUILD/openmpi-2.0.1/ompi/mca/io/romio314/romio/mpi-io/read.c:166<br /> 8 0x000000000000d453 mca_io_romio314_dist_MPI_File_read()  /gestconf/project/hpcdelivery/build/current_SCS5R1/obj/x86_64_rhel7_r1/topdir/BUILD/openmpi-2.0.1/ompi/mca/io/romio314/romio/mpi-io/read.c:55<br /> 9 0x00000000000812d2 PMPI_File_read()  /gestconf/project/hpcdelivery/build/current_SCS5R1/obj/x86_64_rhel7_r1/topdir/BUILD/openmpi-2.0.1/ompi/mpi/c/profile/pfile_read.c:68<br />10 0x000000000004b0c1 ompi_file_read_f()  /gestconf/project/hpcdelivery/build/current_SCS5R1/obj/x86_64_rhel7_r1/topdir/BUILD/openmpi-2.0.1/ompi/mpi/fortran/mpif-h/profile/pfile_read_f.c:82<br />11 0x000000000070fd08 m_mpiotk_mp_mpiotk_read_fsuba_dp2d_()  /scratch/cnusc/adci/acirou/abinit-8.2.2/src/27_toolbox_oop/m_mpiotk.F90:360<br />12 0x000000000047763e m_wfk_mp_wfk_read_band_block_()  /scratch/cnusc/adci/acirou/abinit-8.2.2/src/62_iowfdenpot/m_wfk.F90:1404<br />13 0x000000000042d84f m_cut3d_mp_cut3d_wffile_()  /scratch/cnusc/adci/acirou/abinit-8.2.2/src/83_cut3d/m_cut3d.F90:1985<br />14 0x000000000040747a MAIN__()  /scratch/cnusc/adci/acirou/abinit-8.2.2/src/98_main/cut3d.F90:253<br />15 0x00000000004052be main()  ??:0<br />16 0x0000000000021b35 __libc_start_main()  ??:0<br />17 0x00000000004051c9 _start()  ??:0<br />===================<br />Segmentation fault<br /><br />----------<br /><br />Thanks for your help,<br />Boubacar</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: cut3d error when extracting wave functions from _WFK fil</h3>
				<div class="date">Posted: <strong>Tue May 09, 2017 10:37 pm</strong></div>
				<div class="author">by <strong>mverstra</strong></div>
				<div class="content">Hello Boubacar,<br /><br />your WFK file is probably corrupted somehow. As your k-point is towards the end, the header may be intact but not all of the file (or it may have been truncated because your disk quota ran out?)<br /><br />Other possibility: was it made on the same system as the cut3d you are running? The binary files may not be compatible.<br /><br />good luck</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: cut3d error when extracting wave functions from _WFK fil</h3>
				<div class="date">Posted: <strong>Tue May 09, 2017 11:26 pm</strong></div>
				<div class="author">by <strong>boubacar</strong></div>
				<div class="content">Hello Mathieu,<br /><br />Thank you for your reply!<br /><br />I don't think that it is a disk space problem because I still have much space left. I have tried the same cut3d with the density file *_DEN and it works.<br />It may indeed be that my _WFK file is corrupted but I don't know how to check that (how would I check that)?<br /><br />I was thinking that the RAM may not be enough when running cut3d since the _WFK file is huge (47 GB) with 1620 bands. So I was wondering if it could not be related to that?<br />Any ideas ...?<br /><br />Thanks,<br />Boubacar</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: cut3d error when extracting wave functions from _WFK fil</h3>
				<div class="date">Posted: <strong>Fri May 12, 2017 3:36 pm</strong></div>
				<div class="author">by <strong>boubacar</strong></div>
				<div class="content">Hello,<br /><br />I have just run cut3d on a machine with 100GB of RAM and I still have a segmentation fault. The caclulations with abinit 8.2.2 goes to the end and finishes properly. But I don't see why cut3d fails. I am suspecting the problem to be related to cut3d (in abinit 8.2.2) in extracting the wavefunctions. I note that it works with the density file _DEN without problem.<br />Below is the error message with _WFK file :<br /><br />---<br /> This file is a WF file. <br /> <br /> For which k-points? (1 to    2)<br />1<br />  =&gt; Your k-point is :            1<br /> <br /> <br /> For which band ? (1 to  1632)<br />1592<br />  =&gt; Your band number is :         1592<br /> <br />  =&gt; Your spin polarisation number is :            1<br /> <br />  nspinor =            2<br /> <br />  For which spinor component ?<br />1<br />  =&gt; Your spinor component is :            1<br /> <br />forrtl: severe (174): SIGSEGV, segmentation fault occurred<br />Image              PC                Routine            Line        Source             <br />cut3d              000000000088C65D  Unknown               Unknown  Unknown<br />cut3d              000000000088A4F7  Unknown               Unknown  Unknown<br />cut3d              0000000000833CA4  Unknown               Unknown  Unknown<br />cut3d              0000000000833AB6  Unknown               Unknown  Unknown<br />cut3d              00000000007BCC49  Unknown               Unknown  Unknown<br />cut3d              00000000007C27B0  Unknown               Unknown  Unknown<br />Unknown            00000036CB60F7E0  Unknown               Unknown  Unknown<br />libmpifort.so.12   00002B766B2CF597  Unknown               Unknown  Unknown<br />libmpi.so.12       00002B766B65AB94  Unknown               Unknown  Unknown<br />libmpi.so.12       00002B766B8DF3B6  Unknown               Unknown  Unknown<br />libmpi.so.12       00002B766B8DF0D2  Unknown               Unknown  Unknown<br />libmpifort.so.12   00002B766B27C559  Unknown               Unknown  Unknown<br />cut3d              0000000000701D29  Unknown               Unknown  Unknown<br />cut3d              00000000004722A9  Unknown               Unknown  Unknown<br />cut3d              000000000042C572  Unknown               Unknown  Unknown<br />cut3d              000000000040E7E2  Unknown               Unknown  Unknown<br />cut3d              000000000040D35E  Unknown               Unknown  Unknown<br />libc.so.6          00000036CB21ED5D  Unknown               Unknown  Unknown<br />cut3d              000000000040D1E9  Unknown               Unknown  Unknown<br />---<br /><br /><br />Any ideas?<br /><br />Thanks,<br />Boubacar</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: cut3d error when extracting wave functions from _WFK fil</h3>
				<div class="date">Posted: <strong>Tue May 16, 2017 9:00 am</strong></div>
				<div class="author">by <strong>gmatteo</strong></div>
				<div class="content">Can you try to set `ulimit -s unlimited` before running cut3d?<br /><br />If the error persists, change cut3d to enforce Fortran-IO (see patch below), recompile with `make` and rerun<br /><br />diff --git a/src/83_cut3d/m_cut3d.F90 b/src/83_cut3d/m_cut3d.F90<br />index 3004f171..81e67c84 100644<br />--- a/src/83_cut3d/m_cut3d.F90<br />+++ b/src/83_cut3d/m_cut3d.F90<br />@@ -1981,6 +1981,7 @@ subroutine cut3d_wffile(wfk_fname,ecut,exchn2n3d,istwfk,kpt,natom,nband,nkpt,npw<br /> !    FIXME<br /> !    nband depends on (kpt,spin)<br />      iomode = iomode_from_fname(wfk_fname)<br />+     iomode = IO_MODE_FORTRAN<br />      call wfk_open_read(Wfk,wfk_fname,formeig0,iomode,get_unit(),xmpi_comm_self)<br />      call wfk_read_band_block(Wfk,[1,nband(ckpt)],ckpt,csppol,xmpio_single,cg_k=cg_k,eig_k=eig_k,occ_k=occ_k)<br />      call wfk_close(Wfk)</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: cut3d error when extracting wave functions from _WFK fil</h3>
				<div class="date">Posted: <strong>Fri May 19, 2017 6:03 pm</strong></div>
				<div class="author">by <strong>boubacar</strong></div>
				<div class="content">Hi gmatteo,<br /><br />Thank you for your response.<br />It did not work with ulimit.<br /><br />I will see with the cluster administrator to apply the patch that you provided. I will be back to you with the feedback when done!<br /><br />Thanks,<br />Boubacar</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: cut3d error when extracting wave functions from _WFK fil</h3>
				<div class="date">Posted: <strong>Tue May 23, 2017 4:06 pm</strong></div>
				<div class="author">by <strong>boubacar</strong></div>
				<div class="content">Hi gmatteo,<br /><br />Your patch worked well !<br /><br />I managed to extract the wavefunctions from *_WFK file using cut3d of abinit8.2.2.<br />Thank you for your responses !<br /><br />Best regards,<br />Boubacar</div>
			</div>
			<hr />
			</div>

	<div id="page-footer" class="page-footer">
		<div class="page-number">All times are <span title="Europe/Brussels">UTC+02:00</span><br />Page <strong>1</strong> of <strong>1</strong></div>
			<div class="copyright">
				<p>Powered by <a href="https://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Limited
				</p>
							</div>
	</div>
</div>

</body>

<!-- Mirrored from forum.abinit.org/viewtopic.php?f=12&t=3589&view=print by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 20 Sep 2024 21:03:24 GMT -->
</html>
