<!DOCTYPE html>
<html dir="ltr" lang="en-gb">

<!-- Mirrored from forum.abinit.org/viewtopic.php?f=3&t=3693&view=print by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 20 Sep 2024 23:19:12 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="robots" content="noindex" />

<title>ABINIT Discussion Forums &bull; Fortran could not compile .f90 files during 'make'</title>

<link href="styles/flat-style/theme/print.css" rel="stylesheet">
<link href="styles/flat-style/theme/bidi.css" rel="stylesheet">
</head>
<body id="phpbb" class="ltr">
<div id="wrap" class="wrap">
	<a id="top" class="top-anchor" accesskey="t"></a>

	<div id="page-header">
		<h1>ABINIT Discussion Forums</h1>
		<p>The meeting place for ABINIT users and developers<br /><a href="index.html">https://forum.abinit.org/</a></p>

		<h2>Fortran could not compile .f90 files during 'make'</h2>
		<p><a href="viewtopic7fd3.html?f=3&amp;t=3693">https://forum.abinit.org/viewtopic.php?f=3&amp;t=3693</a></p>
	</div>

	<div id="page-body" class="page-body">
		<div class="page-number">Page <strong>1</strong> of <strong>1</strong></div>
					<div class="post">
				<h3>Fortran could not compile .f90 files during 'make'</h3>
				<div class="date">Posted: <strong>Fri Oct 06, 2017 12:43 am</strong></div>
				<div class="author">by <strong>kaelynf</strong></div>
				<div class="content">Hi all,<br /><br />I am attempting to install the latest version of ABINIT (8.4.4).  After successfully linking the mkl libraries and configuring abinit, I run into an error during the 'make' procedure:<br /><br />checking whether we are using the GNU C compiler... (cached) yes<br />checking whether gcc -m64 accepts -g... (cached) yes<br />checking for gcc -m64 option to accept ISO C89... (cached) none needed<br />checking whether gcc -m64 understands -c and -o together... (cached) yes<br />checking dependency style of gcc -m64... (cached) gcc3<br />checking for inline... inline<br />checking for ANSI C header files... (cached) yes<br />checking for size_t... yes<br />checking for working alloca.h... yes<br />checking for alloca... yes<br />checking size of void*... 8<br />checking for sqrtf in -lm... yes<br />checking for cbrt in -lm... yes<br />checking for cbrtf in -lm... yes<br />checking for feenableexcept in -lm... yes<br />checking whether we are using the GNU Fortran compiler... no<br />checking whether ifort accepts -g... yes<br />checking if libtool supports shared libraries... yes<br />checking whether to build shared libraries... no<br />checking whether to build static libraries... yes<br />libtool.m4: error: problem compiling FC test program<br />checking for ifort option to produce PIC... -fPIC<br />checking if ifort PIC flag -fPIC works... no<br />checking if ifort static flag -static works... no<br />checking if ifort supports -c -o file.o... no<br />checking if ifort supports -c -o file.o... (cached) no<br />checking whether the ifort linker (/usr/x86_64-suse-linux/bin/ld -m elf_x86_64) supports shared libraries... yes<br />checking dynamic linker characteristics... (cached) GNU/Linux ld.so<br />checking how to hardcode library paths into programs... immediate<br /><strong class="text-strong">checking for Fortran flag to compile .f90 files... unknown<br />configure: error: Fortran could not compile .f90 files</strong><br />Makefile:766: recipe for target 'stamps/libxc-config-stamp' failed<br />make[3]: *** [stamps/libxc-config-stamp] Error 1<br />make[3]: Leaving directory '/home/ferris/ABINIT-8.4.4/abinit-8.4.4/fallbacks'<br />Makefile:731: recipe for target 'all-local' failed<br />make[2]: [all-local] Error 2 (ignored)<br />Checking build of libxc fallback<br />test -e stamps/libxc-install-stamp<br />Makefile:731: recipe for target 'all-local' failed<br />make[2]: *** [all-local] Error 1<br />make[2]: Leaving directory '/home/ferris/ABINIT-8.4.4/abinit-8.4.4/fallbacks'<br />Makefile:2457: recipe for target 'all-recursive' failed<br />make[1]: *** [all-recursive] Error 1<br />make[1]: Leaving directory '/home/ferris/ABINIT-8.4.4/abinit-8.4.4'<br />Makefile:2385: recipe for target 'all' failed<br />make: *** [all] Error 2<br /><br />Currently I have the following flags in my configuration file<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>enable_64bit_flags=&quot;yes&quot;<br />enable_debug=&quot;verbose&quot;<br />enable_optim=&quot;safe&quot;<br />prefix=&quot;${HOME}/ABINIT&quot;<br />enable_mpi=&quot;no&quot;<br />with_fft_flavor=&quot;fftw3&quot;<br />with_fft_incs=&quot;-I/opt/intel/composer_xe_2015.0.090/mkl/include -I/opt/intel/composer_xe_2015.0.090/mkl/include/fftw&quot;<br />with_fft_libs=&quot;-L/opt/intel/composer_xe_2015.0.090/mkl/lib/intel64 -Wl,--start-group -lmkl_blas95_ilp64 -lmkl_lapack95_ilp64 -lmkl_intel_ilp64 -lmkl_sequential -lmkl_core -Wl,--end-group -lpthread&quot;<br />with_linalg_flavor=&quot;mkl&quot;<br />with_linalg_incs=&quot;-I/opt/intel/composer_xe_2015.0.090/mkl/include -I/opt/intel/composer_xe_2015.0.090/mkl/include/intel64/ilp64&quot;<br />with_linalg_libs=&quot;-L/opt/intel/composer_xe_2015.0.090/mkl/lib/intel64/ -Wl,--start-group -lmkl_intel_ilp64 -lmkl_sequential -lmkl_core -Wl,--end-group -lpthread&quot;<br />with_dft_flavor=&quot;libxc-fallback&quot;<br /></code></pre></div><br /><br />Additionally you may find the config.log file attached.<br /><br />Any help would be greatly appreciated.<br /><br />Kind Regards,<br />Kaelyn Ferris</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Fortran could not compile .f90 files during 'make'</h3>
				<div class="date">Posted: <strong>Fri Oct 13, 2017 7:19 pm</strong></div>
				<div class="author">by <strong>kaelynf</strong></div>
				<div class="content">After some time debugging I have been able to determine what the issue was (however a new one has arisen).  The problem I was running into was that I was not setting the environment variables the configuration and make scripts need to run.  To accomplish this I sourced the intel compiler scripts <em class="text-italics">compilervars</em>, <em class="text-italics">compilervars_arch</em>, and <em class="text-italics">mklvars</em>.  With these environment variables set, I am able to successfully build abinit using the fallback linear algebra and fft libraries.<br /><br />The new problem I am running into is that when I try to link my linear algebra and fft libraries (Intel's mkl libraries and fft wrappers), I can run the makefile successfully, but  I run into numerous SEGFAULT errors when running <em class="text-italics">make check</em>.<br /><br />As a possible solution to this, I ensured the optimization level was set to &quot;safe&quot;, but when I ran the <em class="text-italics">make</em> script, there is a flag set by FCFLAGS which my compiler does not like, <em class="text-italics">-fp-model precise</em>, which I find odd seeing as I was able to find it within intel's documentation of ifort.<br /><br />Some helpful information:  I am using the ifort 15.0 compiler and my config-file options can be found below.<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>enable_64bit_flags=&quot;yes&quot;<br />prefix=&quot;${HOME}/ABINIT-MKL-FFT&quot;<br />CC=&quot;icc&quot;<br />CXX=&quot;icc&quot;<br />FC=&quot;ifort&quot;<br />enable_mpi=&quot;no&quot;<br />with_timer_flavor=&quot;none&quot;<br />with_trio_flavor=&quot;none&quot;<br />with_fft_flavor=&quot;fftw3&quot;<br />with_fft_incs=&quot;-I/opt/intel/composer_xe_2015.0.090/mkl/include -I/opt/intel/composer_xe_2015.0.090/mkl/include/fftw&quot;<br />with_fft_libs=&quot;-L/opt/intel/composer_xe_2015.0.090/mkl/lib/intel64 -Wl,--start-group -lmkl_blas95_ilp64 -lmkl_lapack95_ilp64 -lmkl_intel_ilp64 -lmkl_sequential -lmkl_core -Wl,--end-group -lpthread&quot;<br />with_linalg_flavor=&quot;mkl&quot;<br />with_linalg_incs=&quot;-I/opt/intel/composer_xe_2015.0.090/mkl/include -I/opt/intel/composer_xe_2015.0.090/mkl/include/intel64/ilp64&quot;<br />with_linalg_libs=&quot;-L/opt/intel/composer_xe_2015.0.090/mkl/lib/intel64/ -Wl,--start-group -lmkl_intel_ilp64 -lmkl_sequential -lmkl_core -Wl,--end-group -lpthread&quot;<br />with_dft_flavor=&quot;libxc&quot;<br />with_libxc_incs=&quot;-I/home/ferris/local/libxc/include/&quot;<br />with_libxc_libs=&quot;-L/home/ferris/local/libxc/lib64 -lxcf90 -lxc&quot;<br /></code></pre></div><br /><br />Cheers,<br />Kaelyn</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Fortran could not compile .f90 files during 'make'&nbsp;&nbsp;<span style="color: #006600">[SOLVED]</span></h3>
				<div class="date">Posted: <strong>Mon Oct 16, 2017 8:10 pm</strong></div>
				<div class="author">by <strong>kaelynf</strong></div>
				<div class="content">A solution has been found!  I will explain what I did in the hopes that it may help someone in the future running into a similar issue.<br /><br />The reason for the spurious SEGFAULT errors was that I was using the ilp64 version of the mkl and fft libraries which assumes the 64-bit integer type.  However, the Fortran compiler assumes a 32-bit integer type by default which I realized after being inspired by this thread: <a href="viewtopic3593.html?f=2&amp;t=3259" class="postlink">https://forum.abinit.org/viewtopic.php?f=2&amp;t=3259</a>.<br /><br />The fix was straightforward, I simply changed the libraries to link and include to lp64 version rather than the ilp64 version.<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>with_fft_incs=&quot;-I/opt/intel/composer_xe_2015.0.090/mkl/include -I/opt/intel/composer_xe_2015.0.090/mkl/include/fftw&quot;<br />with_fft_libs=&quot;-L/opt/intel/composer_xe_2015.0.090/mkl/lib/intel64 -Wl,--start-group -lmkl_blas95_ilp64 -lmkl_lapack95_lp64 -lmkl_intel_lp64 -lmkl_sequential -lmkl_core -Wl,--end-group -lpthread&quot;<br />with_linalg_flavor=&quot;mkl&quot;<br />with_linalg_incs=&quot;-I/opt/intel/composer_xe_2015.0.090/mkl/include -I/opt/intel/composer_xe_2015.0.090/mkl/include/intel64/lp64&quot;<br />with_linalg_libs=&quot;-L/opt/intel/composer_xe_2015.0.090/mkl/lib/intel64/ -Wl,--start-group -lmkl_blas95_ilp64 -lmkl_lapack95_lp64 -lmkl_intel_lp64 -lmkl_sequential -lmkl_core -Wl,--end-group -lpthread&quot;<br />with_dft_flavor=&quot;libxc&quot;</code></pre></div>.<br /><br />Additionally, I changed the sourcing arguments to set up my environment variables to<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>. $INTELROOT/bin/compilervars.sh intel64 mod lp64<br />. $INTELROOT/bin/compilervars_arch.sh intel64 mod lp64<br />. $MKLROOT/bin/mklvars.sh intel64 mod lp64<br /></code></pre></div><br />although I am unsure if the last argument in each line is completely necessary.<br /><br />Hopefully this proves helpful to future readers of this forum running into a similar problem.<br /><br />Cheers,<br />Kaelyn</div>
			</div>
			<hr />
			</div>

	<div id="page-footer" class="page-footer">
		<div class="page-number">All times are <span title="Europe/Brussels">UTC+02:00</span><br />Page <strong>1</strong> of <strong>1</strong></div>
			<div class="copyright">
				<p>Powered by <a href="https://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Limited
				</p>
							</div>
	</div>
</div>

</body>

<!-- Mirrored from forum.abinit.org/viewtopic.php?f=3&t=3693&view=print by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 20 Sep 2024 23:19:12 GMT -->
</html>
