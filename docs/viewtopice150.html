<!DOCTYPE html>
<html dir="ltr" lang="en-gb">

<!-- Mirrored from forum.abinit.org/viewtopic.php?f=12&t=2873&view=print by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 20 Sep 2024 21:05:22 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="robots" content="noindex" />

<title>ABINIT Discussion Forums &bull; can not use Cut3d</title>

<link href="styles/flat-style/theme/print.css" rel="stylesheet">
<link href="styles/flat-style/theme/bidi.css" rel="stylesheet">
</head>
<body id="phpbb" class="ltr">
<div id="wrap" class="wrap">
	<a id="top" class="top-anchor" accesskey="t"></a>

	<div id="page-header">
		<h1>ABINIT Discussion Forums</h1>
		<p>The meeting place for ABINIT users and developers<br /><a href="index.html">https://forum.abinit.org/</a></p>

		<h2>can not use Cut3d</h2>
		<p><a href="viewtopic7592.html?f=12&amp;t=2873">https://forum.abinit.org/viewtopic.php?f=12&amp;t=2873</a></p>
	</div>

	<div id="page-body" class="page-body">
		<div class="page-number">Page <strong>1</strong> of <strong>1</strong></div>
					<div class="post">
				<h3>can not use Cut3d</h3>
				<div class="date">Posted: <strong>Thu Dec 04, 2014 2:16 am</strong></div>
				<div class="author">by <strong>jiabo</strong></div>
				<div class="content">Dear every ABINIT user<br /><br />I got a really urgent problem that I can not use Cut3d on ARCHER (High performance computer centre in UK) to transfer my unformatted POT file into formatted one. According to what I have known, maybe the ABINIT on ARCHER is a paralleled version that leads me not to use it just typing 'cut3d', can anyone give me some instruction how to deal with this?<br /><br />The file is too big to upload, I would really appreciate if someone can do me a favour to try to transfer it for me, please leave me an email address so that I can send the file to you.<br /><br />Thank you <br /><br />Jiabo</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: can not use Cut3d</h3>
				<div class="date">Posted: <strong>Thu Dec 04, 2014 9:21 am</strong></div>
				<div class="author">by <strong>Jordan</strong></div>
				<div class="content">This will depend on you HPC. <br />If you compiled abinit with MPI and you administrator does not allow you to run a MPI program even in sequentiel on you login node then you have at least 2 possibilites :<br />1) submit a job and put all the things you would type on the keyboard in a file - let say cut3d.file - and run cut3d as<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>cut3d &lt; cut3d.file<br /></code></pre></div><br />2) recompile abinit (with no optimization not special features so the compilation is much faster) without mpi so you can use it on the login node.<br />3) export you POT file to you local machine and do the post processing on it.<br /><br />Jordan</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: can not use Cut3d</h3>
				<div class="date">Posted: <strong>Thu Dec 04, 2014 12:58 pm</strong></div>
				<div class="author">by <strong>jiabo</strong></div>
				<div class="content">Hi Jordan<br /><br />Thank you for your reply. I have tried the first method, it seems cut3d can be used, but still have something wrong. You can see the first and last few lines below, I do not know why it stopped after the first option.<br /><br />And there is a sequential version of ABINIT in my another account, but still not work.<br /><br />Jiabo<br /><br /> What is the name of the 3D function (density, potential or wavef) file ?<br />  =&gt; Your 3D function file is : Pt_xo_TIM3_POT<br /><br />  Does this file contain formatted 3D ASCII data (=0)<br />   or unformatted binary header + 3D data        (=1) ?<br />   or ETSF binary                                (=2) ?<br />  1 =&gt; Your file contains unformatted binary header + 3D data<br />  The information it contains should be sufficient.<br />  cut3d : read file Pt_xo_TIM3_POT from unit number 19.<br /><br /><br /> End the ECHO of the ABINIT file header<br /> ===============================================================================<br /><br /> ===========================================================<br /><br /> ECHO important input variables ...<br /><br />  Dimensional primitive vectors (ABINIT equivalent : rprimd):<br />    1.071097E+01    0.000000E+00    0.000000E+00<br />   -5.355484E+00    9.275970E+00    0.000000E+00<br />    3.233235E-15    5.600127E-15    5.280273E+01<br />  Grid density (ABINIT equivalent : ngfft):    54   54  270<br />  Number of atoms       :          16<br />  Number of atomic types:           1<br /><br />   #    Atomic positions (cartesian coordinates - Bohr)<br />   1   -1.100271E-19    6.376265E-04   -1.242070E-02<br />   2   -5.812424E-21   -9.984450E-04    1.313095E+01<br />   3    2.677742E+00    1.543855E+00    8.724622E+00<br />   4    4.700827E-17    3.094770E+00    4.393967E+00<br />   5    5.355484E+00    6.376265E-04   -1.242070E-02<br />   6    5.355484E+00   -9.984450E-04    1.313095E+01<br />   7    8.033226E+00    1.543855E+00    8.724622E+00<br />   8    5.355484E+00    3.094770E+00    4.393967E+00<br />   9   -2.677742E+00    4.638504E+00   -1.222914E-02<br />  10   -2.677742E+00    4.636737E+00    1.313073E+01<br />  11   -3.539525E-16    6.181875E+00    8.724572E+00<br />  12   -2.677742E+00    7.732728E+00    4.393732E+00<br />  13    2.677742E+00    4.638504E+00   -1.222914E-02<br />  14    2.677742E+00    4.636737E+00    1.313073E+01<br />  15    5.355484E+00    6.181875E+00    8.724572E+00<br />  16    2.677742E+00    7.732728E+00    4.393732E+00<br /><br />  This file is a Density or Potential file<br />Application 12134916 exit codes: 67<br />Application 12134916 resources: utime ~0s, stime ~0s, Rss ~6196, inblocks ~23845, outblocks ~52239</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: can not use Cut3d</h3>
				<div class="date">Posted: <strong>Tue Dec 09, 2014 10:18 am</strong></div>
				<div class="author">by <strong>Jordan</strong></div>
				<div class="content">Could you check that this is not a memory problem ? If your POT file is large enough and cut3d allocates lots of arrays it might crash the code.<br /><br />In addition, could you (again, sorry) recompile the whole abinit package without optimization and debug information with for instance :<br />FCFLAGS_EXTRA=&quot;-g -O0 -traceback&quot; for intel compiler or FCFLAGS_EXTRA=&quot;-g -O0 -fbacktrace&quot; for gfortran.<br />on your ./configure command line or in your *.ac file. Don't forget to make clean before make<br /><br />Jordan</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: can not use Cut3d</h3>
				<div class="date">Posted: <strong>Mon Feb 02, 2015 9:39 pm</strong></div>
				<div class="author">by <strong>JEJohns</strong></div>
				<div class="content">Hi Jordan,<br /><br />I see a similar behavior, but it seems to occur only when I'm handling a large file.  For example, I'm currently working on a surface with 147 atoms, and an ~18 x 18 x75 bohr hexagonal unit cell.  When I try and load the *POT file with cut3d, I get the same error as you jiabo.  When I then try and load it using a serial version of cut3d I get the following error: <br />&quot;At line 96 of rrho.F90 (unit=19, file='e:\DFT\Abinit7.4\MoS2_Fe_POT')<br />Fortran Runtime Error:  I/O past end of record on unformatted file&quot;<br /><br />So I don't think that it's the memory that is the question because it also loads the associate *DEN file just fine.<br />So I looked at rrho.F90, and the relevant section is below in bold.<br /><br />Line 96 of the rrho.F90 is bolded below.  <br /><blockquote class="uncited"><div>!  Formatted (only one spin component is allowed)<br />   case (0)<br />     do ir3=1,nr3<br />       do ir2=1,nr2<br />         do ir1=1,nr1<br />          read(unit=wff%unwff,fmt=*) grid_full(ir1,ir2,ir3,1)<br />         end do<br />       end do<br />     end do<br /><br />!    Unformatted, on one record<br />   case (1)<br />     do ispden=1,nspden<br />       <strong class="text-strong">read(unit=wff%unwff) grid_full(1:nr1,1:nr2,1:nr3,ispden)</strong><br />     end do<br />!    ETSF case<br />  </div></blockquote><br /><br /><br />That seems pretty straightforward.  Loop over the fft grid and number of spin densities and make a grid of V((nx,ny,nz,nspden)). It does this same routine for  both DEN &amp; POT types of files.  At this point, I realized that my POT file was roughly 1/2 the size of my DEN file.  This corresponds to the number of processors I'm parallelizing the FFT over. <br /> I did some tests on a dummy system (a GAN in a giant box, doesn't really matter), and the POT file always has the size of 1/npfft * DEN file. This means that if your system is large and you need to start paralleling over the fft grid, cut3d cannot read the POT files.  I'll look more into it since this came up previously in the threads back in 2010, but if anyone else wants to that would be a great help.  I'm an experimentalist any my Fortran is iffy at best.<br /><br />Cheers,<br />James</div>
			</div>
			<hr />
			</div>

	<div id="page-footer" class="page-footer">
		<div class="page-number">All times are <span title="Europe/Brussels">UTC+02:00</span><br />Page <strong>1</strong> of <strong>1</strong></div>
			<div class="copyright">
				<p>Powered by <a href="https://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Limited
				</p>
							</div>
	</div>
</div>

</body>

<!-- Mirrored from forum.abinit.org/viewtopic.php?f=12&t=2873&view=print by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 20 Sep 2024 21:05:22 GMT -->
</html>
