<!DOCTYPE html>
<html dir="ltr" lang="en-gb">

<!-- Mirrored from forum.abinit.org/viewtopic.php?f=3&t=2728&view=print by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 21 Sep 2024 01:00:29 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="robots" content="noindex" />

<title>ABINIT Discussion Forums &bull; Abinit +intel compilators wierd issue while opt geom</title>

<link href="styles/flat-style/theme/print.css" rel="stylesheet">
<link href="styles/flat-style/theme/bidi.css" rel="stylesheet">
</head>
<body id="phpbb" class="ltr">
<div id="wrap" class="wrap">
	<a id="top" class="top-anchor" accesskey="t"></a>

	<div id="page-header">
		<h1>ABINIT Discussion Forums</h1>
		<p>The meeting place for ABINIT users and developers<br /><a href="index.html">https://forum.abinit.org/</a></p>

		<h2>Abinit +intel compilators wierd issue while opt geom</h2>
		<p><a href="viewtopic50ec.html?f=3&amp;t=2728">https://forum.abinit.org/viewtopic.php?f=3&amp;t=2728</a></p>
	</div>

	<div id="page-body" class="page-body">
		<div class="page-number">Page <strong>1</strong> of <strong>1</strong></div>
					<div class="post">
				<h3>Abinit +intel compilators wierd issue while opt geom&nbsp;&nbsp;<span style="color: #006600">[SOLVED]</span></h3>
				<div class="date">Posted: <strong>Wed Jul 09, 2014 4:35 pm</strong></div>
				<div class="author">by <strong>roginovicci</strong></div>
				<div class="content">I have a vary strange situation. On the same machine (2 xenon e5-2340 processor based) I've compiled abinit 7.8.1 with both intel and gcc compilators. The configuration is as follows:<br />For intel (intel mpi used):<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>export FC=$MPICH/bin/mpiifort&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />export CC=$MPICH/bin/mpiicc&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />export CXX=$MPICH/bin/mpiicpc&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />./configure --prefix=/opt/abinit-$VER --enable-mpi --enable-mpi-io \&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp;--with-linalg-incs=&quot;-I$INTEL_COMP/mkl/include&quot; \&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp;--with-fft-flavor=&quot;fftw3-mkl&quot; --with-fft-incs=&quot;-I$INTEL_COMP/mkl/include/fftw&quot; \&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp;--with-fft-libs=&quot;-L$INTEL_COMP/mkl/lib/intel64 -lfftw3xf_intel&quot; \&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp;--with-linalg-flavor=&quot;mkl&quot; \&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp;--with-linalg-libs=&quot;-L$INTEL_COMP/mkl/lib/intel64&nbsp; -Wl,--start-group&nbsp; -lmkl_intel_lp64 -lmkl_intel_thread -lmkl_core -Wl,--end-group -liomp5 -lpthread -limf -lsvml -lirc&quot; \&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp;--with-linalg-incs=&quot;-I$INTEL_COMP/mkl/include&quot; \&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp;--with-dft-flavor=&quot;atompaw+bigdft+libxc+wannier90&quot; </code></pre></div><br />For gcc (mpich used):<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>./configure --prefix=/opt/abinit-$VER --with-mpich=$MPICH2 \&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp;--with-dft-flavor=&quot;atompaw+bigdft+libxc+wannier90&quot; </code></pre></div><br /><br />And while optimizing the structure with abinit compiled by intel compilators it fails at some step, while optimizing with gcc abinit it finishes smooth. Here is the input I have:<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>&nbsp;acell 5.88 5.88 57.1<br />&nbsp; &nbsp;angdeg 90.000&nbsp; 90.000 120.000<br /><br />rprim sqrt(0.75)&nbsp; 0.5&nbsp; 0.0<br />&nbsp; &nbsp; &nbsp;-sqrt(0.75)&nbsp; 0.5&nbsp; 0.0&nbsp; &nbsp;<br />&nbsp; &nbsp; &nbsp; 0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.0&nbsp; 1.0&nbsp; &nbsp;<br />&nbsp; &nbsp;ntypat 3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp;znucl 31 7 13&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp;natom 24&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp;typat 1 2 1 2 1 2 1 2 1 2 3 2 3 2 3 2 3 2 3 2 3 2 3 2&nbsp; &nbsp; &nbsp; <br />xred&nbsp; &nbsp; <br />1/3&nbsp; &nbsp;2/3&nbsp; &nbsp; &nbsp;0.0000000000<br />1/3&nbsp; &nbsp;2/3&nbsp; &nbsp; &nbsp;0.0637500000<br />2/3&nbsp; &nbsp;1/3&nbsp; &nbsp; &nbsp;0.0841584158<br />2/3&nbsp; &nbsp;1/3&nbsp; &nbsp; &nbsp;0.1479084158<br />1/3&nbsp; &nbsp;2/3&nbsp; &nbsp; &nbsp;0.1683168317<br />1/3&nbsp; &nbsp;2/3&nbsp; &nbsp; &nbsp;0.2320668317<br />2/3&nbsp; &nbsp;1/3&nbsp; &nbsp; &nbsp;0.2524752475<br />2/3&nbsp; &nbsp;1/3&nbsp; &nbsp; &nbsp;0.3162252475<br />1/3&nbsp; &nbsp;2/3&nbsp; &nbsp; &nbsp;0.3366336634<br />1/3&nbsp; &nbsp;2/3&nbsp; &nbsp; &nbsp;0.4003836634<br />2/3&nbsp; &nbsp;1/3&nbsp; &nbsp; &nbsp;0.4207920792<br />2/3&nbsp; &nbsp;1/3&nbsp; &nbsp; &nbsp;0.4845420792<br />1/3&nbsp; &nbsp;2/3&nbsp; &nbsp; &nbsp;0.5049504950<br />1/3&nbsp; &nbsp;2/3&nbsp; &nbsp; &nbsp;0.5687004950<br />2/3&nbsp; &nbsp;1/3&nbsp; &nbsp; &nbsp;0.5923283505<br />2/3&nbsp; &nbsp;1/3&nbsp; &nbsp; &nbsp;0.6536028603<br />1/3&nbsp; &nbsp;2/3&nbsp; &nbsp; &nbsp;0.6732187925<br />1/3&nbsp; &nbsp;2/3&nbsp; &nbsp; &nbsp;0.7344933023<br />2/3&nbsp; &nbsp;1/3&nbsp; &nbsp; &nbsp;0.7541092345<br />2/3&nbsp; &nbsp;1/3&nbsp; &nbsp; &nbsp;0.8153837443<br />1/3&nbsp; &nbsp;2/3&nbsp; &nbsp; &nbsp;0.8349996764<br />1/3&nbsp; &nbsp;2/3&nbsp; &nbsp; &nbsp;0.8962741862<br />2/3&nbsp; &nbsp;1/3&nbsp; &nbsp; &nbsp;0.9158901184<br />2/3&nbsp; &nbsp;1/3&nbsp; &nbsp; &nbsp;0.9771646282<br /><br />&nbsp;ixc&nbsp; &nbsp; &nbsp; &nbsp;7&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # Teter XC functional<br />&nbsp; &nbsp;ecut&nbsp; &nbsp; &nbsp; 25&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # Kinetic energy cut-off (in Ha)<br />&nbsp; &nbsp;ecutsm&nbsp; &nbsp; 0.5<br />&nbsp; &nbsp;dilatmx&nbsp; &nbsp;1.25<br /><br /><br />&nbsp; &nbsp;kptopt&nbsp; &nbsp; 1<br /><br />&nbsp; &nbsp;ngkpt&nbsp; &nbsp; &nbsp;6 6 4<br />&nbsp; &nbsp;nshiftk&nbsp; &nbsp;1<br />&nbsp; &nbsp;shiftk&nbsp; &nbsp; 0.0 0.0 0.5<br /><br />&nbsp; &nbsp;iscf&nbsp; &nbsp; &nbsp; 5&nbsp; &nbsp; &nbsp; # Pulay mixing (default for norm-conserving PSP)<br />&nbsp; &nbsp;nstep&nbsp; &nbsp; &nbsp;150&nbsp; &nbsp; # Modify default<br /><br />&nbsp; &nbsp;ionmov 3<br />&nbsp; &nbsp;ntime 150<br /><br />&nbsp; &nbsp;toldff&nbsp; &nbsp; 1.0d-4<br />&nbsp; &nbsp;tolmxf&nbsp; &nbsp; 1.0d-3<br />optforces 1<br />&nbsp; optcell 0<br />use_gpu_cuda 0<br />AUTOPARAL=0<br /></code></pre></div><br /><br />ABINIT fails with warning<br /><blockquote class="uncited"><div> Potential-based CG line minimization not converged after13 restarts.                                                                                                  <br />    Action : read the eventual warnings about lack of convergence.                                                                                                        <br />    Some might be relevant. Otherwise, raise nband. Returning                                                                                                             <br />src_file: scfcge.F90                                                                                                                                                      <br />src_line: 375<br /></div></blockquote><br /><br />Moreover if I use abinit compiled with intel compilator on another machine (cluster) it whent smooth also. The optimization process goes absolutle the same way up to 4th step 5th step differs and the 6th fails.<br /><br />There is somthing different with reduced forces they all goes to zero in basis at the fifth (pre fails) step of optimisation.<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>Cartesian forces (fcart) &#91;Ha/bohr&#93;; max,rms= 9.03107E-03 2.51165E-03 (free atoms)<br />&nbsp; 0.00000000000000E+00&nbsp; 0.00000000000000E+00&nbsp; 1.54667733343065E-03<br />&nbsp; 0.00000000000000E+00&nbsp; 0.00000000000000E+00 -2.06600109156256E-03<br />&nbsp; 0.00000000000000E+00&nbsp; 0.00000000000000E+00 -9.83194404385286E-04<br />&nbsp; 0.00000000000000E+00&nbsp; 0.00000000000000E+00 -4.16727320416967E-03<br />&nbsp; 0.00000000000000E+00&nbsp; 0.00000000000000E+00&nbsp; 1.68339746419727E-03<br />&nbsp; 0.00000000000000E+00&nbsp; 0.00000000000000E+00 -1.72370601891689E-03<br />&nbsp; 0.00000000000000E+00&nbsp; 0.00000000000000E+00&nbsp; 5.67865482140431E-03<br />&nbsp; 0.00000000000000E+00&nbsp; 0.00000000000000E+00&nbsp; 4.59214632078102E-03<br />&nbsp; 0.00000000000000E+00&nbsp; 0.00000000000000E+00&nbsp; 4.48469221935451E-03<br />&nbsp; 0.00000000000000E+00&nbsp; 0.00000000000000E+00 -1.97601745013876E-03<br />&nbsp; 0.00000000000000E+00&nbsp; 0.00000000000000E+00&nbsp; 8.04770880797129E-03<br />&nbsp; 0.00000000000000E+00&nbsp; 0.00000000000000E+00&nbsp; 6.86837849770853E-03<br />&nbsp; 0.00000000000000E+00&nbsp; 0.00000000000000E+00 -1.29830590065030E-03<br />&nbsp; 0.00000000000000E+00&nbsp; 0.00000000000000E+00 -9.03107255582250E-03<br />&nbsp; 0.00000000000000E+00&nbsp; 0.00000000000000E+00&nbsp; 8.13504889824362E-03<br />&nbsp; 0.00000000000000E+00&nbsp; 0.00000000000000E+00 -2.12193114733188E-03<br />&nbsp; 0.00000000000000E+00&nbsp; 0.00000000000000E+00 -5.56983517030434E-03<br />&nbsp; 0.00000000000000E+00&nbsp; 0.00000000000000E+00 -4.53171312473877E-03<br />&nbsp; 0.00000000000000E+00&nbsp; 0.00000000000000E+00&nbsp; 5.62000940042989E-04<br />&nbsp; 0.00000000000000E+00&nbsp; 0.00000000000000E+00 -1.60093617041179E-03<br />&nbsp; 0.00000000000000E+00&nbsp; 0.00000000000000E+00&nbsp; 9.81585503490430E-04<br />&nbsp; 0.00000000000000E+00&nbsp; 0.00000000000000E+00 -2.38942398773797E-03<br />&nbsp; 0.00000000000000E+00&nbsp; 0.00000000000000E+00 -8.33702492019031E-04<br />&nbsp; 0.00000000000000E+00&nbsp; 0.00000000000000E+00 -4.28717808843490E-03<br /></code></pre></div><br />While in previous step its of order -4.30318458033374E-33<br /><br />Maybe there is somekind of precision issure? Is there paramiter I should pass to intel compilator to rise precision of calculations.<br /><br />In cluster (Xeon Processor X5550) where abinit compiled by intel the compilator set is 2013 upd 1. I was trying the set in my machine (Xenon E5-2340) to compile good abinit binary with no succes, but I can use the binary compiled in cluster on my E5-2340 based computer with full success. I've tried to use mpich and openmpi with no success also. Maybe I should add some additional flags to intel compilator?</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Abinit +intel compilators wierd issue while opt geom</h3>
				<div class="date">Posted: <strong>Thu Jul 10, 2014 12:45 pm</strong></div>
				<div class="author">by <strong>jbeuken</strong></div>
				<div class="content">Hi,<br /><br />which version of ifort ?<br /><br />here , a part of my configure working with ifort 13.1.3 ( without parallel MKL ) :<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>--with-fft-flavor=&quot;fftw3&quot;&nbsp; \<br />--with-fft-libs=&quot;-L/opt/intel/mkl/lib/intel64 -Wl,--start-group&nbsp; -lmkl_intel_lp64 -lmkl_sequential -lmkl_core -Wl,--end-group&quot;&nbsp; \<br />--with-linalg-flavor=&quot;mkl&quot;&nbsp; \<br />--with-linalg-libs=&quot;-L/opt/intel/mkl/lib/intel64 -Wl,--start-group&nbsp; -lmkl_intel_lp64 -lmkl_sequential -lmkl_core -Wl,--end-group&quot;&nbsp; \<br /></code></pre></div><br /><br />can you try this ?<br /><br />regards<br /><br />jmb</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Abinit +intel compilators wierd issue while opt geom</h3>
				<div class="date">Posted: <strong>Thu Jul 10, 2014 3:53 pm</strong></div>
				<div class="author">by <strong>roginovicci</strong></div>
				<div class="content">I've tried 13.0.1 (2013 update 1) and 14.1.3 (sp1 upd3) and 14.0.1 I suppose. It all does not seems to be a compilator version issue. But the issue of platform I am using to compile the code. Yesterday I have compiled the code on the same distro (centos 6.5) with the same intel compilator on my home slow machine based on  pentium G2120 processor. Compilation was smooth and the binary abinit file works just fine on my Xenon E5-2340 based machine. So I don't think my configure script is bad. It produces good binary compiled in other machine than Xenon E5-2340. It is very very strange. The distro is the same the compilators is the same also but compilation process makes different results for different CPU. Maybe I should reinstall OS to make sure it is not software problem, but I am not ready for that. There is a lot of setups I've already made. Thx in advance, anyway!<br /><br />p.s. While searching arround I have found my swap partition was not attached to system, reattach and start compilation procedure again. Not sure this is a problem (I have 16Gb of memory installed), but will try.<br />p.p.s. Forgot to say that I was trying to compile without mkl at all, using internal abinit math library. And tha same result here, it fails at fifth or sixth step.</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Abinit +intel compilators wierd issue while opt geom</h3>
				<div class="date">Posted: <strong>Thu Jul 10, 2014 7:34 pm</strong></div>
				<div class="author">by <strong>Jordan</strong></div>
				<div class="content">The intel compiler for intel cpu can cause some issues with advance intel cpu features (sse/avx) <br />I have recently experienced this kind of problem with the latest abinit with intel14 on avx and avx2 cpus.<br /><br />Can you try to compile abinit on your faulty system with absolutly no optimization at all and no &quot;cpu dependant&quot; features (check there is no -march or -mtune option when compiling)?<br /><br />In addition to that, if you have exactly the same OS and libraries (and same directories tree) you can try to run abinit compiled for your PC on the E5 (assuming there no special instruction used by intel). <br /><br /><br />Jordan</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Abinit +intel compilators wierd issue while opt geom</h3>
				<div class="date">Posted: <strong>Fri Jul 11, 2014 1:10 am</strong></div>
				<div class="author">by <strong>roginovicci</strong></div>
				<div class="content"><blockquote><div><cite>Jordan wrote:</cite>The intel compiler for intel cpu can cause some issues with advance intel cpu features (sse/avx) <br />I have recently experienced this kind of problem with the latest abinit with intel14 on avx and avx2 cpus.<br /><br />Can you try to compile abinit on your faulty system with absolutly no optimization at all and no &quot;cpu dependant&quot; features (check there is no -march or -mtune option when compiling)?<br /></div></blockquote><br />Sure I can, but how? I do not add -march -mtune by myself. There is some script required (not strongly indeed) to run before compilation compilervars.sh, iccvars.sh and so on. Should I check them to figure out if the one adds -mtune?<br /><br /><blockquote><div><cite>Jordan wrote:</cite>In addition to that, if you have exactly the same OS and libraries (and same directories tree) you can try to run abinit compiled for your PC on the E5 (assuming there no special instruction used by intel). <br />Jordan</div></blockquote><br /><br />Well, I'am telling you, compiled binaries on pentium G2120 processor platforms works like a charm on E5. Actually there is no need in the same directry structure. The only dependence is glibc version. The other dependencies is intel one. And binaries from the other cluster with xenon X5670 work on E5-2630 just fine too. And that is really wierd.</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Abinit +intel compilators wierd issue while opt geom</h3>
				<div class="date">Posted: <strong>Fri Jul 11, 2014 5:23 pm</strong></div>
				<div class="author">by <strong>Jordan</strong></div>
				<div class="content"><blockquote><div><cite>roginovicci wrote:</cite>Sure I can, but how? I do not add -march -mtune by myself. There is some script required (not strongly indeed) to run before compilation compilervars.sh, iccvars.sh and so on. Should I check them to figure out if the one adds -mtune?<br /></div></blockquote><br />Juste be sure that in your configure file *.ac you have enable_optim=no or --enable-optim=&quot;no&quot; in your command line to disable any kind of optimization (testing purpose). At the end of the configuration you should read &quot;optimizations : no&quot; in the summary of important options.<br />During compilation you should see something that looks like<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>mpif90 -DHAVE_CONFIG -I. -I../-O0 -g&nbsp; file.F90 -c -o file.o<br /></code></pre></div><br /><br />If you do not see -O0 it means you use -O2 (default value) and thus ask for optimizations)<br /><br />For speed up compilation purpose, also remove the dft_flavors. Can you try to compile with both gcc and intel compilers using the mkl for linalg and fftw (I use fftw3 instead of fftw3-mkl even if I use the mkl implementation) ? (You might need to use --enable-zdot-bugfix for gcc+mkl if a segfault occures when running the code). <br />You will end with two identical abinits and NO optimizations. Compare both. If they behave the same, compile again removing the --enable-optim or set it to &quot;yes&quot; for both compilers. Compare the new version generated by gcc with the previous one and make sure they give the same result. Now compare with the new intel generated abinit. <br /><br />This is just to figure out where the problem is.<br /><br />If I'm not clear, let me not.<br /><br />Jordan</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Abinit +intel compilators wierd issue while opt geom</h3>
				<div class="date">Posted: <strong>Sat Jul 12, 2014 9:26 am</strong></div>
				<div class="author">by <strong>roginovicci</strong></div>
				<div class="content">It seems I should make my apologies to you. For some odd reason the one single symbol was lost in my script. And the one is dot. Thus my environment was not changed while compilation process. What I am saying is:<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>. ${INTEL_COMP}/bin/compilervars.sh intel64<br /></code></pre></div><br />Has transformed to<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>${INTEL_COMP}/bin/compilervars.sh intel64<br /></code></pre></div><br /><br />That is critical error for some xenon processors  in fact. Now I'm going to recompile abinit and recheck the functionality, I am pretty sure the problem would be set as solved.<br /><br /><br />But talking about optimization... Hmmm I really not sure lowering optimization is a good idea. It is probably better to increase optimization level to -O3 to produce more optimized code for the processor and increase precision or whatever. I'm not sure this is the case, just my thoughts. But here is some small question. Compiling abinit with higher optimization level -O3 fails at fallback step. Is it possible to configure abinit to use -O2 for fallbacks and -O3 for main abinit code?<br />And Thank to anyone in the thread for help!</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Abinit +intel compilators wierd issue while opt geom</h3>
				<div class="date">Posted: <strong>Sat Jul 12, 2014 7:55 pm</strong></div>
				<div class="author">by <strong>Jordan</strong></div>
				<div class="content">Hi<br /><br />Hope that the missing &quot;.&quot; solve your problem.<br />But if you were not sourcing the intel compiler, what compiler did you use ??? So I guess there was a conflict between compilation time and runtime dynamic libraries...<br /><br />Anyways.<br />Of course turning on optimizations is better for production, but it can be convenient for debugging purpose to turn them off.<br />So yes you can use -O3.<br />what fallback fails to compile with -O3 ?<br />You can use any of <br />fcflags_opt_algo=''<br />fcflags_opt_atompaw=''<br />fcflags_opt_bigdft=''<br />fcflags_opt_etsf_io=''<br />fcflags_opt_fox=''<br />fcflags_opt_libpspio=''<br />fcflags_opt_libxc=''<br />fcflags_opt_linalg=''<br />fcflags_opt_netcdf=''<br />fcflags_opt_wannier90=''<br />fcflags_opt_yaml=''<br /> to change the optimizations used for each fallback.<br /><br />Hope that helps.<br /><br />Jordan</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Abinit +intel compilators wierd issue while opt geom</h3>
				<div class="date">Posted: <strong>Sat Jul 12, 2014 9:45 pm</strong></div>
				<div class="author">by <strong>roginovicci</strong></div>
				<div class="content"><blockquote class="uncited"><div>But if you were not sourcing the intel compiler, what compiler did you use ??? So I guess there was a conflict between compilation time and runtime dynamic libraries...</div></blockquote><br />Using ldd command I have found the binary was linked to intel libraries only. no libgfortran in the list.<br /><br /><blockquote class="uncited"><div>what fallback fails to compile with -O3 ?</div></blockquote><br />atompow I suppose. Don't remember for sure. I've compiled abinit without fallbacks and with O3 optimization level. And started geomopt procedure to if there is a difference to O2 optimized binary.<br /><br /><blockquote class="uncited"><div>You can use any of<br />fcflags_opt_algo=''<br />fcflags_opt_atompaw=''<br /></div></blockquote><br />This is all lower case variables I should set with export? Smthg like:<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>export fcflags_opt_algo=''-fp-model precise -fp-model source -O2&quot;<br /><br />./configure --prefix=/opt/abintit ....</code></pre></div><br /><br /><br />UPD. I have compiled source code without fallbacks with -O3 optimization and found no difference with the code compiled with -O2 thus I dont see the reason to use -O3.  I've posted my configuration script in neighborhood topic, just in a case.</div>
			</div>
			<hr />
			</div>

	<div id="page-footer" class="page-footer">
		<div class="page-number">All times are <span title="Europe/Brussels">UTC+02:00</span><br />Page <strong>1</strong> of <strong>1</strong></div>
			<div class="copyright">
				<p>Powered by <a href="https://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Limited
				</p>
							</div>
	</div>
</div>

</body>

<!-- Mirrored from forum.abinit.org/viewtopic.php?f=3&t=2728&view=print by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 21 Sep 2024 01:00:29 GMT -->
</html>
