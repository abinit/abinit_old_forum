<!DOCTYPE html>
<html dir="ltr" lang="en-gb">

<!-- Mirrored from forum.abinit.org/viewtopic.php?p=5956 by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 20 Sep 2024 21:59:11 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1" />

<title>Bug in ncache assignment for MPI FFTs - ABINIT Discussion Forums</title>


	<link rel="canonical" href="viewtopic54f1.html?t=1886">

<!--
	phpBB style name: Flat Style
	Based on style:   prosilver (this is the default phpBB3 style)
	Original author:  Tom Beddard ( http://www.subBlue.com/ )
	Modified by:      Ian Bradley
-->

<link href="assets/css/font-awesome.minaea1.css?assets_version=57" rel="stylesheet">
<link href="styles/flat-style/theme/stylesheetaea1.css?assets_version=57" rel="stylesheet">
<link href="styles/flat-style/theme/en/stylesheetaea1.css?assets_version=57" rel="stylesheet">




<!--[if lte IE 9]>
	<link href="./styles/flat-style/theme/tweaks.css?assets_version=57" rel="stylesheet">
<![endif]-->

<meta name="google-site-verification" content="PLdTN48UENWHvJ5ViWhDTahZKzoMyw5e1QZgw1IECVw" />
<link rel="alternate" type="application/atom+xml" title="ATOM" href="app.php/smartfeed/feed.html" />
<link rel="alternate" type="application/rss+xml" title="RSS" href="app.php/smartfeed/feed9830.html?y=2" />

<link href="ext/crizzo/aboutus/styles/prosilver/theme/aboutusaea1.css?assets_version=57" rel="stylesheet" media="screen" />
<link href="ext/dmzx/topicageday/styles/prosilver/theme/topicagedayaea1.css?assets_version=57" rel="stylesheet" media="screen" />
<link href="ext/hifikabin/clock/styles/all/theme/clockaea1.css?assets_version=57" rel="stylesheet" media="screen" />
<link href="ext/hifikabin/googlesearch/styles/prosilver/theme/googlesearchaea1.css?assets_version=57" rel="stylesheet" media="screen" />
<link href="ext/kinerity/bestanswer/styles/prosilver/theme/bestansweraea1.css?assets_version=57" rel="stylesheet" media="screen" />
<link href="ext/phpbb/collapsiblecategories/styles/all/theme/collapsiblecategoriesaea1.css?assets_version=57" rel="stylesheet" media="screen" />
<link href="ext/phpbbservices/smartfeed/styles/prosilver/theme/customaea1.css?assets_version=57" rel="stylesheet" media="screen" />
<link href="ext/senky/userstatistics/styles/prosilver/theme/userstatisticsaea1.css?assets_version=57" rel="stylesheet" media="screen" />
<link href="ext/tierra/topicsolved/styles/prosilver/theme/buttonsaea1.css?assets_version=57" rel="stylesheet" media="screen" />



</head>
<body id="phpbb" class="nojs notouch section-viewtopic ltr ">


<div id="wrap" class="wrap">
	<a id="top" class="top-anchor" accesskey="t"></a>
	<div id="page-header">
		<div class="headerbar" role="banner">
					<div class="inner">

			<div id="site-description">
				<a id="logo" class="logo" href="index-2.html" title="Board index"><span class="site_logo"></span></a>
				<div  class="site-description">
					<h1>ABINIT Discussion Forums</h1>
					<p>The meeting place for ABINIT users and developers</p>
					<p class="skiplink"><a href="#start_here">Skip to content</a></p>
				</div>
			</div>

			</div>
					</div>
				<div class="navbar navbar-top" role="navigation">
	<div class="inner">

	<ul id="nav-main" class="nav-main linklist" role="menubar">

		<li id="quick-links" class="quick-links dropdown-container responsive-menu" data-skip-responsive="true">
			<a href="#" class="dropdown-trigger">
				<i class="icon fa-bars fa-fw" aria-hidden="true"></i><span>Quick links</span>
			</a>
			<div class="dropdown">
				<div class="pointer"><div class="pointer-inner"></div></div>
				<ul class="dropdown-contents" role="menu">
					
											<li class="separator"></li>
																									<li>
								<a href="search33a7.html?search_id=unanswered" role="menuitem">
									<i class="icon fa-file fa-fw" aria-hidden="true"></i><span>Unanswered topics</span>
								</a>
							</li>
							<li>
								<a href="search526f.html?search_id=active_topics" role="menuitem">
									<i class="icon fa-file fa-fw" aria-hidden="true"></i><span>Active topics</span>
								</a>
							</li>
							<li class="separator"></li>
							<li>
								<a href="search.html" role="menuitem">
									<i class="icon fa-search fa-fw" aria-hidden="true"></i><span>Search</span>
								</a>
							</li>
					
										
										<li class="separator"></li>

									</ul>
			</div>
		</li>

			<li class="small-icon icon-smartfeed no-bulletin"><a href="app.php/smartfeed/ui.html">Smartfeed</a></li>		<li data-skip-responsive="true">
			<a href="app.php/help/faq.html" rel="help" title="Frequently Asked Questions" role="menuitem">
				<i class="icon fa-question-circle fa-fw" aria-hidden="true"></i><span>FAQ</span>
			</a>
		</li>
								<li data-last-responsive="true">
				<a href="https://www.abinit.org/" title="" role="menuitem" target="_blank">
				<i class="icon fa-home fa-fw" aria-hidden="true"></i><span>Main Site</span>
				</a>
			</li>
								<li data-last-responsive="true">
				<a href="https://www.abinit.org/packages" title="" role="menuitem" target="_blank">
				<i class="icon fa-download fa-fw" aria-hidden="true"></i><span>Download</span>
				</a>
			</li>
								<li data-last-responsive="true">
				<a href="https://docs.abinit.org/" title="" role="menuitem" target="_blank">
				<i class="icon fa-book fa-fw" aria-hidden="true"></i><span>Documentations</span>
				</a>
			</li>
								<li data-last-responsive="true">
				<a href="https://docs.abinit.org/tutorial/" title="" role="menuitem" target="_blank">
				<i class="icon fa-graduation-cap fa-fw" aria-hidden="true"></i><span>Tutorials</span>
				</a>
			</li>
							
			<li class="rightside"  data-skip-responsive="true">
			<a href="ucp26c3.html?mode=login" title="Login" accesskey="x" role="menuitem">
				<i class="icon fa-power-off fa-fw" aria-hidden="true"></i><span>Login</span>
			</a>
		</li>
						</ul>
    </div>
</div>

<div class="navbar" role="navigation">
	<div class="inner">
	<ul id="nav-breadcrumbs" class="nav-breadcrumbs linklist navlinks" role="menubar">
								<li class="breadcrumbs" itemscope itemtype="http://schema.org/BreadcrumbList">
										<span class="crumb"  itemtype="http://schema.org/ListItem" itemprop="itemListElement" itemscope><a href="index-2.html" itemtype="https://schema.org/Thing" itemprop="item" accesskey="h" data-navbar-reference="index"><i class="icon fa-home fa-fw"></i><span itemprop="name">Board index</span></a><meta itemprop="position" content="1" /></span>
											<span class="crumb"  itemtype="http://schema.org/ListItem" itemprop="itemListElement" itemscope data-forum-id="5"><a href="viewforume774.html?f=5" itemtype="https://schema.org/Thing" itemprop="item"><span itemprop="name">Developing Abinit</span></a><meta itemprop="position" content="2" /></span>
															<span class="crumb"  itemtype="http://schema.org/ListItem" itemprop="itemListElement" itemscope data-forum-id="19"><a href="viewforum218b.html?f=19" itemtype="https://schema.org/Thing" itemprop="item"><span itemprop="name">Improving ABINIT</span></a><meta itemprop="position" content="3" /></span>
												</li>
		<li class="rightside responsive-hide">
	<div id="show-clock">
		<div id="liveclock" class="outer_face">
			<div class="marker oneseven"></div>
			<div class="marker twoeight"></div>
			<div class="marker fourten"></div>
			<div class="marker fiveeleven"></div>
			<div class="inner_face">
				<div class="hand hour"></div>
				<div class="hand minute"></div>
				<div class="hand second"></div>
			</div>
		</div>
	</div>
</li><!--[if !IE]><!-->
<li id="g-search-box" class="search-box rightside responsive-hide">
	<form action="https://forum.abinit.org/app.php/googlesearch">
	<fieldset>
		<input name="cx" type="hidden" value="017804512478788106347:tlftx8kncg4">
		<input name="q" type="search" maxlength="255" class="inputbox search tiny" value="" placeholder="Google Search ...">
		<button class="button button-search-google" type="submit" name="sitesearch" title="Google Search">
		<i class="icon fa-search fa-fw" aria-hidden="true"></i>
		</button>
	</fieldset>
</form>
</li>
<!--<![endif]-->

							<li id="search-box" class="rightside search-box responsive-hide" role="search">
				<form action="https://forum.abinit.org/search.php" method="get" id="search">
				<fieldset>
					<input name="keywords" id="keywords" type="search" maxlength="128" title="Search for keywords" class="inputbox search tiny" size="20" value="" placeholder="Search…" />
					<button class="button button-search" type="submit" title="Search">
						<i class="icon fa-search fa-fw" aria-hidden="true"></i><span class="sr-only">Search</span>
					</button>
					<a href="search.html" class="button button-search-end" title="Advanced search">
						<i class="icon fa-cog fa-fw" aria-hidden="true"></i><span class="sr-only">Advanced search</span>
					</a>
					
				</fieldset>
				</form>
			</li>

			<li class="rightside responsive-search">
				<a href="search.html" title="View the advanced search options" role="menuitem">
					<i class="icon fa-search fa-fw" aria-hidden="true"></i><span class="sr-only">Search</span>
				</a>
			</li>
					</ul>

	</div>
</div>
	</div>

	
	<a id="start_here" class="anchor"></a>
	<div id="page-body" class="page-body" role="main">
		
		﻿
<h2 class="topic-title"><a href="viewtopic44c9.html?f=19&amp;t=1886">Bug in ncache assignment for MPI FFTs</a>&nbsp;
<a href="viewtopica493.html?f=19&amp;t=1886&amp;p=7223#p7223" style="color: #006600;">
	[SOLVED]
</a>
</h2>
<!-- NOTE: remove the style="display: none" when you want to have the forum description on the topic body -->
<div style="display: none !important;">Documentation, Web site and code modifications<br /></div>
<p>
	<strong>Moderators:</strong> <a href="memberlist4183.html?mode=viewprofile&amp;u=1676" class="username">baguetl</a>, <a href="memberlistccd1.html?mode=viewprofile&amp;u=2257" class="username">routerov</a>
</p>


<div class="action-bar bar-top">
	
			<a href="posting70e0.html?mode=reply&amp;f=19&amp;t=1886" class="button" title="This topic is locked, you cannot edit posts or make further replies.">
							<span>Locked</span> <i class="icon fa-lock fa-fw" aria-hidden="true"></i>
					</a>
	
			<div class="dropdown-container dropdown-button-control topic-tools">
		<span title="Topic tools" class="button button-secondary dropdown-trigger dropdown-select">
			<i class="icon fa-wrench fa-fw" aria-hidden="true"></i>
			<span class="caret"><i class="icon fa-sort-down fa-fw" aria-hidden="true"></i></span>
		</span>
		<div class="dropdown">
			<div class="pointer"><div class="pointer-inner"></div></div>
			<ul class="dropdown-contents">
																												<li>
					<a href="viewtopic7bef.html?f=19&amp;t=1886&amp;view=print" title="Print view" accesskey="p">
						<i class="icon fa-print fa-fw" aria-hidden="true"></i><span>Print view</span>
					</a>
				</li>
											</ul>
		</div>
	</div>
	
			<div class="search-box" role="search">
			<form method="get" id="topic-search" action="https://forum.abinit.org/search.php">
			<fieldset>
				<input class="inputbox search tiny"  type="search" name="keywords" id="search_keywords" size="20" placeholder="Search this topic…" />
				<button class="button button-search" type="submit" title="Search">
					<i class="icon fa-search fa-fw" aria-hidden="true"></i><span class="sr-only">Search</span>
				</button>
				<a href="search.html" class="button button-search-end" title="Advanced search">
					<i class="icon fa-cog fa-fw" aria-hidden="true"></i><span class="sr-only">Advanced search</span>
				</a>
				<input type="hidden" name="t" value="1886" />
<input type="hidden" name="sf" value="msgonly" />

			</fieldset>
			</form>
		</div>
	
			<div class="pagination">
			4 posts
							&bull; Page <strong>1</strong> of <strong>1</strong>
					</div>
		</div>




			<div id="p5956" class="post has-profile bg2 offline">
		<div class="inner">

		<dl class="postprofile" id="profile5956">
			<dt class="no-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlistc6ea.html?mode=viewprofile&amp;u=1016" class="username">renatomiceli</a>							</dt>

									
		<dd class="profile-posts"><strong>Posts:</strong> <a href="searcha79c.html?author_id=1016&amp;sr=posts">10</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> Sat Jul 21, 2012 4:11 pm</dd>		
		
																<dd class="profile-custom-field profile-phpbb_location"><strong>Location:</strong> Salvador da Bahia, Brazil</dd>
							
							<dd class="profile-contact">
				<strong>Contact:</strong>
				<div class="dropdown-container dropdown-left">
					<a href="#" class="dropdown-trigger" title="Contact renatomiceli">
						<i class="icon fa-commenting-o fa-fw icon-lg" aria-hidden="true"></i><span class="sr-only">Contact renatomiceli</span>
					</a>
					<div class="dropdown">
						<div class="pointer"><div class="pointer-inner"></div></div>
						<div class="dropdown-contents contact-icons">
																																								<div>
																	<a href="http://renatomiceli.com/" title="Website" class="last-cell">
										<span class="contact-icon phpbb_website-icon">Website</span>
									</a>
																	</div>
																					</div>
					</div>
				</div>
			</dd>
				
		</dl>

		<div class="postbody">
						<div id="post_content5956">

						<h3 class="first"><a href="#p5956">Bug in ncache assignment for MPI FFTs</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting6a3c.html?mode=quote&amp;f=19&amp;p=5956" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author">
									<a class="unread" href="viewtopicdd4f.html?p=5956#p5956" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlistc6ea.html?mode=viewprofile&amp;u=1016" class="username">renatomiceli</a></strong> &raquo; </span>Mon Nov 19, 2012 6:46 pm
			</p>
			
			
			
			<div class="content">Hi all,<br /><br />one of our users here at the Irish Centre for High-End Computing ran into an error while running Abinit 6.12.3. The error message printed right before the execution stopped was as below:<br /><br /><blockquote class="uncited"><div>ncache has to be enlarged to be able to hold at<br />  least one 1-d FFT of each size even though this will<br />  reduce the performance for shorter transform lengths<br /></div></blockquote><br />I was able to successfully replicate his 'ncache' issue and then to trace it to the FFT routines within Abinit, contained in <strong class="text-strong">abinit-6.12.3/src/52_fft_mpi_noabirule</strong>. Variable 'ncache' defines the size of the working area for the FFT algorithm and leads to a program finalisation in case the work array is too small to even fit a single dimensional transform. The issue is that the value for 'ncache' is hardcoded in the code and the execution won't be able to proceed if any of the FFT dimensions exceed 1024, which is the scenario the user faced. The piece of code that caused the unexpected finalisation is the following:<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>&nbsp; &nbsp; &nbsp; &nbsp; ncache=4*1024<br />&nbsp; &nbsp; &nbsp; &nbsp; if (ncache/(4*max(n1,n2,n3)).lt.1) then<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; write(std_out,*) &amp;<br />&amp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ' ncache has to be enlarged to be able to hold at', &amp;<br />&amp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ' least one 1-d FFT of each size even though this will', &amp;<br />&amp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ' reduce the performance for shorter transform lengths'<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;stop<br />&nbsp; &nbsp; &nbsp; &nbsp; end if<br /></code></pre></div><br />In order to work around this issue I've managed to patch Abinit to allow for a variable work array for the FFT algorithm to be allocated. I replaced in files <strong class="text-strong">accrho.F90</strong>, <strong class="text-strong">applypot.F90</strong>, <strong class="text-strong">back.F90</strong>, <strong class="text-strong">back_wf.F90</strong>, <strong class="text-strong">forw.F90</strong> and <strong class="text-strong">forw_wf.F90</strong> all the assignments of 'ncache':<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>&nbsp; &nbsp; &nbsp; &nbsp; ncache=4*1024<br /></code></pre></div><br />By the following, in order to allow the working area for the FFT algorithm to fit at least a single dimensional transform:<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>&nbsp; &nbsp; &nbsp; &nbsp; ncache=4*max(n1,n2,n3,1024)<br /></code></pre></div><br />Where 'n1', 'n2' and 'n3' are the FFT dimensions.<br /><br />Now that Abinit 6.12.3 is patched, the code passed the check that was leading to the unexpected finalisation, the job finalised successfully and the results yielded were physically consistent.<br /><br />I appreciate if you can fix this bug in Abinit's main trunk.<br /><br />If you'd like to replicate the bug, I've published the test case scenario here:<br /><!-- m --><a class="postlink" href="http://www-staff.ichec.ie/~rmiceli/abinit/">http://www-staff.ichec.ie/~rmiceli/abinit/</a><!-- m --><br /><br />The Abinit 6.12.3 installation script I used is available here:<br /><!-- m --><a class="postlink" href="http://www-staff.ichec.ie/~rmiceli/abinit/ncache-bug/build-abinit-6.12.3.sh">http://www-staff.ichec.ie/~rmiceli/abin ... -6.12.3.sh</a><!-- m --><br /><br />The data sets, input files and PBS scripts are available here:<br /><!-- m --><a class="postlink" href="http://www-staff.ichec.ie/~rmiceli/abinit/ncache-bug/test-case/">http://www-staff.ichec.ie/~rmiceli/abin ... test-case/</a><!-- m --><br /><br />(where <strong class="text-strong">01-H.LDA.fhi</strong> and <strong class="text-strong">14-Si.LDA.fhi</strong> are the pseudopotentials; <strong class="text-strong">sislab.files</strong> and <strong class="text-strong">sislab.in</strong> are the input files; <strong class="text-strong">sislab.scr</strong> is the PBS script for job execution; and <strong class="text-strong">sislab.log</strong>, <strong class="text-strong">sislab.o1209327</strong>, <strong class="text-strong">sislab.out</strong>, <strong class="text-strong">sislab_STATUS</strong> and <strong class="text-strong">sislabo_OUT.nc</strong> are the output files after the execution unexpectedly terminates.)<br /><br />You can also find the patches for the source files at <strong class="text-strong">abinit-6.12.3/src/52_fft_mpi_noabirule</strong> here:<br /><!-- m --><a class="postlink" href="http://www-staff.ichec.ie/~rmiceli/abinit/ncache-bug/patches/">http://www-staff.ichec.ie/~rmiceli/abin ... g/patches/</a><!-- m --><br /><br />And here is the execution script already performing the patching, using 'sed':<br /><!-- m --><a class="postlink" href="http://www-staff.ichec.ie/~rmiceli/abinit/ncache-bug/build-abinit-6.12.3-patched.sh">http://www-staff.ichec.ie/~rmiceli/abin ... patched.sh</a><!-- m --><br /><br />Please let me know if you'd like any more inputs.<br />Thank you in advance for your time and patience.<br /><br />Kind regards,<br />Renato Miceli</div>
			
			
			
									
									<div id="sig5956" class="signature">Mr. Renato Miceli<br />Independent HPC &amp; Supercomputing Consultant<br /><!-- m --><a class="postlink" href="http://renatomiceli.com/">http://renatomiceli.com/</a><!-- m --></div>
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p6229" class="post has-profile bg1 offline">
		<div class="inner">

		<dl class="postprofile" id="profile6229">
			<dt class="no-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlistc6ea.html?mode=viewprofile&amp;u=1016" class="username">renatomiceli</a>							</dt>

									
		<dd class="profile-posts"><strong>Posts:</strong> <a href="searcha79c.html?author_id=1016&amp;sr=posts">10</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> Sat Jul 21, 2012 4:11 pm</dd>		
		
																<dd class="profile-custom-field profile-phpbb_location"><strong>Location:</strong> Salvador da Bahia, Brazil</dd>
							
							<dd class="profile-contact">
				<strong>Contact:</strong>
				<div class="dropdown-container dropdown-left">
					<a href="#" class="dropdown-trigger" title="Contact renatomiceli">
						<i class="icon fa-commenting-o fa-fw icon-lg" aria-hidden="true"></i><span class="sr-only">Contact renatomiceli</span>
					</a>
					<div class="dropdown">
						<div class="pointer"><div class="pointer-inner"></div></div>
						<div class="dropdown-contents contact-icons">
																																								<div>
																	<a href="http://renatomiceli.com/" title="Website" class="last-cell">
										<span class="contact-icon phpbb_website-icon">Website</span>
									</a>
																	</div>
																					</div>
					</div>
				</div>
			</dd>
				
		</dl>

		<div class="postbody">
						<div id="post_content6229">

						<h3 ><a href="#p6229">Re: Bug in ncache assignment for MPI FFTs</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting3338.html?mode=quote&amp;f=19&amp;p=6229" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author">
									<a class="unread" href="viewtopice470-2.html?p=6229#p6229" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlistc6ea.html?mode=viewprofile&amp;u=1016" class="username">renatomiceli</a></strong> &raquo; </span>Tue Jan 29, 2013 7:44 pm
			</p>
			
			
			
			<div class="content">Hi,<br /><br />just to update you that this reported bug remains in both versions 7.0.3 and 7.0.5 (the latest Abinit release). The error message has now changed to the following:<br /><blockquote class="uncited"><div> back.F90:120:ERROR<br />  ncache has to be enlarged to be able to hold at<br /> least one 1-d FFT of each size even though this will<br /> reduce the performance for shorter transform lengths<br />mpiexec_raw: Warning: tasks 0-143 exited with status 1.<br /></div></blockquote><br /><br />It now becomes even clearer that the bug lies within file <strong class="text-strong">back.F90</strong> at directory <strong class="text-strong">abinit-7.0.5/src/52_fft_mpi_noabirule/</strong>. The other 5 files that contain the same construct <em class="text-italics">ncache=4*1024</em> need to be patched as well.<br /><br />I appreciate if you can fix this bug in Abinit's main trunk.<br /><br />The test case scenario used to reach this error state is the same as before:<br /><!-- m --><a class="postlink" href="http://www-staff.ichec.ie/~rmiceli/abinit/ncache-bug-7.0.5/test-case/">http://www-staff.ichec.ie/~rmiceli/abin ... test-case/</a><!-- m --><br /><br />Its results with Abinit 7.0.5 are here:<br /><!-- m --><a class="postlink" href="http://www-staff.ichec.ie/~rmiceli/abinit/ncache-bug-7.0.5/test-case/unpatched/">http://www-staff.ichec.ie/~rmiceli/abin ... unpatched/</a><!-- m --><br /><br />The Abinit 7.0.5 installation script I used is available here:<br /><!-- m --><a class="postlink" href="http://www-staff.ichec.ie/~rmiceli/abinit/ncache-bug-7.0.5/build-abinit-7.0.5.sh">http://www-staff.ichec.ie/~rmiceli/abin ... t-7.0.5.sh</a><!-- m --><br /><br />The patches I propose to fix this bug are here:<br /><!-- m --><a class="postlink" href="http://www-staff.ichec.ie/~rmiceli/abinit/ncache-bug-7.0.5/patches/">http://www-staff.ichec.ie/~rmiceli/abin ... 5/patches/</a><!-- m --><br /><br />Or else, you could just sed the files, as I've done in the patched installation script here:<br /><!-- m --><a class="postlink" href="http://www-staff.ichec.ie/~rmiceli/abinit/ncache-bug-7.0.5/build-abinit-7.0.5-patched.sh">http://www-staff.ichec.ie/~rmiceli/abin ... patched.sh</a><!-- m --><br /><br />And the results are now properly computed, as you can see here:<br /><!-- m --><a class="postlink" href="http://www-staff.ichec.ie/~rmiceli/abinit/ncache-bug-7.0.5/test-case/patched/">http://www-staff.ichec.ie/~rmiceli/abin ... e/patched/</a><!-- m --><br /><br />Please let me know if you need my contribution for anything else. I will be happy to see this bug fixed at your earliest convenience.<br /><br />Kind regards,<br />Renato Miceli</div>
			
			
			
									
									<div id="sig6229" class="signature">Mr. Renato Miceli<br />Independent HPC &amp; Supercomputing Consultant<br /><!-- m --><a class="postlink" href="http://renatomiceli.com/">http://renatomiceli.com/</a><!-- m --></div>
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p7223" class="post has-profile bg2 offline">
		<div class="inner">

		<dl class="postprofile" id="profile7223">
			<dt class="no-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlist32d1.html?mode=viewprofile&amp;u=72" class="username">mverstra</a>							</dt>

									
		<dd class="profile-posts"><strong>Posts:</strong> <a href="search1bef.html?author_id=72&amp;sr=posts">655</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> Wed Aug 19, 2009 12:01 pm</dd>		
		
						
						
		</dl>

		<div class="postbody">
						<div id="post_content7223">

						<h3 ><a href="#p7223">Re: Bug in ncache assignment for MPI FFTs&nbsp;&nbsp;<span style="color: #006600">[SOLVED]</span></a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting1833.html?mode=quote&amp;f=19&amp;p=7223" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author">
									<a class="unread" href="viewtopicd9b9.html?p=7223#p7223" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlist32d1.html?mode=viewprofile&amp;u=72" class="username">mverstra</a></strong> &raquo; </span>Mon Sep 16, 2013 1:13 pm
			</p>
			
			
			
			<div class="content">Hi Renato,<br /><br />sorry about being so long in integrating this. It is now in my devel 7.5.3 branch and will be tested then released in abinit 7.6 shortly. I can send you a source tar.gz if you wish to try it now.<br /><br />PS: your reference and source files are not legible/downloadable. I did get the patch files, though.<br /><br />cheers, and many thanks for the contrib!<br /><br />Matthieu</div>
			
			
			
									
									<div id="sig7223" class="signature">Matthieu Verstraete<br />University of Liege, Belgium</div>
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p7592" class="post has-profile bg1 offline">
		<div class="inner">

		<dl class="postprofile" id="profile7592">
			<dt class="no-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlistc6ea.html?mode=viewprofile&amp;u=1016" class="username">renatomiceli</a>							</dt>

									
		<dd class="profile-posts"><strong>Posts:</strong> <a href="searcha79c.html?author_id=1016&amp;sr=posts">10</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> Sat Jul 21, 2012 4:11 pm</dd>		
		
																<dd class="profile-custom-field profile-phpbb_location"><strong>Location:</strong> Salvador da Bahia, Brazil</dd>
							
							<dd class="profile-contact">
				<strong>Contact:</strong>
				<div class="dropdown-container dropdown-left">
					<a href="#" class="dropdown-trigger" title="Contact renatomiceli">
						<i class="icon fa-commenting-o fa-fw icon-lg" aria-hidden="true"></i><span class="sr-only">Contact renatomiceli</span>
					</a>
					<div class="dropdown">
						<div class="pointer"><div class="pointer-inner"></div></div>
						<div class="dropdown-contents contact-icons">
																																								<div>
																	<a href="http://renatomiceli.com/" title="Website" class="last-cell">
										<span class="contact-icon phpbb_website-icon">Website</span>
									</a>
																	</div>
																					</div>
					</div>
				</div>
			</dd>
				
		</dl>

		<div class="postbody">
						<div id="post_content7592">

						<h3 ><a href="#p7592">Re: Bug in ncache assignment for MPI FFTs</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting8318.html?mode=quote&amp;f=19&amp;p=7592" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author">
									<a class="unread" href="viewtopicba52.html?p=7592#p7592" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlistc6ea.html?mode=viewprofile&amp;u=1016" class="username">renatomiceli</a></strong> &raquo; </span>Wed Jan 22, 2014 4:27 pm
			</p>
			
			
			
			<div class="content">Hi Matthieu,<br /><br />I just saw that my patches were applied to Abinit 7.6.1 released last week.<br />It was a pleasure to contribute to Abinit!<br /><br />Thanks again for patching the new release!<br /><br />Kind regards,<br />Renato Miceli</div>
			
			
			
									
									<div id="sig7592" class="signature">Mr. Renato Miceli<br />Independent HPC &amp; Supercomputing Consultant<br /><!-- m --><a class="postlink" href="http://renatomiceli.com/">http://renatomiceli.com/</a><!-- m --></div>
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
	

	<div class="action-bar bar-bottom">
	
			<a href="posting70e0.html?mode=reply&amp;f=19&amp;t=1886" class="button" title="This topic is locked, you cannot edit posts or make further replies.">
							<span>Locked</span> <i class="icon fa-lock fa-fw" aria-hidden="true"></i>
					</a>
		
		<div class="dropdown-container dropdown-button-control topic-tools">
		<span title="Topic tools" class="button button-secondary dropdown-trigger dropdown-select">
			<i class="icon fa-wrench fa-fw" aria-hidden="true"></i>
			<span class="caret"><i class="icon fa-sort-down fa-fw" aria-hidden="true"></i></span>
		</span>
		<div class="dropdown">
			<div class="pointer"><div class="pointer-inner"></div></div>
			<ul class="dropdown-contents">
																												<li>
					<a href="viewtopic7bef.html?f=19&amp;t=1886&amp;view=print" title="Print view" accesskey="p">
						<i class="icon fa-print fa-fw" aria-hidden="true"></i><span>Print view</span>
					</a>
				</li>
											</ul>
		</div>
	</div>

			<form method="post" action="https://forum.abinit.org/viewtopic.php?f=19&amp;t=1886">
		<div class="dropdown-container dropdown-container-left dropdown-button-control sort-tools">
	<span title="Display and sorting options" class="button button-secondary dropdown-trigger dropdown-select">
		<i class="icon fa-sort-amount-asc fa-fw" aria-hidden="true"></i>
		<span class="caret"><i class="icon fa-sort-down fa-fw" aria-hidden="true"></i></span>
	</span>
	<div class="dropdown hidden">
		<div class="pointer"><div class="pointer-inner"></div></div>
		<div class="dropdown-contents">
			<fieldset class="display-options">
							<label>Display: <select name="st" id="st"><option value="0" selected="selected">All posts</option><option value="1">1 day</option><option value="7">7 days</option><option value="14">2 weeks</option><option value="30">1 month</option><option value="90">3 months</option><option value="180">6 months</option><option value="365">1 year</option></select></label>
								<label>Sort by: <select name="sk" id="sk"><option value="a">Author</option><option value="t" selected="selected">Post time</option><option value="s">Subject</option></select></label>
				<label>Direction: <select name="sd" id="sd"><option value="a" selected="selected">Ascending</option><option value="d">Descending</option></select></label>
								<hr class="dashed" />
				<input type="submit" class="button2" name="sort" value="Go" />
						</fieldset>
		</div>
	</div>
</div>
		</form>
	
	
	
			<div class="pagination">
			4 posts
							&bull; Page <strong>1</strong> of <strong>1</strong>
					</div>
	</div>


<div class="action-bar actions-jump">
		<p class="jumpbox-return">
		<a href="viewforum218b.html?f=19" class="left-box arrow-left" accesskey="r">
			<i class="icon fa-angle-left fa-fw icon-black" aria-hidden="true"></i><span>Return to “Improving ABINIT”</span>
		</a>
	</p>
	
		<div class="jumpbox dropdown-container dropdown-container-right dropdown-up dropdown-left dropdown-button-control" id="jumpbox">
			<span title="Jump to" class="button button-secondary dropdown-trigger dropdown-select">
				<span>Jump to</span>
				<span class="caret"><i class="icon fa-sort-down fa-fw" aria-hidden="true"></i></span>
			</span>
		<div class="dropdown">
			<div class="pointer"><div class="pointer-inner"></div></div>
			<ul class="dropdown-contents">
																				<li><a href="viewforumffeb.html?f=20" class="jumpbox-forum-link"> <span> News &amp; Announcements</span></a></li>
																<li><a href="viewforum8011.html?f=23" class="jumpbox-forum-link"> <span> Jobs and Other Announcements</span></a></li>
																<li><a href="viewforum58da.html?f=1" class="jumpbox-cat-link"> <span> Building ABINIT</span></a></li>
																<li><a href="viewforum4d6b.html?f=3" class="jumpbox-sub-link"><span class="spacer"></span> <span>&#8627; &nbsp; Configuring and compiling ABINIT</span></a></li>
																<li><a href="viewforum31e6.html?f=4" class="jumpbox-cat-link"> <span> Running Abinit</span></a></li>
																<li><a href="viewforumfdc5.html?f=9" class="jumpbox-sub-link"><span class="spacer"></span> <span>&#8627; &nbsp; Ground state</span></a></li>
																<li><a href="viewforum15ca.html?f=10" class="jumpbox-sub-link"><span class="spacer"></span> <span>&#8627; &nbsp; Response calculations</span></a></li>
																<li><a href="viewforum8a83.html?f=11" class="jumpbox-sub-link"><span class="spacer"></span> <span>&#8627; &nbsp; Many-body perturbation theory</span></a></li>
																<li><a href="viewforum01c9.html?f=12" class="jumpbox-sub-link"><span class="spacer"></span> <span>&#8627; &nbsp; Other tools and postprocessing in ABINIT</span></a></li>
																<li><a href="viewforum345c.html?f=24" class="jumpbox-sub-link"><span class="spacer"></span> <span>&#8627; &nbsp; Python interfacing : Abipy ecosystem</span></a></li>
																<li><a href="viewforum9780.html?f=14" class="jumpbox-sub-link"><span class="spacer"></span> <span>&#8627; &nbsp; Link to other codes</span></a></li>
																<li><a href="viewforume774.html?f=5" class="jumpbox-cat-link"> <span> Developing Abinit</span></a></li>
																<li><a href="viewforum218b.html?f=19" class="jumpbox-sub-link"><span class="spacer"></span> <span>&#8627; &nbsp; Improving ABINIT</span></a></li>
											</ul>
		</div>
	</div>

	</div>


			</div>


<div id="page-footer" class="page-footer" role="contentinfo">
	<div class="navbar navbar-bottom" role="navigation">
	<div class="inner">

	<ul id="nav-footer" class="nav-footer linklist" role="menubar">
		<li class="breadcrumbs">
									<span class="crumb"><a href="index-2.html" data-navbar-reference="index"><i class="icon fa-home fa-fw" aria-hidden="true"></i><span>Board index</span></a></span>					</li>
		
				
							<li class="rightside">
				<a href="ucp033a.html?mode=delete_cookies" data-ajax="true" data-refresh="true" role="menuitem">
					<i class="icon fa-trash fa-fw" aria-hidden="true"></i><span>Delete cookies</span>
				</a>
			</li>
				
		<li class="rightside" data-last-responsive="true"><a href="app.php/aboutus.html" role="menuitem"><i class="icon fa-info-circle fa-fw" aria-hidden="true"></i><span>About us</span></a></li>			</ul>

	</div>
</div>

	<div class="copyright">
		<script type="text/javascript">
copyright=new Date();

update=copyright.getFullYear();

document.write("Copyright\u0020\u0026copy\u003B 2009 - "+ update +	" ABINIT Discussion Forums All\u0020rights\u0020reserved.");

</script>
<br /><br />		<p class="footer-row">
			<span class="footer-copyright">Flat Style by <a href="http://phpbbstyles.oo.gd/">Ian Bradley</a></span>
		</p>
        <p class="footer-row">
			<span class="footer-copyright">Powered by <a href="https://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Limited</span>
		</p>
						<p class="footer-row">
			<a class="footer-link" href="ucp4d86.html?mode=privacy" title="Privacy" role="menuitem">
				<span class="footer-link-text">Privacy</span>
			</a>
			|
			<a class="footer-link" href="ucp226b.html?mode=terms" title="Terms" role="menuitem">
				<span class="footer-link-text">Terms</span>
			</a>
		</p>
					</div>

	<div id="darkenwrapper" class="darkenwrapper" data-ajax-error-title="AJAX error" data-ajax-error-text="Something went wrong when processing your request." data-ajax-error-text-abort="User aborted request." data-ajax-error-text-timeout="Your request timed out; please try again." data-ajax-error-text-parsererror="Something went wrong with the request and the server returned an invalid reply.">
		<div id="darken" class="darken">&nbsp;</div>
	</div>

	<div id="phpbb_alert" class="phpbb_alert" data-l-err="Error" data-l-timeout-processing-req="Request timed out.">
		<a href="#" class="alert_close">
			<i class="icon fa-times-circle fa-fw" aria-hidden="true"></i>
		</a>
		<h3 class="alert_title">&nbsp;</h3><p class="alert_text"></p>
	</div>
	<div id="phpbb_confirm" class="phpbb_alert">
		<a href="#" class="alert_close">
			<i class="icon fa-times-circle fa-fw" aria-hidden="true"></i>
		</a>
		<div class="alert_text"></div>
	</div>
</div>

</div>

<div>
	<a id="bottom" class="anchor" accesskey="z"></a>
	</div>

<script src="assets/javascript/jquery.minaea1.js?assets_version=57"></script>
<script src="assets/javascript/coreaea1.js?assets_version=57"></script>



<script>
	(function() {
		var cx = '017804512478788106347\u003Atlftx8kncg4';
		var gcse = document.createElement('script');
		gcse.type = 'text/javascript';
		gcse.async = true;
		gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
			'//cse.google.com/cse.js?cx=' + cx;
		var s = document.getElementsByTagName('script')[0];
		s.parentNode.insertBefore(gcse, s);
	})();
</script>
<script type="text/javascript">
(function($) {  // Avoid conflicts with other libraries

'use strict';
	
	phpbb.addAjaxCallback('reporttosfs', function(data) {
		if (data.postid !== "undefined") {
			$('#sfs' + data.postid).hide();
			phpbb.closeDarkenWrapper(5000);
		}
	});

})(jQuery);
</script>
<script src="ext/hifikabin/clock/styles/all/template/js/js_clockaea1.js?assets_version=57"></script>
<script src="ext/phpbb/collapsiblecategories/styles/all/template/js/collapsiblecategoriesaea1.js?assets_version=57"></script>
<script src="styles/prosilver/template/forum_fnaea1.js?assets_version=57"></script>
<script src="styles/prosilver/template/ajaxaea1.js?assets_version=57"></script>



</body>

<!-- Mirrored from forum.abinit.org/viewtopic.php?p=5956 by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 20 Sep 2024 21:59:11 GMT -->
</html>
