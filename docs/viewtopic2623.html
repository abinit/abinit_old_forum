<!DOCTYPE html>
<html dir="ltr" lang="en-gb">

<!-- Mirrored from forum.abinit.org/viewtopic.php?f=14&t=21&view=print by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 20 Sep 2024 21:27:29 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="robots" content="noindex" />

<title>ABINIT Discussion Forums &bull; [SOLVED 6.0.4] how to link abinit to Vsim?</title>

<link href="styles/flat-style/theme/print.css" rel="stylesheet">
<link href="styles/flat-style/theme/bidi.css" rel="stylesheet">
</head>
<body id="phpbb" class="ltr">
<div id="wrap" class="wrap">
	<a id="top" class="top-anchor" accesskey="t"></a>

	<div id="page-header">
		<h1>ABINIT Discussion Forums</h1>
		<p>The meeting place for ABINIT users and developers<br /><a href="index.html">https://forum.abinit.org/</a></p>

		<h2>[SOLVED 6.0.4] how to link abinit to Vsim?</h2>
		<p><a href="viewtopic0d79.html?f=14&amp;t=21">https://forum.abinit.org/viewtopic.php?f=14&amp;t=21</a></p>
	</div>

	<div id="page-body" class="page-body">
		<div class="page-number">Page <strong>1</strong> of <strong>1</strong></div>
					<div class="post">
				<h3>[SOLVED 6.0.4] how to link abinit to Vsim?</h3>
				<div class="date">Posted: <strong>Mon Jan 04, 2010 10:50 am</strong></div>
				<div class="author">by <strong>hhwj340</strong></div>
				<div class="content">Hey, i  want to link abinit to Vsim.<br />i don't know how to do?<br />Can someone tell me how to do?<br />thanks!<br />                            hhwj340</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: how to link abinit to Vsim?</h3>
				<div class="date">Posted: <strong>Thu Feb 18, 2010 3:56 pm</strong></div>
				<div class="author">by <strong>dcaliste</strong></div>
				<div class="content">Hello,<br /><br />   Sorry for very late answering, I'm not reading the forum...<br /><br />   To have V_Sim reading ABINIT input file, you need:<br />- ABINIT 5.7.x and V_Sim 3.4.x, or ;<br />- ABINIT 5.8.x and V_Sim 3.5.x.<br /><br />   When you compile ABINIT, use --enable-bindings during configure stage. Depending on your compiler, you'll have also to change the #define in bindings/parser/ab6_invars_c.c. Using gfortran 4.2 is fine. For later versions or with ifort, FC_MOD_NAME need modifications.<br /><br />   Then, in this directory, you'll have a libabinis.a and some headers. A make install should put them in proper directory. For the example, let say that it puts the lib in $ABINIT/lib and the headers in $ABINIT/include.<br /><br />   In V_Sim now, during configure time, set --with-abinit=$ABINIT (same value than before). You should see at the end of configure that abinit option is indeed set to yes. If not, you'll have to look in the config.log to see what is wrong.<br /><br />   Don't hesitate to ask question here now, I've suscribe the RSS feed.</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: how to link abinit to Vsim?</h3>
				<div class="date">Posted: <strong>Wed Apr 07, 2010 12:19 pm</strong></div>
				<div class="author">by <strong>maurosgroi</strong></div>
				<div class="content">Dear dcaliste,<br />I followed your instructions with abinit 6.03 and v_sim 3.5.1 but the bindings seem to not work.<br />I get the following error in the config.log file of v_sim:<br /><br />configure:26695: gcc -o conftest -O2 -Wall -W -ansi -Wno-error   conftest.c  -L/opt/abinit-6.0.3/lib -labinis  -L/usr/lib/gcc/x86_64-linux-gnu/4.4.3 -L/usr/lib/gcc/x86_64-linux-gnu/4.4.3/../../../../lib -L/lib/../lib -L/usr/lib/../lib -L/usr/lib/gcc/x86_64-linux-gnu/4.4.3/../../.. -lgfortranbegin -lgfortran -lm &gt;&amp;5<br />conftest.c: In function 'main':<br />conftest.c:13: warning: implicit declaration of function 'ab6_invars_new_from_file'<br />conftest.c:11: warning: unused parameter 'argc'<br />conftest.c:11: warning: unused parameter 'argv'<br />/opt/abinit-6.0.3/lib/libabinis.a(ab6_invars_c.o): In function `ab6_invars_get_real_array':<br />/opt/src/abinit-6.0.3/bindings/parser/ab6_invars_c.c:126: undefined reference to `__ab6_invars__ab6_invars_get_real_array'<br />/opt/abinit-6.0.3/lib/libabinis.a(ab6_invars_c.o): In function `ab6_invars_get_integer_array':<br />/opt/src/abinit-6.0.3/bindings/parser/ab6_invars_c.c:117: undefined reference to `__ab6_invars__ab6_invars_get_integer_array'<br />/opt/abinit-6.0.3/lib/libabinis.a(ab6_invars_c.o): In function `ab6_invars_get_shape':<br />/opt/src/abinit-6.0.3/bindings/parser/ab6_invars_c.c:108: undefined reference to `__ab6_invars__ab6_invars_get_shape'<br />/opt/abinit-6.0.3/lib/libabinis.a(ab6_invars_c.o): In function `ab6_invars_get_real':<br />/opt/src/abinit-6.0.3/bindings/parser/ab6_invars_c.c:100: undefined reference to `__ab6_invars__ab6_invars_get_real'<br />/opt/abinit-6.0.3/lib/libabinis.a(ab6_invars_c.o): In function `ab6_invars_get_integer':<br />/opt/src/abinit-6.0.3/bindings/parser/ab6_invars_c.c:91: undefined reference to `__ab6_invars__ab6_invars_get_integer'<br />/opt/abinit-6.0.3/lib/libabinis.a(ab6_invars_c.o): In function `ab6_invars_get_ndtset':<br />/opt/src/abinit-6.0.3/bindings/parser/ab6_invars_c.c:82: undefined reference to `__ab6_invars__ab6_invars_get_ndtset'<br />/opt/abinit-6.0.3/lib/libabinis.a(ab6_invars_c.o): In function `ab6_invars_free':<br />/opt/src/abinit-6.0.3/bindings/parser/ab6_invars_c.c:74: undefined reference to `__ab6_invars__ab6_invars_free'<br />/opt/abinit-6.0.3/lib/libabinis.a(ab6_invars_c.o): In function `ab6_invars_new_from_string':<br />/opt/src/abinit-6.0.3/bindings/parser/ab6_invars_c.c:61: undefined reference to `__ab6_invars__ab6_invars_new_from_string'<br />/opt/abinit-6.0.3/lib/libabinis.a(ab6_invars_c.o): In function `ab6_invars_new_from_file':<br />/opt/src/abinit-6.0.3/bindings/parser/ab6_invars_c.c:44: undefined reference to `__ab6_invars__ab6_invars_new_from_file'<br />collect2: ld returned 1 exit status<br /><br />I get a similar undefined reference error trying to check the bindings in the parser directory with: make -f parser.mk check. <br />So I think that the problem could be related to abinit.<br />Thanks a lot in advance and best regards,<br />Mauro Sgroi.</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: how to link abinit to Vsim?</h3>
				<div class="date">Posted: <strong>Fri Apr 09, 2010 9:52 am</strong></div>
				<div class="author">by <strong>dcaliste</strong></div>
				<div class="content">Hello,<br /><br />   Thanks for giving the log informations.<br /><br /><blockquote><div><cite>maurosgroi wrote:</cite>/opt/abinit-6.0.3/lib/libabinis.a(ab6_invars_c.o): In function `ab6_invars_get_real_array':<br />/opt/src/abinit-6.0.3/bindings/parser/ab6_invars_c.c:126: undefined reference to `__ab6_invars__ab6_invars_get_real_array'<br /></div></blockquote><br /><br />   I guess that you're using a version of GFortran greater than 4.2. There is no official support currently in the Autotools for Fortran modules and we thus need to do it by hand in ABINIT. The current code in ABINIT has been written for Gfortran 4.2, but this compiler changed its naming scheme of modules between version 4.2 and 4.3. To solve this, edit the file $ABINIT/bindings/parser/ab6_invars_c.c line 8:<br />#define FC_MOD_NAME(M,A) __ ## M ## __ ## A<br />should become #define FC_MOD_NAME(M,A) __ ## M ## _MOD_ ## A<br />This can be done also in ab6_symmetry_c.c.<br />Then issue make again in the bindings/parser directory, and then a make install.<br /><br />   Try again the configure of V_Sim, it may work.</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: how to link abinit to Vsim?</h3>
				<div class="date">Posted: <strong>Fri Apr 09, 2010 1:55 pm</strong></div>
				<div class="author">by <strong>maurosgroi</strong></div>
				<div class="content"><blockquote><div><cite>dcaliste wrote:</cite>Hello,<br /><br />   Thanks for giving the log informations.<br /><br /><blockquote><div><cite>maurosgroi wrote:</cite>/opt/abinit-6.0.3/lib/libabinis.a(ab6_invars_c.o): In function `ab6_invars_get_real_array':<br />/opt/src/abinit-6.0.3/bindings/parser/ab6_invars_c.c:126: undefined reference to `__ab6_invars__ab6_invars_get_real_array'<br /></div></blockquote><br /><br />   I guess that you're using a version of GFortran greater than 4.2. There is no official support currently in the Autotools for Fortran modules and we thus need to do it by hand in ABINIT. The current code in ABINIT has been written for Gfortran 4.2, but this compiler changed its naming scheme of modules between version 4.2 and 4.3. To solve this, edit the file $ABINIT/bindings/parser/ab6_invars_c.c line 8:<br />#define FC_MOD_NAME(M,A) __ ## M ## __ ## A<br />should become #define FC_MOD_NAME(M,A) __ ## M ## _MOD_ ## A<br />This can be done also in ab6_symmetry_c.c.<br />Then issue make again in the bindings/parser directory, and then a make install.<br /><br />   Try again the configure of V_Sim, it may work.</div></blockquote><br /><br />Dear dcaliste,<br />thanks a lot for the information.<br />Now v_sim configures and compiles apparently well. <br />But when I execute it I get:<br /><br />** (v_sim:24149): WARNING **: The plugin '/opt/v_sim-3.5.1/lib/v_sim/plug-ins/libabinit.so' is not a loadable module, error:<br />/opt/v_sim-3.5.1/lib/v_sim/plug-ins/libabinit.so: undefined symbol: __ab6_invars_MOD_ab6_invars_get_real_array.<br /><br />** (v_sim:24149): WARNING **: failure loading plugin '/opt/v_sim-3.5.1/lib/v_sim/plug-ins/libabinit.so'!<br /><br />It seems that some symbols are not exported well in libabinit.so. <br />Doing nm on it:<br /><br />nm libabinit.so | grep  __ab6_invars_MOD_ab6_invars_get_real_array<br /><br />I get:<br />                 U __ab6_invars_MOD_ab6_invars_get_real_array<br /><br />Thanks a lot in advance and best regards,<br />Mauro.</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: how to link abinit to Vsim?</h3>
				<div class="date">Posted: <strong>Fri Apr 09, 2010 5:26 pm</strong></div>
				<div class="author">by <strong>dcaliste</strong></div>
				<div class="content">Hello,<br /><br /><blockquote><div><cite>maurosgroi wrote:</cite>** (v_sim:24149): WARNING **: The plugin '/opt/v_sim-3.5.1/lib/v_sim/plug-ins/libabinit.so' is not a loadable module, error:<br />/opt/v_sim-3.5.1/lib/v_sim/plug-ins/libabinit.so: undefined symbol: __ab6_invars_MOD_ab6_invars_get_real_array.<br />nm libabinit.so | grep  __ab6_invars_MOD_ab6_invars_get_real_array<br />I get:<br />                 U __ab6_invars_MOD_ab6_invars_get_real_array<br /></div></blockquote><br /><br />After investigation, I noticed that the module ab6_invars in src/57_iovars has been renamed to m_ab6_invars to fullfill coding rules. Waiting for the official correction, you can modify the two previous files (ab6_invars_c_.c and ab6_symmetry_c.c) and change again the #define line with:<br />#define FC_MOD_NAME(M,A) __m_ ## M ## _MOD_ ## A<br /><br />I hope it will do the job properly...<br /><br />Damien.</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: how to link abinit to Vsim?</h3>
				<div class="date">Posted: <strong>Mon Apr 12, 2010 10:21 am</strong></div>
				<div class="author">by <strong>maurosgroi</strong></div>
				<div class="content">Dear dcaliste,<br />this is the output of the configure command (config.log). With the last modification v_sim doesn't configure with the abinit support.<br />I can't understand  the problem.<br />Best regards,<br />Mauro.<br /><br />configure:26695: gcc -o conftest -O3 -mtune=native -Wall -W -ansi -Wno-error   conftest.c  -L/opt/abinit-6.0.3/lib -labinis  -L/usr/lib/gcc/x86_64-linux-gnu/4.4.3 -L/usr/lib/gcc/x86_64-linux-gnu/4.4.3/../../../../lib -L/lib/../lib -L/usr/lib/../lib -L/usr/lib/gcc/x86_64-linux-gnu/4.4.3/../../.. -lgfortranbegin -lgfortran -lm &gt;&amp;5<br />conftest.c: In function 'main':<br />conftest.c:13: warning: implicit declaration of function 'ab6_invars_new_from_file'<br />conftest.c:11: warning: unused parameter 'argc'<br />conftest.c:11: warning: unused parameter 'argv'<br />/opt/abinit-6.0.3/lib/libabinis.a(pspheads_comm.o): In function `pspheads_comm':<br />/opt/src/abinit-6.0.3/src/51_manage_mpi/pspheads_comm.F90:97: undefined reference to `mpi_bcast_'<br />/opt/src/abinit-6.0.3/src/51_manage_mpi/pspheads_comm.F90:120: undefined reference to `mpi_bcast_'<br />/opt/src/abinit-6.0.3/src/51_manage_mpi/pspheads_comm.F90:143: undefined reference to `mpi_bcast_'<br />/opt/src/abinit-6.0.3/src/51_manage_mpi/pspheads_comm.F90:157: undefined reference to `mpi_bcast_'<br />/opt/src/abinit-6.0.3/src/51_manage_mpi/pspheads_comm.F90:169: undefined reference to `mpi_bcast_'<br />/opt/abinit-6.0.3/lib/libabinis.a(leave_test.o): In function `leave_test':<br />/opt/src/abinit-6.0.3/src/51_manage_mpi/leave_test.F90:82: undefined reference to `mpi_barrier_'<br />/opt/src/abinit-6.0.3/src/51_manage_mpi/leave_test.F90:92: undefined reference to `mpi_allreduce_'<br />/opt/src/abinit-6.0.3/src/51_manage_mpi/leave_test.F90:98: undefined reference to `mpi_finalize_'<br />/opt/abinit-6.0.3/lib/libabinis.a(xmpi_me.o): In function `xmpi_me':<br />/opt/src/abinit-6.0.3/src/12_hide_mpi/xmpi_me.F90:60: undefined reference to `mpi_comm_rank_'<br />/opt/abinit-6.0.3/lib/libabinis.a(clnmpi_fft.o): In function `clnmpi_fft':<br />/opt/src/abinit-6.0.3/src/51_manage_mpi/clnmpi_fft.F90:74: undefined reference to `mpi_comm_free_'<br />/opt/src/abinit-6.0.3/src/51_manage_mpi/clnmpi_fft.F90:83: undefined reference to `mpi_comm_free_'<br />/opt/abinit-6.0.3/lib/libabinis.a(initmpi_fft.o): In function `initmpi_fft':<br />/opt/src/abinit-6.0.3/src/51_manage_mpi/initmpi_fft.F90:101: undefined reference to `mpi_comm_size_'<br />/opt/src/abinit-6.0.3/src/51_manage_mpi/initmpi_fft.F90:102: undefined reference to `mpi_comm_rank_'<br />/opt/src/abinit-6.0.3/src/51_manage_mpi/initmpi_fft.F90:117: undefined reference to `mpi_comm_group_'<br />/opt/src/abinit-6.0.3/src/51_manage_mpi/initmpi_fft.F90:293: undefined reference to `mpi_group_incl_'<br />/opt/src/abinit-6.0.3/src/51_manage_mpi/initmpi_fft.F90:294: undefined reference to `mpi_comm_create_'<br />/opt/src/abinit-6.0.3/src/51_manage_mpi/initmpi_fft.F90:300: undefined reference to `mpi_group_incl_'<br />/opt/src/abinit-6.0.3/src/51_manage_mpi/initmpi_fft.F90:130: undefined reference to `mpi_group_incl_'<br />/opt/src/abinit-6.0.3/src/51_manage_mpi/initmpi_fft.F90:132: undefined reference to `mpi_comm_create_'<br />/opt/src/abinit-6.0.3/src/51_manage_mpi/initmpi_fft.F90:136: undefined reference to `mpi_group_free_'<br />/opt/src/abinit-6.0.3/src/51_manage_mpi/initmpi_fft.F90:142: undefined reference to `mpi_comm_rank_'<br />/opt/src/abinit-6.0.3/src/51_manage_mpi/initmpi_fft.F90:149: undefined reference to `mpi_comm_size_'<br />/opt/src/abinit-6.0.3/src/51_manage_mpi/initmpi_fft.F90:270: undefined reference to `mpi_group_incl_'<br />/opt/src/abinit-6.0.3/src/51_manage_mpi/initmpi_fft.F90:273: undefined reference to `mpi_comm_create_'<br />/opt/src/abinit-6.0.3/src/51_manage_mpi/initmpi_fft.F90:276: undefined reference to `mpi_group_free_'<br />/opt/abinit-6.0.3/lib/libabinis.a(initmpi_grid.o): In function `initmpi_grid':<br />/opt/src/abinit-6.0.3/src/51_manage_mpi/initmpi_grid.F90:124: undefined reference to `mpi_cart_create_'<br />/opt/src/abinit-6.0.3/src/51_manage_mpi/initmpi_grid.F90:128: undefined reference to `mpi_comm_rank_'<br />/opt/src/abinit-6.0.3/src/51_manage_mpi/initmpi_grid.F90:130: undefined reference to `mpi_cart_coords_'<br />/opt/src/abinit-6.0.3/src/51_manage_mpi/initmpi_grid.F90:139: undefined reference to `mpi_cart_sub_'<br />/opt/src/abinit-6.0.3/src/51_manage_mpi/initmpi_grid.F90:145: undefined reference to `mpi_cart_sub_'<br />/opt/src/abinit-6.0.3/src/51_manage_mpi/initmpi_grid.F90:152: undefined reference to `mpi_cart_sub_'<br />/opt/src/abinit-6.0.3/src/51_manage_mpi/initmpi_grid.F90:154: undefined reference to `mpi_comm_size_'<br />/opt/src/abinit-6.0.3/src/51_manage_mpi/initmpi_grid.F90:156: undefined reference to `mpi_comm_size_'<br />/opt/src/abinit-6.0.3/src/51_manage_mpi/initmpi_grid.F90:158: undefined reference to `mpi_comm_size_'<br />/opt/src/abinit-6.0.3/src/51_manage_mpi/initmpi_grid.F90:166: undefined reference to `mpi_cart_sub_'<br />/opt/src/abinit-6.0.3/src/51_manage_mpi/initmpi_grid.F90:168: undefined reference to `mpi_comm_rank_'<br />/opt/abinit-6.0.3/lib/libabinis.a(m_numeric_tools.o): In function `__m_numeric_tools_MOD_llsfit_svd':<br />/opt/src/abinit-6.0.3/src/28_numeric_noabirule/m_numeric_tools.F90:1503: undefined reference to `dgesvd_'<br />collect2: ld returned 1 exit status<br />configure:26701: $? = 1<br />configure: failed program was:<br />| <br />| void wrtout_()<br />| {<br />| }<br />| void leave_new_()<br />| {<br />| }<br />| void timab_()<br />| {<br />| }<br />| int main(int argc, const char **argv)<br />| {<br />|   ab6_invars_new_from_file();<br />|   return 0;<br />| }<br />| <br />configure:26717: result: no<br />configure:26720: checking for symmetry capabilities in libabinis.a from /opt/abinit-6.0.3/lib<br />configure:26746: gcc -o conftest -O3 -mtune=native -Wall -W -ansi -Wno-error   conftest.c  -L/opt/abinit-6.0.3/lib -labinis  -L/usr/lib/gcc/x86_64-linux-gnu/4.4.3 -L/usr/lib/gcc/x86_64-linux-gnu/4.4.3/../../../../lib -L/lib/../lib -L/usr/lib/../lib -L/usr/lib/gcc/x86_64-linux-gnu/4.4.3/../../.. -lgfortranbegin -lgfortran -lm &gt;&amp;5<br />conftest.c: In function 'main':<br />conftest.c:13: warning: implicit declaration of function 'ab6_symmetry_new'<br />conftest.c:11: warning: unused parameter 'argc'<br />conftest.c:11: warning: unused parameter 'argv'<br />/opt/abinit-6.0.3/lib/libabinis.a(ab6_symmetry_c.o): In function `ab6_symmetry_get_auto_k_grid':<br />/opt/src/abinit-6.0.3/bindings/parser/ab6_symmetry_c.c:383: undefined reference to `__m_ab6_symmetry_MOD_ab6_symmetry_binding_auto_k_1'<br />/opt/src/abinit-6.0.3/bindings/parser/ab6_symmetry_c.c:387: undefined reference to `__m_ab6_symmetry_MOD_ab6_symmetry_binding_auto_k_2'<br />/opt/abinit-6.0.3/lib/libabinis.a(ab6_symmetry_c.o): In function `ab6_symmetry_get_mp_k_grid':<br />/opt/src/abinit-6.0.3/bindings/parser/ab6_symmetry_c.c:366: undefined reference to `__m_ab6_symmetry_MOD_ab6_symmetry_binding_mp_k_1'<br />/opt/src/abinit-6.0.3/bindings/parser/ab6_symmetry_c.c:370: undefined reference to `__m_ab6_symmetry_MOD_ab6_symmetry_binding_mp_k_2'<br />/opt/abinit-6.0.3/lib/libabinis.a(ab6_symmetry_c.o): In function `ab6_symmetry_get_group':<br />/opt/src/abinit-6.0.3/bindings/parser/ab6_symmetry_c.c:305: undefined reference to `__m_ab6_symmetry_MOD_ab6_symmetry_get_group'<br />/opt/abinit-6.0.3/lib/libabinis.a(ab6_symmetry_c.o): In function `ab6_symmetry_get_matrices':<br />/opt/src/abinit-6.0.3/bindings/parser/ab6_symmetry_c.c:261: undefined reference to `__m_ab6_symmetry_MOD_ab6_symmetry_get_matrices'<br />/opt/abinit-6.0.3/lib/libabinis.a(ab6_symmetry_c.o): In function `ab6_symmetry_get_bravais':<br />/opt/src/abinit-6.0.3/bindings/parser/ab6_symmetry_c.c:222: undefined reference to `__m_ab6_symmetry_MOD_ab6_symmetry_get_bravais'<br />/opt/abinit-6.0.3/lib/libabinis.a(ab6_symmetry_c.o): In function `ab6_symmetry_get_multiplicity':<br />/opt/src/abinit-6.0.3/bindings/parser/ab6_symmetry_c.c:210: undefined reference to `__m_ab6_symmetry_MOD_ab6_symmetry_get_multiplicity'<br />/opt/abinit-6.0.3/lib/libabinis.a(ab6_symmetry_c.o): In function `ab6_symmetry_get_n_sym':<br />/opt/src/abinit-6.0.3/bindings/parser/ab6_symmetry_c.c:203: undefined reference to `__m_ab6_symmetry_MOD_ab6_symmetry_get_n_sym'<br />/opt/abinit-6.0.3/lib/libabinis.a(ab6_symmetry_c.o): In function `ab6_symmetry_get_equivalent_atom':<br />/opt/src/abinit-6.0.3/bindings/parser/ab6_symmetry_c.c:337: undefined reference to `__m_ab6_symmetry_MOD_ab6_symmetry_get_equivalent_atom'<br />/opt/abinit-6.0.3/lib/libabinis.a(ab6_symmetry_c.o): In function `ab6_symmetry_get_n_atoms':<br />/opt/src/abinit-6.0.3/bindings/parser/ab6_symmetry_c.c:196: undefined reference to `__m_ab6_symmetry_MOD_ab6_symmetry_get_n_atoms'<br />/opt/abinit-6.0.3/lib/libabinis.a(ab6_symmetry_c.o): In function `ab6_symmetry_set_jellium':<br />/opt/src/abinit-6.0.3/bindings/parser/ab6_symmetry_c.c:188: undefined reference to `__m_ab6_symmetry_MOD_ab6_symmetry_set_jellium'<br />/opt/abinit-6.0.3/lib/libabinis.a(ab6_symmetry_c.o): In function `ab6_symmetry_set_field':<br />/opt/src/abinit-6.0.3/bindings/parser/ab6_symmetry_c.c:181: undefined reference to `__m_ab6_symmetry_MOD_ab6_symmetry_set_field'<br />/opt/abinit-6.0.3/lib/libabinis.a(ab6_symmetry_c.o): In function `ab6_symmetry_set_spin_orbit':<br />/opt/src/abinit-6.0.3/bindings/parser/ab6_symmetry_c.c:174: undefined reference to `__m_ab6_symmetry_MOD_ab6_symmetry_set_spin_orbit'<br />/opt/abinit-6.0.3/lib/libabinis.a(ab6_symmetry_c.o): In function `ab6_symmetry_set_spin':<br />/opt/src/abinit-6.0.3/bindings/parser/ab6_symmetry_c.c:163: undefined reference to `__m_ab6_symmetry_MOD_ab6_symmetry_get_n_atoms'<br />/opt/src/abinit-6.0.3/bindings/parser/ab6_symmetry_c.c:167: undefined reference to `__m_ab6_symmetry_MOD_ab6_symmetry_set_spin'<br />/opt/abinit-6.0.3/lib/libabinis.a(ab6_symmetry_c.o): In function `ab6_symmetry_set_structure':<br />/opt/src/abinit-6.0.3/bindings/parser/ab6_symmetry_c.c:155: undefined reference to `__m_ab6_symmetry_MOD_ab6_symmetry_set_structure'<br />/opt/abinit-6.0.3/lib/libabinis.a(ab6_symmetry_c.o): In function `ab6_symmetry_set_lattice':<br />/opt/src/abinit-6.0.3/bindings/parser/ab6_symmetry_c.c:147: undefined reference to `__m_ab6_symmetry_MOD_ab6_symmetry_set_lattice'<br />/opt/abinit-6.0.3/lib/libabinis.a(ab6_symmetry_c.o): In function `ab6_symmetry_set_tolerance':<br />/opt/src/abinit-6.0.3/bindings/parser/ab6_symmetry_c.c:130: undefined reference to `__m_ab6_symmetry_MOD_ab6_symmetry_set_tolerance'<br />/opt/abinit-6.0.3/lib/libabinis.a(ab6_symmetry_c.o): In function `ab6_symmetry_free':<br />/opt/src/abinit-6.0.3/bindings/parser/ab6_symmetry_c.c:123: undefined reference to `__m_ab6_symmetry_MOD_ab6_symmetry_free'<br />/opt/abinit-6.0.3/lib/libabinis.a(ab6_symmetry_c.o): In function `ab6_symmetry_new':<br />/opt/src/abinit-6.0.3/bindings/parser/ab6_symmetry_c.c:111: undefined reference to `__m_ab6_symmetry_MOD_ab6_symmetry_new'<br />collect2: ld returned 1 exit status<br />configure:26752: $? = 1<br />configure: failed program was:<br />| <br />| void wrtout_()<br />| {<br />| }<br />| void leave_new_()<br />| {<br />| }<br />| void timab_()<br />| {<br />| }<br />| int main(int argc, const char **argv)<br />| {<br />|   ab6_symmetry_new();<br />|   return 0;<br />| }</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: how to link abinit to Vsim?</h3>
				<div class="date">Posted: <strong>Fri Apr 16, 2010 10:00 am</strong></div>
				<div class="author">by <strong>dcaliste</strong></div>
				<div class="content">Hello,<br /><br /><blockquote><div><cite>maurosgroi wrote:</cite>Dear dcaliste,<br />this is the output of the configure command (config.log). With the last modification v_sim doesn't configure with the abinit support.<br /><br />/opt/src/abinit-6.0.3/src/51_manage_mpi/initmpi_fft.F90:101: undefined reference to `mpi_comm_size_'<br />/opt/src/abinit-6.0.3/src/51_manage_mpi/initmpi_fft.F90:102: undefined reference to `mpi_comm_rank_'<br />/opt/src/abinit-6.0.3/src/51_manage_mpi/initmpi_fft.F90:117: undefined reference to `mpi_comm_group_'<br /></div></blockquote><br />This is a more severe issue than I expected. The plugin has been tested with ABINIT up to 5.9.x, and it seems that it fails to pass the 6.x jump :(<br />Some of the lower levels of ABINIT has been reorganised and now depend on MPI (seem so from your logs, I must check this assertion).<br /><br />I'll work on it next week in my ABINIT branch. A solution should be publicly available in the next minor revision of ABINIT.<br /><br />You may have a work around waiting for the offical solution that would be to compile ABINIT without MPI support when you compile the library. Or to try to compile V_Sim with the MPI cc compiler.</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: how to link abinit to Vsim?</h3>
				<div class="date">Posted: <strong>Fri Apr 16, 2010 3:14 pm</strong></div>
				<div class="author">by <strong>maurosgroi</strong></div>
				<div class="content">Dear Damien,<br />I modified the FC_MOD_NAME macro as you suggested.<br /><br />I'm now trying excluding the MPI libraries. So I compiled abinit in a serial way by using:<br /><br />FC=gfortran<br />CC=gcc<br />CXX=g++<br />LD=gfortran<br />export FC CC CXX LD<br />configure --prefix=/opt/abinit-6.0.3-serial --enable-64bit-flags --enable-optim=aggressive --enable-mpi=no --enable-bindings --disable-all-plugins  --with-linalg-libs='-L/opt/lib/static//atlas -llapack -lf77blas -lcblas -latlas'<br /><br />After obtaining libabinis.a I configured v_sim including the ATLAS/LAPACK libraries (otherwise I get an undefined reference to lapack subroutine):<br /><br />export LIBS=&quot;-L/opt/lib/static/atlas -llapack -lf77blas -lcblas -latlas&quot;<br />./configure CFLAGS='-O3 -m64 -mtune=native -fPIC' CXXFLAGS='-O3 -mtune=native -m64 -fPIC' --with-xsf --with-netcdf --with-abinit=/opt/abinit-6.0.3-serial --with-openbabel --with-cube  --with-etsf-file-format --prefix=/opt/v_sim-3.5.1<br /><br />Doing this v_sim configures correctly and the excutable can link the plugins to open the abinit input files. <br /><br />By the way, using the MPI version of abinit and including the MPI libraries in the LIBS variable, I obtained an excutable working apparently that crashed trying to open an abinit input file. <br />I've a last question: in the config.log file I still get some undefined references when configure tries to check the symmetry capabilities of libabinis.a: <br /><br />configure:26720: checking for symmetry capabilities in libabinis.a from /opt/abinit-6.0.3-serial/lib<br />configure:26746: gcc -o conftest -O3 -m64 -mtune=native -fPIC -Wall -W -ansi -Wno-error   conftest.c -L/opt/lib/static/atlas -llapack -lf77blas -lcblas -latlas -L/opt/abinit-6.0.3-serial/lib -labinis  -L/opt/lib/static/atlas -L/usr/lib/gcc/x86_64-linux-gnu/4.4.3 -L/usr/lib/gcc/x86_64-linux-gnu/4.4.3/../../../../lib -L/lib/../lib -L/usr/lib/../lib -L/usr/lib/gcc/x86_64-linux-gnu/4.4.3/../../.. -llapack -lf77blas -lcblas -latlas -lgfortranbegin -lgfortran -lm &gt;&amp;5<br />conftest.c: In function 'main':<br />conftest.c:13: warning: implicit declaration of function 'ab6_symmetry_new'<br />conftest.c:11: warning: unused parameter 'argc'<br />conftest.c:11: warning: unused parameter 'argv'<br />/opt/abinit-6.0.3-serial/lib/libabinis.a(ab6_symmetry_c.o): In function `ab6_symmetry_get_auto_k_grid':<br />/opt/src/abinit-6.0.3/bindings/parser/ab6_symmetry_c.c:384: undefined reference to `__m_ab6_symmetry_MOD_ab6_symmetry_binding_auto_k_1'<br />/opt/src/abinit-6.0.3/bindings/parser/ab6_symmetry_c.c:388: undefined reference to `__m_ab6_symmetry_MOD_ab6_symmetry_binding_auto_k_2'<br />/opt/abinit-6.0.3-serial/lib/libabinis.a(ab6_symmetry_c.o): In function `ab6_symmetry_get_mp_k_grid':<br />/opt/src/abinit-6.0.3/bindings/parser/ab6_symmetry_c.c:367: undefined reference to `__m_ab6_symmetry_MOD_ab6_symmetry_binding_mp_k_1'<br />/opt/src/abinit-6.0.3/bindings/parser/ab6_symmetry_c.c:371: undefined reference to `__m_ab6_symmetry_MOD_ab6_symmetry_binding_mp_k_2'<br />/opt/abinit-6.0.3-serial/lib/libabinis.a(ab6_symmetry_c.o): In function `ab6_symmetry_get_group':<br />/opt/src/abinit-6.0.3/bindings/parser/ab6_symmetry_c.c:306: undefined reference to `__m_ab6_symmetry_MOD_ab6_symmetry_get_group'<br />/opt/abinit-6.0.3-serial/lib/libabinis.a(ab6_symmetry_c.o): In function `ab6_symmetry_get_matrices':<br />/opt/src/abinit-6.0.3/bindings/parser/ab6_symmetry_c.c:262: undefined reference to `__m_ab6_symmetry_MOD_ab6_symmetry_get_matrices'<br />/opt/abinit-6.0.3-serial/lib/libabinis.a(ab6_symmetry_c.o): In function `ab6_symmetry_get_bravais':<br />/opt/src/abinit-6.0.3/bindings/parser/ab6_symmetry_c.c:223: undefined reference to `__m_ab6_symmetry_MOD_ab6_symmetry_get_bravais'<br />/opt/abinit-6.0.3-serial/lib/libabinis.a(ab6_symmetry_c.o): In function `ab6_symmetry_get_multiplicity':<br />/opt/src/abinit-6.0.3/bindings/parser/ab6_symmetry_c.c:211: undefined reference to `__m_ab6_symmetry_MOD_ab6_symmetry_get_multiplicity'<br />/opt/abinit-6.0.3-serial/lib/libabinis.a(ab6_symmetry_c.o): In function `ab6_symmetry_get_n_sym':<br />/opt/src/abinit-6.0.3/bindings/parser/ab6_symmetry_c.c:204: undefined reference to `__m_ab6_symmetry_MOD_ab6_symmetry_get_n_sym'<br />/opt/abinit-6.0.3-serial/lib/libabinis.a(ab6_symmetry_c.o): In function `ab6_symmetry_get_equivalent_atom':<br />/opt/src/abinit-6.0.3/bindings/parser/ab6_symmetry_c.c:338: undefined reference to `__m_ab6_symmetry_MOD_ab6_symmetry_get_equivalent_atom'<br />/opt/abinit-6.0.3-serial/lib/libabinis.a(ab6_symmetry_c.o): In function `ab6_symmetry_get_n_atoms':<br />/opt/src/abinit-6.0.3/bindings/parser/ab6_symmetry_c.c:197: undefined reference to `__m_ab6_symmetry_MOD_ab6_symmetry_get_n_atoms'<br />/opt/abinit-6.0.3-serial/lib/libabinis.a(ab6_symmetry_c.o): In function `ab6_symmetry_set_jellium':<br />/opt/src/abinit-6.0.3/bindings/parser/ab6_symmetry_c.c:189: undefined reference to `__m_ab6_symmetry_MOD_ab6_symmetry_set_jellium'<br />/opt/abinit-6.0.3-serial/lib/libabinis.a(ab6_symmetry_c.o): In function `ab6_symmetry_set_field':<br />/opt/src/abinit-6.0.3/bindings/parser/ab6_symmetry_c.c:182: undefined reference to `__m_ab6_symmetry_MOD_ab6_symmetry_set_field'<br />/opt/abinit-6.0.3-serial/lib/libabinis.a(ab6_symmetry_c.o): In function `ab6_symmetry_set_spin_orbit':<br />/opt/src/abinit-6.0.3/bindings/parser/ab6_symmetry_c.c:175: undefined reference to `__m_ab6_symmetry_MOD_ab6_symmetry_set_spin_orbit'<br />/opt/abinit-6.0.3-serial/lib/libabinis.a(ab6_symmetry_c.o): In function `ab6_symmetry_set_spin':<br />/opt/src/abinit-6.0.3/bindings/parser/ab6_symmetry_c.c:164: undefined reference to `__m_ab6_symmetry_MOD_ab6_symmetry_get_n_atoms'<br />/opt/src/abinit-6.0.3/bindings/parser/ab6_symmetry_c.c:168: undefined reference to `__m_ab6_symmetry_MOD_ab6_symmetry_set_spin'<br />/opt/abinit-6.0.3-serial/lib/libabinis.a(ab6_symmetry_c.o): In function `ab6_symmetry_set_structure':<br />/opt/src/abinit-6.0.3/bindings/parser/ab6_symmetry_c.c:156: undefined reference to `__m_ab6_symmetry_MOD_ab6_symmetry_set_structure'<br />/opt/abinit-6.0.3-serial/lib/libabinis.a(ab6_symmetry_c.o): In function `ab6_symmetry_set_lattice':<br />/opt/src/abinit-6.0.3/bindings/parser/ab6_symmetry_c.c:148: undefined reference to `__m_ab6_symmetry_MOD_ab6_symmetry_set_lattice'<br />/opt/abinit-6.0.3-serial/lib/libabinis.a(ab6_symmetry_c.o): In function `ab6_symmetry_set_tolerance':<br />/opt/src/abinit-6.0.3/bindings/parser/ab6_symmetry_c.c:131: undefined reference to `__m_ab6_symmetry_MOD_ab6_symmetry_set_tolerance'<br />/opt/abinit-6.0.3-serial/lib/libabinis.a(ab6_symmetry_c.o): In function `ab6_symmetry_free':<br />/opt/src/abinit-6.0.3/bindings/parser/ab6_symmetry_c.c:124: undefined reference to `__m_ab6_symmetry_MOD_ab6_symmetry_free'<br />/opt/abinit-6.0.3-serial/lib/libabinis.a(ab6_symmetry_c.o): In function `ab6_symmetry_new':<br />/opt/src/abinit-6.0.3/bindings/parser/ab6_symmetry_c.c:112: undefined reference to `__m_ab6_symmetry_MOD_ab6_symmetry_new'<br /><br />The make command compiles correctly the program and I get a working excutable, but I don't know if the simmetries capabilities supplied by abinit are missing.<br /><br />Thanks a lot and best regards,<br />Mauro.</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: how to link abinit to Vsim?</h3>
				<div class="date">Posted: <strong>Mon Apr 19, 2010 9:39 am</strong></div>
				<div class="author">by <strong>dcaliste</strong></div>
				<div class="content">Hello,<br /><br />   It's good to see that you succeeded in the compilation and that you can directly visualise the ABINIT input file, that's convenient.<br /><br />   I'm working on the fixes for the 6.0.x branch to correct automatically the issues you encountered. About the symmetry errors in the config.log, it should give the ability to V_Sim to output the space group of the represented file, using the routines from ABINIT, and to highlight equivalent atoms. (When it's working), it's located in the &quot;interactive dialog&quot;, third tab, when you click on the interactive button of the command window. I don't know currently why it fails to compile on your machine. I'll check also.</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: how to link abinit to Vsim?</h3>
				<div class="date">Posted: <strong>Mon Apr 19, 2010 10:17 am</strong></div>
				<div class="author">by <strong>maurosgroi</strong></div>
				<div class="content">Dear Damien,<br />I succeeded to compile v_sim using the parallel version of abinit using mpicc as compiler instead of gcc. This is my configuration script&#058;<br /><br />export CC=mpicc<br />export CXX=mpic++<br />export LIBS=&quot;-lmpi_f90 -lmpi_cxx -lmpi_f77 -lmpi -L/opt/lib/static/atlas -llapack -lf77blas -lcblas -latlas&quot;<br />./configure CFLAGS='-O3 -m64 -mtune=native -fPIC' CXXFLAGS='-O3 -mtune=native -m64 -fPIC' --with-xsf --with-netcdf --with-abinit=/opt/abinit-6.0.3-openmpi --with-openbabel --with-cube  --with-etsf-file-format --prefix=/opt/v_sim-3.5.1<br /><br />as you can see I explicitly linked with the MPI libraries.<br /><br />The key to correctly get the symmetry capabilities is to modify the FC_MOD_NAME macro in the ab6_symmetry_c.c file:<br /><br />#define FC_MOD_NAME(M,A) __ ## M ## _MOD_ ## A<br /><br />and the  FC_MOD_NAME in the ab6_invars_c.c as follows:<br /><br />#define FC_MOD_NAME(M,A) __m_ ## M ## _MOD_ ## A<br /><br />In this way the program is working correctly.<br />Thanks a lot and best wishes,<br />Mauro.</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: how to link abinit to Vsim?</h3>
				<div class="date">Posted: <strong>Mon Apr 19, 2010 11:17 am</strong></div>
				<div class="author">by <strong>maurosgroi</strong></div>
				<div class="content">Dear Damien,<br />when I use &quot;compute symmetry&quot; to get the space group, excutable crashes with this error:<br /><br />ERROR : This part should be rewritten, at least in part, since the<br /> original routine from which it was taken, ingeo.F90, has been improved much,<br /> so that this section is now contained in the symanal.F90 routine.<br /><br />This happens even if the configuration and compilation process was apparently correct.<br />Regards,<br />Mauro.</div>
			</div>
			<hr />
					<div class="post">
				<h3>HOWTO compiling from version 6.0.4</h3>
				<div class="date">Posted: <strong>Mon Apr 26, 2010 9:31 am</strong></div>
				<div class="author">by <strong>dcaliste</strong></div>
				<div class="content">Ok, all the bugs reported up to here have been corrected in version 6.0.4 and later.<br /><br />Configuring with --enable-bindings to use the ABINIT library later in V_Sim requires to disable MPI (--disable-mpi) and disable ETSF_IO (--disable-etsf-io from version 6.2.x). This can be done in another compiling directory (thanks to the Autotools):<br />- mkdir compiling-library &amp;&amp; cd compiling-library ;<br />- $ABINIT_SOURCES_DIR/configure --enable-bindings --disable-mpi --disable-etsf-io FC=gfortran ;<br />- make &amp;&amp; make install ;<br /><br />The trick about the #define depending on the version of Gfortran must still be applied if necessary.</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: [SOLVED 6.0.4] how to link abinit to Vsim?</h3>
				<div class="date">Posted: <strong>Tue May 18, 2010 3:03 pm</strong></div>
				<div class="author">by <strong>maurosgroi</strong></div>
				<div class="content">Dear Damien,<br />I had to change the file lib/plug-ins/abinit/ab_symmetry.c at line 401:<br /><br />/* We get then the space group. */<br />/*      errno = ab6_symmetry_get_group(sym, &amp;ptGrp, &amp;spGrp, &amp;grpId,<br />                                     &amp;grpMagnId, genAfm);  From Abinit 6.0.4  to keep track of the change in */<br /><br />      errno = ab6_symmetry_get_group(sym, &amp;spGrp, &amp;grpId, &amp;grpMagnId, genAfm);<br /><br />in order to take in account the different order (between version 6.03 and 6.04) of input parameters for the function ab6_symmetry_get_group in the file abinit-6.0.4/bindings/parser/ab6_symmetry.h.<br /><br />Best regards,<br />Mauro.</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: [SOLVED 6.0.4] how to link abinit to Vsim?</h3>
				<div class="date">Posted: <strong>Tue Jan 10, 2017 6:18 pm</strong></div>
				<div class="author">by <strong>jean-luc</strong></div>
				<div class="content">Hello,<br /><br />I tried to link v_sim to abinit. In fact, with the version 8.0.8 of abinit, the files transformed from ab6 to ab7 in dir ~/bindings. In that dir, README tell us to modify FC_MOD_NAME. I just found FC_MOD, and it is not at all the same syntax.<br /><br />V_sim appears to compile correctly, but abinit does not compile with --enable-bindings. message here after configure :<br /><br />configure: ABINIT version 8.0.8<br />configure: M4 010413 - Autoconf 026300 - Automake 011101 - Libtool 020206<br />configure: reporting user interface changes:<br />configure:  * new option --enable-avx-safe-mode is available<br />configure: error: removed option --enable-bindings has been used<br />jlb@pcsera48:/opt/abinit-8.0.8/temp-build$ gfortran --version<br />GNU Fortran (Debian 4.9.2-10) 4.9.2<br />Copyright (C) 2014 Free Software Foundation, Inc.<br /><br />So in the following, I suppose that it cause abinit not to create abinis.a<br />Could you tell me why ?<br />Best Regards <br />JLuc</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: [SOLVED 6.0.4] how to link abinit to Vsim?</h3>
				<div class="date">Posted: <strong>Thu Mar 09, 2017 4:05 pm</strong></div>
				<div class="author">by <strong>pouillon</strong></div>
				<div class="content">Abinit bindings to V_Sim are currently broken and unmaintained. They might be replaced by something else in the near future. There will be developers meeting this year where we will decide what to do with this part of the code. We will inform you when a decision has been taken.</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: [SOLVED 6.0.4] how to link abinit to Vsim?</h3>
				<div class="date">Posted: <strong>Thu Mar 09, 2017 4:24 pm</strong></div>
				<div class="author">by <strong>jean-luc</strong></div>
				<div class="content">Dear Yann,<br /><br />I appreciate V-sim alone. I suppose that the link abinit/v-sim is a kind of translator. Not to say that it is trivial.<br />I used v-sim alone to represent the cells, etc... and it is a nice soft and a great effort from developper,<br /><br />Thanks for your reply,<br /><br />Best Regards<br />Jean-Luc</div>
			</div>
			<hr />
			</div>

	<div id="page-footer" class="page-footer">
		<div class="page-number">All times are <span title="Europe/Brussels">UTC+02:00</span><br />Page <strong>1</strong> of <strong>1</strong></div>
			<div class="copyright">
				<p>Powered by <a href="https://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Limited
				</p>
							</div>
	</div>
</div>

</body>

<!-- Mirrored from forum.abinit.org/viewtopic.php?f=14&t=21&view=print by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 20 Sep 2024 21:27:29 GMT -->
</html>
