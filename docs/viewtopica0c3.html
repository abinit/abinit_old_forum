<!DOCTYPE html>
<html dir="ltr" lang="en-gb">

<!-- Mirrored from forum.abinit.org/viewtopic.php?f=3&t=2854&view=print by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 21 Sep 2024 01:47:46 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="robots" content="noindex" />

<title>ABINIT Discussion Forums &bull; Trouble linking to fftw3</title>

<link href="styles/flat-style/theme/print.css" rel="stylesheet">
<link href="styles/flat-style/theme/bidi.css" rel="stylesheet">
</head>
<body id="phpbb" class="ltr">
<div id="wrap" class="wrap">
	<a id="top" class="top-anchor" accesskey="t"></a>

	<div id="page-header">
		<h1>ABINIT Discussion Forums</h1>
		<p>The meeting place for ABINIT users and developers<br /><a href="index.html">https://forum.abinit.org/</a></p>

		<h2>Trouble linking to fftw3</h2>
		<p><a href="viewtopic3616.html?f=3&amp;t=2854">https://forum.abinit.org/viewtopic.php?f=3&amp;t=2854</a></p>
	</div>

	<div id="page-body" class="page-body">
		<div class="page-number">Page <strong>1</strong> of <strong>1</strong></div>
					<div class="post">
				<h3>Trouble linking to fftw3</h3>
				<div class="date">Posted: <strong>Fri Nov 14, 2014 11:38 pm</strong></div>
				<div class="author">by <strong>esr3d</strong></div>
				<div class="content">Hi,<br /><br />I am trying to install Abinit-7.8.2 on my MacBook Pro, running snow leopard (10.6.8), Intel core i7 processor.  I'm using the gcc48 set of compilers, which I installed from macports.  I am using the following config file:<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>prefix=&quot;/usr/local&quot;<br />with_trio_flavor=&quot;netcdf+etsf_io&quot;<br />with_netcdf_incs=&quot;-I/opt/local/include&quot;<br />with_netcdf_libs=&quot;-L/opt/local/lib -lnetcdf -lnetcdff&quot;<br />with_etsf_io_incs=&quot;-I/opt/local/include/gcc&quot;<br />with_etsf_io_libs=&quot;-L/opt/local/lib -letsf_io_low_level -letsf_io_utils -letsf_io&quot;<br />with_fft_flavor=&quot;fftw3&quot;<br />with_fft_incs=&quot;-I/usr/local/include&quot;<br />with_fft_libs=&quot;-L/usr/local/lib -lfftw3f -lfftw3&quot;<br />with_linalg_flavor=&quot;atlas&quot;<br />with_linalg_libs=&quot;-L/opt/local/lib -llapack -lf77blas -lcblas -latlas&quot;<br />with_libxc_incs=&quot;-I/opt/etsf/include&quot;<br />with_libxc_libs=&quot;-L/opt/etsf/lib -lxc -lxcf90&quot;<br />with_wannier90_bins=&quot;/opt/local/bin&quot;<br />with_wannier90_incs=&quot;-I/opt/local/bin&quot;<br />with_wannier90_libs=&quot;-L/opt/local/lib -lwannier&quot;<br />with_dft_flavor=&quot;libxc+wannier90&quot;<br />enable_64bit_flags=&quot;yes&quot;<br />enable_shared<br />enable_optim=&quot;safe&quot;<br />CC=/opt/local/bin/gcc-mp-4.8<br />CPP=/opt/local/bin/cpp-mp-4.8<br />FC=/opt/local/bin/gfortran-mp-4.8<br />FCCPP=/opt/local/bin/cpp-mp-4.8</code></pre></div><br /><br />Everything is fine during the configure step, but I receive the following error during make (I have attached the full make output in make.log):<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>Undefined symbols for architecture x86_64:<br />&nbsp; &quot;__gfortran_backtrace&quot;, referenced from:<br />&nbsp; &nbsp; &nbsp; ___m_errors_MOD_show_backtrace in lib16_hideleave.a(m_errors.o)<br />&nbsp; &nbsp; &nbsp; ___m_errors_MOD_msg_hndl in lib16_hideleave.a(m_errors.o)<br />&nbsp; &quot;_dfftw_cleanup_&quot;, referenced from:<br />&nbsp; &nbsp; &nbsp; ___m_fftw3_MOD_fftw3_cleanup in lib52_fft_mpi_noabirule.a(m_fftw3.o)<br />&nbsp; &quot;_dfftw_destroy_plan_&quot;, referenced from:<br />&nbsp; &nbsp; &nbsp; ___m_fftw3_MOD_fftw3_applypot_many in lib52_fft_mpi_noabirule.a(m_fftw3.o)<br />&nbsp; &nbsp; &nbsp; ___m_fftw3_MOD_fftw3_mpiforw_manywf in lib52_fft_mpi_noabirule.a(m_fftw3.o)<br />&nbsp; &nbsp; &nbsp; ___m_fftw3_MOD_fftw3_mpiback_manywf in lib52_fft_mpi_noabirule.a(m_fftw3.o)<br />&nbsp; &nbsp; &nbsp; ___m_fftw3_MOD_fftw3_accrho in lib52_fft_mpi_noabirule.a(m_fftw3.o)<br />&nbsp; &nbsp; &nbsp; ___m_fftw3_MOD_fftw3_applypot in lib52_fft_mpi_noabirule.a(m_fftw3.o)<br />&nbsp; &nbsp; &nbsp; ___m_fftw3_MOD_fftw3_mpiforw in lib52_fft_mpi_noabirule.a(m_fftw3.o)<br />&nbsp; &nbsp; &nbsp; ___m_fftw3_MOD_fftw3_mpiback in lib52_fft_mpi_noabirule.a(m_fftw3.o)<br />&nbsp; &nbsp; &nbsp; ...<br />&nbsp; &quot;_dfftw_execute_dft_&quot;, referenced from:<br />&nbsp; &nbsp; &nbsp; ___m_fftw3_MOD_fftw3_applypot_many in lib52_fft_mpi_noabirule.a(m_fftw3.o)<br />&nbsp; &nbsp; &nbsp; ___m_fftw3_MOD_fftw3_mpiforw_manywf in lib52_fft_mpi_noabirule.a(m_fftw3.o)<br />&nbsp; &nbsp; &nbsp; ___m_fftw3_MOD_fftw3_mpiback_manywf in lib52_fft_mpi_noabirule.a(m_fftw3.o)<br />&nbsp; &nbsp; &nbsp; ___m_fftw3_MOD_fftw3_accrho in lib52_fft_mpi_noabirule.a(m_fftw3.o)<br />&nbsp; &nbsp; &nbsp; ___m_fftw3_MOD_fftw3_applypot in lib52_fft_mpi_noabirule.a(m_fftw3.o)<br />&nbsp; &nbsp; &nbsp; ___m_fftw3_MOD_fftw3_mpiforw in lib52_fft_mpi_noabirule.a(m_fftw3.o)<br />&nbsp; &nbsp; &nbsp; ___m_fftw3_MOD_fftw3_mpiback in lib52_fft_mpi_noabirule.a(m_fftw3.o)<br /><br />&nbsp;&quot;_dfftw_execute_dft_c2r_&quot;, referenced from:<br />&nbsp; &nbsp; &nbsp; ___m_fftw3_MOD_fftw3_c2r_op in lib52_fft_mpi_noabirule.a(m_fftw3.o)<br />&nbsp; &quot;_dfftw_execute_dft_r2c_&quot;, referenced from:<br />&nbsp; &nbsp; &nbsp; ___m_fftw3_MOD_fftw3_r2c_op in lib52_fft_mpi_noabirule.a(m_fftw3.o)<br />&nbsp; &quot;_dfftw_plan_many_dft_&quot;, referenced from:<br />&nbsp; &nbsp; &nbsp; ___m_fftw3_MOD_zplan_many_dft in lib52_fft_mpi_noabirule.a(m_fftw3.o)<br />&nbsp; &nbsp; &nbsp; ___m_fftw3_MOD_dplan_many_dft_1d in lib52_fft_mpi_noabirule.a(m_fftw3.o)<br />&nbsp; &nbsp; &nbsp; ___m_fftw3_MOD_dplan_many_dft_2d.constprop.2 in lib52_fft_mpi_noabirule.a(m_fftw3.o)<br />&nbsp; &quot;_dfftw_plan_many_dft_c2r_&quot;, referenced from:<br />&nbsp; &nbsp; &nbsp; ___m_fftw3_MOD_dplan_many_dft_c2r.constprop.1 in lib52_fft_mpi_noabirule.a(m_fftw3.o)<br />&nbsp; &quot;_dfftw_plan_many_dft_r2c_&quot;, referenced from:<br />&nbsp; &nbsp; &nbsp; ___m_fftw3_MOD_dplan_many_dft_r2c.constprop.0 in lib52_fft_mpi_noabirule.a(m_fftw3.o)<br />ld: symbol(s) not found for architecture x86_64<br />collect2: error: ld returned 1 exit status<br />make&#91;3&#93;: *** &#91;abinit&#93; Error 1<br />make&#91;2&#93;: *** &#91;all-recursive&#93; Error 1<br />make&#91;1&#93;: *** &#91;all-recursive&#93; Error 1<br />make: *** &#91;all&#93; Error 2<br /><br /></code></pre></div><br /><br />libfftw.a, libfftw.la, libfftw3.3.dylib, libfftw3.a, libfftw3.dylib, libfftw3.la, libfftw3f.3.dylib, libfftw3f.a, libfftw3f.dylib, libfftw3f.la, librfftw.a, and librfftw.la are all located in the /usr/local/lib directory (as I specified in the config file), so I'm not sure what's causing the linking error. <br /><br />Any thoughts or suggestions would be greatly appreciated. For reference, I have also included the config.log.<br /><br />Thanks!<br />Ellen</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Trouble linking to fftw3</h3>
				<div class="date">Posted: <strong>Sat Nov 15, 2014 9:28 pm</strong></div>
				<div class="author">by <strong>jbeuken</strong></div>
				<div class="content">Hi,<br /><br />In our testfarm, I am using the following config file for the bot under Mac OS 10.8 :<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>enable_mpi=&quot;yes&quot;<br />enable_mpi_io=&quot;yes&quot;<br />with_mpi_prefix=&quot;/opt/local&quot;<br />with_trio_flavor=&quot;netcdf+etsf_io&quot;<br />with_etsf_io_incs=&quot;-I/opt/local/include/gcc&quot;<br />with_netcdf_incs=&quot;-I/opt/local/include&quot;<br />with_netcdf_libs=&quot;-L/opt/local/lib -lnetcdf -lnetcdff&quot;<br />with_fft_flavor=&quot;fftw3&quot;<br />with_fft_libs=&quot;-L/opt/local/lib -lfftw3 -lfftw3f&quot;<br />with_linalg_flavor=&quot;atlas+scalapack&quot;<br />with_linalg_incs=&quot;-I/opt/local/include&quot;<br />with_linalg_libs=&quot;-L/opt/local/lib -lscalapack -llapack -lf77blas -lcblas -latlas&quot;<br />with_dft_flavor=&quot;libxc+wannier90&quot;<br />with_libxc_incs=&quot;-I/opt/local/include&quot;<br />with_libxc_libs=&quot;-L/opt/local/lib -lxc&quot;<br />enable_clib=&quot;yes&quot;<br /></code></pre></div><br /><br />and , this is the list of all ports used :<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>&nbsp; gcc48 @4.8.2_0 (active)<br />&nbsp; libgcc @4.8.2_0 (active)<br />&nbsp; <br />&nbsp; fftw-3 @3.3.4_0+gfortran (active)<br />&nbsp; fftw-3-single @3.3.4_0+gfortran (active)<br /><br />&nbsp; etsf_io @1.0.4_0+gcc48 (active)<br />&nbsp; netcdf-fortran @4.2_12+gcc48 (active)<br /><br />&nbsp; atlas @3.10.1_5+gcc48 (active)<br />&nbsp; scalapack @2.0.2_0+gcc48+mpich (active)<br /><br />&nbsp; mpich-default @3.1_0+gcc48<br />&nbsp; mpich-default @3.1_1+gcc48 (active)<br />&nbsp; mpich-gcc48 @3.1_1+fortran (active)<br />&nbsp;<br />&nbsp; libxc @2.0.3_0+gcc48 (active)<br />&nbsp; wannier90 @1.2_0+gcc47 (active)</code></pre></div><br /><br />jmb</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Trouble linking to fftw3</h3>
				<div class="date">Posted: <strong>Mon Nov 17, 2014 1:55 pm</strong></div>
				<div class="author">by <strong>torrent</strong></div>
				<div class="content">Hi,<br /><br />If you just want to use ABINIT (without looking at the src) you can install abinit-7.8.2 directly as a macport package...<br /><br />sudo port install abinit</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Trouble linking to fftw3</h3>
				<div class="date">Posted: <strong>Tue Nov 18, 2014 9:44 pm</strong></div>
				<div class="author">by <strong>esr3d</strong></div>
				<div class="content">Thank you for your replies.<br /><br />Torrent- I have tried installing it as a Macports package using that command, and it installs properly as long as I don't try and link with fftw3.  However, if I try to install it with macports using 'sudo port install abinit +fftw3' then I receive the same error that I get when I compile from source.<br /><br />Jbeuken, I have tried using the config file you provided, but my MPI support is not working.  I will get my MPI support running and then see if installing with that config file works.<br /><br />Thanks again!</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Trouble linking to fftw3</h3>
				<div class="date">Posted: <strong>Wed Nov 19, 2014 10:11 am</strong></div>
				<div class="author">by <strong>torrent</strong></div>
				<div class="content">Are you sure you have installed both fftw-3 and fftw-3-single ports in their <span style="text-decoration: underline">last version</span> (important) ?<br /><br />What is the result of:<br />nm /opt/local/lib/libfftw3f.a | grep dfftw_cleanup<br />and<br />nm /opt/local/lib/libfftw3.a | grep dfftw_cleanup<br />?<br /><br />Your error message indicates that the double precision fftw3 API is missing.<br /><br />If you're not using plane-wave parallelism (and only k, spin, band) fftw-3 does not provide any acceleration; internal Abinit FFTs are efficient (and you can use FFT parallelism with them). On a laptop, abinit can be used without fftw-3...</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Trouble linking to fftw3</h3>
				<div class="date">Posted: <strong>Mon Nov 24, 2014 11:22 pm</strong></div>
				<div class="author">by <strong>esr3d</strong></div>
				<div class="content">Hi,<br /><br />I have the most recent versions of fftw-3 and fftw-3-single (versions 3.3.4_1) that port offers. <br /><br />The result of nm /opt/local/lib/libfftw3f.a | grep dfftw_cleanup is<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>warning: nm: no name list<br />warning: nm: no name list<br />warning: nm: no name list<br />warning: nm: no name list<br />warning: nm: no name list<br /></code></pre></div><br /><br />Similarly, the result of nm /opt/local/lib/libfftw3.a | grep dfftw_cleanup is<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>warning: nm: no name list<br />warning: nm: no name list<br />warning: nm: no name list<br />warning: nm: no name list<br />warning: nm: no name list<br />warning: nm: no name list<br />warning: nm: no name list<br />warning: nm: no name list<br /></code></pre></div><br /><br />I am not too familiar with the 'nm' command.  Do these results confirm that the double precision fftw3 API is missing?<br /><br />I am using a laptop, and can get the Abinit port installed without fftw-3.  I didn't realize the internal Abinit fft's are efficient enough for use on a laptop, thanks!  However, I'm planning on using Wannier90 and I was under the impression that Wannier90 functions better with fftw3.  Do you know if this is correct?<br /><br />Also, when I run the first part of the Wannier90 tutorial (provided by Abinit, <!-- m --><a class="postlink" href="http://www.abinit.org/documentation/helpfiles/for-v7.8/tutorial/lesson_wannier90.html">http://www.abinit.org/documentation/hel ... ier90.html</a><!-- m -->), the job is interrupted by a segfault and I'm unsure if that could be a result of running it without fftw3 or without the parallel version of Abinit.  I've attached the log file.<br /><br />Thanks for your help!<br /><br />~Ellen</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Trouble linking to fftw3</h3>
				<div class="date">Posted: <strong>Tue Nov 25, 2014 10:52 am</strong></div>
				<div class="author">by <strong>torrent</strong></div>
				<div class="content">Hi,<br /><br />Yes, apparently the double precision fftw3 is missing; strange...<br />I'm running Mavericks or Yosemite and it's OK for me.<br />Perhaps it's due to the snow leopard install.<br /><br />I don't know if wannier 90 is more efficient with fftw-3... but it's not connected to Abinit's port.<br />This is managed by wannier90 port, ie the FFT selection for wannier90 has to be given at the level of the wannier90 compilation.<br /><br />I'm not really familiar with the wannier90 code sections in Abinit.<br />But it's seems that you found some kind of bug, apparently connected to a non-initalized size of array (see &quot;size=18446744072846893056&quot; in your log file). Try to post a msg in the &quot;link to other codes&quot; section of the forum... wainting for another developer answer...</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Trouble linking to fftw3</h3>
				<div class="date">Posted: <strong>Tue Dec 02, 2014 4:11 am</strong></div>
				<div class="author">by <strong>esr3d</strong></div>
				<div class="content">Thanks for your input!  I've submitted a post to the 'link to other codes' section and I will look into whether or not I selected fftw-3 during compilation of wannier90 (although I don't believe I did).</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Trouble linking to fftw3</h3>
				<div class="date">Posted: <strong>Thu Dec 04, 2014 2:38 pm</strong></div>
				<div class="author">by <strong>pouillon</strong></div>
				<div class="content">FYI: Wannier90 does not depend on FFTW.</div>
			</div>
			<hr />
			</div>

	<div id="page-footer" class="page-footer">
		<div class="page-number">All times are <span title="Europe/Brussels">UTC+02:00</span><br />Page <strong>1</strong> of <strong>1</strong></div>
			<div class="copyright">
				<p>Powered by <a href="https://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Limited
				</p>
							</div>
	</div>
</div>

</body>

<!-- Mirrored from forum.abinit.org/viewtopic.php?f=3&t=2854&view=print by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 21 Sep 2024 01:47:46 GMT -->
</html>
