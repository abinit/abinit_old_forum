<!DOCTYPE html>
<html dir="ltr" lang="en-gb">

<!-- Mirrored from forum.abinit.org/viewtopic.php?f=19&t=3525&view=print by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 20 Sep 2024 21:57:18 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="robots" content="noindex" />

<title>ABINIT Discussion Forums &bull; Test the performance of abinit8 SCF too slow</title>

<link href="styles/flat-style/theme/print.css" rel="stylesheet">
<link href="styles/flat-style/theme/bidi.css" rel="stylesheet">
</head>
<body id="phpbb" class="ltr">
<div id="wrap" class="wrap">
	<a id="top" class="top-anchor" accesskey="t"></a>

	<div id="page-header">
		<h1>ABINIT Discussion Forums</h1>
		<p>The meeting place for ABINIT users and developers<br /><a href="index.html">https://forum.abinit.org/</a></p>

		<h2>Test the performance of abinit8 SCF too slow</h2>
		<p><a href="viewtopic4a01.html?f=19&amp;t=3525">https://forum.abinit.org/viewtopic.php?f=19&amp;t=3525</a></p>
	</div>

	<div id="page-body" class="page-body">
		<div class="page-number">Page <strong>1</strong> of <strong>1</strong></div>
					<div class="post">
				<h3>Test the performance of abinit8 SCF too slow</h3>
				<div class="date">Posted: <strong>Sun Feb 26, 2017 6:16 pm</strong></div>
				<div class="author">by <strong>Dominic</strong></div>
				<div class="content">I compiled abinit8 with atlas and mpi, calculated my system consisting of 26 atoms and 100 bands on 16 threads, calculation time reached about 10min - 1 hr per iterations. Out of my frustrations, I did the same calculation in Quantum Espresso (compiled with the same library on the same pc), I calculated the same systems with 300 bands, calculation time reached 3s - 30s per iterations.<br /><br />Summary<br /><br />Abinit: 100 bands 10 mins - 1 hr calculation time/iteration<br />Quantum Espresso: 300 bands 3s - 30s calculation time/iteration<br /><br /><br />Conclusion<br /><br />SCF calcuations in Abinit should be improved, In my previous post, I profiled Abinit and found out that opernlb to be a possible culprit. However, upon seeing the performance of QE there might be something else influencing the performance.</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Test the performance of abinit8 SCF too slow</h3>
				<div class="date">Posted: <strong>Sun Feb 26, 2017 6:23 pm</strong></div>
				<div class="author">by <strong>gmatteo</strong></div>
				<div class="content"><blockquote class="uncited"><div>my system consisting of 26 atoms and 100 bands on 16 thread<br /></div></blockquote><br /><br /><ul>* OpenMP threads or MPI processes?<br />* Could you post the input file?<br />* configure options and output of `abinit -b`<br /></ul></div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Test the performance of abinit8 SCF too slow</h3>
				<div class="date">Posted: <strong>Sun Feb 26, 2017 6:45 pm</strong></div>
				<div class="author">by <strong>Dominic</strong></div>
				<div class="content">Hi, I only have MPI threading, no threading in linear algebra. Below is my input file for geometry optimization, there is a lot of iterations here, first is iteration for energy convergence then the iteration in structure, but I can fairly check the LOG file and see clearly that the Iterations for energy convergence is very slow<br /><br />Pseudo potentials comes from abinit source package: Cl.GGA-PBE-paw.abinit and Al.GGA-PBE-paw.abinit<br /><br />mysystem.in<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>ionmov&nbsp; 2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # Use the modified Broyden algorithm<br />occopt 6<br />optcell 2<br />ecutsm 0.5<br />pawecutdg 18<br />ntime&nbsp; &nbsp;100&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />tolmxf&nbsp; 5.0d-2<br />toldff&nbsp; 5.0d-3<br /><br />&#91;b&#93;nband&nbsp; &nbsp; 100 &#91;/b&#93;<br /><br />#Definition of the unit cell<br />acell 7.6495800018 38.0000000000 16.0000000000 angstrom<br /><br />#Definition of the atom types<br />ntypat 2<br />znucl 17 13<br /><br />#Definition of the atoms<br />&#91;b&#93;natom 26&#91;/b&#93;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# There are two atoms<br />typat 1 1 1 1 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 <br /><br />#Definition of the planewave basis set<br />ecut 14&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# Maximal kinetic energy cut-off, in Hartree<br /><br />#Definition of the k-point grid<br />ngkpt 6 1 1 #K points similar to VASP<br />nshiftk 1 #Definition of K-point generator<br />shiftk&nbsp; &nbsp;0.0 0.0 0.0<br /><br />#Definition of the SCF procedure<br />nstep 100<br />diemac 100<br /><br />xred&nbsp; &nbsp; &nbsp; &nbsp;0.223574534&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.158213347&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.800000012<br />&nbsp; &nbsp; &nbsp;0.776425481&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.158213347&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.800000012<br />&nbsp; &nbsp; &nbsp;0.776425481&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.841786623&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.800000012<br />&nbsp; &nbsp; &nbsp;0.223574534&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.841786623&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.800000012<br />&nbsp; &nbsp; &nbsp;0.332109123&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.209108904&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.800000012<br />&nbsp; &nbsp; &nbsp;0.667890906&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.209108904&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.800000012<br />&nbsp; &nbsp; &nbsp;0.168449000&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.267287105&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.800000012<br />&nbsp; &nbsp; &nbsp;0.831551015&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.267287105&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.800000012<br />&nbsp; &nbsp; &nbsp;0.332109123&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.325446516&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.800000012<br />&nbsp; &nbsp; &nbsp;0.667890906&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.325446516&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.800000012<br />&nbsp; &nbsp; &nbsp;0.168449000&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.383643568&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.800000012<br />&nbsp; &nbsp; &nbsp;0.831551015&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.383643568&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.800000012<br />&nbsp; &nbsp; &nbsp;0.332109123&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.441821784&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.800000012<br />&nbsp; &nbsp; &nbsp;0.667890906&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.441821784&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.800000012<br />&nbsp; &nbsp; &nbsp;0.168449000&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.500000000&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.800000012<br />&nbsp; &nbsp; &nbsp;0.831551015&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.500000000&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.800000012<br />&nbsp; &nbsp; &nbsp;0.332109123&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.558178186&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.800000012<br />&nbsp; &nbsp; &nbsp;0.667890906&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.558178186&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.800000012<br />&nbsp; &nbsp; &nbsp;0.168449000&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.616356432&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.800000012<br />&nbsp; &nbsp; &nbsp;0.831551015&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.616356432&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.800000012<br />&nbsp; &nbsp; &nbsp;0.332109123&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.674553514&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.800000012<br />&nbsp; &nbsp; &nbsp;0.667890906&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.674553514&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.800000012<br />&nbsp; &nbsp; &nbsp;0.168449000&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.732712865&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.800000012<br />&nbsp; &nbsp; &nbsp;0.831551015&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.732712865&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.800000012<br />&nbsp; &nbsp; &nbsp;0.332109123&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.790891111&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.800000012<br />&nbsp; &nbsp; &nbsp;0.667890906&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.790891111&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.800000012<br /></code></pre></div><br /><br />Abinit Configure options:<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>&nbsp;=== Build Information === <br />&nbsp; Version&nbsp; &nbsp; &nbsp; &nbsp;: 8.0.8<br />&nbsp; Build target&nbsp; : x86_64_linux_gnu4.7<br />&nbsp; Build date&nbsp; &nbsp; : 20170224<br /><br />&nbsp;=== Compiler Suite === <br />&nbsp; C compiler&nbsp; &nbsp; &nbsp; &nbsp;: gnu4.7<br />&nbsp; C++ compiler&nbsp; &nbsp; &nbsp;: gnu4.7<br />&nbsp; Fortran compiler : gnu4.7<br />&nbsp; CFLAGS&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;:&nbsp; &nbsp;-O3 -mtune=native -march=native&nbsp; -fPIC<br />&nbsp; CXXFLAGS&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;:&nbsp; &nbsp;-O3 -mtune=native -march=native&nbsp; -fPIC<br />&nbsp; FCFLAGS&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; :&nbsp; &nbsp;-ffree-line-length-none -fPIC<br />&nbsp; FC_LDFLAGS&nbsp; &nbsp; &nbsp; &nbsp;:&nbsp; &nbsp; &nbsp;-Wl,-z,muldefs<br /><br />&nbsp;=== Optimizations === <br />&nbsp; Debug level&nbsp; &nbsp; &nbsp; &nbsp; : no<br />&nbsp; Optimization level : aggressive<br />&nbsp; Architecture&nbsp; &nbsp; &nbsp; &nbsp;: intel_xeon<br /><br />&nbsp;=== Multicore === <br />&nbsp; Parallel build : yes<br />&nbsp; Parallel I/O&nbsp; &nbsp;: yes<br />&nbsp; openMP support : no<br />&nbsp; GPU support&nbsp; &nbsp; : no<br /><br />&nbsp;=== Connectors / Fallbacks === <br />&nbsp; Connectors on : yes<br />&nbsp; Fallbacks on&nbsp; : yes<br />&nbsp; DFT flavor&nbsp; &nbsp; : libxc-fallback+atompaw-fallback+bigdft-fallback+wannier90-fallback<br />&nbsp; FFT flavor&nbsp; &nbsp; : none<br />&nbsp; LINALG flavor : atlas<br />&nbsp; MATH flavor&nbsp; &nbsp;: none<br />&nbsp; TIMER flavor&nbsp; : abinit<br />&nbsp; TRIO flavor&nbsp; &nbsp;: netcdf-fallback+etsf_io-fallback<br /><br />&nbsp;=== Experimental features === <br />&nbsp; Bindings&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : @enable_bindings@<br />&nbsp; Exports&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: yes<br />&nbsp; GW double-precision : yes<br /><br />&nbsp;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++<br /><br /><br />&nbsp;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++<br />&nbsp;Default optimizations:<br />&nbsp; &nbsp;-O3 -mtune=native -march=native -faggressive-function-elimination -fstack-arrays<br /><br /><br />&nbsp;Optimizations for 20_datashare:<br />&nbsp; &nbsp;-O0<br /><br /><br />&nbsp;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++<br /><br /><br />&nbsp;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++<br />&nbsp;CPP options activated during the build:<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CC_GNU&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;CXX_GNU&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; FC_GNU<br />&nbsp;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; HAVE_DFT_ATOMPAW&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;HAVE_DFT_BIGDFT&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; HAVE_DFT_LIBXC<br />&nbsp;<br />&nbsp; &nbsp; &nbsp; &nbsp; HAVE_DFT_WANNIER90 HAVE_FC_ALLOCATABLE_DT...&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;HAVE_FC_ASYNC<br />&nbsp;<br />&nbsp; HAVE_FC_COMMAND_ARGUMENT&nbsp; &nbsp; &nbsp; HAVE_FC_COMMAND_LINE&nbsp; &nbsp; &nbsp; &nbsp; HAVE_FC_CONTIGUOUS<br />&nbsp;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;HAVE_FC_CPUTIME&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; HAVE_FC_EXIT&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;HAVE_FC_FLUSH<br />&nbsp;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;HAVE_FC_GAMMA&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; HAVE_FC_GETENV&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; HAVE_FC_INT_QUAD<br />&nbsp;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;HAVE_FC_IOMSG&nbsp; &nbsp; &nbsp;HAVE_FC_ISO_C_BINDING&nbsp; HAVE_FC_ISO_FORTRAN_2008<br />&nbsp;<br />&nbsp; &nbsp; &nbsp; &nbsp; HAVE_FC_LONG_LINES&nbsp; &nbsp; &nbsp; &nbsp; HAVE_FC_MOVE_ALLOC&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;HAVE_FC_PRIVATE<br />&nbsp;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;HAVE_FC_PROTECTED&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;HAVE_FC_STREAM_IO&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; HAVE_FC_SYSTEM<br />&nbsp;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; HAVE_FORTRAN2003&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;HAVE_GW_DPC&nbsp; &nbsp; &nbsp; &nbsp; HAVE_LIBPAW_ABINIT<br />&nbsp;<br />&nbsp; &nbsp; &nbsp; HAVE_LIBTETRA_ABINIT&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;HAVE_LINALG&nbsp; &nbsp; &nbsp; &nbsp; HAVE_LINALG_SERIAL<br />&nbsp;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; HAVE_MPI&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;HAVE_MPI2&nbsp; &nbsp; &nbsp; &nbsp; HAVE_MPI_INTEGER16<br />&nbsp;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;HAVE_MPI_IO HAVE_MPI_TYPE_CREATE_S...&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;HAVE_OS_LINUX<br />&nbsp;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; HAVE_TIMER&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;HAVE_TIMER_ABINIT&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; HAVE_TIMER_MPI<br />&nbsp;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;HAVE_TIMER_SERIAL&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;HAVE_TRIO_ETSF_IO&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; HAVE_TRIO_NETCDF<br />&nbsp;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; USE_MACROAVE&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp;++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</code></pre></div><br /><br />Atlas was builded properly, works nicely in quantum espresso<br /><br />configure options:<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>enable_debug=&quot;no&quot;<br />enable_optim=&quot;aggressive&quot;<br />prefix=&quot;$HOME/MineOS/abinit8-cpu&quot;<br />FC_LDFLAGS_EXTRA=&quot;-Wl,-z,muldefs&quot;<br />enable_mpi=&quot;yes&quot;<br />enable_mpi_io=&quot;yes&quot;<br />with_mpi_prefix=&quot;$HOME/MineOS/openmpi1.6.5-4.7.4&quot;<br />with_trio_flavor=&quot;netcdf+etsf_io&quot;<br />with_linalg_flavor=&quot;atlas&quot;<br />with_linalg_incs=&quot;-I$HOME/MineOS/atlas3-4.7.4/include&quot;<br />with_linalg_libs=&quot;-L$HOME/MineOS/atlas3-4.7.4/lib -lsatlas -lstdc++&quot;<br />with_dft_flavor=&quot;atompaw+bigdft+libxc+wannier90&quot;<br />enable_exports=&quot;yes&quot;<br />enable_gw_dpc=&quot;yes&quot;<br />enable_memory_profiling=&quot;no&quot;<br /></code></pre></div><br /><br />The code optimization is -O3 cause I did use the default code optimization from abinit previously but still got the same thing, by the way, QE was also compiled with -O3 so I thing there is no problem in code optimization.<br /><br />Some note: SPAMHAUS frequently blocks my IP even though I am on Linux and Browser cache is cleared (Yeah and spamhause complains about me having a WINDOWS spamware, buggy spamhaus tsk tsk), so I might reply a bit slow sooner or later. And oh, In case I missed something from the Input, I have have just wrongly deleted or added some characters while editing. The input works fine, its just the iteration for energy convergence which is slow.</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Test the performance of abinit8 SCF too slow</h3>
				<div class="date">Posted: <strong>Sun Feb 26, 2017 9:19 pm</strong></div>
				<div class="author">by <strong>gmatteo</strong></div>
				<div class="content">A few comments on your test.<br /><br />First of all, your calculation is done with 4 k-points in the IBZ and the default eigenvalue solver (conjugate-gradient).<br />The CG eigensolver is very robust but the parallelism is limited to nkpt * nsppol MPI processors.<br /><br />Note that the code does not stop if you run it with mpi_procs &gt; nkpt * nsppol, it just issues a warning in the log file<br />In your benchmark there are 12 processes that are completely idle and this explains why the wall-time per iteration is so large.<br />I suggest to use paral_kgb =1 (the lobpcg eigenvalue solver) to treat this case because in paral_kgb = 1 one can <br />take advantage of additional levels of parallelism (MPI-FFT with npfft, band parallelism with npband, spinor and atom parallelism)<br />If I use:<br /><br />paral_kgb 1<br />npkpt 4 <br />npfft 4 <br />npband 1<br /><br />I get much more reasonable results for time/iteration with 100 bands (&lt; 30 seconds).<br />Obviously you can use more CPUS and activate the band parallelism when the scalability of MPI-FFT begins to saturate<br /><br />I've noticed  that you are using the internal FFT routines and the FFT mesh in your benchmark is not that small.<br />I suggest an optimized external library for FFT.<br />In abinit/doc/build/config-examples there are several examples for fftw3 and mkl.<br />Other examples for HPC clusters are available at <!-- m --><a class="postlink" href="https://github.com/abinit/abiconfig">https://github.com/abinit/abiconfig</a><!-- m --><br /><br />If I use perf to profile the code with 300 bands, I find that the most CPU-demanding sections are: <br /><br />  12.83%  abinit   abinit                      [.] opernlb_ylm_<br />   8.81%  abinit   [unknown]                [k] 0xffffffff811b691a<br />   6.77%  abinit   abinit                       [.] opernla_ylm_<br />   6.64%  abinit   libmkl_avx2.so          [.] mkl_blas_avx2_xzgemv<br />   6.29%  abinit   libmkl_avx2.so          [.] mkl_blas_avx2_zgemm_zccopy_right6_ea<br /><br />The other sections score less than 5%.<br />In a previous post, Jordan wrote that he has been working on a improved version of the opernlb kernels that will hopefully<br />reduce the time spent for the application of the non-local part.<br /><br />Best regards,<br />M</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Test the performance of abinit8 SCF too slow</h3>
				<div class="date">Posted: <strong>Mon Feb 27, 2017 5:01 pm</strong></div>
				<div class="author">by <strong>Dominic</strong></div>
				<div class="content">Hi, all good now, from 10 mins - 1hr into &lt; 1.5 mins, that is an ultimate huge Improvements! Maybe I have got to tweak my build further, however why was this cool feature not automatically optimized by Abinit Or something like Abinit defaults to fastest possible settings unless modified by the user?</div>
			</div>
			<hr />
			</div>

	<div id="page-footer" class="page-footer">
		<div class="page-number">All times are <span title="Europe/Brussels">UTC+02:00</span><br />Page <strong>1</strong> of <strong>1</strong></div>
			<div class="copyright">
				<p>Powered by <a href="https://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Limited
				</p>
							</div>
	</div>
</div>

</body>

<!-- Mirrored from forum.abinit.org/viewtopic.php?f=19&t=3525&view=print by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 20 Sep 2024 21:57:18 GMT -->
</html>
