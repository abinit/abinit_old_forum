<!DOCTYPE html>
<html dir="ltr" lang="en-gb">

<!-- Mirrored from forum.abinit.org/viewtopic.php?f=3&t=1614&view=print by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 21 Sep 2024 02:53:50 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="robots" content="noindex" />

<title>ABINIT Discussion Forums &bull; 【Solved】Compiling error in 12_hide_mpi by PathScale</title>

<link href="styles/flat-style/theme/print.css" rel="stylesheet">
<link href="styles/flat-style/theme/bidi.css" rel="stylesheet">
</head>
<body id="phpbb" class="ltr">
<div id="wrap" class="wrap">
	<a id="top" class="top-anchor" accesskey="t"></a>

	<div id="page-header">
		<h1>ABINIT Discussion Forums</h1>
		<p>The meeting place for ABINIT users and developers<br /><a href="index.html">https://forum.abinit.org/</a></p>

		<h2>【Solved】Compiling error in 12_hide_mpi by PathScale</h2>
		<p><a href="viewtopica2ee.html?f=3&amp;t=1614">https://forum.abinit.org/viewtopic.php?f=3&amp;t=1614</a></p>
	</div>

	<div id="page-body" class="page-body">
		<div class="page-number">Page <strong>1</strong> of <strong>1</strong></div>
					<div class="post">
				<h3>【Solved】Compiling error in 12_hide_mpi by PathScale</h3>
				<div class="date">Posted: <strong>Sat Apr 14, 2012 1:56 pm</strong></div>
				<div class="author">by <strong>vistawanted</strong></div>
				<div class="content">I am using PathScale ( the nightly version which can be downloaded from <span style="color: blue"> <!-- m --><a class="postlink" href="http://www.pathscale.com/ekopath-compiler-suite">http://www.pathscale.com/ekopath-compiler-suite</a><!-- m --></span> ) for mpich2 and pathscale compiling.<br />The system is Red Hat Enterprise Linux 6.2 x86_64 Server, and mpich2 is the 1.4.1p version.<br />I have compiled MPICH2 by <div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>&nbsp;./configure --preifx=xxx FC=pathf90 FCFLAGS=-O3 --with-romio --disable-weak-symbols --enable-f90modules </code></pre></div><br />Then, after add the {mpich_install}/bin to the environment variable, I began configurate Abinit 6.12.3 by <div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>&nbsp;./configure --prefix=xxx --enable-mpi=yes FC=mpif90 --with-dft-flavor=&quot;libxc&quot; </code></pre></div><br />Then, I use <div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>&nbsp;make mj4 </code></pre></div> to run the compile process, until the error happen:<br /><blockquote class="uncited"><div>mpif90 -DHAVE_CONFIG_H -I. -I../.. -I../../src/incs -I../../src/incs -I/home/vbox/Downloads/abinit-6.12.3/fallbacks/exports/include   -freeform -module /home/vbox/Downloads/abinit-6.12.3/src/mods -O2 -g -extend-source  -c -o interfaces_12_hide_mpi.o interfaces_12_hide_mpi.F90<br /><br />MODULE m_xmpi<br />       ^      <br />pathf95-855 pathf90: ERROR M_XMPI, File = m_xmpi.F90, Line = 30, Column = 8 <br />  The compiler has detected errors in module &quot;M_XMPI&quot;.  No module information file will be created for this module.<br /><br /> call MPI_Type_hvector(ny,1,stride_x,column_type,new_type,mpi_err)<br />                            ^                                      <br />pathf95-1307 pathf90: ERROR XMPIO_CREATE_FSUBARRAY_2D, File = m_xmpi.F90, Line = 2214, Column = 29 <br />  The kind (4) of this actual argument does not match that of its associated dummy argument (8).<br /><br /> call MPI_Type_hvector(ny,1,stride_x,column_type,plane_type,mpi_err)<br />                            ^                                        <br />pathf95-1307 pathf90: ERROR XMPIO_CREATE_FSUBARRAY_3D, File = m_xmpi.F90, Line = 2297, Column = 29 <br />  The kind (4) of this actual argument does not match that of its associated dummy argument (8).<br /><br /> call MPI_Type_hvector(nz,1,ldy*stride_x,plane_type,new_type,mpi_err)<br />                               ^                                      <br />pathf95-1307 pathf90: ERROR XMPIO_CREATE_FSUBARRAY_3D, File = m_xmpi.F90, Line = 2299, Column = 32 <br />  The kind (4) of this actual argument does not match that of its associated dummy argument (8).<br /><br /> call MPI_Type_hvector(ny,1,stride_x,column_type,plane_type,mpi_err)<br />                            ^                                        <br />pathf95-1307 pathf90: ERROR XMPIO_CREATE_FSUBARRAY_4D, File = m_xmpi.F90, Line = 2383, Column = 29 <br />  The kind (4) of this actual argument does not match that of its associated dummy argument (8).<br /><br /> call MPI_Type_hvector(nz,1,ldy*stride_x,plane_type,vol_type,mpi_err)<br />                               ^                                      <br />pathf95-1307 pathf90: ERROR XMPIO_CREATE_FSUBARRAY_4D, File = m_xmpi.F90, Line = 2385, Column = 32 <br />  The kind (4) of this actual argument does not match that of its associated dummy argument (8).<br /><br /> call MPI_Type_hvector(na,1,ldz*ldy*stride_x,vol_type,new_type,mpi_err)<br />                                   ^                                    <br />pathf95-1307 pathf90: ERROR XMPIO_CREATE_FSUBARRAY_4D, File = m_xmpi.F90, Line = 2387, Column = 36 <br />  The kind (4) of this actual argument does not match that of its associated dummy argument (8).<br /><br />pathf95: PathScale(TM) Fortran Version 4.0.12.1 (f14) Sat Apr 14, 2012  17:20:47<br />pathf95: 14684 source lines<br />pathf95: 7 Error(s), 0 Warning(s), 0 Other message(s), 0 ANSI(s)<br />pathf95: &quot;explain pathf95-message number&quot; gives more information about each message<br />make[5]: *** [m_xmpi.o] Error 1<br />make[5]: Leaving directory `....<br /></div></blockquote><br />Since my CPU is AMD Phenom II x6, I think PathScale should provide better speed and compatity than ifort does. How can I overcome this problem? Any suggestion will be welcome.</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Compiling error in 12_hide_mpi by PathScale</h3>
				<div class="date">Posted: <strong>Sat Apr 14, 2012 9:09 pm</strong></div>
				<div class="author">by <strong>jbeuken</strong></div>
				<div class="content">Dear Gao Zhe,<br /><br />In our test farm, we have a bot with PathScale Compiler ( ekopath 4.0.12 ) and use OpenMPI 1.4.4.<br />with version 6.12.3,  all tests ( with all plugins ) pass except test Q4 of MPI-IO<br /><br />my some tests with the  nightly version have failed ( even with the paid version &lt; 4.0.12 )<br /><br />for infos :<br /><br />this is my script to compile OpenMPI :<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>#!/bin/bash<br />#<br />export CC='pathcc'<br />export CFLAGS='-O2 -m64'<br />export F77='pathf90'<br />export F77FLAGS=' -O2 -m64'<br />export FC='pathf90'<br />export FCFLAGS='-O2 -m64'<br />#<br />../configure --prefix=/usr/local/openmpi-1.4.4-psc \<br />&nbsp; &nbsp;&nbsp; &nbsp; --disable-ipv6&nbsp; --enable-static \<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; --enable-mpi-f77 --enable-mpi-f90 \<br />&nbsp; &nbsp;&nbsp; &nbsp; --enable-mpi-profile \<br />&nbsp; &nbsp;&nbsp; &nbsp; --disable-mpi-cxx --disable-mpi-cxx-seek \&nbsp; &nbsp;&nbsp; &nbsp;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; --enable-contrib-no-build=libnbc,vt \<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; --enable-mca-no-build=maffinity,btl-portals </code></pre></div><br /><br />and this is my *.ac file to configure of abinit :<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>enable_64bit_flags=&quot;yes&quot;<br />enable_mpi=&quot;yes&quot;<br />enable_mpi_io=&quot;no&quot;<br />with_mpi_prefix=&quot;/usr/local/openmpi-path64&quot;<br />with_linalg_flavor=&quot;netlib&quot;<br />with_linalg_libs=&quot;-L/usr/local/lib64/linalg_psc -llapack -lblas&quot;<br />enable_clib=&quot;yes&quot;<br />enable_gw_dpc=&quot;yes&quot;</code></pre></div><br /><br />regards<br /><br />jmb</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Compiling error in 12_hide_mpi by PathScale</h3>
				<div class="date">Posted: <strong>Sat Apr 14, 2012 10:41 pm</strong></div>
				<div class="author">by <strong>vistawanted</strong></div>
				<div class="content"><blockquote><div><cite>jbeuken wrote:</cite>Dear Gao Zhe,<br /><br />In our test farm, we have a bot with PathScale Compiler ( ekopath 4.0.12 ) and use OpenMPI 1.4.4.<br />with version 6.12.3,  all tests ( with all plugins ) pass except test Q4 of MPI-IO<br /><br />my some tests with the  nightly version have failed ( even with the paid version &lt; 4.0.12 )<br /><br />......<br /><br />regards<br /><br />jmb</div></blockquote><br /><br />Dear jbeuken<br />Thanks for your reply.<br />I tried several times with different parameters and found that the error in m_xmpi.F90 code can be solved by adding -i8 into FCFLAGS.<br />However, -r8 cannot be added due to the compiling error in etsf_io.<br />Finally, my compiling stopped at 28_numeric_noabirule as:<br /><blockquote class="uncited"><div>make[5]: Entering directory `/home/vbox/Downloads/abinit-6.12.3/src/28_numeric_noabirule'<br />mpif90 -DHAVE_CONFIG_H -I. -I../.. -I../../src/incs -I../../src/incs -I/home/vbox/Downloads/abinit-6.12.3/fallbacks/exports/include   -freeform -module /home/vbox/Downloads/abinit-6.12.3/src/mods  -m64 -align64 -i8 -fullwarn -c -o m_bspline.o m_bspline.F90<br /><br />### Assertion failure at line 110 of /var/atlassian/application-data/bamboo/xml-data/build-dir/EKOPATH-NIGHTLYLINUX-RELEASE/src/ekopath-suite/ekopath/compiler/src/be/lno/dep.cxx:<br />### Compiler Error in file m_bspline.F90 during Loop Nest Optimizer phase:<br />### num_dim = 16 is too large in Create_DEPV_ARRAY<br />Signal: Aborted in Loop Nest Optimizer phase.<br />Error: Signal Aborted in phase Loop Nest Optimizer -- processing aborted<br />*** Internal stack backtrace:<br />    /home/vbox/Program/PathScale/lib/4.0.12.1/x8664/be() [0xb96abe]<br />    /home/vbox/Program/PathScale/lib/4.0.12.1/x8664/be() [0xb96911]<br />    /home/vbox/Program/PathScale/lib/4.0.12.1/x8664/be() [0xb95851]<br />    /home/vbox/Program/PathScale/lib/4.0.12.1/x8664/be(ErrMsg_Report+0x44) [0xb97c60]<br />    /home/vbox/Program/PathScale/lib/4.0.12.1/x8664/be(ErrMsgLine+0xaf) [0xb97b5b]<br />    /home/vbox/Program/PathScale/lib/4.0.12.1/x8664/be() [0xb96d20]<br />    /lib64/libc.so.6() [0x3f09632900]<br />    /lib64/libc.so.6(gsignal+0x35) [0x3f09632885]<br />    /lib64/libc.so.6(abort+0x175) [0x3f09634065]<br />    /lib64/libc.so.6() [0x3f0966f7a7]<br />    /lib64/libc.so.6() [0x3f096750c6]<br />    /home/vbox/Program/PathScale/lib/4.0.12.1/x8664/be(_ZN23RELATED_SEGMENTED_ARRAYI7BE_PREGLj128EED1Ev+0x56) [0xf4d550]<br />    /home/vbox/Program/PathScale/lib/4.0.12.1/x8664/be() [0xf4d6f8]<br />    /home/vbox/Program/PathScale/lib/4.0.12.1/x8664/be() [0x7073b3]<br />    /lib64/libc.so.6(exit+0xe2) [0x3f09635d92]<br />    [0x3f09021718]<br />    [0x3d850fc085002111]<br />pathf90 ERROR: execute '/home/vbox/Program/PathScale/lib/4.0.12.1/x8664/be' failed: Died due to unknown signal<br />make[5]: *** [m_bspline.o] Error 1<br />make[5]: Leaving directory `/home/vbox/Downloads/abinit-6.12.3/src/28_numeric_noabirule'<br />make[4]: *** [all-recursive] Error 1<br /></div></blockquote><br />Some additional error message:<br /><blockquote class="uncited"><div>*** glibc detected *** /home/vbox/Program/PathScale/lib/4.0.12.1/x8664/be: free(): invalid pointer: 0x0000000003c3fec0 ***<br />======= Backtrace: =========<br />/lib64/libc.so.6[0x3f096750c6]<br />/home/vbox/Program/PathScale/lib/4.0.12.1/x8664/be(_ZN23RELATED_SEGMENTED_ARRAYI7BE_PREGLj128EED1Ev+0x56)[0xf4d550]<br />/home/vbox/Program/PathScale/lib/4.0.12.1/x8664/be[0xf4d6f8]<br />/home/vbox/Program/PathScale/lib/4.0.12.1/x8664/be[0x7073b3]<br />======= Memory map: ========<br />00400000-01857000 r-xp 00000000 08:01 543455                             /home/vbox/Program/PathScale/lib/4.0.12.1/x8664/be<br />01a57000-01a8a000 rw-p 01457000 08:01 543455                             /home/vbox/Program/PathScale/lib/4.0.12.1/x8664/be<br />01a8a000-02b3f000 rw-p 00000000 00:00 0 <br />0331e000-03e1f000 rw-p 00000000 00:00 0                                  [heap]<br />3f08e00000-3f08e20000 r-xp 00000000 08:01 942813                         /lib64/ld-2.12.so<br />3f0901f000-3f09020000 r--p 0001f000 08:01 942813                         /lib64/ld-2.12.so<br />3f09020000-3f09021000 rw-p 00020000 08:01 942813                         /lib64/ld-2.12.so<br />3f09021000-3f09022000 rw-p 00000000 00:00 0 <br />3f09200000-3f09283000 r-xp 00000000 08:01 942827                         /lib64/libm-2.12.so<br />3f09283000-3f09482000 ---p 00083000 08:01 942827                         /lib64/libm-2.12.so<br />3f09482000-3f09483000 r--p 00082000 08:01 942827                         /lib64/libm-2.12.so<br />3f09483000-3f09484000 rw-p 00083000 08:01 942827                         /lib64/libm-2.12.so<br />3f09600000-3f09797000 r-xp 00000000 08:01 942814                         /lib64/libc-2.12.so<br />3f09797000-3f09997000 ---p 00197000 08:01 942814                         /lib64/libc-2.12.so<br />3f09997000-3f0999b000 r--p 00197000 08:01 942814                         /lib64/libc-2.12.so<br />3f0999b000-3f0999c000 rw-p 0019b000 08:01 942814                         /lib64/libc-2.12.so<br />3f0999c000-3f099a1000 rw-p 00000000 00:00 0 <br />3f09a00000-3f09a17000 r-xp 00000000 08:01 942815                         /lib64/libpthread-2.12.so<br />3f09a17000-3f09c16000 ---p 00017000 08:01 942815                         /lib64/libpthread-2.12.so<br />3f09c16000-3f09c17000 r--p 00016000 08:01 942815                         /lib64/libpthread-2.12.so<br />3f09c17000-3f09c18000 rw-p 00017000 08:01 942815                         /lib64/libpthread-2.12.so<br />3f09c18000-3f09c1c000 rw-p 00000000 00:00 0 <br />3f09e00000-3f09e02000 r-xp 00000000 08:01 942820                         /lib64/libdl-2.12.so<br />3f09e02000-3f0a002000 ---p 00002000 08:01 942820                         /lib64/libdl-2.12.so<br />3f0a002000-3f0a003000 r--p 00002000 08:01 942820                         /lib64/libdl-2.12.so<br />3f0a003000-3f0a004000 rw-p 00003000 08:01 942820                         /lib64/libdl-2.12.so<br />3f14e00000-3f14e16000 r-xp 00000000 08:01 942850                         /lib64/libgcc_s-4.4.6-20110824.so.1<br />3f14e16000-3f15015000 ---p 00016000 08:01 942850                         /lib64/libgcc_s-4.4.6-20110824.so.1<br />3f15015000-3f15016000 rw-p 00015000 08:01 942850                         /lib64/libgcc_s-4.4.6-20110824.so.1<br />2af84db17000-2af84db18000 rw-p 00000000 00:00 0 <br />2af84db2f000-2af84db32000 rw-p 00000000 00:00 0 <br />2af84db32000-2af84db5d000 r-xp 00000000 08:01 543447                     /home/vbox/Program/PathScale/lib/4.0.12.1/x8664/sandy.so<br />2af84db5d000-2af84dd5c000 ---p 0002b000 08:01 543447                     /home/vbox/Program/PathScale/lib/4.0.12.1/x8664/sandy.so<br />2af84dd5c000-2af84dd5d000 rw-p 0002a000 08:01 543447                     /home/vbox/Program/PathScale/lib/4.0.12.1/x8664/sandy.so<br />2af84dd5d000-2af84dd5e000 rw-p 00000000 00:00 0 <br />2af84de2b000-2af84e330000 rw-p 00000000 00:00 0 <br />7fff4eb61000-7fff4eb7f000 rw-p 00000000 00:00 0                          [stack]<br />7fff4ebff000-7fff4ec00000 r-xp 00000000 00:00 0                          [vdso]<br />ffffffffff600000-ffffffffff601000 r-xp 00000000 00:00 0                  [vsyscall]<br /></div></blockquote><br />Acctually, because of the information <span style="color: red"><strong class="text-strong">num_dim = 16 is too large in Create_DEPV_ARRAY</strong></span>, I tried to add -arign64 into FCFLAGS, but the same error occured......</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Compiling error in 12_hide_mpi by PathScale</h3>
				<div class="date">Posted: <strong>Sun Apr 15, 2012 5:53 am</strong></div>
				<div class="author">by <strong>vistawanted</strong></div>
				<div class="content">I have checked some information about PathScale in the source file dpp.cxx and found:<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>extern DEPV_ARRAY *<br />&nbsp; &nbsp;Create_DEPV_ARRAY(mUINT8 num_vec, mUINT8 num_dim, mUINT8 num_unused_dim, MEM_POOL *pool)<br />&nbsp;{<br />&nbsp; &nbsp;// the size of the data is sizeof(DEPV) * num_vec*num_dim<br />&nbsp; &nbsp;DEPV_ARRAY *result = (DEPV_ARRAY *) MEM_POOL_Alloc(pool,sizeof(DEPV_ARRAY) + (num_vec*num_dim-1)*sizeof(DEPV));<br />&nbsp; &nbsp;FmtAssert(num_dim &lt;= 15,&nbsp; (&quot;num_dim = %d is too large in Create_DEPV_ARRAY&quot;,num_dim));<br />&nbsp; &nbsp;FmtAssert(num_unused_dim &lt;= 15,&nbsp; &nbsp;(&quot;num_unused_dim = %d is too large in Create_DEPV_ARRAY&quot;,num_unused_dim));<br />&nbsp; &nbsp;result-&gt;_num_vec = num_vec;<br />&nbsp; &nbsp;result-&gt;_dim = (num_unused_dim &lt;&lt; 4) | num_dim;<br />&nbsp; &nbsp;return(result);<br />&nbsp;}<br /></code></pre></div><br />It seems that PathScale does not support num_dim larger than 15 but the one given by Abinit is 16~ <img class="smilies" src="images/smilies/icon_eek.gif" alt=":shock:" title="Shocked" /> Does this mean that there is almost no method to solve this problem?  <img class="smilies" src="images/smilies/icon_e_sad.gif" alt=":(" title="Sad" /></div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Compiling error in 12_hide_mpi by PathScale</h3>
				<div class="date">Posted: <strong>Sun Apr 15, 2012 11:43 am</strong></div>
				<div class="author">by <strong>vistawanted</strong></div>
				<div class="content"><img class="smilies" src="images/smilies/icon_e_biggrin.gif" alt=":D" title="Very Happy" /> OK, I solved it, such a num_dim problem can be avoided by changing optizimation level~</div>
			</div>
			<hr />
			</div>

	<div id="page-footer" class="page-footer">
		<div class="page-number">All times are <span title="Europe/Brussels">UTC+02:00</span><br />Page <strong>1</strong> of <strong>1</strong></div>
			<div class="copyright">
				<p>Powered by <a href="https://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Limited
				</p>
							</div>
	</div>
</div>

</body>

<!-- Mirrored from forum.abinit.org/viewtopic.php?f=3&t=1614&view=print by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 21 Sep 2024 02:53:50 GMT -->
</html>
