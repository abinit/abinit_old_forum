<!DOCTYPE html>
<html dir="ltr" lang="en-gb">

<!-- Mirrored from forum.abinit.org/viewtopic.php?f=11&t=1956&view=print by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 21 Sep 2024 01:14:54 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="robots" content="noindex" />

<title>ABINIT Discussion Forums &bull; [SOLVED]screening calculation terminates with too many procs</title>

<link href="styles/flat-style/theme/print.css" rel="stylesheet">
<link href="styles/flat-style/theme/bidi.css" rel="stylesheet">
</head>
<body id="phpbb" class="ltr">
<div id="wrap" class="wrap">
	<a id="top" class="top-anchor" accesskey="t"></a>

	<div id="page-header">
		<h1>ABINIT Discussion Forums</h1>
		<p>The meeting place for ABINIT users and developers<br /><a href="index.html">https://forum.abinit.org/</a></p>

		<h2>[SOLVED]screening calculation terminates with too many procs</h2>
		<p><a href="viewtopic79e6.html?f=11&amp;t=1956">https://forum.abinit.org/viewtopic.php?f=11&amp;t=1956</a></p>
	</div>

	<div id="page-body" class="page-body">
		<div class="page-number">Page <strong>1</strong> of <strong>1</strong></div>
					<div class="post">
				<h3>[SOLVED]screening calculation terminates with too many procs</h3>
				<div class="date">Posted: <strong>Sat Jan 19, 2013 11:47 pm</strong></div>
				<div class="author">by <strong>raul_l</strong></div>
				<div class="content">I'm not sure if the following problem is related to abinit, Intel mpi or something else. I thought I'd ask here first and then consult the cluster administrators if necessary.<br />I'm trying to do a screening calculation using the following input:<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code># CdWO4 - geometry optimized for WC06 10/01/13-gw<br /><br />acell 9.5002266139 11.166582897 9.6076647657<br />angdeg 90 91.1744636516631 90<br />ntypat 3<br />znucl 48 74 8<br />natom 12<br />typat 1 1 2 2 3 3 3 3 3 3 3 3<br />xred<br />&nbsp; &nbsp; &nbsp; &nbsp;0.500000000000&nbsp; &nbsp; &nbsp; 0.310555555482&nbsp; &nbsp; &nbsp; 0.750000000000<br />&nbsp; &nbsp; &nbsp; -0.500000000000&nbsp; &nbsp; &nbsp;-0.310555555482&nbsp; &nbsp; &nbsp;-0.750000000000<br />&nbsp; &nbsp; &nbsp; &nbsp;0.000000000000&nbsp; &nbsp; &nbsp; 0.176323504801&nbsp; &nbsp; &nbsp; 0.250000000000<br />&nbsp; &nbsp; &nbsp; &nbsp;0.000000000000&nbsp; &nbsp; &nbsp;-0.176323504801&nbsp; &nbsp; &nbsp;-0.250000000000<br />&nbsp; &nbsp; &nbsp; &nbsp;0.245393128716&nbsp; &nbsp; &nbsp; 0.370110158446&nbsp; &nbsp; &nbsp; 0.385018997706<br />&nbsp; &nbsp; &nbsp; -0.245393128716&nbsp; &nbsp; &nbsp;-0.370110158446&nbsp; &nbsp; &nbsp;-0.385018997706<br />&nbsp; &nbsp; &nbsp; &nbsp;0.245393128716&nbsp; &nbsp; &nbsp;-0.370110158446&nbsp; &nbsp; &nbsp; 0.885018997706<br />&nbsp; &nbsp; &nbsp; -0.245393128716&nbsp; &nbsp; &nbsp; 0.370110158446&nbsp; &nbsp; &nbsp;-0.885018997706<br />&nbsp; &nbsp; &nbsp; &nbsp;0.201581562187&nbsp; &nbsp; &nbsp; 0.096340377830&nbsp; &nbsp; &nbsp; 0.945468039038<br />&nbsp; &nbsp; &nbsp; -0.201581562187&nbsp; &nbsp; &nbsp;-0.096340377830&nbsp; &nbsp; &nbsp;-0.945468039038<br />&nbsp; &nbsp; &nbsp; &nbsp;0.201581562187&nbsp; &nbsp; &nbsp;-0.096340377830&nbsp; &nbsp; &nbsp; 1.445468039038<br />&nbsp; &nbsp; &nbsp; -0.201581562187&nbsp; &nbsp; &nbsp; 0.096340377830&nbsp; &nbsp; &nbsp;-1.445468039038<br /><br />ngkpt 3*2<br />nshiftk 1<br />shiftk 3*0<br />nband 2874 # 58 vb, 2816 cb<br /><br />gwcomp 1 gwencomp 7<br /><br />ecut 17<br />pawecutdg 60<br />ecuteps 8<br /><br />gwpara 2<br /><br />optdriver 3<br /># gwcalctyp 2<br /><br />istwfk *1<br />symchi 1<br /><br />inclvkb 2<br /></code></pre></div><br />With 256 processors the calculation runs for a few minutes but then ends with<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>&nbsp;Calculation status (&nbsp; &nbsp; &nbsp; 8 to be completed):<br />-P-0000&nbsp; ik =&nbsp; &nbsp; 1 /&nbsp; &nbsp; 8 is =&nbsp; 1 done by processor&nbsp; &nbsp;0<br />APPLICATION TERMINATED WITH THE EXIT STRING: Hangup (signal 1)</code></pre></div><br />If I reduce the number of bands to 1850 the calculation gets a bit farther but then ends with<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>&nbsp;Calculation status (&nbsp; &nbsp; &nbsp; 8 to be completed):<br />-P-0000&nbsp; ik =&nbsp; &nbsp; 1 /&nbsp; &nbsp; 8 is =&nbsp; 1 done by processor&nbsp; &nbsp;0<br />-P-0000&nbsp; ik =&nbsp; &nbsp; 2 /&nbsp; &nbsp; 8 is =&nbsp; 1 done by processor&nbsp; &nbsp;0<br />-P-0000&nbsp; ik =&nbsp; &nbsp; 3 /&nbsp; &nbsp; 8 is =&nbsp; 1 done by processor&nbsp; &nbsp;0<br />-P-0000&nbsp; ik =&nbsp; &nbsp; 4 /&nbsp; &nbsp; 8 is =&nbsp; 1 done by processor&nbsp; &nbsp;0<br />-P-0000&nbsp; ik =&nbsp; &nbsp; 5 /&nbsp; &nbsp; 8 is =&nbsp; 1 done by processor&nbsp; &nbsp;0<br />-P-0000&nbsp; ik =&nbsp; &nbsp; 6 /&nbsp; &nbsp; 8 is =&nbsp; 1 done by processor&nbsp; &nbsp;0<br />-P-0000&nbsp; ik =&nbsp; &nbsp; 7 /&nbsp; &nbsp; 8 is =&nbsp; 1 done by processor&nbsp; &nbsp;0<br />-P-0000&nbsp; ik =&nbsp; &nbsp; 8 /&nbsp; &nbsp; 8 is =&nbsp; 1 done by processor&nbsp; &nbsp;0<br />&#91;0:klots11&#93; unexpected disconnect completion event from &#91;176:klots5&#93;<br />&#91;240:klots21&#93; unexpected disconnect completion event from &#91;176:klots5&#93;<br />Assertion failed in file ../../dapl_conn_rc.c at line 1054: 0<br />internal ABORT - process 240<br />Assertion failed in file ../../dapl_conn_rc.c at line 1054: 0<br />internal ABORT - process 0<br />&#91;16:klots12&#93; unexpected disconnect completion event from &#91;176:klots5&#93;<br />Assertion failed in file ../../dapl_conn_rc.c at line 1054: 0<br />internal ABORT - process 16<br />&#91;32:klots13&#93; unexpected disconnect completion event from &#91;176:klots5&#93;<br />Assertion failed in file ../../dapl_conn_rc.c at line 1054: 0<br />internal ABORT - process 32<br />&#91;48:klots14&#93; unexpected disconnect completion event from &#91;176:klots5&#93;<br />Assertion failed in file ../../dapl_conn_rc.c at line 1054: 0<br />internal ABORT - process 48<br />&#91;64:klots15&#93; unexpected disconnect completion event from &#91;176:klots5&#93;<br />Assertion failed in file ../../dapl_conn_rc.c at line 1054: 0<br />internal ABORT - process 64<br />&#91;80:klots16&#93; unexpected disconnect completion event from &#91;176:klots5&#93;<br />Assertion failed in file ../../dapl_conn_rc.c at line 1054: 0<br />internal ABORT - process 80<br />&#91;96:klots17&#93; unexpected disconnect completion event from &#91;176:klots5&#93;<br />Assertion failed in file ../../dapl_conn_rc.c at line 1054: 0<br />internal ABORT - process 96<br />&#91;112:klots18&#93; unexpected disconnect completion event from &#91;176:klots5&#93;<br />Assertion failed in file ../../dapl_conn_rc.c at line 1054: 0<br />internal ABORT - process 112<br />&#91;128:klots19&#93; unexpected disconnect completion event from &#91;176:klots5&#93;<br />Assertion failed in file ../../dapl_conn_rc.c at line 1054: 0<br />internal ABORT - process 128<br />&#91;144:klots20&#93; unexpected disconnect completion event from &#91;176:klots5&#93;<br />Assertion failed in file ../../dapl_conn_rc.c at line 1054: 0<br />internal ABORT - process 144<br />&#91;160:klots4&#93; unexpected disconnect completion event from &#91;176:klots5&#93;<br />Assertion failed in file ../../dapl_conn_rc.c at line 1054: 0<br />internal ABORT - process 160<br />&#91;208:klots8&#93; unexpected disconnect completion event from &#91;176:klots5&#93;<br />Assertion failed in file ../../dapl_conn_rc.c at line 1054: 0<br />internal ABORT - process 208<br />&#91;166:klots4&#93; unexpected disconnect completion event from &#91;176:klots5&#93;<br />Assertion failed in file ../../dapl_conn_rc.c at line 1054: 0<br />internal ABORT - process 166<br />&#91;92:klots16&#93; unexpected disconnect completion event from &#91;176:klots5&#93;<br />Assertion failed in file ../../dapl_conn_rc.c at line 1054: 0<br />internal ABORT - process 92<br />&#91;148:klots20&#93; unexpected disconnect completion event from &#91;176:klots5&#93;<br />Assertion failed in file ../../dapl_conn_rc.c at line 1054: 0<br />internal ABORT - process 148<br />&#91;24:klots12&#93; unexpected disconnect completion event from &#91;176:klots5&#93;<br />Assertion failed in file ../../dapl_conn_rc.c at line 1054: 0<br />internal ABORT - process 24<br />&#91;165:klots4&#93; unexpected disconnect completion event from &#91;176:klots5&#93;<br />Assertion failed in file ../../dapl_conn_rc.c at line 1054: 0<br />internal ABORT - process 165<br />&#91;proxy:0:1@klots12&#93; HYDT_dmxu_poll_wait_for_event (./tools/demux/demux_poll.c:70): assert (!(pollfds&#91;i&#93;.revents &amp; ~POLLIN &amp; ~POLLOUT &amp; ~POLLHUP)) failed<br />&#91;proxy:0:1@klots12&#93; main (./pm/pmiserv/pmip.c:387): demux engine error waiting for event<br />&#91;proxy:0:9@klots20&#93; HYDT_dmxu_poll_wait_for_event (./tools/demux/demux_poll.c:70): assert (!(pollfds&#91;i&#93;.revents &amp; ~POLLIN &amp; ~POLLOUT &amp; ~POLLHUP)) failed<br />&#91;proxy:0:9@klots20&#93; main (./pm/pmiserv/pmip.c:387): demux engine error waiting for event<br />&#91;proxy:0:10@klots4&#93; HYDT_dmxu_poll_wait_for_event (./tools/demux/demux_poll.c:70): assert (!(pollfds&#91;i&#93;.revents &amp; ~POLLIN &amp; ~POLLOUT &amp; ~POLLHUP)) failed<br />&#91;proxy:0:10@klots4&#93; main (./pm/pmiserv/pmip.c:387): demux engine error waiting for event<br />&#91;proxy:0:7@klots18&#93; HYDT_dmxu_poll_wait_for_event (./tools/demux/demux_poll.c:70): assert (!(pollfds&#91;i&#93;.revents &amp; ~POLLIN &amp; ~POLLOUT &amp; ~POLLHUP)) failed<br />&#91;proxy:0:7@klots18&#93; main (./pm/pmiserv/pmip.c:387): demux engine error waiting for event<br />&#91;mpiexec@klots11&#93; HYDT_bscu_wait_for_completion (./tools/bootstrap/utils/bscu_wait.c:101): one of the processes terminated badly; aborting<br />&#91;mpiexec@klots11&#93; HYDT_bsci_wait_for_completion (./tools/bootstrap/src/bsci_wait.c:18): bootstrap device returned error waiting for completion<br />&#91;mpiexec@klots11&#93; HYD_pmci_wait_for_completion (./pm/pmiserv/pmiserv_pmci.c:521): bootstrap server returned error waiting for completion<br />&#91;mpiexec@klots11&#93; main (./ui/mpich/mpiexec.c:548): process manager error waiting for completion<br /></code></pre></div><br />With 128 processors the calculation runs successfully. With 256 processors but gwcomp set to 0 the calculation also runs successfully. If I split the input over q-points (nqptdm, qptdm) and run both calculations with 128 processors, then one of them ends with a similar error as above, and the other seems to run successfully. I don't know where to look for a mistake. Does it look like a bug in abinit? Any ideas would be welcome.<br />Abinit-7.0.4 is configured with<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>--enable-mpi FC=mpiifort CC=mpiicc CXX=mpiicpc \<br />--with-dft-flavor=libxc+wannier90 \<br />--enable-64bit-flags=&quot;yes&quot; --with-linalg-flavor=mkl \<br />--with-fft-flavor=fftw3 \<br />--with-fft-incs=&quot;-I$HOME/local/fftw/include&quot; \<br />--with-fft-libs=&quot;-L$HOME/local/fftw/lib -lfftw3&quot;</code></pre></div><br />This is my ulimit -a:<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>core file size&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (blocks, -c) unlimited<br />data seg size&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;(kbytes, -d) unlimited<br />scheduling priority&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;(-e) 0<br />file size&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;(blocks, -f) unlimited<br />pending signals&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;(-i) 385703<br />max locked memory&nbsp; &nbsp; &nbsp; &nbsp;(kbytes, -l) unlimited<br />max memory size&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;(kbytes, -m) unlimited<br />open files&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (-n) 1024<br />pipe size&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (512 bytes, -p) 8<br />POSIX message queues&nbsp; &nbsp; &nbsp;(bytes, -q) 819200<br />real-time priority&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (-r) 0<br />stack size&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (kbytes, -s) unlimited<br />cpu time&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;(seconds, -t) unlimited<br />max user processes&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (-u) 300<br />virtual memory&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (kbytes, -v) 4000000<br />file locks&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (-x) unlimited</code></pre></div><br />As a resource manager we use Torque. The Intel compilers have version 12.1.0 20110811.<br />Thanks</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: screening calculation terminates with too many processor</h3>
				<div class="date">Posted: <strong>Sun Jan 20, 2013 8:23 pm</strong></div>
				<div class="author">by <strong>Alain_Jacques</strong></div>
				<div class="content">Hi Raul,<br /><br />As a first step, I would check if you didn't bong against the maximum walltime allowed by torque on the queue selected for your jobs or exceed the maximum memory allocated. The unexpected disconnect is a classic message when torque kills the job for insufficient resources<br />Next I would study the optimum number of parallel slots as reported by prt_kgb - sure of your 128/256 slots?<br /><br />BTW, if you select --with-linalg-flavor=mkl without specifying how to link it, I doubt configure detected the right recipe and probably defaulted to the fallback netlib.<br /><br />Kind regards,<br /><br />Alain</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: screening calculation terminates with too many processor</h3>
				<div class="date">Posted: <strong>Sun Jan 20, 2013 11:16 pm</strong></div>
				<div class="author">by <strong>raul_l</strong></div>
				<div class="content">Thank you for the reply.<br />Maximum walltime of the queue is 400 hours, while my calculation only ran for a few minutes. This is the Torque summary of the calculation:<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>Execution terminated<br />Exit_status=0<br />resources_used.cput=01:25:42<br />resources_used.mem=33177740kb<br />resources_used.vmem=40725464kb<br />resources_used.walltime=00:06:14</code></pre></div><br />Also, I don't think memory consumption is high enough to hit any limit. I'm using 16 nodes with about 40 GB of memory available on each node. I emailed the administrators about my problem and am waiting for their reply.<br /><br />What is prt_kgb? I don't know if 256 is optimal but using 826 bands (768 CBs) I have tried 64, 128 and 256 slots. 64 takes almost twice as much time as 128 and 128 is about 1.4 times slower compared to 256 slots.<br /><br />I think MKL is linked just fine. At the end of configure it says<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>* LINALG flavor = mkl (libs: auto-detected)</code></pre></div><br />Also, by inspecting config.log it appears abinit has found all the correct libraries.</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: screening calculation terminates with too many processor</h3>
				<div class="date">Posted: <strong>Tue Jan 22, 2013 10:02 am</strong></div>
				<div class="author">by <strong>raul_l</strong></div>
				<div class="content">It turns out it was memory after all. 'vmem' of Torque is supposed to be the total memory used, but for some reason it only shows the memory consumption of a single node. As I said, about 40 GB per node is the limit, which explains it. I knew GW calculations were expensive but I didn't imagine I would be using over 600 GB of memory for that!</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: [SOLVED]screening calculation terminates with too many p</h3>
				<div class="date">Posted: <strong>Tue Jan 22, 2013 4:28 pm</strong></div>
				<div class="author">by <strong>gmatteo</strong></div>
				<div class="content">gwmem 10<br /><br />drastically decreases the memory requirements of your run at the price of more FFTs to execute.</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: [SOLVED]screening calculation terminates with too many p</h3>
				<div class="date">Posted: <strong>Thu Feb 21, 2013 10:57 pm</strong></div>
				<div class="author">by <strong>raul_l</strong></div>
				<div class="content">I tried gwmem 0, but saw only a 3% drop in memory usage, which is still large. Excecution time increased about 5%, so gwmem seems to have very little effect. I also tried mkmem 0, but got<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>&nbsp;Subroutine Unknown:0:ERROR<br />&nbsp;mkmem=0 not yet implemented.<br /></code></pre></div><br />I've tried so many different variables but nothing seems to reduce memory. Perhaps the system is too complex and further memory reduction is not possible. I have 12 atoms in the unit cell, including Cd and W, each of which possess 8 partial waves. ecuteps seems to be converged at 9 Ha at the level of 50 meV.</div>
			</div>
			<hr />
			</div>

	<div id="page-footer" class="page-footer">
		<div class="page-number">All times are <span title="Europe/Brussels">UTC+02:00</span><br />Page <strong>1</strong> of <strong>1</strong></div>
			<div class="copyright">
				<p>Powered by <a href="https://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Limited
				</p>
							</div>
	</div>
</div>

</body>

<!-- Mirrored from forum.abinit.org/viewtopic.php?f=11&t=1956&view=print by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 21 Sep 2024 01:14:54 GMT -->
</html>
