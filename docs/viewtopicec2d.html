<!DOCTYPE html>
<html dir="ltr" lang="en-gb">

<!-- Mirrored from forum.abinit.org/viewtopic.php?f=10&t=2138&view=print by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 21 Sep 2024 01:57:26 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="robots" content="noindex" />

<title>ABINIT Discussion Forums &bull; Serial version: Convergence of dataset2 in linear response c</title>

<link href="styles/flat-style/theme/print.css" rel="stylesheet">
<link href="styles/flat-style/theme/bidi.css" rel="stylesheet">
</head>
<body id="phpbb" class="ltr">
<div id="wrap" class="wrap">
	<a id="top" class="top-anchor" accesskey="t"></a>

	<div id="page-header">
		<h1>ABINIT Discussion Forums</h1>
		<p>The meeting place for ABINIT users and developers<br /><a href="index.html">https://forum.abinit.org/</a></p>

		<h2>Serial version: Convergence of dataset2 in linear response c</h2>
		<p><a href="viewtopicd1eb-2.html?f=10&amp;t=2138">https://forum.abinit.org/viewtopic.php?f=10&amp;t=2138</a></p>
	</div>

	<div id="page-body" class="page-body">
		<div class="page-number">Page <strong>1</strong> of <strong>1</strong></div>
					<div class="post">
				<h3>Serial version: Convergence of dataset2 in linear response c</h3>
				<div class="date">Posted: <strong>Tue May 14, 2013 3:09 pm</strong></div>
				<div class="author">by <strong>uma</strong></div>
				<div class="content">As the parallel version 7.2.1 ends up with segmentation fault errors, I am trying to run the serial version to do the linear response calculations for an insulator. I am using the template trf2_1.in. The program was Ok for a 4x4x4 kmesh, diemac =2 and converged within 3000 steps. But when I increase ngkpt to 8x8x8, program runs smoothly, but dataset 2 does not converge even after nstep=5000. I used diemac = 1. Can someone suggest a solution please..?<br />Uma</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Serial version: Convergence of dataset2 in linear respon</h3>
				<div class="date">Posted: <strong>Mon May 20, 2013 5:11 pm</strong></div>
				<div class="author">by <strong>jzwanzig</strong></div>
				<div class="content">What do you mean? That the input file trf2_1.in itself fails? That is pretty unlikely. Have you altered it for your system? If so you will have to post it, otherwise no one can give you advice--</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Serial version: Convergence of dataset2 in linear respon</h3>
				<div class="date">Posted: <strong>Mon May 27, 2013 10:41 am</strong></div>
				<div class="author">by <strong>uma</strong></div>
				<div class="content">Dear Professor,<br />I have now attached the input file that I used for the calculation which ran to completion for all datasets, but dataset2 Energy has not converged ( tolwfr2   1.0d-22). Can you suggest a solution to achieve convergence so that the phonon frequencies based on this calculation could be reliable?<br />Uma<br /><blockquote class="uncited"><div></div></blockquote><br /><span style="color: #FF0000"># computation of the phonon spectrum<br /><br />   ndtset   37<br />#Set 1 : ground state self-consistency<br /><br />  getwfk1   0            # Cancel default<br />  kptopt1   1            # Automatic generation of k points, taking<br />                         # into account the symmetry<br />    nqpt1   0            # Cancel default<br />  tolvrs1   1.0d-18      # SCF stopping criterion (modify default)<br />  rfphon1   0            # Cancel default<br />  getddk1   0<br />  optdriver1 0<br />  rfelfd1 0<br />  tolwfr1  0<br /><br />#Q vectors for all datasets<br /><br />#Complete set of symmetry-inequivalent qpt chosen to be commensurate<br /># with kpt mesh so that only one set of GS wave functions is needed.<br />#Generated automatically by running GS calculation with kptopt=1,<br /># nshift=0, shiftk=0 0 0 (to include gamma) and taking output kpt set<br /># file as qpt set. Set nstep=1 so only one iteration runs.<br /><br />     nqpt   1            # One qpt for each dataset (only 0 or 1 allowed)<br />                         # This is the default for all datasets and must<br />                         #  be explicitly turned off for dataset 1.<br />               <br />              qpt2      0.00000000E+00  0.00000000E+00  0.00000000E+00<br />              qpt3      0.00000000E+00  0.00000000E+00  0.00000000E+00<br />              qpt4        1.25000000E-01  0.00000000E+00  0.00000000E+00<br />              qpt5         2.50000000E-01  0.00000000E+00  0.00000000E+00<br />              qpt6         3.75000000E-01  0.00000000E+00  0.00000000E+00<br />              qpt7         5.00000000E-01  0.00000000E+00  0.00000000E+00<br />              qpt8         1.25000000E-01  1.25000000E-01  0.00000000E+00<br />              qpt9         2.50000000E-01  1.25000000E-01  0.00000000E+00<br />              qpt10         3.75000000E-01  1.25000000E-01  0.00000000E+00<br />              qpt11          5.00000000E-01  1.25000000E-01  0.00000000E+00<br />              qpt12        -3.75000000E-01  1.25000000E-01  0.00000000E+00<br />              qpt13         2.50000000E-01  2.50000000E-01  0.00000000E+00<br />              qpt14         3.75000000E-01  2.50000000E-01  0.00000000E+00<br />              qpt15         1.25000000E-01  1.25000000E-01  1.25000000E-01<br />              qpt16         2.50000000E-01  1.25000000E-01  1.25000000E-01<br />              qpt17         3.75000000E-01  1.25000000E-01  1.25000000E-01<br />              qpt18        -1.25000000E-01  1.25000000E-01  1.25000000E-01<br />              qpt19         2.50000000E-01  2.50000000E-01  1.25000000E-01<br />              qpt20        -2.50000000E-01  2.50000000E-01  1.25000000E-01<br />              qpt21        -1.25000000E-01  2.50000000E-01  1.25000000E-01<br />              qpt22        -3.75000000E-01  3.75000000E-01  1.25000000E-01<br />              qpt23        -2.50000000E-01  3.75000000E-01  1.25000000E-01<br />              qpt24        -1.25000000E-01  3.75000000E-01  1.25000000E-01<br />              qpt25         5.00000000E-01  5.00000000E-01  1.25000000E-01<br />              qpt26        -3.75000000E-01  5.00000000E-01  1.25000000E-01<br />              qpt27        -2.50000000E-01  5.00000000E-01  1.25000000E-01<br />              qpt28        -3.75000000E-01 -3.75000000E-01  1.25000000E-01<br />              qpt29         2.50000000E-01  2.50000000E-01  2.50000000E-01<br />              qpt30        -2.50000000E-01  2.50000000E-01  2.50000000E-01<br />              qpt31        -3.75000000E-01  3.75000000E-01  2.50000000E-01<br />              qpt32        -2.50000000E-01  3.75000000E-01  2.50000000E-01<br />              qpt33         5.00000000E-01  5.00000000E-01  2.50000000E-01<br />              qpt34        -3.75000000E-01  5.00000000E-01  2.50000000E-01<br />              qpt35        -3.75000000E-01  3.75000000E-01  3.75000000E-01<br />              qpt36         5.00000000E-01  5.00000000E-01  3.75000000E-01<br />              qpt37         5.00000000E-01  5.00000000E-01  5.00000000E-01<br /><br />#                   qpt2    0.00000000E+00  0.00000000E+00  0.00000000E+00<br />#                   qpt3    0.00000000E+00  0.00000000E+00  0.00000000E+00<br />#                   qpt4    2.50000000E-01  0.00000000E+00  0.00000000E+00<br />#                   qpt5    5.00000000E-01  0.00000000E+00  0.00000000E+00<br />#                   qpt6    2.50000000E-01  2.50000000E-01  0.00000000E+00<br />#                   qpt7    2.50000000E-01  2.50000000E-01  2.50000000E-01<br />#                   qpt8   -2.50000000E-01  2.50000000E-01  2.50000000E-01<br />#                   qpt9    5.00000000E-01  5.00000000E-01  2.50000000E-01<br />#                   qpt10   5.00000000E-01  5.00000000E-01  5.00000000E-01<br /><br /><br />#Set 2 : Response function calculation of d/dk wave function <br /><br />    iscf2   -3         # Need this non-self-consistent option for d/dk<br />  kptopt2   2          # Modify default to use time-reversal symmetry<br />  rfphon2   0          # Cancel default<br />  rfelfd2   2          # Calculate d/dk wave function only<br />  tolwfr2   1.0d-22    # Use wave function residual criterion instead<br />  getwfk2   1<br />  getddk2    0<br />  optdriver 1<br />  tolvrs2  0<br />#Set 3 : Response function calculation of Q=0 phonons and electric field pert.<br /><br />  getddk3   2          # d/dk wave functions from last dataset<br />  kptopt3   2          # Modify default to use time-reversal symmetry<br />  rfelfd3   3          # Electric-field perturbation response only<br />  getwfk3   1<br />  tolwfr    0<br />#Sets 4-37 : Finite-wave-vector phonon calculations (defaults for all datasets)<br />   getddk    0<br />   getwfk    1          # Use GS wave functions from dataset1<br />   kptopt4   3          # Need full k-point set for finite-Q response<br />   kptopt5   3<br />   kptopt6   3<br />   kptopt7   3<br />   kptopt8   3<br />   kptopt9   3<br />   kptopt10  3<br />   kptopt    3<br />   rfphon   1          # Do phonon response<br />   rfelfd  0<br />   rfatpol   1 4       # Treat displacements of all atoms<br />    rfdir   1 1 1      # Do all directions (symmetry will be used)<br />   tolvrs   1.0d-8     # This default is active for sets 3-10<br /><br />#######################################################################<br />#Common input variables<br /><br />#Definition of the unit cell<br />    acell   3.8037 3.8037 3.8037 angstrom<br />    rprim -0.5000000000000000    0.5000000000000000    0.5000000000000000<br />        0.5000000000000000   -0.5000000000000000    0.5000000000000000<br />        0.5000000000000000    0.5000000000000000   -0.5000000000000000<br /><br />#    rprim   0.0  0.5  0.5   # In lessons 1 and 2, these primitive vectors <br />#            0.5  0.0  0.5   # (to be scaled by acell) were 1 0 0  0 1 0  0 0 1 <br />#            0.5  0.5  0.0   # that is, the default.<br /><br />#Definition of the atom types<br />   ntypat   1         # There is one type of atom<br />    znucl   7.0     # The keyword &quot;znucl&quot; refers to the atomic number of the <br />                      # possible type(s) of atom. The pseudopotential(s) <br />                      # mentioned in the &quot;files&quot; file must correspond<br />                      # to the type(s) of atom. <br /><br />#Definition of the atoms<br />    natom   4         # There are 4 atoms<br />    typat   1 1 1 1   # 4 atoms of the same type N.<br />    xred   0.17000000000000017  0.1700000000000017  0.1700000000000017<br />        0.5000000000000000  0.0000000000000000  0.3299999999999983<br />        0.0000000000000000  0.3299999999999983  0.5000000000000000<br />        0.3299999999999983  0.5000000000000000  0.0000000000000000<br />                   <br />#     xred   0.0  0.0  0.0<br />#            0.25 0.25 0.25  <br /><br />#Gives the number of band, explicitely (do not take the default)<br />    nband   24         <br /><br />#Exchange-correlation functional<br /><br />      ixc   11             # GGA, Perdew-Burke-Ernzerhof GGA functional<br /><br />#Definition of the planewave basis set<br /><br />     ecut   500 eV           # Maximal kinetic energy cut-off, in eV<br />     enunit 2     <br />#Definition of the k-point grid<br />    ngkpt   8 8 8          <br />#     prtkpt   0 <br />   nshiftk   1              # Use one copy of grid only (default)<br />   shiftk   0.0 0.0 0.0    # This gives the usual fcc Monkhorst-Pack grid<br />#            0.5 0.5 0.5<br />#            0.5 0.5 0.5<br />#            0.5 0.5 0.5<br /><br />#Definition of the SCF procedure<br />     iscf   5          # Self-consistent calculation, using algorithm 5<br />    nstep   5000         # Maximal number of SCF cycles<br />   diemac   1.0d0        # Although this is not mandatory, it is worth to<br />                       # precondition the SCF cycle. The model dielectric<br />                       # function used as the standard preconditioner<br />                       # is described in the &quot;dielng&quot; input variable section.<br />                 # add to conserve old &lt; 6.7.2 behavior for calculating forces at each SCF step<br /> optforces 1<br /># rfasr 1<br /> tsmear .04<br />#%%&lt;BEGIN TEST_INFO&gt;<br />#%% [setup]<br />#%% executable = abinit<br />#%% test_chain = trf2_1.in, trf2_3.in, trf2_4.in, trf2_5.in, trf2_6.in, trf2_7.in<br />#%% [files]<br />#%% files_to_test = <br />#%%   trf2_1.out, tolnlines= 13, tolabs=  4.294e-05, tolrel=  5.000e-04, fld_options=-medium<br />#%% psp_files =  13al.981214.fhi, 33as.pspnc <br />#%% [paral_info]<br />#%% max_nprocs = 1<br />#%% [extra_info]<br />#%% author = <br />#%% keywords = NC, DFPT<br />#%% description = <br />#%%&lt;END TEST_INFO&gt;<br /><blockquote class="uncited"><div></div></blockquote></span></div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Serial version: Convergence of dataset2 in linear respon</h3>
				<div class="date">Posted: <strong>Mon May 27, 2013 1:02 pm</strong></div>
				<div class="author">by <strong>jzwanzig</strong></div>
				<div class="content">From your input file it looks like you're trying to model a high pressure phase of nitrogen, that you are treating as metallic (you have tsmear defined, you have nband = 24 though I suspect there are only 20 valenece electrons in the system--5 for each nitrogen, 4 nitrogen in the cell). So, if my guesses above are correct, you should not be doing the ddk or rfelfd calculations, they have no meaning in a metallic system. You should only do the phonon calculations.</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Serial version: Convergence of dataset2 in linear respon</h3>
				<div class="date">Posted: <strong>Mon May 27, 2013 1:25 pm</strong></div>
				<div class="author">by <strong>uma</strong></div>
				<div class="content">Thank you for your response Professor. But I am working on Nitrogen when it is an insulator. But at some point during my trials, the code suggested that I increase the number of bands. That is why I used nband=24 instead of my original value of 20. I shall try again with nband=20 and not specifying tsmear. Will that be a correct direction of managing parameters..?<br />Uma</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Serial version: Convergence of dataset2 in linear respon</h3>
				<div class="date">Posted: <strong>Mon May 27, 2013 1:43 pm</strong></div>
				<div class="author">by <strong>jzwanzig</strong></div>
				<div class="content">Yes, but I don't understand why it is 20 and not 10--what is your valence space for the nitrogen pseudopotentials? I'm guessing 2s2-2p3, so 5 electrons per nitrogen. You have four nitrogens in the cell, so 20 electrons, so you should have nband = 10. Or am I missing something?</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Serial version: Convergence of dataset2 in linear respon</h3>
				<div class="date">Posted: <strong>Mon May 27, 2013 5:50 pm</strong></div>
				<div class="author">by <strong>uma</strong></div>
				<div class="content">Dear Professor,<br />With nband=10 this is the error message I received:<br /><blockquote class="uncited"><div></div></blockquote><br /><span style="color: #FF0000">scfcge : ERROR -<br />  Potential-based CG line minimization not converged after 13 restarts. <br />  Action : read the eventual warnings about lack of convergence.<br />  Some might be relevant. Otherwise, raise nband.</span><br /><blockquote class="uncited"><div></div></blockquote></div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Serial version: Convergence of dataset2 in linear respon</h3>
				<div class="date">Posted: <strong>Mon May 27, 2013 6:38 pm</strong></div>
				<div class="author">by <strong>jzwanzig</strong></div>
				<div class="content">Nonetheless, the ddk calculation is only meant to work with no unoccupied bands. I would suggest two things: first have you computed the band structure? It would be worthwhile to see what the band gap appears to be based on the xc and pseudopotentials you are using. Perhaps the band gap is too small and that's where the problems come from. Secondly, do you really need the electric field calculation? If you only need the phonons (and can live without the lo-to spliting) you can simply not do the ddk and rfelfd calcs and only do the phonons.</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Serial version: Convergence of dataset2 in linear respon</h3>
				<div class="date">Posted: <strong>Tue May 28, 2013 3:17 pm</strong></div>
				<div class="author">by <strong>uma</strong></div>
				<div class="content">Dear Professor,<br />Yes. I need only the phonon frequencies of Nitrogen as an insulator.I commented datasets 2 and 3. So I did not include d/dk calculations and the electric field perturbation. Also nband=10. diemac =1. This is the error message I get.<br /><blockquote class="uncited"><div></div></blockquote><br /><br /><span style="color: #FF0000">Subroutine Unknown:0:ERROR<br /> <br /> scfcge : ERROR -<br />  Potential-based CG line minimization not converged after 13 restarts. <br />  Action : read the eventual warnings about lack of convergence.<br />  Some might be relevant. Otherwise, raise nband.<br /><br /> leave_new : decision taken to exit ...<br /></span><br /><blockquote class="uncited"><div></div></blockquote><br />Any suggestion please..? I will plot the band structure if it will solve this problem. I have the results of this calculation using VASP. So I know it to be an insulator.<br /><br />Uma</div>
			</div>
			<hr />
			</div>

	<div id="page-footer" class="page-footer">
		<div class="page-number">All times are <span title="Europe/Brussels">UTC+02:00</span><br />Page <strong>1</strong> of <strong>1</strong></div>
			<div class="copyright">
				<p>Powered by <a href="https://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Limited
				</p>
							</div>
	</div>
</div>

</body>

<!-- Mirrored from forum.abinit.org/viewtopic.php?f=10&t=2138&view=print by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 21 Sep 2024 01:57:26 GMT -->
</html>
