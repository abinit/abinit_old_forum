<!DOCTYPE html>
<html dir="ltr" lang="en-gb">

<!-- Mirrored from forum.abinit.org/viewtopic.php?f=14&t=2716&view=print by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 20 Sep 2024 23:03:46 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="robots" content="noindex" />

<title>ABINIT Discussion Forums &bull; PAW  AE_WFK with SOC</title>

<link href="styles/flat-style/theme/print.css" rel="stylesheet">
<link href="styles/flat-style/theme/bidi.css" rel="stylesheet">
</head>
<body id="phpbb" class="ltr">
<div id="wrap" class="wrap">
	<a id="top" class="top-anchor" accesskey="t"></a>

	<div id="page-header">
		<h1>ABINIT Discussion Forums</h1>
		<p>The meeting place for ABINIT users and developers<br /><a href="index.html">https://forum.abinit.org/</a></p>

		<h2>PAW  AE_WFK with SOC</h2>
		<p><a href="viewtopica326.html?f=14&amp;t=2716">https://forum.abinit.org/viewtopic.php?f=14&amp;t=2716</a></p>
	</div>

	<div id="page-body" class="page-body">
		<div class="page-number">Page <strong>1</strong> of <strong>1</strong></div>
					<div class="post">
				<h3>PAW  AE_WFK with SOC</h3>
				<div class="date">Posted: <strong>Fri Jun 27, 2014 9:32 am</strong></div>
				<div class="author">by <strong>temok</strong></div>
				<div class="content">Dear ABINIT Forum Members,<br /><br />[Dear Panel Admins, please let me know if I should move this post to the Ground State panel]<br /><br />For post-procesing purposes, I need to output the full wavefunction for a PAW run, including the spin orbit coupling, for a set of kpoints, i.e.<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>pawprtwf&nbsp; 1<br />pawspnorb 1 <br />kptopt&nbsp; &nbsp; 4&nbsp; # Only spatial symmetries. Mandatory if pawspnorb=1.<br />iscf2&nbsp; &nbsp; -2<br />kpt2&nbsp; &nbsp;&lt;the kpoints&gt;</code></pre></div><br /><br />I do the run with an ABINIT executable (version 7.6.2) compiled for serial execution, <br />(MPI disabled at configure stage), as implied in the description of pawprtwf.<br /><br />The following files get written:<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>4.1G&nbsp; &nbsp;&nbsp; case_DS2_AE_ONSITE_WFK-etsf.nc<br />27G&nbsp; &nbsp;&nbsp; case_DS2_AE_WFK-etsf.nc<br />40K&nbsp; &nbsp;&nbsp; case_DS2_PAWSTAT<br />4.1G&nbsp; &nbsp;&nbsp; case_DS2_PS_ONSITE_WFK-etsf.nc<br />27G&nbsp; &nbsp;&nbsp; case_DS2_PS_WFK-etsf.nc<br />485M&nbsp; &nbsp;&nbsp; case_DS2_WFK</code></pre></div><br /><br />And although the run reaches the point where the suggested acknowledgements and the string <br />&quot;Calculation completed. .Delivered    5 WARNINGs and   0 COMMENTs&quot; gets written, <br />such <span style="color: #FF0080">log file is infested with error messages.</span><br /><br />Surprisingly these errors did not stop ABINIT to proceed, as usually do,<br />so<span style="color: #4040FF"> I wonder if I can trust the AE_WFK-etsf.nc</span><br /><br />The following block of error messages appear almost 3 thousand times (exactly nkpt * band * nspinor; I got 34 kpts, 44 bands and 2 spinnors)<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>--- !ERROR<br />message: |<br />&nbsp; &nbsp; Backtrace&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : etsf_io_main_put()<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;write_var_double_var()<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;write_var_double_2D()<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;etsf_io_low_check_var()<br />&nbsp; &nbsp; &nbsp; Action performed&nbsp; &nbsp;: specifications routine argument<br />&nbsp; &nbsp; &nbsp; Target (name)&nbsp; &nbsp; &nbsp; : real_space_wavefunctions (map)<br />&nbsp; &nbsp; &nbsp; Error message&nbsp; &nbsp; &nbsp; : wrong map value&nbsp; (map address = ***** &amp; max address = *****)<br /><br />src_file: pawmkaewf.F90<br />src_line: 1105<br />...<br />--- !ERROR<br />message: |<br />&nbsp; &nbsp; Backtrace&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : etsf_io_main_put()<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;write_var_double_var()<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;write_var_double_2D()<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;etsf_io_low_check_var()<br />&nbsp; &nbsp; &nbsp; Action performed&nbsp; &nbsp;: specifications routine argument<br />&nbsp; &nbsp; &nbsp; Target (name)&nbsp; &nbsp; &nbsp; : real_space_wavefunctions (map)<br />&nbsp; &nbsp; &nbsp; Error message&nbsp; &nbsp; &nbsp; : wrong map value&nbsp; (map address = ***** &amp; max address = *****)<br /><br />src_file: pawmkaewf.F90<br />src_line: 1109<br /></code></pre></div><br /><br />So, the error seems to come from lines 1105 &amp; 1109 of  pawmkaewf.F90:<br />( leading numbers added by 'less -N pawmkaewf.F90')<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>&nbsp; &nbsp;1087 #if defined HAVE_TRIO_ETSF_IO<br />&nbsp; &nbsp;1088&nbsp; &nbsp; &nbsp; &nbsp; MainFolder%wfs_rsp__spin_access&nbsp; &nbsp;=&nbsp; isppol !this is wrong if para!<br />&nbsp; &nbsp;1089&nbsp; &nbsp; &nbsp; &nbsp; if (nprocs&gt;1) MainFolder%wfs_rsp__spin_access = 1<br />&nbsp; &nbsp;1090&nbsp; &nbsp; &nbsp; &nbsp; MainFolder%wfs_rsp__kpoint_access = my_kstable(ikpt,isppol) !ikpt<br />&nbsp; &nbsp;1091&nbsp; &nbsp; &nbsp; &nbsp; MainFolder%wfs_rsp__state_access&nbsp; = iband<br />&nbsp; &nbsp;1092 !&nbsp; &nbsp; &nbsp; main_folder%wfs_coeff__number_of_coefficients = npw * dtset%nspinor<br />&nbsp; &nbsp;1093<br />&nbsp; &nbsp;1094 !&nbsp; &nbsp; &nbsp; We use the group level write routine.<br />&nbsp; &nbsp;1095&nbsp; &nbsp; &nbsp; &nbsp; MainFolder%real_space_wavefunctions%data2D&nbsp; =&gt; ur<br />&nbsp; &nbsp;1096&nbsp; &nbsp; &nbsp; &nbsp; call etsf_io_main_put(ncids(1),MainFolder,lstat,Error_data=Error_data)<br />&nbsp; &nbsp;1097&nbsp; &nbsp; &nbsp; &nbsp; ETSF_CHECK_ERROR(lstat,Error_data)<br />&nbsp; &nbsp;1098<br />&nbsp; &nbsp;1099&nbsp; &nbsp; &nbsp; &nbsp; MainFolder%real_space_wavefunctions%data2D&nbsp; =&gt; ur_pw<br />&nbsp; &nbsp;1100&nbsp; &nbsp; &nbsp; &nbsp; call etsf_io_main_put(ncids(2),MainFolder,lstat,Error_data=Error_data)<br />&nbsp; &nbsp;1101&nbsp; &nbsp; &nbsp; &nbsp; ETSF_CHECK_ERROR(lstat,Error_data)<br />&nbsp; &nbsp;1102<br />&nbsp; &nbsp;1103&nbsp; &nbsp; &nbsp; &nbsp; MainFolder%real_space_wavefunctions%data2D&nbsp; =&gt; ur_ae_onsite<br />&nbsp; &nbsp;1104&nbsp; &nbsp; &nbsp; &nbsp; call etsf_io_main_put(ncids(3),MainFolder,lstat,Error_data=Error_data)<br />&nbsp; &nbsp;1105&nbsp; &nbsp; &nbsp; &nbsp; ETSF_CHECK_ERROR(lstat,Error_data)<br />&nbsp; &nbsp;1106<br />&nbsp; &nbsp;1107&nbsp; &nbsp; &nbsp; &nbsp; MainFolder%real_space_wavefunctions%data2D&nbsp; =&gt; ur_ps_onsite<br />&nbsp; &nbsp;1108&nbsp; &nbsp; &nbsp; &nbsp; call etsf_io_main_put(ncids(4),MainFolder,lstat,Error_data=Error_data)<br />&nbsp; &nbsp;1109&nbsp; &nbsp; &nbsp; &nbsp; ETSF_CHECK_ERROR(lstat,Error_data)<br />&nbsp; &nbsp;1110<br />&nbsp; &nbsp;1111<br />&nbsp; &nbsp;1112 #endif<br /></code></pre></div><br /><br />and a selection of the norm info is<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>.<br />.<br />ikpt,iband, norm (G,PSWF)=&nbsp; &nbsp;34&nbsp; &nbsp;17&nbsp; &nbsp; 0.4328657874146002 norm (R,AEWF)=&nbsp; &nbsp; 1.0001195823635485<br />ikpt,iband, norm (G,PSWF)=&nbsp; &nbsp;34&nbsp; &nbsp;18&nbsp; &nbsp; 0.4328657862454370 norm (R,AEWF)=&nbsp; &nbsp; 1.0001195841832851<br />ikpt,iband, norm (G,PSWF)=&nbsp; &nbsp;34&nbsp; &nbsp;19&nbsp; &nbsp; 0.4321775527241986 norm (R,AEWF)=&nbsp; &nbsp; 1.0007126256329253<br />ikpt,iband, norm (G,PSWF)=&nbsp; &nbsp;34&nbsp; &nbsp;20&nbsp; &nbsp; 0.4321775554873209 norm (R,AEWF)=&nbsp; &nbsp; 1.0007126263955426<br />ikpt,iband, norm (G,PSWF)=&nbsp; &nbsp;34&nbsp; &nbsp;21&nbsp; &nbsp; 1.0009449953360174 norm (R,AEWF)=&nbsp; &nbsp; 1.0003276827115253<br />ikpt,iband, norm (G,PSWF)=&nbsp; &nbsp;34&nbsp; &nbsp;22&nbsp; &nbsp; 1.0009449873972405 norm (R,AEWF)=&nbsp; &nbsp; 1.0003276838017774<br />ikpt,iband, norm (G,PSWF)=&nbsp; &nbsp;34&nbsp; &nbsp;23&nbsp; &nbsp; 1.0036109239103379 norm (R,AEWF)=&nbsp; &nbsp; 1.0006291588033582<br />ikpt,iband, norm (G,PSWF)=&nbsp; &nbsp;34&nbsp; &nbsp;24&nbsp; &nbsp; 1.0036109259480923 norm (R,AEWF)=&nbsp; &nbsp; 1.0006291561889276<br />.<br />.<br /></code></pre></div><br />I would appreciate any comments on the validity of the obtained AE_WFK-etsf.nc data.<br />With regards,<br />Temok</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: PAW  AE_WFK with SOC</h3>
				<div class="date">Posted: <strong>Fri Jun 27, 2014 6:38 pm</strong></div>
				<div class="author">by <strong>temok</strong></div>
				<div class="content">I wish to add that the produced AE_WFK-etsf.nc file seems to be corrupted.<br /><br />Usually I browse ABINIT's  etsf.nc files with ipython, using <br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>from scipy.io import netcdf<br />f = netcdf.netcdf_file(&nbsp; 'case_DS2_AE_WFK-etsf.nc', 'r')<br /></code></pre></div><br />but for this AE_WFK python gives:<br /><span style="color: #FF0080">ValueError: mmap length is greater than file size</span>.<br /><br />As mentioned in the previous post, ABINIT's error message to the log file was:<br /><span style="color: #FF0000">Error message      : wrong map value  (map address = ***** &amp; max address = *****)</span><br /><br />The full python's errors are:<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>ValueError&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Traceback (most recent call last)<br />&lt;ipython-input-2-987ca711c62e&gt; in &lt;module&gt;()<br />----&gt; 1 f = netcdf.netcdf_file(&nbsp; '../staneneo_DS2_AE_WFK-etsf.nc', 'r')<br /><br />/usr/local/lib/python2.7/site-packages/scipy-0.13.3-py2.7-linux-x86_64.egg/scipy/io/netcdf.pyc in __init__(self, filename, mode, mmap, version)<br />&nbsp; &nbsp; 216<br />&nbsp; &nbsp; 217&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if mode == 'r':<br />--&gt; 218&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;self._read()<br />&nbsp; &nbsp; 219<br />&nbsp; &nbsp; 220&nbsp; &nbsp; &nbsp;def __setattr__(self, attr, value):<br /><br />/usr/local/lib/python2.7/site-packages/scipy-0.13.3-py2.7-linux-x86_64.egg/scipy/io/netcdf.pyc in _read(self)<br />&nbsp; &nbsp; 506&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;self._read_dim_array()<br />&nbsp; &nbsp; 507&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;self._read_gatt_array()<br />--&gt; 508&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;self._read_var_array()<br />&nbsp; &nbsp; 509<br />&nbsp; &nbsp; 510&nbsp; &nbsp; &nbsp;def _read_numrecs(self):<br /><br />/usr/local/lib/python2.7/site-packages/scipy-0.13.3-py2.7-linux-x86_64.egg/scipy/io/netcdf.pyc in _read_var_array(self)<br />&nbsp; &nbsp; 589&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;a_size = reduce(mul, shape, 1) * size<br />&nbsp; &nbsp; 590&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if self.use_mmap:<br />--&gt; 591&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mm = mmap(self.fp.fileno(), begin_+a_size, access=ACCESS_READ)<br />&nbsp; &nbsp; 592&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;data = ndarray.__new__(ndarray, shape, dtype=dtype_,<br />&nbsp; &nbsp; 593&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;buffer=mm, offset=begin_, order=0)<br /><br />ValueError: mmap length is greater than file size</code></pre></div><br /><br />Is it likely that the upcoming ABINIT 7.8 will support the output of this PAW AE_WFK for the case of spin-orbit?<br /><br />(in older posts dated from a Aug 2012, <a href="viewtopic08a7.html?f=19&amp;t=1627" class="postlink">http://forum.abinit.org/viewtopic.php?f=19&amp;t=1627</a>, problems related to this  AE_WFK+SOC were mentioned, and a solution was proposed. I wonder if this was indeed corrected in the current ABINIT versions 7.6.x. <br /><br />Cheers,<br />Temok</div>
			</div>
			<hr />
			</div>

	<div id="page-footer" class="page-footer">
		<div class="page-number">All times are <span title="Europe/Brussels">UTC+02:00</span><br />Page <strong>1</strong> of <strong>1</strong></div>
			<div class="copyright">
				<p>Powered by <a href="https://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Limited
				</p>
							</div>
	</div>
</div>

</body>

<!-- Mirrored from forum.abinit.org/viewtopic.php?f=14&t=2716&view=print by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 20 Sep 2024 23:03:46 GMT -->
</html>
