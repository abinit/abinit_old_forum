<!DOCTYPE html>
<html dir="ltr" lang="en-gb">

<!-- Mirrored from forum.abinit.org/viewtopic.php?p=9304 by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 21 Sep 2024 01:21:35 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1" />

<title>Why opt_diag==2 in module qmc_prep_ctqmc.F90 - ABINIT Discussion Forums</title>


	<link rel="canonical" href="viewtopic0178.html?t=3015">

<!--
	phpBB style name: Flat Style
	Based on style:   prosilver (this is the default phpBB3 style)
	Original author:  Tom Beddard ( http://www.subBlue.com/ )
	Modified by:      Ian Bradley
-->

<link href="assets/css/font-awesome.minaea1.css?assets_version=57" rel="stylesheet">
<link href="styles/flat-style/theme/stylesheetaea1.css?assets_version=57" rel="stylesheet">
<link href="styles/flat-style/theme/en/stylesheetaea1.css?assets_version=57" rel="stylesheet">




<!--[if lte IE 9]>
	<link href="./styles/flat-style/theme/tweaks.css?assets_version=57" rel="stylesheet">
<![endif]-->

<meta name="google-site-verification" content="PLdTN48UENWHvJ5ViWhDTahZKzoMyw5e1QZgw1IECVw" />
<link rel="alternate" type="application/atom+xml" title="ATOM" href="app.php/smartfeed/feed.html" />
<link rel="alternate" type="application/rss+xml" title="RSS" href="app.php/smartfeed/feed9830.html?y=2" />

<link href="ext/crizzo/aboutus/styles/prosilver/theme/aboutusaea1.css?assets_version=57" rel="stylesheet" media="screen" />
<link href="ext/dmzx/topicageday/styles/prosilver/theme/topicagedayaea1.css?assets_version=57" rel="stylesheet" media="screen" />
<link href="ext/hifikabin/clock/styles/all/theme/clockaea1.css?assets_version=57" rel="stylesheet" media="screen" />
<link href="ext/hifikabin/googlesearch/styles/prosilver/theme/googlesearchaea1.css?assets_version=57" rel="stylesheet" media="screen" />
<link href="ext/kinerity/bestanswer/styles/prosilver/theme/bestansweraea1.css?assets_version=57" rel="stylesheet" media="screen" />
<link href="ext/phpbb/collapsiblecategories/styles/all/theme/collapsiblecategoriesaea1.css?assets_version=57" rel="stylesheet" media="screen" />
<link href="ext/phpbbservices/smartfeed/styles/prosilver/theme/customaea1.css?assets_version=57" rel="stylesheet" media="screen" />
<link href="ext/senky/userstatistics/styles/prosilver/theme/userstatisticsaea1.css?assets_version=57" rel="stylesheet" media="screen" />
<link href="ext/tierra/topicsolved/styles/prosilver/theme/buttonsaea1.css?assets_version=57" rel="stylesheet" media="screen" />



</head>
<body id="phpbb" class="nojs notouch section-viewtopic ltr ">


<div id="wrap" class="wrap">
	<a id="top" class="top-anchor" accesskey="t"></a>
	<div id="page-header">
		<div class="headerbar" role="banner">
					<div class="inner">

			<div id="site-description">
				<a id="logo" class="logo" href="index-2.html" title="Board index"><span class="site_logo"></span></a>
				<div  class="site-description">
					<h1>ABINIT Discussion Forums</h1>
					<p>The meeting place for ABINIT users and developers</p>
					<p class="skiplink"><a href="#start_here">Skip to content</a></p>
				</div>
			</div>

			</div>
					</div>
				<div class="navbar navbar-top" role="navigation">
	<div class="inner">

	<ul id="nav-main" class="nav-main linklist" role="menubar">

		<li id="quick-links" class="quick-links dropdown-container responsive-menu" data-skip-responsive="true">
			<a href="#" class="dropdown-trigger">
				<i class="icon fa-bars fa-fw" aria-hidden="true"></i><span>Quick links</span>
			</a>
			<div class="dropdown">
				<div class="pointer"><div class="pointer-inner"></div></div>
				<ul class="dropdown-contents" role="menu">
					
											<li class="separator"></li>
																									<li>
								<a href="search33a7.html?search_id=unanswered" role="menuitem">
									<i class="icon fa-file fa-fw" aria-hidden="true"></i><span>Unanswered topics</span>
								</a>
							</li>
							<li>
								<a href="search526f.html?search_id=active_topics" role="menuitem">
									<i class="icon fa-file fa-fw" aria-hidden="true"></i><span>Active topics</span>
								</a>
							</li>
							<li class="separator"></li>
							<li>
								<a href="search.html" role="menuitem">
									<i class="icon fa-search fa-fw" aria-hidden="true"></i><span>Search</span>
								</a>
							</li>
					
										
										<li class="separator"></li>

									</ul>
			</div>
		</li>

			<li class="small-icon icon-smartfeed no-bulletin"><a href="app.php/smartfeed/ui.html">Smartfeed</a></li>		<li data-skip-responsive="true">
			<a href="app.php/help/faq.html" rel="help" title="Frequently Asked Questions" role="menuitem">
				<i class="icon fa-question-circle fa-fw" aria-hidden="true"></i><span>FAQ</span>
			</a>
		</li>
								<li data-last-responsive="true">
				<a href="https://www.abinit.org/" title="" role="menuitem" target="_blank">
				<i class="icon fa-home fa-fw" aria-hidden="true"></i><span>Main Site</span>
				</a>
			</li>
								<li data-last-responsive="true">
				<a href="https://www.abinit.org/packages" title="" role="menuitem" target="_blank">
				<i class="icon fa-download fa-fw" aria-hidden="true"></i><span>Download</span>
				</a>
			</li>
								<li data-last-responsive="true">
				<a href="https://docs.abinit.org/" title="" role="menuitem" target="_blank">
				<i class="icon fa-book fa-fw" aria-hidden="true"></i><span>Documentations</span>
				</a>
			</li>
								<li data-last-responsive="true">
				<a href="https://docs.abinit.org/tutorial/" title="" role="menuitem" target="_blank">
				<i class="icon fa-graduation-cap fa-fw" aria-hidden="true"></i><span>Tutorials</span>
				</a>
			</li>
							
			<li class="rightside"  data-skip-responsive="true">
			<a href="ucp26c3.html?mode=login" title="Login" accesskey="x" role="menuitem">
				<i class="icon fa-power-off fa-fw" aria-hidden="true"></i><span>Login</span>
			</a>
		</li>
						</ul>
    </div>
</div>

<div class="navbar" role="navigation">
	<div class="inner">
	<ul id="nav-breadcrumbs" class="nav-breadcrumbs linklist navlinks" role="menubar">
								<li class="breadcrumbs" itemscope itemtype="http://schema.org/BreadcrumbList">
										<span class="crumb"  itemtype="http://schema.org/ListItem" itemprop="itemListElement" itemscope><a href="index-2.html" itemtype="https://schema.org/Thing" itemprop="item" accesskey="h" data-navbar-reference="index"><i class="icon fa-home fa-fw"></i><span itemprop="name">Board index</span></a><meta itemprop="position" content="1" /></span>
											<span class="crumb"  itemtype="http://schema.org/ListItem" itemprop="itemListElement" itemscope data-forum-id="4"><a href="viewforum31e6.html?f=4" itemtype="https://schema.org/Thing" itemprop="item"><span itemprop="name">Running Abinit</span></a><meta itemprop="position" content="2" /></span>
															<span class="crumb"  itemtype="http://schema.org/ListItem" itemprop="itemListElement" itemscope data-forum-id="9"><a href="viewforumfdc5.html?f=9" itemtype="https://schema.org/Thing" itemprop="item"><span itemprop="name">Ground state</span></a><meta itemprop="position" content="3" /></span>
												</li>
		<li class="rightside responsive-hide">
	<div id="show-clock">
		<div id="liveclock" class="outer_face">
			<div class="marker oneseven"></div>
			<div class="marker twoeight"></div>
			<div class="marker fourten"></div>
			<div class="marker fiveeleven"></div>
			<div class="inner_face">
				<div class="hand hour"></div>
				<div class="hand minute"></div>
				<div class="hand second"></div>
			</div>
		</div>
	</div>
</li><!--[if !IE]><!-->
<li id="g-search-box" class="search-box rightside responsive-hide">
	<form action="https://forum.abinit.org/app.php/googlesearch">
	<fieldset>
		<input name="cx" type="hidden" value="017804512478788106347:tlftx8kncg4">
		<input name="q" type="search" maxlength="255" class="inputbox search tiny" value="" placeholder="Google Search ...">
		<button class="button button-search-google" type="submit" name="sitesearch" title="Google Search">
		<i class="icon fa-search fa-fw" aria-hidden="true"></i>
		</button>
	</fieldset>
</form>
</li>
<!--<![endif]-->

							<li id="search-box" class="rightside search-box responsive-hide" role="search">
				<form action="https://forum.abinit.org/search.php" method="get" id="search">
				<fieldset>
					<input name="keywords" id="keywords" type="search" maxlength="128" title="Search for keywords" class="inputbox search tiny" size="20" value="" placeholder="Search…" />
					<button class="button button-search" type="submit" title="Search">
						<i class="icon fa-search fa-fw" aria-hidden="true"></i><span class="sr-only">Search</span>
					</button>
					<a href="search.html" class="button button-search-end" title="Advanced search">
						<i class="icon fa-cog fa-fw" aria-hidden="true"></i><span class="sr-only">Advanced search</span>
					</a>
					
				</fieldset>
				</form>
			</li>

			<li class="rightside responsive-search">
				<a href="search.html" title="View the advanced search options" role="menuitem">
					<i class="icon fa-search fa-fw" aria-hidden="true"></i><span class="sr-only">Search</span>
				</a>
			</li>
					</ul>

	</div>
</div>
	</div>

	
	<a id="start_here" class="anchor"></a>
	<div id="page-body" class="page-body" role="main">
		
		﻿
<h2 class="topic-title"><a href="viewtopicdf47.html?f=9&amp;t=3015">Why opt_diag==2 in module qmc_prep_ctqmc.F90</a></h2>
<!-- NOTE: remove the style="display: none" when you want to have the forum description on the topic body -->
<div style="display: none !important;">Total energy, geometry optimization, DFT+U, spin....<br /></div>
<p>
	<strong>Moderator:</strong> <a href="memberlista146.html?mode=viewprofile&amp;u=2687" class="username">bguster</a>
</p>


<div class="action-bar bar-top">
	
			<a href="posting32ea.html?mode=reply&amp;f=9&amp;t=3015" class="button" title="This topic is locked, you cannot edit posts or make further replies.">
							<span>Locked</span> <i class="icon fa-lock fa-fw" aria-hidden="true"></i>
					</a>
	
			<div class="dropdown-container dropdown-button-control topic-tools">
		<span title="Topic tools" class="button button-secondary dropdown-trigger dropdown-select">
			<i class="icon fa-wrench fa-fw" aria-hidden="true"></i>
			<span class="caret"><i class="icon fa-sort-down fa-fw" aria-hidden="true"></i></span>
		</span>
		<div class="dropdown">
			<div class="pointer"><div class="pointer-inner"></div></div>
			<ul class="dropdown-contents">
																												<li>
					<a href="viewtopic9e0a.html?f=9&amp;t=3015&amp;view=print" title="Print view" accesskey="p">
						<i class="icon fa-print fa-fw" aria-hidden="true"></i><span>Print view</span>
					</a>
				</li>
											</ul>
		</div>
	</div>
	
			<div class="search-box" role="search">
			<form method="get" id="topic-search" action="https://forum.abinit.org/search.php">
			<fieldset>
				<input class="inputbox search tiny"  type="search" name="keywords" id="search_keywords" size="20" placeholder="Search this topic…" />
				<button class="button button-search" type="submit" title="Search">
					<i class="icon fa-search fa-fw" aria-hidden="true"></i><span class="sr-only">Search</span>
				</button>
				<a href="search.html" class="button button-search-end" title="Advanced search">
					<i class="icon fa-cog fa-fw" aria-hidden="true"></i><span class="sr-only">Advanced search</span>
				</a>
				<input type="hidden" name="t" value="3015" />
<input type="hidden" name="sf" value="msgonly" />

			</fieldset>
			</form>
		</div>
	
			<div class="pagination">
			5 posts
							&bull; Page <strong>1</strong> of <strong>1</strong>
					</div>
		</div>




			<div id="p9259" class="post has-profile bg2 offline">
		<div class="inner">

		<dl class="postprofile" id="profile9259">
			<dt class="no-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlist65aa.html?mode=viewprofile&amp;u=1606" class="username">PhilippBa</a>							</dt>

									
		<dd class="profile-posts"><strong>Posts:</strong> <a href="search2dfb.html?author_id=1606&amp;sr=posts">15</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> Tue May 26, 2015 7:22 pm</dd>		
		
						
						
		</dl>

		<div class="postbody">
						<div id="post_content9259">

						<h3 class="first"><a href="#p9259">Why opt_diag==2 in module qmc_prep_ctqmc.F90</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting7aa8.html?mode=quote&amp;f=9&amp;p=9259" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author">
									<a class="unread" href="viewtopic61f0.html?p=9259#p9259" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlist65aa.html?mode=viewprofile&amp;u=1606" class="username">PhilippBa</a></strong> &raquo; </span>Wed Jun 03, 2015 2:31 pm
			</p>
			
			
			
			<div class="content">Dear all,<br /><br />during some DMFT calculations (with CTQMC as impurity solver) i noticed that my occupation matrix is not diagonal after the CTQMC. After checking the output, we noticed that the density matrix is diagonalised before the QMC run (this is due to the flag &quot;opt_diag=2&quot; in qmc_prep_ctqmc.F90 (see code below)). It is, however, diagonal by symmetry in the DFT and also entering the solver.<br />Can anyone explain what is happening here? After setting opt_diag=0 my occupation matrix after CTQMC remains diagonal. <br />My inputs are given in a recently opened topic &quot;Runtime error during LDA+DMFT&quot; (with the suggested settings, thanks to B. Amadon)<br /><br /><br />! =================================================================<br />! Impose diago of levels and Ylm basis if opt_nondiag=1<br />! =================================================================<br />! opt_diag=2 ! 2: diago density matrix (can be used for historical reasons)<br />! opt_diag=3 ! 3: weiss function is diagonalized: for test, bad and should NOT be used<br />! opt_diag=1 ! 1: diago the levels (The best choice).<br /><br /> if(nspinor==2) then<br />   opt_diag=1    ! because levels are the quantity to diagonalise for CTQMC and NOT dmat<br />   useylm=1      ! to avoid complex G(tau)<br />   opt_nondiag=1 ! mandatory for soc.<br /> end if<br /> useylm=0<br /> <strong class="text-strong">opt_diag=2</strong><br /> opt_nondiag=0 ! impose it now for diagonal CTQMC code<br /><br /><br /><br />Best regards,<br /><br />Philipp Bahlke</div>
			
			
			
									
									<div id="sig9259" class="signature">Philipp Bahlke<br />University of Hamburg<br />Institute for inorganic and applied chemistry <br />Germany</div>
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p9260" class="post has-profile bg1 offline">
		<div class="inner">

		<dl class="postprofile" id="profile9260">
			<dt class="no-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlist830e.html?mode=viewprofile&amp;u=73" class="username">amadon</a>							</dt>

									
		<dd class="profile-posts"><strong>Posts:</strong> <a href="search8bda.html?author_id=73&amp;sr=posts">46</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> Mon Aug 24, 2009 10:58 am</dd>		
		
						
						
		</dl>

		<div class="postbody">
						<div id="post_content9260">

						<h3 ><a href="#p9260">Re: Why opt_diag==2 in module qmc_prep_ctqmc.F90</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting93ce.html?mode=quote&amp;f=9&amp;p=9260" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author">
									<a class="unread" href="viewtopic641e.html?p=9260#p9260" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlist830e.html?mode=viewprofile&amp;u=73" class="username">amadon</a></strong> &raquo; </span>Wed Jun 03, 2015 5:31 pm
			</p>
			
			
			
			<div class="content">Dear Philipp<br /><br />In the general case, the atomic levels (or the density matrix) have to be diagonalized for the CTQMC solver.<br />In your case, the diagonalization is useless but nevertheless done. If you have degenerate levels, <br />the rotation is not the identity but can mix arbitrarily different degenerate levels. Moreover, as the QMC solver generate<br />noise in the calculation, the occupation matrix will not be perfectly degenerated.<br />As a consequence, the inverse rotation subsequently applied to this occupation matrix, can generate, (small) non diagonal elements.<br />If these are not so small, could you post your input and output occupation matrices ?<br /><br />Best regards<br />Bernard</div>
			
			
			
									
									<div id="sig9260" class="signature">Bernard Amadon<br />CEA<br />France</div>
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p9273" class="post has-profile bg2 offline">
		<div class="inner">

		<dl class="postprofile" id="profile9273">
			<dt class="no-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlist65aa.html?mode=viewprofile&amp;u=1606" class="username">PhilippBa</a>							</dt>

									
		<dd class="profile-posts"><strong>Posts:</strong> <a href="search2dfb.html?author_id=1606&amp;sr=posts">15</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> Tue May 26, 2015 7:22 pm</dd>		
		
						
						
		</dl>

		<div class="postbody">
						<div id="post_content9273">

						<h3 ><a href="#p9273">Re: Why opt_diag==2 in module qmc_prep_ctqmc.F90</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting4e8f.html?mode=quote&amp;f=9&amp;p=9273" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author">
									<a class="unread" href="viewtopicd4c1-3.html?p=9273#p9273" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlist65aa.html?mode=viewprofile&amp;u=1606" class="username">PhilippBa</a></strong> &raquo; </span>Fri Jun 05, 2015 8:11 am
			</p>
			
			
			
			<div class="content">Dear Bernard,<br /><br />this is the occupation matrix i get after the projection:<br /><br /><br /><em class="text-italics"> = Occupation matrix from KS occupations<br /><br />   -------&gt; For Correlated Atom  19<br /><br />          -- polarization spin component  1<br />        0.49828   0.00000   0.00000  -0.00000   0.00000<br />        0.00000   0.48910   0.00000  -0.00000   0.00000<br />        0.00000   0.00000   0.55793  -0.00000   0.00000<br />       -0.00000  -0.00000  -0.00000   0.48910   0.00000<br />        0.00000   0.00000   0.00000   0.00000   0.52510<br /></em><br /><br />After the search of the Fermi level the DMFT loops starts with the diagonalisation:<br /><br /><em class="text-italics"> Slm basis is used<br />  The correlated occupation matrix is diagonalized<br /><br />   == Print Energy levels for Fermi Level=     -0.09543<br /><br />   -------&gt; For Correlated Atom  19<br /><br />          -- polarization spin component  1<br />       -1.00084  -0.00000   0.00000   0.00000   0.00000<br />       -0.00000  -1.00668  -0.00000   0.00000   0.00000<br />        0.00000  -0.00000  -0.99886   0.00000   0.00000<br />        0.00000   0.00000   0.00000  -1.00668   0.00000<br />        0.00000   0.00000   0.00000   0.00000  -1.01032</em><br /><br />Then the CTQMC starts and after transforming back to the original basis:<br /><br /><em class="text-italics">   -------&gt; For Correlated Atom  19<br /><br />          -- polarization spin component  1<br />        0.72479  -0.00000   0.00215   0.00000   0.00000<br />       -0.00000   0.78315   0.00000   0.05991   0.00000<br />        0.00215   0.00000   0.74983  -0.00000   0.00000<br />        0.00000   0.05991  -0.00000   0.78315   0.00000<br />        0.00000   0.00000   0.00000   0.00000   0.87721</em><br /><br />Here you can see that one of the off-diagonal elements starts to be non-zero (0.05991). And the converged occupation matrix (after the calculation of the total energy) is then:<br /><br /><em class="text-italics">========== LDA+U DATA ===================================================<br /><br />====== For Atom   19, occupations for correlated orbitals. l =   2<br /><br /><br />== Calculated occupation matrix for correlated orbitals:<br /><br />Calculated occupation matrix for component up<br />     0.45815    0.00144    0.00146   -0.00144    0.00000<br />     0.00144    0.48435    0.00114    0.01550   -0.00091<br />     0.00146    0.00114    0.47312   -0.00114    0.00000<br />    -0.00144    0.01550   -0.00114    0.48435   -0.00091<br />     0.00000   -0.00091    0.00000   -0.00091    0.52702</em><br /><br />Ok, the off-diagonal element is just 0.01550, however, I already calculated the system with much more copper atoms (91 atoms in the unit cell instead off 19). The converged matrix for this one is:<br /><br /><em class="text-italics">Calculated occupation matrix for component up<br />     0.36026   -0.00121   -0.00022    0.00121    0.00000<br />    -0.00121    0.43399    0.00098   -0.05749    0.00259<br />    -0.00022    0.00098    0.51731   -0.00098    0.00000<br />     0.00121   -0.05749   -0.00098    0.43399    0.00259<br />     0.00000    0.00259    0.00000    0.00259    0.54571</em><br /><br /><br />I am not sure if 0.0155 or 0.05749 are small enough for the off-diagonal elements. But if i set opt_diag to 0 i get (for the large system):<br /><br /><em class="text-italics">Calculated occupation matrix for component up<br />     0.37335   -0.00308   -0.00012    0.00308    0.00000<br />    -0.00308    0.52172    0.00098    0.00002    0.00010<br />    -0.00012    0.00098    0.41617   -0.00098    0.00000<br />     0.00308    0.00002   -0.00098    0.52172    0.00010<br />     0.00000    0.00010    0.00000    0.00010    0.54874</em><br /><br />So the off-diagonal elements are a bit smaller. But I have to know if I do some error by setting opt_diag to 0 in the code? Or if everything is fine if I do so, as long as my matrix are diagonal?<br /><br /><br />Best regards,<br /><br />Philipp</div>
			
			
			
									
									<div id="sig9273" class="signature">Philipp Bahlke<br />University of Hamburg<br />Institute for inorganic and applied chemistry <br />Germany</div>
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p9304" class="post has-profile bg1 offline">
		<div class="inner">

		<dl class="postprofile" id="profile9304">
			<dt class="no-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlist830e.html?mode=viewprofile&amp;u=73" class="username">amadon</a>							</dt>

									
		<dd class="profile-posts"><strong>Posts:</strong> <a href="search8bda.html?author_id=73&amp;sr=posts">46</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> Mon Aug 24, 2009 10:58 am</dd>		
		
						
						
		</dl>

		<div class="postbody">
						<div id="post_content9304">

						<h3 ><a href="#p9304">Re: Why opt_diag==2 in module qmc_prep_ctqmc.F90</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting2e6f.html?mode=quote&amp;f=9&amp;p=9304" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author">
									<a class="unread" href="viewtopicdf57.html?p=9304#p9304" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlist830e.html?mode=viewprofile&amp;u=73" class="username">amadon</a></strong> &raquo; </span>Thu Jun 11, 2015 3:09 pm
			</p>
			
			
			
			<div class="content">Dear Philipp,<br /><br />Indeed, it seems that the fact that the LDA occupation matrix is diagonal, is not imposed by symmetry (you have a reduced number of symmetries).<br />So, your occupation matrix is not exactly diagonal (it can be checked by increasing the precision in the writings) even before the CTQMC.<br />I do not know if the reason is physical or a LDA convergence which is not sufficient.<br />And moreover, the density matrix and the atomic levels are not diagonal in the same basis (it seems: I have done some quick checks).<br />If it is not a convergence problem (at the LDA level), the solution would be to diagonalise<br />the atomic levels and use a CTQMC code with a non diagonal hybridization.<br />This is not yet available in the public version of ABINIT. It will be available soon nevertheless, but anyway,<br />the computational cost would be higher for a very weak improvement (you have small non diagonal terms).<br /><br />=&gt; However,  what you can do is to use opt_diag=0 indeed and use pawprtvol=3.<br />You will have much more information about the density matrices after the CTQMC.<br /><br />I was however not able to recover your results for the small system (I have in my case very small non diagonal elements even for the DMFT          occupation matrices). Can you post the exact inputs (LDA and DMFT) that you use to have these occupation matrices ?<br /><br />Best regards<br />Bernard</div>
			
			
			
									
									<div id="sig9304" class="signature">Bernard Amadon<br />CEA<br />France</div>
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p9306" class="post has-profile bg2 offline">
		<div class="inner">

		<dl class="postprofile" id="profile9306">
			<dt class="no-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlist65aa.html?mode=viewprofile&amp;u=1606" class="username">PhilippBa</a>							</dt>

									
		<dd class="profile-posts"><strong>Posts:</strong> <a href="search2dfb.html?author_id=1606&amp;sr=posts">15</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> Tue May 26, 2015 7:22 pm</dd>		
		
						
						
		</dl>

		<div class="postbody">
						<div id="post_content9306">

						<h3 ><a href="#p9306">Re: Why opt_diag==2 in module qmc_prep_ctqmc.F90</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="postingbc22.html?mode=quote&amp;f=9&amp;p=9306" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author">
									<a class="unread" href="viewtopicc820-2.html?p=9306#p9306" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlist65aa.html?mode=viewprofile&amp;u=1606" class="username">PhilippBa</a></strong> &raquo; </span>Fri Jun 12, 2015 3:11 pm
			</p>
			
			
			
			<div class="content">Thanks for response!<br /><br /><br />The exact inputs are given below! I used the PSP's from <!-- m --><a class="postlink" href="http://www.physics.rutgers.edu/gbrv/">http://www.physics.rutgers.edu/gbrv/</a><!-- m --> , maybe that could be important to reproduce my results.<br /><br />By the way: I am looking for a way to print the Hybridization function. Is there any possibility to do so in ABINIT?<br /><br /><br />Best regards,<br /><br /><br />Philipp</div>
			
			
							<dl class="attachbox">
					<dt>
						Attachments
					</dt>
											<dd>
			
		
		
				<dl class="file">
			<dt><img src="images/upload_icons/txt.gif" alt="" /> <a class="postlink" href="download/file21ea.php?id=1136">lda.in</a></dt>
						<dd>(927 Bytes) Downloaded 325 times</dd>
		</dl>
		
		
			</dd>
											<dd>
			
		
		
				<dl class="file">
			<dt><img src="images/upload_icons/txt.gif" alt="" /> <a class="postlink" href="download/filedcbe.php?id=1137">dmft.in</a></dt>
						<dd>(1.33 KiB) Downloaded 260 times</dd>
		</dl>
		
		
			</dd>
									</dl>
			
									
									<div id="sig9306" class="signature">Philipp Bahlke<br />University of Hamburg<br />Institute for inorganic and applied chemistry <br />Germany</div>
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
	

	<div class="action-bar bar-bottom">
	
			<a href="posting32ea.html?mode=reply&amp;f=9&amp;t=3015" class="button" title="This topic is locked, you cannot edit posts or make further replies.">
							<span>Locked</span> <i class="icon fa-lock fa-fw" aria-hidden="true"></i>
					</a>
		
		<div class="dropdown-container dropdown-button-control topic-tools">
		<span title="Topic tools" class="button button-secondary dropdown-trigger dropdown-select">
			<i class="icon fa-wrench fa-fw" aria-hidden="true"></i>
			<span class="caret"><i class="icon fa-sort-down fa-fw" aria-hidden="true"></i></span>
		</span>
		<div class="dropdown">
			<div class="pointer"><div class="pointer-inner"></div></div>
			<ul class="dropdown-contents">
																												<li>
					<a href="viewtopic9e0a.html?f=9&amp;t=3015&amp;view=print" title="Print view" accesskey="p">
						<i class="icon fa-print fa-fw" aria-hidden="true"></i><span>Print view</span>
					</a>
				</li>
											</ul>
		</div>
	</div>

			<form method="post" action="https://forum.abinit.org/viewtopic.php?f=9&amp;t=3015">
		<div class="dropdown-container dropdown-container-left dropdown-button-control sort-tools">
	<span title="Display and sorting options" class="button button-secondary dropdown-trigger dropdown-select">
		<i class="icon fa-sort-amount-asc fa-fw" aria-hidden="true"></i>
		<span class="caret"><i class="icon fa-sort-down fa-fw" aria-hidden="true"></i></span>
	</span>
	<div class="dropdown hidden">
		<div class="pointer"><div class="pointer-inner"></div></div>
		<div class="dropdown-contents">
			<fieldset class="display-options">
							<label>Display: <select name="st" id="st"><option value="0" selected="selected">All posts</option><option value="1">1 day</option><option value="7">7 days</option><option value="14">2 weeks</option><option value="30">1 month</option><option value="90">3 months</option><option value="180">6 months</option><option value="365">1 year</option></select></label>
								<label>Sort by: <select name="sk" id="sk"><option value="a">Author</option><option value="t" selected="selected">Post time</option><option value="s">Subject</option></select></label>
				<label>Direction: <select name="sd" id="sd"><option value="a" selected="selected">Ascending</option><option value="d">Descending</option></select></label>
								<hr class="dashed" />
				<input type="submit" class="button2" name="sort" value="Go" />
						</fieldset>
		</div>
	</div>
</div>
		</form>
	
	
	
			<div class="pagination">
			5 posts
							&bull; Page <strong>1</strong> of <strong>1</strong>
					</div>
	</div>


<div class="action-bar actions-jump">
		<p class="jumpbox-return">
		<a href="viewforumfdc5.html?f=9" class="left-box arrow-left" accesskey="r">
			<i class="icon fa-angle-left fa-fw icon-black" aria-hidden="true"></i><span>Return to “Ground state”</span>
		</a>
	</p>
	
		<div class="jumpbox dropdown-container dropdown-container-right dropdown-up dropdown-left dropdown-button-control" id="jumpbox">
			<span title="Jump to" class="button button-secondary dropdown-trigger dropdown-select">
				<span>Jump to</span>
				<span class="caret"><i class="icon fa-sort-down fa-fw" aria-hidden="true"></i></span>
			</span>
		<div class="dropdown">
			<div class="pointer"><div class="pointer-inner"></div></div>
			<ul class="dropdown-contents">
																				<li><a href="viewforumffeb.html?f=20" class="jumpbox-forum-link"> <span> News &amp; Announcements</span></a></li>
																<li><a href="viewforum8011.html?f=23" class="jumpbox-forum-link"> <span> Jobs and Other Announcements</span></a></li>
																<li><a href="viewforum58da.html?f=1" class="jumpbox-cat-link"> <span> Building ABINIT</span></a></li>
																<li><a href="viewforum4d6b.html?f=3" class="jumpbox-sub-link"><span class="spacer"></span> <span>&#8627; &nbsp; Configuring and compiling ABINIT</span></a></li>
																<li><a href="viewforum31e6.html?f=4" class="jumpbox-cat-link"> <span> Running Abinit</span></a></li>
																<li><a href="viewforumfdc5.html?f=9" class="jumpbox-sub-link"><span class="spacer"></span> <span>&#8627; &nbsp; Ground state</span></a></li>
																<li><a href="viewforum15ca.html?f=10" class="jumpbox-sub-link"><span class="spacer"></span> <span>&#8627; &nbsp; Response calculations</span></a></li>
																<li><a href="viewforum8a83.html?f=11" class="jumpbox-sub-link"><span class="spacer"></span> <span>&#8627; &nbsp; Many-body perturbation theory</span></a></li>
																<li><a href="viewforum01c9.html?f=12" class="jumpbox-sub-link"><span class="spacer"></span> <span>&#8627; &nbsp; Other tools and postprocessing in ABINIT</span></a></li>
																<li><a href="viewforum345c.html?f=24" class="jumpbox-sub-link"><span class="spacer"></span> <span>&#8627; &nbsp; Python interfacing : Abipy ecosystem</span></a></li>
																<li><a href="viewforum9780.html?f=14" class="jumpbox-sub-link"><span class="spacer"></span> <span>&#8627; &nbsp; Link to other codes</span></a></li>
																<li><a href="viewforume774.html?f=5" class="jumpbox-cat-link"> <span> Developing Abinit</span></a></li>
																<li><a href="viewforum218b.html?f=19" class="jumpbox-sub-link"><span class="spacer"></span> <span>&#8627; &nbsp; Improving ABINIT</span></a></li>
											</ul>
		</div>
	</div>

	</div>


			</div>


<div id="page-footer" class="page-footer" role="contentinfo">
	<div class="navbar navbar-bottom" role="navigation">
	<div class="inner">

	<ul id="nav-footer" class="nav-footer linklist" role="menubar">
		<li class="breadcrumbs">
									<span class="crumb"><a href="index-2.html" data-navbar-reference="index"><i class="icon fa-home fa-fw" aria-hidden="true"></i><span>Board index</span></a></span>					</li>
		
				
							<li class="rightside">
				<a href="ucp033a.html?mode=delete_cookies" data-ajax="true" data-refresh="true" role="menuitem">
					<i class="icon fa-trash fa-fw" aria-hidden="true"></i><span>Delete cookies</span>
				</a>
			</li>
				
		<li class="rightside" data-last-responsive="true"><a href="app.php/aboutus.html" role="menuitem"><i class="icon fa-info-circle fa-fw" aria-hidden="true"></i><span>About us</span></a></li>			</ul>

	</div>
</div>

	<div class="copyright">
		<script type="text/javascript">
copyright=new Date();

update=copyright.getFullYear();

document.write("Copyright\u0020\u0026copy\u003B 2009 - "+ update +	" ABINIT Discussion Forums All\u0020rights\u0020reserved.");

</script>
<br /><br />		<p class="footer-row">
			<span class="footer-copyright">Flat Style by <a href="http://phpbbstyles.oo.gd/">Ian Bradley</a></span>
		</p>
        <p class="footer-row">
			<span class="footer-copyright">Powered by <a href="https://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Limited</span>
		</p>
						<p class="footer-row">
			<a class="footer-link" href="ucp4d86.html?mode=privacy" title="Privacy" role="menuitem">
				<span class="footer-link-text">Privacy</span>
			</a>
			|
			<a class="footer-link" href="ucp226b.html?mode=terms" title="Terms" role="menuitem">
				<span class="footer-link-text">Terms</span>
			</a>
		</p>
					</div>

	<div id="darkenwrapper" class="darkenwrapper" data-ajax-error-title="AJAX error" data-ajax-error-text="Something went wrong when processing your request." data-ajax-error-text-abort="User aborted request." data-ajax-error-text-timeout="Your request timed out; please try again." data-ajax-error-text-parsererror="Something went wrong with the request and the server returned an invalid reply.">
		<div id="darken" class="darken">&nbsp;</div>
	</div>

	<div id="phpbb_alert" class="phpbb_alert" data-l-err="Error" data-l-timeout-processing-req="Request timed out.">
		<a href="#" class="alert_close">
			<i class="icon fa-times-circle fa-fw" aria-hidden="true"></i>
		</a>
		<h3 class="alert_title">&nbsp;</h3><p class="alert_text"></p>
	</div>
	<div id="phpbb_confirm" class="phpbb_alert">
		<a href="#" class="alert_close">
			<i class="icon fa-times-circle fa-fw" aria-hidden="true"></i>
		</a>
		<div class="alert_text"></div>
	</div>
</div>

</div>

<div>
	<a id="bottom" class="anchor" accesskey="z"></a>
	</div>

<script src="assets/javascript/jquery.minaea1.js?assets_version=57"></script>
<script src="assets/javascript/coreaea1.js?assets_version=57"></script>



<script>
	(function() {
		var cx = '017804512478788106347\u003Atlftx8kncg4';
		var gcse = document.createElement('script');
		gcse.type = 'text/javascript';
		gcse.async = true;
		gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
			'//cse.google.com/cse.js?cx=' + cx;
		var s = document.getElementsByTagName('script')[0];
		s.parentNode.insertBefore(gcse, s);
	})();
</script>
<script type="text/javascript">
(function($) {  // Avoid conflicts with other libraries

'use strict';
	
	phpbb.addAjaxCallback('reporttosfs', function(data) {
		if (data.postid !== "undefined") {
			$('#sfs' + data.postid).hide();
			phpbb.closeDarkenWrapper(5000);
		}
	});

})(jQuery);
</script>
<script src="ext/hifikabin/clock/styles/all/template/js/js_clockaea1.js?assets_version=57"></script>
<script src="ext/phpbb/collapsiblecategories/styles/all/template/js/collapsiblecategoriesaea1.js?assets_version=57"></script>
<script src="styles/prosilver/template/forum_fnaea1.js?assets_version=57"></script>
<script src="styles/prosilver/template/ajaxaea1.js?assets_version=57"></script>



</body>

<!-- Mirrored from forum.abinit.org/viewtopic.php?p=9304 by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 21 Sep 2024 01:21:35 GMT -->
</html>
