<!DOCTYPE html>
<html dir="ltr" lang="en-gb">

<!-- Mirrored from forum.abinit.org/viewtopic.php?f=3&t=3923&view=print by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 20 Sep 2024 18:41:04 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="robots" content="noindex" />

<title>ABINIT Discussion Forums &bull; Is Information Test Fail Really Means Fail in Next Usage?</title>

<link href="styles/flat-style/theme/print.css" rel="stylesheet">
<link href="styles/flat-style/theme/bidi.css" rel="stylesheet">
</head>
<body id="phpbb" class="ltr">
<div id="wrap" class="wrap">
	<a id="top" class="top-anchor" accesskey="t"></a>

	<div id="page-header">
		<h1>ABINIT Discussion Forums</h1>
		<p>The meeting place for ABINIT users and developers<br /><a href="index.html">https://forum.abinit.org/</a></p>

		<h2>Is Information Test Fail Really Means Fail in Next Usage?</h2>
		<p><a href="viewtopic809b.html?f=3&amp;t=3923">https://forum.abinit.org/viewtopic.php?f=3&amp;t=3923</a></p>
	</div>

	<div id="page-body" class="page-body">
		<div class="page-number">Page <strong>1</strong> of <strong>1</strong></div>
					<div class="post">
				<h3>Is Information Test Fail Really Means Fail in Next Usage?</h3>
				<div class="date">Posted: <strong>Mon Sep 17, 2018 8:56 am</strong></div>
				<div class="author">by <strong>ibnusyuhadap3</strong></div>
				<div class="content">Dear moderators and friends,<br /><br />I was build Abinit with fully features, where MKL+MAGMA+MPI and fully DFT flavour used. First, I build magma with configuration as follow<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>#//////////////////////////////////////////////////////////////////////////////<br />#&nbsp; &nbsp;-- MAGMA (version 2.4.0) --<br />#&nbsp; &nbsp; &nbsp; Univ. of Tennessee, Knoxville<br />#&nbsp; &nbsp; &nbsp; Univ. of California, Berkeley<br />#&nbsp; &nbsp; &nbsp; Univ. of Colorado, Denver<br />#&nbsp; &nbsp; &nbsp; @date June 2018<br />#//////////////////////////////////////////////////////////////////////////////<br /><br /># GPU_TARGET contains one or more of Fermi, Kepler, Maxwell, Pascal, Volta<br /># to specify for which GPUs you want to compile MAGMA:<br />#&nbsp; &nbsp; &nbsp;Fermi&nbsp; &nbsp;- NVIDIA compute capability 2.x cards<br />#&nbsp; &nbsp; &nbsp;Kepler&nbsp; - NVIDIA compute capability 3.x cards<br />#&nbsp; &nbsp; &nbsp;Maxwell - NVIDIA compute capability 5.x cards<br />#&nbsp; &nbsp; &nbsp;Pascal&nbsp; - NVIDIA compute capability 6.x cards<br />#&nbsp; &nbsp; &nbsp;Volta&nbsp; &nbsp;- NVIDIA compute capability 7.x cards<br /># The default is &quot;Kepler Maxwell Pascal&quot;.<br /># Note that NVIDIA no longer supports 1.x cards, as of CUDA 6.5.<br /># See http://developer.nvidia.com/cuda-gpus<br />#<br />GPU_TARGET ?= Pascal #Kepler Maxwell Pascal Volta<br /><br /># --------------------<br /># programs<br /><br />CC&nbsp; &nbsp; &nbsp; &nbsp; = mpicc<br />CXX&nbsp; &nbsp; &nbsp; &nbsp;= mpicxx<br />NVCC&nbsp; &nbsp; &nbsp; = nvcc<br />FORT&nbsp; &nbsp; &nbsp; = mpif90<br /><br />ARCH&nbsp; &nbsp; &nbsp; = ar<br />ARCHFLAGS = cr<br />RANLIB&nbsp; &nbsp; = ranlib<br /><br /><br /># --------------------<br /># flags<br /><br /># Use -fPIC to make shared (.so) and static (.a) library;<br /># can be commented out if making only static library.<br />FPIC&nbsp; &nbsp; &nbsp; = -fPIC<br /><br />CFLAGS&nbsp; &nbsp; = -O3 $(FPIC) -fopenmp -DNDEBUG -DADD_ -Wall -Wno-strict-aliasing -Wshadow -DMAGMA_WITH_MKL<br />FFLAGS&nbsp; &nbsp; = -O3 $(FPIC)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -DNDEBUG -DADD_ -Wall -Wno-unused-dummy-argument<br />F90FLAGS&nbsp; = -O3 $(FPIC)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -DNDEBUG -DADD_ -Wall -Wno-unused-dummy-argument -x f95-cpp-input<br />NVCCFLAGS = -O3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -DNDEBUG -DADD_ -Xcompiler &quot;$(FPIC) -Wall -Wno-unused-function -Wno-strict-aliasing&quot;<br />LDFLAGS&nbsp; &nbsp;=&nbsp; &nbsp; &nbsp;$(FPIC) -fopenmp<br /><br /># C++11 (gcc &gt;= 4.7) is not required, but has benefits like atomic operations<br />CXXFLAGS := $(CFLAGS) -std=c++11<br />CFLAGS&nbsp; &nbsp;+= -std=c99<br /><br /><br /># --------------------<br /># libraries<br /><br /># see MKL Link Advisor at http://software.intel.com/sites/products/mkl/<br /># gcc/gfortran with MKL 10.3, GNU OpenMP threads (use -fopenmp in CFLAGS, LDFLAGS)<br />LIB&nbsp; &nbsp; &nbsp; &nbsp;= -lmkl_blas95_lp64 -lmkl_lapack95_lp64 -lmkl_scalapack_lp64 -Wl,--start-group -lmkl_gf_lp64 -lmkl_gnu_thread -lmkl_core -lmkl_blacs_openmpi_lp64 -Wl,--end-group -lgomp -lpthread -lstdc++ -lm -lgfortran<br /><br /># Supposedly, gcc can use Intel threads (libiomp5) instead, but be careful that<br /># libiomp5 and libgomp are NOT BOTH linked. Above, we use gnu threads as a safer option.<br /># gcc/gfortran with MKL 10.3, Intel OpenMP threads (remove -fopenmp from LDFLAGS above)<br />#LIB&nbsp; &nbsp; &nbsp; &nbsp;= -lmkl_gf_lp64 -lmkl_intel_thread -lmkl_core -liomp5 -lpthread -lstdc++ -lm -lgfortran<br />LIB&nbsp; &nbsp; &nbsp; += -lcublas -lcusparse -lcudart -lcudadevrt<br /><br /># --------------------<br /># directories<br /><br /># define library directories preferably in your environment, or here.<br /># for MKL run, e.g.: source /opt/intel/composerxe/mkl/bin/mklvars.sh intel64<br />MKLROOT ?= /opt/intel/compilers_and_libraries_2018.3.222/linux/mkl<br />CUDADIR ?= /usr/local/cuda-9.2<br />-include make.check-mkl<br />-include make.check-cuda<br /><br />LIBDIR&nbsp; &nbsp; = -L$(CUDADIR)/lib64 \<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -L$(MKLROOT)/lib/intel64_lin<br /><br />INC&nbsp; &nbsp; &nbsp; &nbsp;= -I$(CUDADIR)/include \<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -I$(MKLROOT)/include \<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -I$(MKLROOT)/include/intel64/lp64<br /></code></pre></div><br /><br />then, my config file of Abinit is as follow<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>enable_optim=&quot;yes&quot;<br />C=&quot;mpicc -O3 -fopenmp -std=c99&quot;<br />CXX=&quot;mpicxx -O3 -std=c++11&quot;<br />FC=&quot;mpif90 -O3 -fopenmp&quot;<br />enable_mpi=&quot;yes&quot;<br />enable_mpi_io=&quot;yes&quot;<br />with_mpi_prefix=&quot;/usr&quot;<br />enable_gpu=&quot;yes&quot;<br />with_gpu_flavor=&quot;cuda-double&quot;<br />with_gpu_prefix=&quot;/usr/local/cuda-9.2&quot;<br />NVCC=&quot;nvcc -O3 -Xcompiler -gencode arch=compute_60,code=sm_60 -gencode arch=compute_60,code=compute_60&quot;<br />with_trio_flavor=&quot;netcdf&quot;<br />with_fft_flavor=&quot;fftw3-mkl&quot;<br />with_fft_incs=&quot;-I${MKLROOT}/include -I${MKLROOT}/include/fftw -I${MKLROOT}/include/intel64/lp64 -I/usr/local/magma/include&quot;<br />with_fft_libs=&quot;-L${MKLROOT}/lib/intel64_lin -lfftw3xc_gnu -lfftw3xf_gnu -lmkl_blas95_lp64 -lmkl_lapack95_lp64 -lmkl_scalapack_lp64 -Wl,--start-group -lmkl_gf_lp64 -lmkl_gnu_thread -lmkl_core -lmkl_blacs_openmpi_lp64 -Wl,--end-group -lgomp -lpthread -lstdc++ -lm -lgfortran -ldl -L/usr/local/magma/lib -lmagma -lmagma_sparse&quot;<br />with_linalg_flavor=&quot;mkl+magma&quot;<br />with_linalg_incs=&quot;-I${MKLROOT}/include -I${MKLROOT}/include/intel64/lp64 -I/usr/local/magma/include&quot;<br />with_linalg_libs=&quot;-L${MKLROOT}/lib/intel64_lin -lmkl_blas95_lp64 -lmkl_lapack95_lp64 -lmkl_scalapack_lp64 -Wl,--start-group -lmkl_gf_lp64 -lmkl_gnu_thread -lmkl_core -lmkl_blacs_openmpi_lp64 -Wl,--end-group -lgomp -lpthread -lstdc++ -lm -lgfortran -ldl -L/usr/local/magma/lib -lmagma -lmagma_sparse&quot;<br />with_dft_flavor=&quot;atompaw+bigdft+libxc+wannier90&quot;<br />enable_gw_dpc=&quot;yes&quot;<br />enable_openmp=&quot;yes&quot;<br /></code></pre></div><br /><br />Compile was success. I really check the error due to segmentation fault, by using command &quot;make check&quot; after compile. The result is also fine. But it is still reported 8 fails. Then I check the Test Suites. I found, it only different parameter of my Test Suites compared by ABinit reference tests. As example for t03.out.fldiff test, <br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>&lt; .(MPI version, prepared for a x86_64_linux_gnu5.3 computer)<br />&gt; .(MPI version, prepared for a x86_64_linux_gnu5.4 computer)<br />17<br />&lt; .Starting date : Mon&nbsp; 4 Apr 2016.<br />&gt; .Starting date : Mon 17 Sep 2018.<br />29<br />&lt;&nbsp; &nbsp; &nbsp; intxc =&nbsp; &nbsp; &nbsp; &nbsp;1&nbsp; &nbsp; ionmov =&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; iscf =&nbsp; &nbsp; &nbsp; &nbsp;7&nbsp; &nbsp; lmnmax =&nbsp; &nbsp; &nbsp; &nbsp;4<br />&gt;&nbsp; &nbsp; &nbsp; intxc =&nbsp; &nbsp; &nbsp; &nbsp;1&nbsp; &nbsp; ionmov =&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; iscf =&nbsp; &nbsp; &nbsp; &nbsp;7&nbsp; &nbsp; lmnmax =&nbsp; &nbsp; &nbsp; &nbsp;8<br />305<br />&lt;&nbsp; &nbsp;sigma(1 1)= -3.10729488E-05&nbsp; sigma(3 2)=&nbsp; 0.00000000E+00<br />&gt;&nbsp; &nbsp;sigma(1 1)= -8.78351260E-04&nbsp; sigma(3 2)=&nbsp; 0.00000000E+00<br />306<br />&lt;&nbsp; &nbsp;sigma(2 2)= -3.10729488E-05&nbsp; sigma(3 1)=&nbsp; 0.00000000E+00<br />&gt;&nbsp; &nbsp;sigma(2 2)= -8.78351260E-04&nbsp; sigma(3 1)=&nbsp; 0.00000000E+00<br />307<br />&lt;&nbsp; &nbsp;sigma(3 3)= -3.10729488E-05&nbsp; sigma(2 1)=&nbsp; 0.00000000E+00<br />&gt;&nbsp; &nbsp;sigma(3 3)= -8.78351260E-04&nbsp; sigma(2 1)=&nbsp; 0.00000000E+00<br />399<br />&lt;&nbsp; &nbsp;sigma(1 1)= -3.10729488E-05&nbsp; sigma(3 2)=&nbsp; 0.00000000E+00<br />&gt;&nbsp; &nbsp;sigma(1 1)= -8.78351260E-04&nbsp; sigma(3 2)=&nbsp; 0.00000000E+00<br />400<br />&lt;&nbsp; &nbsp;sigma(2 2)= -3.10729488E-05&nbsp; sigma(3 1)=&nbsp; 0.00000000E+00<br />&gt;&nbsp; &nbsp;sigma(2 2)= -8.78351260E-04&nbsp; sigma(3 1)=&nbsp; 0.00000000E+00<br />401<br />&lt;&nbsp; &nbsp;sigma(3 3)= -3.10729488E-05&nbsp; sigma(2 1)=&nbsp; 0.00000000E+00<br />&gt;&nbsp; &nbsp;sigma(3 3)= -8.78351260E-04&nbsp; sigma(2 1)=&nbsp; 0.00000000E+00<br />442<br />&lt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; strten&nbsp; &nbsp; &nbsp;-3.1072948751E-05 -3.1072948751E-05 -3.1072948751E-05<br />&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; strten&nbsp; &nbsp; &nbsp;-8.7835126025E-04 -8.7835126025E-04 -8.7835126025E-04<br />812<br />&lt; .Delivered&nbsp; &nbsp;5 WARNINGs and&nbsp; &nbsp;1 COMMENTs to log file.<br />&gt; .Delivered&nbsp; &nbsp;5 WARNINGs and&nbsp; &nbsp;2 COMMENTs to log file.<br />813<br />&lt; +Overall time at end (sec) : cpu=&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1.4&nbsp; wall=&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.9<br />&gt; +Overall time at end (sec) : cpu=&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1.7&nbsp; wall=&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1.7<br />Summary t03.out : different lines= 8 , max abs_diff= 8.473e-04 (l.442), max rel_diff= 9.317e-01 (l.442)<br /></code></pre></div><br /><br />from the fail information above, we can take conclusion that t03 Abinit reference was using &quot;lmnmax =       4&quot;, but in here of my check is &quot;lmnmax =       8&quot;. Then I went to t03.out.diff to see more deep. I get information my check was using &quot;fftalg 112&quot; but Abinit reference use &quot;fftalg 321&quot;. From here, we can take conclusion again, this fail one of them is due to number of fftalg. I also then check the t03.out to see the really fail source, there is no fail. It is just WARNING and COMMENTS. <br /><br />The question now, is this fail is really fail? As we now, we can use ngfft. If this not really fail, then it is fine to use Abinit exe for my next work? Please response. Thank you</div>
			</div>
			<hr />
			</div>

	<div id="page-footer" class="page-footer">
		<div class="page-number">All times are <span title="Europe/Brussels">UTC+02:00</span><br />Page <strong>1</strong> of <strong>1</strong></div>
			<div class="copyright">
				<p>Powered by <a href="https://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Limited
				</p>
							</div>
	</div>
</div>

</body>

<!-- Mirrored from forum.abinit.org/viewtopic.php?f=3&t=3923&view=print by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 20 Sep 2024 18:41:04 GMT -->
</html>
