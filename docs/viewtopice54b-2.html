<!DOCTYPE html>
<html dir="ltr" lang="en-gb">

<!-- Mirrored from forum.abinit.org/viewtopic.php?f=3&t=678&view=print by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 20 Sep 2024 23:32:35 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="robots" content="noindex" />

<title>ABINIT Discussion Forums &bull; Compiling Abinit 6.4.1 in HPC cluster CentOS</title>

<link href="styles/flat-style/theme/print.css" rel="stylesheet">
<link href="styles/flat-style/theme/bidi.css" rel="stylesheet">
</head>
<body id="phpbb" class="ltr">
<div id="wrap" class="wrap">
	<a id="top" class="top-anchor" accesskey="t"></a>

	<div id="page-header">
		<h1>ABINIT Discussion Forums</h1>
		<p>The meeting place for ABINIT users and developers<br /><a href="index.html">https://forum.abinit.org/</a></p>

		<h2>Compiling Abinit 6.4.1 in HPC cluster CentOS</h2>
		<p><a href="viewtopic5431.html?f=3&amp;t=678">https://forum.abinit.org/viewtopic.php?f=3&amp;t=678</a></p>
	</div>

	<div id="page-body" class="page-body">
		<div class="page-number">Page <strong>1</strong> of <strong>1</strong></div>
					<div class="post">
				<h3>Compiling Abinit 6.4.1 in HPC cluster CentOS</h3>
				<div class="date">Posted: <strong>Wed Oct 20, 2010 6:56 am</strong></div>
				<div class="author">by <strong>cespejo</strong></div>
				<div class="content">Dear Abiniters,<br />I'm getting the following problem at configure on several compilers and parallel environments:<br /><br />(1) the compilers: intel 11.1, gfortran 4.1.2<br />(1') parallel environments: mvapich-intel, openmpi-gcc<br />(2) the architecture: 64 bit, HPC SMP cluster. (CentOS 5)<br />(3) The problem occur compiling in parallel.<br />(4) the version of ABINIT: 6.4.1<br />(5) the relevant compiler error message:<br />(the full config.log is attached)<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>&nbsp; $ ../configure --enable-vdwxc=yes --enable-mpi=yes --enable-mpi-io=yes FC=/usr/local/mpi/intel/mvapich/bin/mpif90<br />.<br />.<br />.<br />==============================================================================<br />&nbsp;=== Advanced compiler features&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;===<br />&nbsp;==============================================================================<br /><br />checking stddef.h usability... no<br />checking stddef.h presence... yes<br />configure: WARNING: stddef.h: present but cannot be compiled<br />configure: WARNING: stddef.h:&nbsp; &nbsp; &nbsp;check for missing prerequisite headers?<br />configure: WARNING: stddef.h: see the Autoconf documentation<br />configure: WARNING: stddef.h:&nbsp; &nbsp; &nbsp;section &quot;Present But Cannot Be Compiled&quot;<br />configure: WARNING: stddef.h: proceeding with the compiler's result<br />configure: WARNING:&nbsp; &nbsp; &nbsp;## ------------------------------------------------- ##<br />configure: WARNING:&nbsp; &nbsp; &nbsp;## Report this to https://bugs.launchpad.net/abinit/ ##<br />configure: WARNING:&nbsp; &nbsp; &nbsp;## ------------------------------------------------- ##<br />checking for stddef.h... no<br />checking stdarg.h usability... no<br />checking stdarg.h presence... yes<br />configure: WARNING: stdarg.h: present but cannot be compiled<br />configure: WARNING: stdarg.h:&nbsp; &nbsp; &nbsp;check for missing prerequisite headers?<br />configure: WARNING: stdarg.h: see the Autoconf documentation<br />configure: WARNING: stdarg.h:&nbsp; &nbsp; &nbsp;section &quot;Present But Cannot Be Compiled&quot;<br />configure: WARNING: stdarg.h: proceeding with the compiler's result<br />configure: WARNING:&nbsp; &nbsp; &nbsp;## ------------------------------------------------- ##<br />configure: WARNING:&nbsp; &nbsp; &nbsp;## Report this to https://bugs.launchpad.net/abinit/ ##<br />configure: WARNING:&nbsp; &nbsp; &nbsp;## ------------------------------------------------- ##<br />checking for stdarg.h... no<br />checking stdio.h usability... no<br />checking stdio.h presence... yes<br />configure: WARNING: stdio.h: present but cannot be compiled<br />configure: WARNING: stdio.h:&nbsp; &nbsp; &nbsp;check for missing prerequisite headers?<br />configure: WARNING: stdio.h: see the Autoconf documentation<br />configure: WARNING: stdio.h:&nbsp; &nbsp; &nbsp;section &quot;Present But Cannot Be Compiled&quot;<br />configure: WARNING: stdio.h: proceeding with the compiler's result<br />configure: WARNING:&nbsp; &nbsp; &nbsp;## ------------------------------------------------- ##<br />configure: WARNING:&nbsp; &nbsp; &nbsp;## Report this to https://bugs.launchpad.net/abinit/ ##<br />configure: WARNING:&nbsp; &nbsp; &nbsp;## ------------------------------------------------- ##<br />checking for stdio.h... no<br />checking malloc.h usability... no<br />checking malloc.h presence... yes<br />configure: WARNING: malloc.h: present but cannot be compiled<br />configure: WARNING: malloc.h:&nbsp; &nbsp; &nbsp;check for missing prerequisite headers?<br />configure: WARNING: malloc.h: see the Autoconf documentation<br />configure: WARNING: malloc.h:&nbsp; &nbsp; &nbsp;section &quot;Present But Cannot Be Compiled&quot;<br />configure: WARNING: malloc.h: proceeding with the compiler's result<br />configure: WARNING:&nbsp; &nbsp; &nbsp;## ------------------------------------------------- ##<br />configure: WARNING:&nbsp; &nbsp; &nbsp;## Report this to https://bugs.launchpad.net/abinit/ ##<br />configure: WARNING:&nbsp; &nbsp; &nbsp;## ------------------------------------------------- ##<br />checking for malloc.h... no<br />checking math.h usability... no<br />checking math.h presence... yes<br />configure: WARNING: math.h: present but cannot be compiled<br />configure: WARNING: math.h:&nbsp; &nbsp; &nbsp;check for missing prerequisite headers?<br />configure: WARNING: math.h: see the Autoconf documentation<br />configure: WARNING: math.h:&nbsp; &nbsp; &nbsp;section &quot;Present But Cannot Be Compiled&quot;<br />configure: WARNING: math.h: proceeding with the compiler's result<br />configure: WARNING:&nbsp; &nbsp; &nbsp;## ------------------------------------------------- ##<br />configure: WARNING:&nbsp; &nbsp; &nbsp;## Report this to https://bugs.launchpad.net/abinit/ ##<br />configure: WARNING:&nbsp; &nbsp; &nbsp;## ------------------------------------------------- ##<br />checking for math.h... no<br />checking termios.h usability... no<br />checking termios.h presence... yes<br />configure: WARNING: termios.h: present but cannot be compiled<br />configure: WARNING: termios.h:&nbsp; &nbsp; &nbsp;check for missing prerequisite headers?<br />configure: WARNING: termios.h: see the Autoconf documentation<br />configure: WARNING: termios.h:&nbsp; &nbsp; &nbsp;section &quot;Present But Cannot Be Compiled&quot;<br />configure: WARNING: termios.h: proceeding with the compiler's result<br />configure: WARNING:&nbsp; &nbsp; &nbsp;## ------------------------------------------------- ##<br />configure: WARNING:&nbsp; &nbsp; &nbsp;## Report this to https://bugs.launchpad.net/abinit/ ##<br />configure: WARNING:&nbsp; &nbsp; &nbsp;## ------------------------------------------------- ##<br />checking for termios.h... no<br />checking errno.h usability... no<br />checking errno.h presence... yes<br />configure: WARNING: errno.h: present but cannot be compiled<br />configure: WARNING: errno.h:&nbsp; &nbsp; &nbsp;check for missing prerequisite headers?<br />configure: WARNING: errno.h: see the Autoconf documentation<br />configure: WARNING: errno.h:&nbsp; &nbsp; &nbsp;section &quot;Present But Cannot Be Compiled&quot;<br />configure: WARNING: errno.h: proceeding with the compiler's result<br />configure: WARNING:&nbsp; &nbsp; &nbsp;## ------------------------------------------------- ##<br />configure: WARNING:&nbsp; &nbsp; &nbsp;## Report this to https://bugs.launchpad.net/abinit/ ##<br />configure: WARNING:&nbsp; &nbsp; &nbsp;## ------------------------------------------------- ##<br />checking for errno.h... no<br />checking mcheck.h usability... no<br />checking mcheck.h presence... yes<br />configure: WARNING: mcheck.h: present but cannot be compiled<br />configure: WARNING: mcheck.h:&nbsp; &nbsp; &nbsp;check for missing prerequisite headers?<br />configure: WARNING: mcheck.h: see the Autoconf documentation<br />configure: WARNING: mcheck.h:&nbsp; &nbsp; &nbsp;section &quot;Present But Cannot Be Compiled&quot;<br />configure: WARNING: mcheck.h: proceeding with the compiler's result<br />configure: WARNING:&nbsp; &nbsp; &nbsp;## ------------------------------------------------- ##<br />configure: WARNING:&nbsp; &nbsp; &nbsp;## Report this to https://bugs.launchpad.net/abinit/ ##<br />configure: WARNING:&nbsp; &nbsp; &nbsp;## ------------------------------------------------- ##<br />checking for mcheck.h... no<br />checking for abort... no<br /></code></pre></div><br />Although configure is finished, soon after typing make the installation stops claiming that C compiler cannot create executables.<br />Thanks in advance for any help. <br /><br />Camilo.</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Compiling Abinit 6.4.1 in HPC cluster CentOS</h3>
				<div class="date">Posted: <strong>Wed Oct 20, 2010 10:19 am</strong></div>
				<div class="author">by <strong>Alain_Jacques</strong></div>
				<div class="content">Hello Camillo,<br /><br />It isn't the right way to configure Abinit anymore i.e. don't mix mpi compilers with FC or CC variables. Mpi compilers will call the backend compiler. So a sample configure invocation line should look like <div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>../configure<br />--with-64bit-flags=&quot;yes&quot;<br />--enable-mpi=&quot;yes&quot;<br />--with-mpi-prefix=/PathToMpiRoot<br />FCFLAGS=ifyouneedthem<br />FC_LDFLAGS_EXTRA=ifyouneedthem<br /></code></pre></div><br /><br />Before invoking configure, you should source the script that setups Intel compilers i.e. source /opt/intel/Compiler/.../bin/ifortvars.sh intel64<br />and /PathToMpiRoot is the path where MPI binaries and libs associated with Intel compilers reside i.e. in /PathToMpiRoot/bin/ and /PathToMpiRoot/lib/<br />no CC or FC ... configure should pick the righ compiler from mpif90 and mpicc<br />If it works like that, you may tune i further to add MKL, optimizations ... but that's another story<br /><br />Kind regards,<br /><br />Alain</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Compiling Abinit 6.4.1 in HPC cluster CentOS</h3>
				<div class="date">Posted: <strong>Wed Oct 20, 2010 8:14 pm</strong></div>
				<div class="author">by <strong>cespejo</strong></div>
				<div class="content">Dear Alain,<br />Thanks! I've done what you suggested for the configuration. Also In my .bashrc I source the ifortvars.sh and export Paths and set library paths also. However I'm getting the same problem: although using  --with-mpi-prefix the correct compilers are chosen, there is the same list of warnings at <em class="text-italics">advanced compiler features</em> section of configure, and next in <em class="text-italics">Connectors</em> it is claimed that MPI support is not usable, furthermore after make compilation stops claiming that C compiler connot generate executables. <br />Later I changed to  openmpi-gcc and set properly my .bashrc getting the same results (I take care of logout the machine and login again in order to mpi-selector-menu adjusts the parallel environment).<br />Thanks again for any help.<br /><br />Camilo.</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Compiling Abinit 6.4.1 in HPC cluster CentOS</h3>
				<div class="date">Posted: <strong>Wed Oct 20, 2010 11:31 pm</strong></div>
				<div class="author">by <strong>Alain_Jacques</strong></div>
				<div class="content">Ok Camillo, a small exercise then ...<br /><br />Create a file with this small MPI C program ...<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>#include &lt;stdio.h&gt;<br />#include &lt;mpi.h&gt;<br /><br />int main(int argc, char *argv&#91;&#93;) {<br />&nbsp; int numprocs, rank, namelen;<br />&nbsp; char processor_name&#91;MPI_MAX_PROCESSOR_NAME&#93;;<br /><br />&nbsp; MPI_Init(&amp;argc, &amp;argv);<br />&nbsp; MPI_Comm_size(MPI_COMM_WORLD, &amp;numprocs);<br />&nbsp; MPI_Comm_rank(MPI_COMM_WORLD, &amp;rank);<br />&nbsp; MPI_Get_processor_name(processor_name, &amp;namelen);<br /><br />&nbsp; printf(&quot;Process %d on %s out of %d\n&quot;, rank, processor_name, numprocs);<br /><br />&nbsp; MPI_Finalize();<br />}</code></pre></div><br />Setup your parallel environment, compile with mpicc and run with mpirun (let's say with -np 4 to request 4 slots). Does it work? As long as it doesn't, Abinit configure cannot get past the mpi c consistency test.<br /><br /><br />Alain</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Compiling Abinit 6.4.1 in HPC cluster CentOS</h3>
				<div class="date">Posted: <strong>Wed Oct 20, 2010 11:35 pm</strong></div>
				<div class="author">by <strong>Alain_Jacques</strong></div>
				<div class="content">... Sorry CamiLo - I'll never get &quot;Don Camillo&quot; (<a href="http://en.wikipedia.org/wiki/Don_Camillo" class="postlink">http://en.wikipedia.org/wiki/Don_Camillo</a>) out of my head.  <img class="smilies" src="images/smilies/icon_redface.gif" alt=":oops:" title="Embarrassed" /> <br /><br />Alain</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Compiling Abinit 6.4.1 in HPC cluster CentOS</h3>
				<div class="date">Posted: <strong>Thu Oct 21, 2010 6:09 pm</strong></div>
				<div class="author">by <strong>cespejo</strong></div>
				<div class="content">Dear Alain,<br />It was compiled without complains, and here is the execution log:<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>&nbsp;mpirun -hostfile ./myhosts -np 4 a.out <br />Process 1 on node001 out of 4<br />Process 3 on node001 out of 4<br />Process 0 on node001 out of 4<br />Process 2 on node001 out of 4<br /></code></pre></div><br />So I think that the mpi and c compiler are working.<br /><br />PD. wow now I know that the tv series Don Camilo at the end of the 80s in Colombia was indeed an adaptation of <br />the original Don Camillo to the political weather in the 50s, when rivalry among liberal and conservative parties drove the country <br />to a violent course  <img class="smilies" src="images/smilies/icon_e_wink.gif" alt=";)" title="Wink" /></div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Compiling Abinit 6.4.1 in HPC cluster CentOS</h3>
				<div class="date">Posted: <strong>Thu Oct 21, 2010 7:45 pm</strong></div>
				<div class="author">by <strong>pouillon</strong></div>
				<div class="content">I've looked into your config.log. You're getting these warnings because you're using GCC 4.1, which is not supported by the build system of Abinit. A quick fix would be to specify the CFLAGS at configure-time yourself.</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Compiling Abinit 6.4.1 in HPC cluster CentOS</h3>
				<div class="date">Posted: <strong>Thu Oct 21, 2010 8:47 pm</strong></div>
				<div class="author">by <strong>cespejo</strong></div>
				<div class="content">Thanks Yann. However, the problem persists working with ifort 11.1<br />Cheers.<br />Camilo.</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Compiling Abinit 6.4.1 in HPC cluster CentOS&nbsp;&nbsp;<span style="color: #006600">[SOLVED]</span></h3>
				<div class="date">Posted: <strong>Fri Oct 22, 2010 11:33 am</strong></div>
				<div class="author">by <strong>pouillon</strong></div>
				<div class="content">You have to make sure that mpicc is connected to icc, not to gcc. If &quot;mpicc --version&quot; tells you about GCC, then you know why it keeps giving you these warnings.</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Compiling Abinit 6.4.1 in HPC cluster CentOS</h3>
				<div class="date">Posted: <strong>Mon Oct 25, 2010 6:23 pm</strong></div>
				<div class="author">by <strong>cespejo</strong></div>
				<div class="content">Thanks Yann, certainly it is the problem, we have not the icc compiler!<br />So, neither the mpi-gcc  nor the mpi-intel work due to different reasons (gcc version on one hand and lack of icc on the other)<br />I'm updating the gcc compilers now <img class="smilies" src="images/smilies/icon_e_smile.gif" alt=":)" title="Smile" /> <br />Cheers,<br />Camilo.</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Compiling Abinit 6.4.1 in HPC cluster CentOS</h3>
				<div class="date">Posted: <strong>Mon Oct 25, 2010 10:04 pm</strong></div>
				<div class="author">by <strong>myid520@163.com</strong></div>
				<div class="content"><blockquote><div><cite>pouillon wrote:</cite>I've looked into your config.log. You're getting these warnings because you're using GCC 4.1, which is not supported by the build system of Abinit. A quick fix would be to specify the CFLAGS at configure-time yourself.</div></blockquote><br />Yes. You must remove '-mtune=native -march=native' in the CFLAGS to enable-plugins successfully.<br />(the defauls CFLAGS seems &quot;-fixed -g -extend-source -vec-report0 -noaltparam -nofpscomp  -O3 -xHost -ip -no-prec-div&quot;)<br />Actually, I found icc does not work too if do not remove those keys in CFLAGS.<br />I want to know the defauls CFLAGS is for which type C compilers?</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Compiling Abinit 6.4.1 in HPC cluster CentOS</h3>
				<div class="date">Posted: <strong>Mon Oct 25, 2010 11:19 pm</strong></div>
				<div class="author">by <strong>cespejo</strong></div>
				<div class="content">Thanks a lot Zhenhua! It compiled cleanly with gcc after, as Yann said, adjusting CFLAGS as you suggested <img class="smilies" src="images/smilies/icon_e_biggrin.gif" alt=":D" title="Very Happy" /><br /><br />Camilo.</div>
			</div>
			<hr />
			</div>

	<div id="page-footer" class="page-footer">
		<div class="page-number">All times are <span title="Europe/Brussels">UTC+02:00</span><br />Page <strong>1</strong> of <strong>1</strong></div>
			<div class="copyright">
				<p>Powered by <a href="https://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Limited
				</p>
							</div>
	</div>
</div>

</body>

<!-- Mirrored from forum.abinit.org/viewtopic.php?f=3&t=678&view=print by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 20 Sep 2024 23:32:35 GMT -->
</html>
