<!DOCTYPE html>
<html dir="ltr" lang="en-gb">

<!-- Mirrored from forum.abinit.org/viewtopic.php?f=10&t=3266&view=print by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 21 Sep 2024 00:28:49 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="robots" content="noindex" />

<title>ABINIT Discussion Forums &bull; [BUG] Effective charge calculation with PAW fails.</title>

<link href="styles/flat-style/theme/print.css" rel="stylesheet">
<link href="styles/flat-style/theme/bidi.css" rel="stylesheet">
</head>
<body id="phpbb" class="ltr">
<div id="wrap" class="wrap">
	<a id="top" class="top-anchor" accesskey="t"></a>

	<div id="page-header">
		<h1>ABINIT Discussion Forums</h1>
		<p>The meeting place for ABINIT users and developers<br /><a href="index.html">https://forum.abinit.org/</a></p>

		<h2>[BUG] Effective charge calculation with PAW fails.</h2>
		<p><a href="viewtopicb372-2.html?f=10&amp;t=3266">https://forum.abinit.org/viewtopic.php?f=10&amp;t=3266</a></p>
	</div>

	<div id="page-body" class="page-body">
		<div class="page-number">Page <strong>1</strong> of <strong>1</strong></div>
					<div class="post">
				<h3>[BUG] Effective charge calculation with PAW fails.</h3>
				<div class="date">Posted: <strong>Fri Apr 15, 2016 1:53 pm</strong></div>
				<div class="author">by <strong>roginovicci</strong></div>
				<div class="content">Dear developers,<br /><br />Calculation of effective charges always fails with PAW approach. Example of Effective charge tensors calculated with DFPT approach with norm conserving pseudo potentials:<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>&nbsp; &nbsp;atom&nbsp; &nbsp; displacement<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1&nbsp; &nbsp;-1.362653E+00&nbsp; &nbsp;-7.005936E-17&nbsp; &nbsp; 2.734595E-15<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2&nbsp; &nbsp;-7.005936E-17&nbsp; &nbsp;-1.362653E+00&nbsp; &nbsp; 2.734595E-15<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3&nbsp; &nbsp; 0.000000E+00&nbsp; &nbsp; 0.000000E+00&nbsp; &nbsp;-2.526618E+00<br /></code></pre></div><br /><br />The other way to calculate effective charges is to compute forces with finite electric field, here is example for the same system with NCPP.<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;berryopt11&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;berryopt21&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;4<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;efield11&nbsp; &nbsp; 0.00000000E+00&nbsp; 0.00000000E+00&nbsp; 0.00000000E+00<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;efield21&nbsp; &nbsp; 1.00000000E-04&nbsp; 0.00000000E+00&nbsp; 0.00000000E+00<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fcart11&nbsp; &nbsp; 1.8740197435E-27&nbsp; 2.8110296153E-27&nbsp; 4.3509916121E-05<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1.8740197435E-27&nbsp; 2.8110296153E-27&nbsp; 4.3509916121E-05<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.0000000000E+00&nbsp; 9.3700987177E-28&nbsp; 4.0128747685E-06<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.0000000000E+00&nbsp; 9.3700987177E-28&nbsp; 4.0128747685E-06<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.0000000000E+00&nbsp; 9.3700987177E-28 -4.0128747685E-06<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.0000000000E+00&nbsp; 9.3700987177E-28 -4.0128747685E-06<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -1.8740197435E-27 -4.6850493588E-27 -4.3509916121E-05<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -1.8740197435E-27 -4.6850493588E-27 -4.3509916121E-05<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fcart21&nbsp; &nbsp;-1.3656955412E-04 -3.3732355384E-26&nbsp; 4.3633783390E-05<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -1.3656955412E-04 -3.3732355384E-26&nbsp; 4.3633783390E-05<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1.3656955412E-04&nbsp; 1.1244118461E-26&nbsp; 3.9358044430E-06<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1.3656955412E-04&nbsp; 1.1244118461E-26&nbsp; 3.9358044430E-06<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1.3656955412E-04 -3.7480394871E-27 -3.9358044430E-06<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1.3656955412E-04 -3.7480394871E-27 -3.9358044430E-06<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -1.3656955412E-04&nbsp; 2.6236276410E-26 -4.3633783390E-05<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -1.3656955412E-04&nbsp; 2.6236276410E-26 -4.3633783390E-05<br /></code></pre></div><br /><br />Thus for atom #1 Z*_xx =  -1.3656955412E-04 /  1.00000000E-04 = -1.3656955412  wich is in good agreement with DFPT (see top).<br /><br />The PAW method totally fails. Results with DFPT:<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>&nbsp;Effective charge tensors<br />&nbsp; atom&nbsp; &nbsp; displacement<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1&nbsp; &nbsp;-5.059849E+00&nbsp; &nbsp; 9.548787E-16&nbsp; &nbsp;-1.088279E-15<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2&nbsp; &nbsp; 1.365618E-15&nbsp; &nbsp;-5.059849E+00&nbsp; &nbsp;-6.283949E-15<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3&nbsp; &nbsp; 2.053695E-16&nbsp; &nbsp;-2.053695E-16&nbsp; &nbsp;-6.386698E+00<br /></code></pre></div><br /><br />It is too high with respect to NCPP<br /><br />the finite field method show an appearance of extra forces in Berry phase approach<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;berryopt11&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;berryopt21&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;4<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;efield11&nbsp; &nbsp; 0.00000000E+00&nbsp; 0.00000000E+00&nbsp; 0.00000000E+00<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;efield21&nbsp; &nbsp; 1.00000000E-04&nbsp; 0.00000000E+00&nbsp; 0.00000000E+00<br />&nbsp; &nbsp; &nbsp; &nbsp; fcart11&nbsp; &nbsp; 0.0000000000E+00&nbsp; 0.0000000000E+00 -8.7573174285E-07<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.0000000000E+00&nbsp; 0.0000000000E+00 -8.7453507066E-07<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.0000000000E+00&nbsp; 0.0000000000E+00 -1.0379378587E-05<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.0000000000E+00&nbsp; 0.0000000000E+00 -1.0379283122E-05<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.0000000000E+00&nbsp; 0.0000000000E+00&nbsp; 1.0379378587E-05<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.0000000000E+00&nbsp; 0.0000000000E+00&nbsp; 1.0379283122E-05<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.0000000000E+00&nbsp; 0.0000000000E+00&nbsp; 8.7573174285E-07<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.0000000000E+00&nbsp; 0.0000000000E+00&nbsp; 8.7453507066E-07<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fcart21&nbsp; &nbsp;-7.0943300118E-04&nbsp; 0.0000000000E+00&nbsp; 4.2677714443E-05<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -7.0943058316E-04&nbsp; 0.0000000000E+00&nbsp; 4.2399631840E-05<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;7.0941888806E-04&nbsp; 0.0000000000E+00 -1.3672525219E-05<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;7.0944469628E-04&nbsp; 0.0000000000E+00 -1.3818698694E-05<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;7.0941888806E-04&nbsp; 0.0000000000E+00&nbsp; 1.3672525219E-05<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;7.0944469628E-04&nbsp; 0.0000000000E+00&nbsp; 1.3818698694E-05<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -7.0943300118E-04&nbsp; 0.0000000000E+00 -4.2677714443E-05<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -7.0943058316E-04&nbsp; 0.0000000000E+00 -4.2399631840E-05<br /></code></pre></div><br /><br />The finite field approach represent the same error in calculation of effective charges.  The forces is really bad in x direction and even in z direction (the direction with electric field OFF) forces are totally wrong (these should be the same as the ground state forces). Is there something specific one have to include in input file when calculationg effective charges with PAW method? There was a thread  in the forum related to error in DFPT part of code related to phonon calculations and that was fixed in Version 7.10.5 of ABINIT, but the calculation of effective charge is still broken.</div>
			</div>
			<hr />
			</div>

	<div id="page-footer" class="page-footer">
		<div class="page-number">All times are <span title="Europe/Brussels">UTC+02:00</span><br />Page <strong>1</strong> of <strong>1</strong></div>
			<div class="copyright">
				<p>Powered by <a href="https://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Limited
				</p>
							</div>
	</div>
</div>

</body>

<!-- Mirrored from forum.abinit.org/viewtopic.php?f=10&t=3266&view=print by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 21 Sep 2024 00:28:49 GMT -->
</html>
