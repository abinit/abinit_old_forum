<!DOCTYPE html>
<html dir="ltr" lang="en-gb">

<!-- Mirrored from forum.abinit.org/viewtopic.php?f=3&t=3798&view=print by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 20 Sep 2024 22:24:46 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="robots" content="noindex" />

<title>ABINIT Discussion Forums &bull; Abinit-8.6.3 with gpu support: test gpu failed</title>

<link href="styles/flat-style/theme/print.css" rel="stylesheet">
<link href="styles/flat-style/theme/bidi.css" rel="stylesheet">
</head>
<body id="phpbb" class="ltr">
<div id="wrap" class="wrap">
	<a id="top" class="top-anchor" accesskey="t"></a>

	<div id="page-header">
		<h1>ABINIT Discussion Forums</h1>
		<p>The meeting place for ABINIT users and developers<br /><a href="index.html">https://forum.abinit.org/</a></p>

		<h2>Abinit-8.6.3 with gpu support: test gpu failed</h2>
		<p><a href="viewtopic9c85.html?f=3&amp;t=3798">https://forum.abinit.org/viewtopic.php?f=3&amp;t=3798</a></p>
	</div>

	<div id="page-body" class="page-body">
		<div class="page-number">Page <strong>1</strong> of <strong>1</strong></div>
					<div class="post">
				<h3>Abinit-8.6.3 with gpu support: test gpu failed</h3>
				<div class="date">Posted: <strong>Tue Mar 13, 2018 3:01 am</strong></div>
				<div class="author">by <strong>thanusit</strong></div>
				<div class="content">Dear all<br /><br />I would like to build Abinit-8.6.3 with gpu support(hoping to make the make the most of it). I have tried to build with the options found in the examples and template config.ac and as well as those in several forum posts. However, I am unable to get the right one that works properly for my platform. My problem is that the configures and builds were successful but test gpu all failed. <br /><br />Could anyone please help? Below are the platform's details and one of build options and test results I tried with gcc+openmpi+mkl+maga. Any suggestions are greatly appreciated.<br /><br />Kind regards,<br />Thanusit <br /><br /># Platform<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>- Intel(R) Xeon(R) CPU E5-2630 v4 @ 2.20GHz (with 20 cpus + 4 x testla K80 gpu)<br />- CentOS-7 with gcc-4.8.5 and python-2.7.5, openmpi-1.10.6(via Yum), mkl(locally installed from Intel parallel_studio_xe_2015_update6), magma-1.6.2(locally built), and Cuda 9.0 (built by sys-admin)<br /></code></pre></div><br /><br /># Build config for abinit-8.6.3. The config.log is attached.<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>prefix=&quot;/workspace/thanusit/local/apps/abinit-8.6.3_gpu&quot;<br />enable_exports=&quot;yes&quot;<br />enable_64bit_flags=&quot;yes&quot;<br />enable_gw_dpc=&quot;yes&quot;<br />enable_bse_unpacked=&quot;yes&quot;<br />enable_memory_profiling=&quot;no&quot;<br />enable_maintainer_checks=&quot;no&quot;<br />#enable_openmp=&quot;yes&quot;<br />enable_mpi=&quot;yes&quot;<br />enable_mpi_io=&quot;yes&quot;<br />with_mpi_prefix=&quot;/usr/lib64/openmpi&quot;<br />enable_gpu=&quot;yes&quot;<br />with_gpu_prefix=&quot;/usr/local/cuda&quot;<br />with_gpu_flavor=&quot;cuda-double&quot;<br />#FC_LDFLAGS_EXTRA=&quot;-Wl,-z,muldefs&quot;<br />#NVCC_CFLAGS=&quot;-O3 -Xptxas=-v --use_fast_math --compiler-options -O3,-fPIC&quot;<br />with_trio_flavor=&quot;netcdf&quot;<br />with_netcdf_incs=&quot;-I/usr/include -I/usr/lib64/gfortran/modules&quot;<br />with_netcdf_libs=&quot;-L/usr/lib64 -lnetcdf -lnetcdff&quot;<br />with_fft_flavor=&quot;fftw3-mkl&quot;<br />with_fft_incs=&quot;-I${MKLROOT}/include&quot;<br />with_fft_libs=&quot;-L${MKLROOT}/lib/intel64 -lmkl_gf_lp64 -lmkl_sequential -lmkl_core -lgomp -lpthread -lm&quot;<br />with_linalg_flavor=&quot;mkl+magma&quot;<br />with_linalg_incs=&quot;-I/workspace/thanusit/local/apps/magma-1.6.2/include -I${MKLROOT}/include&quot;<br />with_linalg_libs=&quot;-L/workspace/thanusit/local/apps/magma-1.6.2/lib/ -lmagma -lcuda -L${MKLROOT}/lib/intel64 -lmkl_gf_lp64 -lmkl_sequential -lmkl_core -lgomp -lpthread -lm&quot;<br />#with_algo_flavor=&quot;levmar&quot;<br />#with_algo_incs=&quot;-I/usr/include&quot;<br />#with_algo_libs=&quot;-L/usr/lib64 -llevmar&quot;<br />#with_math_flavor=&quot;gsl&quot;<br />#with_math_incs=&quot;-I/usr/include&quot;<br />#with_math_libs=&quot;-L/usr/lib64 -lgsl -lgslcblas -lm&quot;<br />#with_dft_flavor=&quot;atompaw+bigdft+libxc+wannier90&quot;<br /></code></pre></div><br /><br /># Make.inc for magma-1.6.2 <br />(The header below says version 1.6.1 but the source files I used was certainly magma-1.6.2.tar.gz.  Please note that the build of magma was successful and passed all tests provided in the package)<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>#//////////////////////////////////////////////////////////////////////////////<br />#&nbsp; &nbsp;-- MAGMA (version 1.6.1) --<br />#&nbsp; &nbsp; &nbsp; Univ. of Tennessee, Knoxville<br />#&nbsp; &nbsp; &nbsp; Univ. of California, Berkeley<br />#&nbsp; &nbsp; &nbsp; Univ. of Colorado, Denver<br />#&nbsp; &nbsp; &nbsp; @date January 2015<br />#//////////////////////////////////////////////////////////////////////////////<br /><br /># GPU_TARGET contains one or more of Tesla, Fermi, or Kepler,<br /># to specify for which GPUs you want to compile MAGMA:<br />#&nbsp; &nbsp; &nbsp;Tesla&nbsp; - NVIDIA compute capability 1.x cards (no longer supported in CUDA 6.5)<br />#&nbsp; &nbsp; &nbsp;Fermi&nbsp; - NVIDIA compute capability 2.x cards<br />#&nbsp; &nbsp; &nbsp;Kepler - NVIDIA compute capability 3.x cards<br /># The default is &quot;Fermi Kepler&quot;.<br /># See http://developer.nvidia.com/cuda-gpus<br />#<br />GPU_TARGET = Kepler<br /><br />CC&nbsp; &nbsp; &nbsp; &nbsp; = gcc<br />CXX&nbsp; &nbsp; &nbsp; &nbsp;= g++<br />NVCC&nbsp; &nbsp; &nbsp; = nvcc<br />FORT&nbsp; &nbsp; &nbsp; = gfortran<br /><br />ARCH&nbsp; &nbsp; &nbsp; = ar<br />ARCHFLAGS = cr<br />RANLIB&nbsp; &nbsp; = ranlib<br /><br /># Use -fPIC to make shared (.so) and static (.a) library;<br /># can be commented out if making only static library.<br />FPIC&nbsp; &nbsp; &nbsp; = -fPIC<br /><br />CFLAGS&nbsp; &nbsp; = -O3 $(FPIC) -DADD_ -Wall -fopenmp -DMAGMA_SETAFFINITY -DMAGMA_WITH_MKL<br />FFLAGS&nbsp; &nbsp; = -O3 $(FPIC) -DADD_ -Wall -Wno-unused-dummy-argument<br />F90FLAGS&nbsp; = -O3 $(FPIC) -DADD_ -Wall -Wno-unused-dummy-argument -x f95-cpp-input<br />NVCCFLAGS = -O3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-DADD_&nbsp; &nbsp; &nbsp; &nbsp;-Xcompiler &quot;-fno-strict-aliasing $(FPIC)&quot;<br />LDFLAGS&nbsp; &nbsp;=&nbsp; &nbsp; &nbsp;$(FPIC)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -fopenmp<br /><br /># see MKL Link Advisor at http://software.intel.com/sites/products/mkl/<br /># gcc with MKL 10.3, sequential version<br />LIB&nbsp; &nbsp; &nbsp; &nbsp;= -lmkl_gf_lp64 -lmkl_sequential -lmkl_core -lcublas -lcudart -lstdc++ -lm -lgfortran<br /><br /># define library directories preferably in your environment, or here.<br /># for MKL run, e.g.: source /opt/intel/composerxe/mkl/bin/mklvars.sh intel64<br />MKLROOT = /workspace/thanusit/intel/composer_xe_2015.6.233/mkl<br />CUDADIR = /usr/local/cuda<br />-include make.check-mkl<br />-include make.check-cuda<br /><br />LIBDIR&nbsp; &nbsp; = -L$(CUDADIR)/lib64 \<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -L$(MKLROOT)/lib/intel64<br /><br />INC&nbsp; &nbsp; &nbsp; &nbsp;= -I$(CUDADIR)/include \<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -I$(MKLROOT)/include<br /><br /></code></pre></div><br /><br /># Result of # ../Runtest.py gpu -t0<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>&#91;thanusit@hpc-b abinit-8.6.3_blddir_mkl-seq_cuda_magma-1.6.2&#93;$ ../abinit-8.6.3/tests/runtests.py gpu -t0<br /><br />Running on hpc-b -- system Linux -- ncpus 20 -- Python 2.7.5 -- runtests.py-0.5.4<br /><br />Regenerating database...<br /><br />Saving database to /workspace/thanusit/src_build/abinit-8.6.3/tests/test_suite.cpkl<br />Running 7 test(s) with MPI_procs=1, py_threads=1...<br />&#91;TIP&#93; runtests.py is using 1 CPUs but your architecture has 20 CPUs<br />You may want to use python threads to speed up the execution<br />Use `runtests -jNUM` to run with NUM threads<br />&#91;gpu&#93;&#91;t01&#93;&#91;np=1&#93;: failed: erroneous lines 15 &gt; 12 &#91;file=t01.out&#93;<br />No YAML Error found in &#91;gpu&#93;&#91;t01&#93;&#91;np=1&#93;<br /><br />&#91;gpu&#93;&#91;t02&#93;&#91;np=1&#93;: failed: erroneous lines 5 &gt; 0 &#91;file=t02.out&#93;<br />No YAML Error found in &#91;gpu&#93;&#91;t02&#93;&#91;np=1&#93;<br />&#91;gpu&#93;&#91;t03&#93;&#91;np=1&#93;: failed: absolute error 0.7476 &gt; 0.0007, relative error 1.0 &gt; 0.085 &#91;file=t03.out&#93;<br />No YAML Error found in &#91;gpu&#93;&#91;t03&#93;&#91;np=1&#93;<br />Command&nbsp; &nbsp;/workspace/thanusit/src_build/abinit-8.6.3_blddir_mkl-seq_cuda_magma-1.6.2/src/98_main/abinit &lt; /workspace/thanusit/src_build/abinit-8.6.3_blddir_mkl-seq_cuda_magma-1.6.2/Test_suite/gpu_t04/t04.stdin &gt; /workspace/thanusit/src_build/abinit-8.6.3_blddir_mkl-seq_cuda_magma-1.6.2/Test_suite/<br /><br />gpu_t04/t04.stdout 2&gt; /workspace/thanusit/src_build/abinit-8.6.3_blddir_mkl-seq_cuda_magma-1.6.2/Test_suite/gpu_t04/t04.stderr<br />&nbsp;returned exit_code: 14<br /><br />&#91;gpu&#93;&#91;t04&#93;&#91;np=1&#93;: fldiff.pl fatal error:<br />The diff analysis cannot be done: the number of lines to be analysed differ.<br />File /workspace/thanusit/src_build/abinit-8.6.3/tests/gpu/Refs/t04.out: 262 lines, 34 ignored<br />File /workspace/thanusit/src_build/abinit-8.6.3_blddir_mkl-seq_cuda_magma-1.6.2/Test_suite/gpu_t04/t04.out: 261 lines, 34 ignored &#91;file=t04.out&#93;<br />&#91;gpu&#93;&#91;t04&#93;&#91;np=1&#93;Test was not expected to fail but subprocesses returned 14<br />On entry to magma_zhegvd, parameter 11 had an illegal value (info = -11)<br /><br />YAML Error found in the stdout of &#91;gpu&#93;&#91;t04&#93;&#91;np=1&#93;<br />--- !ERROR<br />src_file: abi_xhegv.f90<br />src_line: 170<br />mpi_rank: 0<br />message: |<br />&nbsp; &nbsp; Problem in abi_xhegv, info= -11<br />...<br /><br />Command&nbsp; &nbsp;/workspace/thanusit/src_build/abinit-8.6.3_blddir_mkl-seq_cuda_magma-1.6.2/src/98_main/abinit &lt; /workspace/thanusit/src_build/abinit-8.6.3_blddir_mkl-seq_cuda_magma-1.6.2/Test_suite/gpu_t05_MPI1/t05_MPI1.stdin &gt; /workspace/thanusit/src_build/abinit-8.6.3_blddir_mkl-seq_cuda_magma-1.6.2/Test_suite/gpu_t05_MPI1/t05_MPI1.stdout 2&gt; /workspace/thanusit/src_build/abinit-8.6.3_blddir_mkl-seq_cuda_magma-1.6.2/Test_suite/gpu_t05_MPI1/t05_MPI1.stderr<br />&nbsp;returned exit_code: 14<br /><br />&#91;gpu&#93;&#91;t05_MPI1&#93;&#91;np=1&#93;: fldiff.pl fatal error:<br />The diff analysis cannot be done: the number of lines to be analysed differ.<br />File /workspace/thanusit/src_build/abinit-8.6.3/tests/gpu/Refs/t05_MPI1.out: 311 lines, 33 ignored<br />File /workspace/thanusit/src_build/abinit-8.6.3_blddir_mkl-seq_cuda_magma-1.6.2/Test_suite/gpu_t05_MPI1/t05_MPI1.out: 310 lines, 33 ignored &#91;file=t05_MPI1.out&#93;<br />&#91;gpu&#93;&#91;t05_MPI1&#93;&#91;np=1&#93;Test was not expected to fail but subprocesses returned 14<br />On entry to magma_zhegvd, parameter 11 had an illegal value (info = -11)<br /><br />YAML Error found in the stdout of &#91;gpu&#93;&#91;t05_MPI1&#93;&#91;np=1&#93;<br />--- !ERROR<br />src_file: abi_xhegv.f90<br />src_line: 170<br />mpi_rank: 0<br />message: |<br />&nbsp; &nbsp; Problem in abi_xhegv, info= -11<br />...<br /><br />&#91;gpu&#93;&#91;t05_MPI2&#93;&#91;np=0&#93;: Skipped.<br />&nbsp; &nbsp;nprocs: 1 != nprocs_to_test: 2<br />&nbsp; &nbsp;nprocs: 1 in exclude_nprocs: &#91;1&#93;<br /><br />&#91;gpu&#93;&#91;t05_MPI4&#93;&#91;np=0&#93;: Skipped.<br />&nbsp; &nbsp;nprocs: 1 != nprocs_to_test: 4<br />&nbsp; &nbsp;nprocs: 1 in exclude_nprocs: &#91;1, 2, 3&#93;<br /><br /><br />Suite&nbsp; &nbsp;failed&nbsp; passed&nbsp; succeeded&nbsp; skipped&nbsp; disabled&nbsp; run_etime&nbsp; tot_etime<br />gpu&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 5&nbsp; &nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp;282.30&nbsp; &nbsp; &nbsp;283.39<br /><br />Completed in 286.26 &#91;s&#93;. Average time for test=56.46 &#91;s&#93;, stdev=54.64 &#91;s&#93;<br />Summary: failed=5, succeeded=0, passed=0, skipped=2, disabled=0<br /><br />Execution completed.<br />Results in HTML format are available in Test_suite/suite_report.html<br /></code></pre></div></div>
			</div>
			<hr />
			</div>

	<div id="page-footer" class="page-footer">
		<div class="page-number">All times are <span title="Europe/Brussels">UTC+02:00</span><br />Page <strong>1</strong> of <strong>1</strong></div>
			<div class="copyright">
				<p>Powered by <a href="https://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Limited
				</p>
							</div>
	</div>
</div>

</body>

<!-- Mirrored from forum.abinit.org/viewtopic.php?f=3&t=3798&view=print by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 20 Sep 2024 22:24:46 GMT -->
</html>
