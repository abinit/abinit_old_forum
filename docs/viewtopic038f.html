<!DOCTYPE html>
<html dir="ltr" lang="en-gb">

<!-- Mirrored from forum.abinit.org/viewtopic.php?f=9&t=3241&view=print by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 20 Sep 2024 23:03:45 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="robots" content="noindex" />

<title>ABINIT Discussion Forums &bull; How to set correct MPI processes number in abinit-7.10.5?</title>

<link href="styles/flat-style/theme/print.css" rel="stylesheet">
<link href="styles/flat-style/theme/bidi.css" rel="stylesheet">
</head>
<body id="phpbb" class="ltr">
<div id="wrap" class="wrap">
	<a id="top" class="top-anchor" accesskey="t"></a>

	<div id="page-header">
		<h1>ABINIT Discussion Forums</h1>
		<p>The meeting place for ABINIT users and developers<br /><a href="index.html">https://forum.abinit.org/</a></p>

		<h2>How to set correct MPI processes number in abinit-7.10.5?</h2>
		<p><a href="viewtopic6152.html?f=9&amp;t=3241">https://forum.abinit.org/viewtopic.php?f=9&amp;t=3241</a></p>
	</div>

	<div id="page-body" class="page-body">
		<div class="page-number">Page <strong>1</strong> of <strong>1</strong></div>
					<div class="post">
				<h3>How to set correct MPI processes number in abinit-7.10.5?</h3>
				<div class="date">Posted: <strong>Sun Mar 27, 2016 4:16 am</strong></div>
				<div class="author">by <strong>kinsang</strong></div>
				<div class="content">Hi, everyone.<br />I am a new user and build the abinit-7.10.5 MPI version.<br />I dont know how to set the correct MPI process number. Is it relevant to the parameters in input files?<br />For example, in the test case: abinit-7.10.5/tests/tutoparal/Input/tdfpt_03.files , why max nprocs=24<br />#SLAB ending TiO2 double layer<br /># N=9<br /># paralelectric configuration<br />#Supercell and atoms<br /><br />acell 4.0 4.0 28.0 Angstrom<br />            xcart      0.0000000000E+00  0.0000000000E+00 -4.2633349730E+00<br />                       3.7794522658E+00  3.7794522658E+00 -3.2803418097E+00<br />                       0.0000000000E+00  3.7794522658E+00 -3.6627278067E+00<br />                       3.7794522658E+00  0.0000000000E+00  6.5250113947E-01<br />                       0.0000000000E+00  3.7794522658E+00 -1.0555036964E-01<br />                       3.7794522658E+00  3.7794522658E+00  3.2682166278E-01<br />                       0.0000000000E+00  0.0000000000E+00  3.9815918094E+00<br />                       3.7794522658E+00  3.7794522658E+00  4.0167907030E+00<br />                       3.7794522658E+00  0.0000000000E+00  7.7541444349E+00<br />                       0.0000000000E+00  3.7794522658E+00  7.6664087705E+00<br />                       3.7794522658E+00  3.7794522658E+00  7.7182324796E+00<br />                       0.0000000000E+00  0.0000000000E+00  1.1412913350E+01<br />                       3.7794522658E+00  3.7794522658E+00  1.1416615533E+01<br />                       3.7794522658E+00  0.0000000000E+00  1.5117809063E+01<br />                       0.0000000000E+00  3.7794522658E+00  1.5117809063E+01<br />                       3.7794522658E+00  3.7794522658E+00  1.5117809063E+01<br />                       0.0000000000E+00  0.0000000000E+00  1.8822704777E+01<br />                       3.7794522658E+00  3.7794522658E+00  1.8819002593E+01<br />                       3.7794522658E+00  0.0000000000E+00  2.2481473692E+01<br />                       0.0000000000E+00  3.7794522658E+00  2.2569209355E+01<br />                       3.7794522658E+00  3.7794522658E+00  2.2517385647E+01<br />                       0.0000000000E+00  0.0000000000E+00  2.6254026317E+01<br />                       3.7794522658E+00  3.7794522658E+00  2.6218827423E+01<br />                       3.7794522658E+00  0.0000000000E+00  2.9583116986E+01<br />                       0.0000000000E+00  3.7794522658E+00  3.0341168496E+01<br />                       3.7794522658E+00  3.7794522658E+00  2.9908796464E+01<br />                       0.0000000000E+00  0.0000000000E+00  3.4498953099E+01<br />                       3.7794522658E+00  3.7794522658E+00  3.3515959935E+01<br />                       0.0000000000E+00  3.7794522658E+00  3.3898345933E+01<br /><br />ntypat 3<br /><br />znucl 56 22 8<br />typat 3 3 2 3 3 2 1 3 3 3 2 1 3 3 3 2 1 3 3 3 2 1 3 3 3 2 3 3 2<br />natom 29<br />nband 120<br /><br />#electronic structure<br />ecut 15.0<br />nstep 50<br />ngkpt 4 4 1<br />kptopt 1<br />tolwfr 1.0d-22<br />iprcel 45<br /><br />prtden 0<br /><br />paral_kgb 1<br />fftalg 401  # Needed to preserve old behaviour<br />npkpt 4<br />npband 6<br />npfft  1<br /><br />#%%&lt;BEGIN TEST_INFO&gt;<br />#%% [setup]<br />#%% executable = abinit<br />#%% test_chain = tdfpt_03.in, tdfpt_04.in<br />#%% [files]<br />#%% psp_files= 56ba.psp_mod, 22ti.psp_mod, 8o.psp_mod<br />#%% [paral_info]<br />#%% max_nprocs = 24<br />#%% nprocs_to_test = 24<br />#%% [NCPU_24]<br />#%%   files_to_test = tdfpt_03_MPI24.out, tolnlines =   0, tolabs =  0.0, tolrel= 0.0<br />#%%   post_commands = <br />#%%     ww_cp tdfpt_03_MPI24o_WFK tdfpt_04_MPI24i_WFK;<br />#%%     ww_mv tdfpt_03_MPI24o_WFK tdfpt_04_MPI24i_WFQ'<br />#%% [extra_info]<br />#%% keywords = NC<br />#%% description = BaTiO3 linear response calculation<br />#%%&lt;END TEST_INFO&gt;</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: How to set correct MPI processes number in abinit-7.10.5</h3>
				<div class="date">Posted: <strong>Sun Mar 27, 2016 4:53 pm</strong></div>
				<div class="author">by <strong>temok</strong></div>
				<div class="content">Dear Kinsang,<br /><br />I believe 'nprocs=24' is for testing purposes. You do not need to set 'nproc' in the input file but in the command line. As far as I know, you should just set the number of processors NP such that NP is a proper divisor of 'nkpt', the total number of k-points; see 'Number of computing cores to accomplish a task' in the second URL below).<br /><br />Example:<br />1) Set your environment variables such that 'mpirun' and  'abinit' are in your PATH (or give their absolute paths in the command below) and set correctly  LD_LIBRARY_PATH (see the URL below, or look it up in the internet; if you are using intel's they provide a script to to all this, it's called 'compilervars.sh' and 'mpivars.sh').<br />2) Then If you wish to run with 10 processors, you do<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>mpirun&nbsp; -np 10&nbsp; -machinefile &lt;machines_file&gt;&nbsp; &nbsp;&lt; abinit&nbsp; &gt;&amp;&nbsp; foo.files&nbsp; &gt;&amp;&nbsp; foo.log</code></pre></div><br />Here<br />&lt;foo.files&gt; is 'tdfpt_03.files' in your example,<br />&lt; machines_file &gt; is a file containing the hostnames of your computing nodes. You can get the hostname of your machines by typing 'hostname' on your terminal. Collect the names in a file &lt;machines_file&gt;, e.g.<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>host01.example.com<br />host02.example.com</code></pre></div><br />See:<br /><a href="https://www.open-mpi.org/faq/?category=running#simple-spmd-run" class="postlink">https://www.open-mpi.org/faq/?category=running#simple-spmd-run</a><br />and overall, the ABINIT tutorials on parallelism,<br /><a href="http://www.abinit.org/doc/helpfiles/for-v7.10/tutorial/lesson_basepar.html" class="postlink">http://www.abinit.org/doc/helpfiles/for-v7.10/tutorial/lesson_basepar.html</a><br /><br />Cheers,<br />Temok</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: How to set correct MPI processes number in abinit-7.10.5&nbsp;&nbsp;<span style="color: #006600">[SOLVED]</span></h3>
				<div class="date">Posted: <strong>Tue Apr 05, 2016 9:43 am</strong></div>
				<div class="author">by <strong>Jordan</strong></div>
				<div class="content">Yes, all the lines at the end of the input files provided in the tests directory and starting with #%% are just comments that we use for our test farm.<br />Here, it means that the test case is tested on a maximum number of 24 cpus.<br /><br />Cheers.</div>
			</div>
			<hr />
			</div>

	<div id="page-footer" class="page-footer">
		<div class="page-number">All times are <span title="Europe/Brussels">UTC+02:00</span><br />Page <strong>1</strong> of <strong>1</strong></div>
			<div class="copyright">
				<p>Powered by <a href="https://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Limited
				</p>
							</div>
	</div>
</div>

</body>

<!-- Mirrored from forum.abinit.org/viewtopic.php?f=9&t=3241&view=print by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 20 Sep 2024 23:03:45 GMT -->
</html>
