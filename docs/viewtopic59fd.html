<!DOCTYPE html>
<html dir="ltr" lang="en-gb">

<!-- Mirrored from forum.abinit.org/viewtopic.php?f=9&t=1605&view=print by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 21 Sep 2024 03:05:26 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="robots" content="noindex" />

<title>ABINIT Discussion Forums &bull; SCF run crashed when writing WFK: how to use the DEN file?</title>

<link href="styles/flat-style/theme/print.css" rel="stylesheet">
<link href="styles/flat-style/theme/bidi.css" rel="stylesheet">
</head>
<body id="phpbb" class="ltr">
<div id="wrap" class="wrap">
	<a id="top" class="top-anchor" accesskey="t"></a>

	<div id="page-header">
		<h1>ABINIT Discussion Forums</h1>
		<p>The meeting place for ABINIT users and developers<br /><a href="index.html">https://forum.abinit.org/</a></p>

		<h2>SCF run crashed when writing WFK: how to use the DEN file?</h2>
		<p><a href="viewtopic500f.html?f=9&amp;t=1605">https://forum.abinit.org/viewtopic.php?f=9&amp;t=1605</a></p>
	</div>

	<div id="page-body" class="page-body">
		<div class="page-number">Page <strong>1</strong> of <strong>1</strong></div>
					<div class="post">
				<h3>SCF run crashed when writing WFK: how to use the DEN file?</h3>
				<div class="date">Posted: <strong>Thu Apr 05, 2012 5:26 pm</strong></div>
				<div class="author">by <strong>elena.mol</strong></div>
				<div class="content">Dear all, <br />is there a way to obtain a WFK file from a DEN file generated by a SCF abinit calculation which has crashed at convergence, after writing the DEN, but before being able to write a complete WFK?  ...without having to restart the calculation from scratch, of course.<br /><br />This question is due to some problems I'm finding in SCF runs for “big” systems: in particular, i'm considering a molecule (175 atoms), using 1 kpoint, 540 bands, and a cubic cell of 64000 A^3. Everything works fine up to ecut=11 Ha., but with ecut=16 Ha. the SCF run crashes at the end, precisely when trying to write the WFK file (after having written a correct DEN file). <br />I suspect these problems might be due to some disk space issue, since for smaller systems, but with the same cutoff and the same “pathology”, in same cases I succeeded in avoiding the crash by running the job on a disk with larger free space. I noticed there are other topics in this forum related to problems/crashes in writing WFK files, but it's not clear to me if the matter has been solved yet. <br /><br />I'm using abinit-6.10.3 and, if needed, I can provide input files etc, but for the moment I would just like to make clear (maybe it's very trivial) if i can “find a shortcut” by obtaining the WFK file from the DEN one.   ...although maybe the problem would appear again, if it's due to lack of disk space *only* at the moment of writing the WFK?...<br /><br /><br />Many thanks in advance<br />cheers<br />Elena<br /><br />Elena Molteni<br />Department of Physics<br />University of Milan<br />via Celoria, 16 <br />I-20133, Milan, Italy<br />and European Theoretical Spectroscopy Facility (ETSF) <br /><!-- m --><a class="postlink" href="http://www.etsf.eu/">http://www.etsf.eu</a><!-- m --></div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: SCF run crashed when writing WFK: how to use the DEN fil</h3>
				<div class="date">Posted: <strong>Wed Apr 11, 2012 3:28 am</strong></div>
				<div class="author">by <strong>kaneod</strong></div>
				<div class="content">Hi Elena,<br /><br />If you only need the WFK file from the final density (no other properties) you can just restart the calculation with iscf -3 and use tolwfr (instead of tolvrs/toldfe) with a suitably small number to make sure the KS orbitals are converged. Note that you may need to comment out other parts of your input file (anything related to structural optimization, for example). You'll also need to make sure the final density from the crashed calculation is available as an input file in the form in_DEN where &quot;in&quot; is the prefix given in the third line of your ab.files file. <br /><br />The WFK file crashing issue(s) are not resolved as far as I'm aware but the reports are very scattered with different versions of abinit, types of crash/hang and usage so I imagine we are going to have to live with them for the time being until someone can isolate the issue. I'm working on it here but we haven't got any answers yet. If the problem is isolated to the WFK write not the disk space you might get close to what you want using pawprtwf. This needs to be done completely in serial (no kpt or kgb parallelization) and bear in mind you get the AE wavefunctions, not the pseudoized ones. Also: a warning, the AE_WFK files are gigantic - I routinely have files more than 50GB in size for large molecules.</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: SCF run crashed when writing WFK: how to use the DEN fil</h3>
				<div class="date">Posted: <strong>Sun May 06, 2012 3:56 pm</strong></div>
				<div class="author">by <strong>sponce</strong></div>
				<div class="content">Dear Elena,<br /><br />I do actually think that I have a similar problem. For a system of 23 atoms with 4x4x4 MP k-pt grid and with ecut 20Ha I got the following bug report in my log file for a simple ground state calculation:<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>&nbsp;<br />-P-0000&nbsp; leave_test : synchronization done...<br />================================================================================<br /><br />&nbsp;----iterations are completed or convergence reached----<br /><br />&nbsp;outwf&nbsp; : write wavefunction to file ecuto_DS1_WFK<br />-P-0000&nbsp; leave_test : synchronization done...<br /><br />m_wffile.F90:279:COMMENT<br />&nbsp; &nbsp;MPI/IO accessing FORTRAN file header: detected record mark length=4<br />File locking failed in ADIOI_Set_lock(fd 17,cmd F_SETLKW/7,type F_WRLCK/1,whence 0) with return value FFFFFFFF and errno 26.<br />If the file system is NFS, you need to use NFS version 3, ensure that the lockd daemon is running on all the machines, and mount the directory with the 'noac' option (no attribute caching).<br />File locking failed in ADIOI_Set_lock(fd 18,cmd F_SETLKW/7,type F_WRLCK/1,whence 0) with return value FFFFFFFF and errno 26.<br />If the file system is NFS, you need to use NFS version 3, ensure that the lockd daemon is running on all the machines, and mount the directory with the 'noac' option (no attribute caching).<br />ADIOI_Set_lock:: Function not implemented<br />ADIOI_Set_lock:offset 83466, length 27648<br />File locking failed in ADIOI_Set_lock(fd 17,cmd F_SETLKW/7,type F_WRLCK/1,whence 0) with return value FFFFFFFF and errno 26.<br />If the file system is NFS, you need to use NFS version 3, ensure that the lockd daemon is running on all the machines, and mount the directory with the 'noac' option (no attribute caching).<br />ADIOI_Set_lock:: Function not implemented<br />ADIOI_Set_lock:offset 138762, length 27648<br />File locking failed in ADIOI_Set_lock(fd 18,cmd F_SETLKW/7,type F_WRLCK/1,whence 0) with return value FFFFFFFF and errno 26.<br />If the file system is NFS, you need to use NFS version 3, ensure that the lockd daemon is running on all the machines, and mount the directory with the 'noac' option (no attribute caching).<br />ADIOI_Set_lock:: Function not implemented<br />ADIOI_Set_lock:offset 166410, length 27660<br />ADIOI_Set_lock:: Function not implemented<br />ADIOI_Set_lock:offset 111114, length 27648<br />--------------------------------------------------------------------------<br />MPI_ABORT was invoked on rank 0 in communicator MPI_COMM_WORLD<br />with errorcode 1.<br /><br />NOTE: invoking MPI_ABORT causes Open MPI to kill all MPI processes.<br />You may or may not see output from other processes, depending on<br />exactly when Open MPI kills them.<br />--------------------------------------------------------------------------<br /></code></pre></div><br /><br />It systematically crashes just after the writing of the WFK file. I'm using abinit-6.12.3.<br /><br />Cheers!<br /><br />Samuel.</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: SCF run crashed when writing WFK: how to use the DEN fil</h3>
				<div class="date">Posted: <strong>Wed Aug 01, 2012 11:04 am</strong></div>
				<div class="author">by <strong>delaveau</strong></div>
				<div class="content">When WFK file crashes for big case. It migth be because the buffer to be write at the same times is to big.<br />A way of decreasing the size of the buffer is in WffReadWrite_mpio.F90 to put MAXBAND to a lower value.<br />Actually, it's put at 500 meaning that a msg of at most 500*taille of one band is written at the same time.<br />A value of 500 has been taken to reduce the number of disk access (very time consuming)<br /><br />Muriel Delaveau</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: SCF run crashed when writing WFK: how to use the DEN fil</h3>
				<div class="date">Posted: <strong>Wed Aug 01, 2012 11:31 am</strong></div>
				<div class="author">by <strong>delaveau</strong></div>
				<div class="content">A possible reason for having crash in case of big system when writing file WFK is the size of message to be written at the same time.<br />this size is fixed by  MAXBAND=500 in WffReadWrite_mpio.F90 . It means that a message of 500*size of one band ( sie of cg for one band) is on memory.<br />This to minimize the number of disk access who can be very expansive in time.<br />So a way to avoid this reason of crash is to decrease MAXBAND.<br /><br />I hope it could help<br />Muriel Delaveau</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: SCF run crashed when writing WFK: how to use the DEN fil</h3>
				<div class="date">Posted: <strong>Wed Aug 01, 2012 3:06 pm</strong></div>
				<div class="author">by <strong>delaveau</strong></div>
				<div class="content">A possible cause for crash of big case is the size of the message to be written or read at the same time.<br />The size of the message is parameted in WffReadWrite_mpio.F90  by MAXBAND=500<br />The way the written is done is hide under mpi-io implementation.<br />but the size of the message could be decrease by decreasing MAXBAND.<br />MAXBAND=500 has been choseen for performance reason because it minimize the number of disk acces<br /><br />So a way for not having the crash is to lowest the size of the message by putting for instance MAXBAND=30<br /><br />I hope it will help<br />Muriel Delaveau</div>
			</div>
			<hr />
			</div>

	<div id="page-footer" class="page-footer">
		<div class="page-number">All times are <span title="Europe/Brussels">UTC+02:00</span><br />Page <strong>1</strong> of <strong>1</strong></div>
			<div class="copyright">
				<p>Powered by <a href="https://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Limited
				</p>
							</div>
	</div>
</div>

</body>

<!-- Mirrored from forum.abinit.org/viewtopic.php?f=9&t=1605&view=print by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 21 Sep 2024 03:05:26 GMT -->
</html>
