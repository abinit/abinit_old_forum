<!DOCTYPE html>
<html dir="ltr" lang="en-gb">

<!-- Mirrored from forum.abinit.org/viewtopic.php?t=3837 by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 21 Sep 2024 00:11:08 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1" />

<title>mpi issues - ABINIT Discussion Forums</title>


	<link rel="canonical" href="viewtopic7db5.html?t=3837">

<!--
	phpBB style name: Flat Style
	Based on style:   prosilver (this is the default phpBB3 style)
	Original author:  Tom Beddard ( http://www.subBlue.com/ )
	Modified by:      Ian Bradley
-->

<link href="assets/css/font-awesome.minaea1.css?assets_version=57" rel="stylesheet">
<link href="styles/flat-style/theme/stylesheetaea1.css?assets_version=57" rel="stylesheet">
<link href="styles/flat-style/theme/en/stylesheetaea1.css?assets_version=57" rel="stylesheet">




<!--[if lte IE 9]>
	<link href="./styles/flat-style/theme/tweaks.css?assets_version=57" rel="stylesheet">
<![endif]-->

<meta name="google-site-verification" content="PLdTN48UENWHvJ5ViWhDTahZKzoMyw5e1QZgw1IECVw" />
<link rel="alternate" type="application/atom+xml" title="ATOM" href="app.php/smartfeed/feed.html" />
<link rel="alternate" type="application/rss+xml" title="RSS" href="app.php/smartfeed/feed9830.html?y=2" />

<link href="ext/crizzo/aboutus/styles/prosilver/theme/aboutusaea1.css?assets_version=57" rel="stylesheet" media="screen" />
<link href="ext/dmzx/topicageday/styles/prosilver/theme/topicagedayaea1.css?assets_version=57" rel="stylesheet" media="screen" />
<link href="ext/hifikabin/clock/styles/all/theme/clockaea1.css?assets_version=57" rel="stylesheet" media="screen" />
<link href="ext/hifikabin/googlesearch/styles/prosilver/theme/googlesearchaea1.css?assets_version=57" rel="stylesheet" media="screen" />
<link href="ext/kinerity/bestanswer/styles/prosilver/theme/bestansweraea1.css?assets_version=57" rel="stylesheet" media="screen" />
<link href="ext/phpbb/collapsiblecategories/styles/all/theme/collapsiblecategoriesaea1.css?assets_version=57" rel="stylesheet" media="screen" />
<link href="ext/phpbbservices/smartfeed/styles/prosilver/theme/customaea1.css?assets_version=57" rel="stylesheet" media="screen" />
<link href="ext/senky/userstatistics/styles/prosilver/theme/userstatisticsaea1.css?assets_version=57" rel="stylesheet" media="screen" />
<link href="ext/tierra/topicsolved/styles/prosilver/theme/buttonsaea1.css?assets_version=57" rel="stylesheet" media="screen" />



</head>
<body id="phpbb" class="nojs notouch section-viewtopic ltr ">


<div id="wrap" class="wrap">
	<a id="top" class="top-anchor" accesskey="t"></a>
	<div id="page-header">
		<div class="headerbar" role="banner">
					<div class="inner">

			<div id="site-description">
				<a id="logo" class="logo" href="index-2.html" title="Board index"><span class="site_logo"></span></a>
				<div  class="site-description">
					<h1>ABINIT Discussion Forums</h1>
					<p>The meeting place for ABINIT users and developers</p>
					<p class="skiplink"><a href="#start_here">Skip to content</a></p>
				</div>
			</div>

			</div>
					</div>
				<div class="navbar navbar-top" role="navigation">
	<div class="inner">

	<ul id="nav-main" class="nav-main linklist" role="menubar">

		<li id="quick-links" class="quick-links dropdown-container responsive-menu" data-skip-responsive="true">
			<a href="#" class="dropdown-trigger">
				<i class="icon fa-bars fa-fw" aria-hidden="true"></i><span>Quick links</span>
			</a>
			<div class="dropdown">
				<div class="pointer"><div class="pointer-inner"></div></div>
				<ul class="dropdown-contents" role="menu">
					
											<li class="separator"></li>
																									<li>
								<a href="search33a7.html?search_id=unanswered" role="menuitem">
									<i class="icon fa-file fa-fw" aria-hidden="true"></i><span>Unanswered topics</span>
								</a>
							</li>
							<li>
								<a href="search526f.html?search_id=active_topics" role="menuitem">
									<i class="icon fa-file fa-fw" aria-hidden="true"></i><span>Active topics</span>
								</a>
							</li>
							<li class="separator"></li>
							<li>
								<a href="search.html" role="menuitem">
									<i class="icon fa-search fa-fw" aria-hidden="true"></i><span>Search</span>
								</a>
							</li>
					
										
										<li class="separator"></li>

									</ul>
			</div>
		</li>

			<li class="small-icon icon-smartfeed no-bulletin"><a href="app.php/smartfeed/ui.html">Smartfeed</a></li>		<li data-skip-responsive="true">
			<a href="app.php/help/faq.html" rel="help" title="Frequently Asked Questions" role="menuitem">
				<i class="icon fa-question-circle fa-fw" aria-hidden="true"></i><span>FAQ</span>
			</a>
		</li>
								<li data-last-responsive="true">
				<a href="https://www.abinit.org/" title="" role="menuitem" target="_blank">
				<i class="icon fa-home fa-fw" aria-hidden="true"></i><span>Main Site</span>
				</a>
			</li>
								<li data-last-responsive="true">
				<a href="https://www.abinit.org/packages" title="" role="menuitem" target="_blank">
				<i class="icon fa-download fa-fw" aria-hidden="true"></i><span>Download</span>
				</a>
			</li>
								<li data-last-responsive="true">
				<a href="https://docs.abinit.org/" title="" role="menuitem" target="_blank">
				<i class="icon fa-book fa-fw" aria-hidden="true"></i><span>Documentations</span>
				</a>
			</li>
								<li data-last-responsive="true">
				<a href="https://docs.abinit.org/tutorial/" title="" role="menuitem" target="_blank">
				<i class="icon fa-graduation-cap fa-fw" aria-hidden="true"></i><span>Tutorials</span>
				</a>
			</li>
							
			<li class="rightside"  data-skip-responsive="true">
			<a href="ucp26c3.html?mode=login" title="Login" accesskey="x" role="menuitem">
				<i class="icon fa-power-off fa-fw" aria-hidden="true"></i><span>Login</span>
			</a>
		</li>
						</ul>
    </div>
</div>

<div class="navbar" role="navigation">
	<div class="inner">
	<ul id="nav-breadcrumbs" class="nav-breadcrumbs linklist navlinks" role="menubar">
								<li class="breadcrumbs" itemscope itemtype="http://schema.org/BreadcrumbList">
										<span class="crumb"  itemtype="http://schema.org/ListItem" itemprop="itemListElement" itemscope><a href="index-2.html" itemtype="https://schema.org/Thing" itemprop="item" accesskey="h" data-navbar-reference="index"><i class="icon fa-home fa-fw"></i><span itemprop="name">Board index</span></a><meta itemprop="position" content="1" /></span>
											<span class="crumb"  itemtype="http://schema.org/ListItem" itemprop="itemListElement" itemscope data-forum-id="4"><a href="viewforum31e6.html?f=4" itemtype="https://schema.org/Thing" itemprop="item"><span itemprop="name">Running Abinit</span></a><meta itemprop="position" content="2" /></span>
															<span class="crumb"  itemtype="http://schema.org/ListItem" itemprop="itemListElement" itemscope data-forum-id="9"><a href="viewforumfdc5.html?f=9" itemtype="https://schema.org/Thing" itemprop="item"><span itemprop="name">Ground state</span></a><meta itemprop="position" content="3" /></span>
												</li>
		<li class="rightside responsive-hide">
	<div id="show-clock">
		<div id="liveclock" class="outer_face">
			<div class="marker oneseven"></div>
			<div class="marker twoeight"></div>
			<div class="marker fourten"></div>
			<div class="marker fiveeleven"></div>
			<div class="inner_face">
				<div class="hand hour"></div>
				<div class="hand minute"></div>
				<div class="hand second"></div>
			</div>
		</div>
	</div>
</li><!--[if !IE]><!-->
<li id="g-search-box" class="search-box rightside responsive-hide">
	<form action="https://forum.abinit.org/app.php/googlesearch">
	<fieldset>
		<input name="cx" type="hidden" value="017804512478788106347:tlftx8kncg4">
		<input name="q" type="search" maxlength="255" class="inputbox search tiny" value="" placeholder="Google Search ...">
		<button class="button button-search-google" type="submit" name="sitesearch" title="Google Search">
		<i class="icon fa-search fa-fw" aria-hidden="true"></i>
		</button>
	</fieldset>
</form>
</li>
<!--<![endif]-->

							<li id="search-box" class="rightside search-box responsive-hide" role="search">
				<form action="https://forum.abinit.org/search.php" method="get" id="search">
				<fieldset>
					<input name="keywords" id="keywords" type="search" maxlength="128" title="Search for keywords" class="inputbox search tiny" size="20" value="" placeholder="Search…" />
					<button class="button button-search" type="submit" title="Search">
						<i class="icon fa-search fa-fw" aria-hidden="true"></i><span class="sr-only">Search</span>
					</button>
					<a href="search.html" class="button button-search-end" title="Advanced search">
						<i class="icon fa-cog fa-fw" aria-hidden="true"></i><span class="sr-only">Advanced search</span>
					</a>
					
				</fieldset>
				</form>
			</li>

			<li class="rightside responsive-search">
				<a href="search.html" title="View the advanced search options" role="menuitem">
					<i class="icon fa-search fa-fw" aria-hidden="true"></i><span class="sr-only">Search</span>
				</a>
			</li>
					</ul>

	</div>
</div>
	</div>

	
	<a id="start_here" class="anchor"></a>
	<div id="page-body" class="page-body" role="main">
		
		﻿
<h2 class="topic-title"><a href="viewtopiccbac.html?f=9&amp;t=3837">mpi issues</a>&nbsp;
<a href="viewtopic000f-2.html?f=9&amp;t=3837&amp;p=11592#p11592" style="color: #006600;">
	[SOLVED]
</a>
</h2>
<!-- NOTE: remove the style="display: none" when you want to have the forum description on the topic body -->
<div style="display: none !important;">Total energy, geometry optimization, DFT+U, spin....<br /></div>
<p>
	<strong>Moderator:</strong> <a href="memberlista146.html?mode=viewprofile&amp;u=2687" class="username">bguster</a>
</p>


<div class="action-bar bar-top">
	
			<a href="postingb19e.html?mode=reply&amp;f=9&amp;t=3837" class="button" title="This topic is locked, you cannot edit posts or make further replies.">
							<span>Locked</span> <i class="icon fa-lock fa-fw" aria-hidden="true"></i>
					</a>
	
			<div class="dropdown-container dropdown-button-control topic-tools">
		<span title="Topic tools" class="button button-secondary dropdown-trigger dropdown-select">
			<i class="icon fa-wrench fa-fw" aria-hidden="true"></i>
			<span class="caret"><i class="icon fa-sort-down fa-fw" aria-hidden="true"></i></span>
		</span>
		<div class="dropdown">
			<div class="pointer"><div class="pointer-inner"></div></div>
			<ul class="dropdown-contents">
																												<li>
					<a href="viewtopicd44b-2.html?f=9&amp;t=3837&amp;view=print" title="Print view" accesskey="p">
						<i class="icon fa-print fa-fw" aria-hidden="true"></i><span>Print view</span>
					</a>
				</li>
											</ul>
		</div>
	</div>
	
			<div class="search-box" role="search">
			<form method="get" id="topic-search" action="https://forum.abinit.org/search.php">
			<fieldset>
				<input class="inputbox search tiny"  type="search" name="keywords" id="search_keywords" size="20" placeholder="Search this topic…" />
				<button class="button button-search" type="submit" title="Search">
					<i class="icon fa-search fa-fw" aria-hidden="true"></i><span class="sr-only">Search</span>
				</button>
				<a href="search.html" class="button button-search-end" title="Advanced search">
					<i class="icon fa-cog fa-fw" aria-hidden="true"></i><span class="sr-only">Advanced search</span>
				</a>
				<input type="hidden" name="t" value="3837" />
<input type="hidden" name="sf" value="msgonly" />

			</fieldset>
			</form>
		</div>
	
			<div class="pagination">
			7 posts
							&bull; Page <strong>1</strong> of <strong>1</strong>
					</div>
		</div>




			<div id="p11583" class="post has-profile bg2 offline">
		<div class="inner">

		<dl class="postprofile" id="profile11583">
			<dt class="no-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlistd669.html?mode=viewprofile&amp;u=2115" class="username">baisxun</a>							</dt>

									
		<dd class="profile-posts"><strong>Posts:</strong> <a href="searchbc31.html?author_id=2115&amp;sr=posts">6</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> Fri Mar 30, 2018 5:10 am</dd>		
		
						
						
		</dl>

		<div class="postbody">
						<div id="post_content11583">

						<h3 class="first"><a href="#p11583">mpi issues</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting7aca.html?mode=quote&amp;f=9&amp;p=11583" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author">
									<a class="unread" href="viewtopicf579.html?p=11583#p11583" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlistd669.html?mode=viewprofile&amp;u=2115" class="username">baisxun</a></strong> &raquo; </span>Mon May 07, 2018 3:10 am
			</p>
			
			
			
			<div class="content">Hi,<br /><br />I have a problem with my mpi paramaters, in the crystal system I'm calculating, there are 167 bands, and when I run on a cluster, a message as follows constantly comes up:<br /><br />&quot;You should try to get npband*bandpp=167<br /> For information matrix size is   177655&quot;<br /><br />For each step this message comes up several times before actually doing any calculation and as a result mpi is much slower than non-mpi runs. The problem is, I can't come up with a combination of npband and bandpp that gives 167, it's just impossible. <br /><br />Has anyone else ever encountered such an issue? How did you deal with it?<br /><br />Any comments would be most appreciated.</div>
			
			
			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p11585" class="post has-profile bg1 offline">
		<div class="inner">

		<dl class="postprofile" id="profile11585">
			<dt class="no-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlist58ee.html?mode=viewprofile&amp;u=682" class="username">ebousquet</a>							</dt>

									
		<dd class="profile-posts"><strong>Posts:</strong> <a href="search82c3.html?author_id=682&amp;sr=posts">469</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> Tue Apr 19, 2011 11:13 am</dd>		
		
											<dd class="profile-custom-field profile-phpbb_location"><strong>Location:</strong> University of Liege, Belgium</dd>
							
						
		</dl>

		<div class="postbody">
						<div id="post_content11585">

						<h3 ><a href="#p11585">Re: mpi issues</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting9793.html?mode=quote&amp;f=9&amp;p=11585" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author">
									<a class="unread" href="viewtopicbe5d.html?p=11585#p11585" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlist58ee.html?mode=viewprofile&amp;u=682" class="username">ebousquet</a></strong> &raquo; </span>Mon May 07, 2018 12:58 pm
			</p>
			
			
			
			<div class="content">Dear baisxun,<br />You can increase nband to &gt;167 that can fit with the number of k-points, etc and the number of CPU. Sometimes having a bit more bands but optimizing the scalability drives you to a much faster calculation.<br />Did you specify the parameters of paral_kgb yourself (npband, npkpt, npfft, bandpp) or did you use the automatic flag?<br />If you initialize paral_kgb=1 by hand can you send the values you put?<br />Best wishes,<br />Eric</div>
			
			
			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p11587" class="post has-profile bg2 offline">
		<div class="inner">

		<dl class="postprofile" id="profile11587">
			<dt class="no-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlistd669.html?mode=viewprofile&amp;u=2115" class="username">baisxun</a>							</dt>

									
		<dd class="profile-posts"><strong>Posts:</strong> <a href="searchbc31.html?author_id=2115&amp;sr=posts">6</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> Fri Mar 30, 2018 5:10 am</dd>		
		
						
						
		</dl>

		<div class="postbody">
						<div id="post_content11587">

						<h3 ><a href="#p11587">Re: mpi issues</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting0bc9.html?mode=quote&amp;f=9&amp;p=11587" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author">
									<a class="unread" href="viewtopic7047-2.html?p=11587#p11587" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlistd669.html?mode=viewprofile&amp;u=2115" class="username">baisxun</a></strong> &raquo; </span>Mon May 07, 2018 6:01 pm
			</p>
			
			
			
			<div class="content"><blockquote><div><cite>ebousquet wrote:</cite>Dear baisxun,<br />You can increase nband to &gt;167 that can fit with the number of k-points, etc and the number of CPU. Sometimes having a bit more bands but optimizing the scalability drives you to a much faster calculation.<br />Did you specify the parameters of paral_kgb yourself (npband, npkpt, npfft, bandpp) or did you use the automatic flag?<br />If you initialize paral_kgb=1 by hand can you send the values you put?<br />Best wishes,<br />Eric</div></blockquote><br /><br />Dear Eric,<br /><br />Thanks you so much for your reply.<br /><br />I'm running on 20 processors (just to test mpi with one node on our cluster). The parallel parameters I used are as follows:<br /><br />paral_kgb 1<br />npband 4<br /> npfft 2<br />npkpt 4<br />bandpp 1<br /><br />If I understand the parameter settings correctly, it multplies to 32, which is bigger than 20, but it somehow still runs. <br /><br />So I should assign, for example, 180 processors, which is bigger than 167, and come up with a combination of npband*npfft*npkpt that gives 180, correct?<br /><br />Best,<br /><br />Shixun</div>
			
			
			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p11589" class="post has-profile bg1 offline">
		<div class="inner">

		<dl class="postprofile" id="profile11589">
			<dt class="no-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlist58ee.html?mode=viewprofile&amp;u=682" class="username">ebousquet</a>							</dt>

									
		<dd class="profile-posts"><strong>Posts:</strong> <a href="search82c3.html?author_id=682&amp;sr=posts">469</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> Tue Apr 19, 2011 11:13 am</dd>		
		
											<dd class="profile-custom-field profile-phpbb_location"><strong>Location:</strong> University of Liege, Belgium</dd>
							
						
		</dl>

		<div class="postbody">
						<div id="post_content11589">

						<h3 ><a href="#p11589">Re: mpi issues</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="postingaaef.html?mode=quote&amp;f=9&amp;p=11589" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author">
									<a class="unread" href="viewtopic1276.html?p=11589#p11589" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlist58ee.html?mode=viewprofile&amp;u=682" class="username">ebousquet</a></strong> &raquo; </span>Tue May 08, 2018 5:33 pm
			</p>
			
			
			
			<div class="content">Dear Shixun,<br />Lets first suppose we parallelize only on bands and kpoints (i.e. npfft=1).<br />The best is first to have npkpt=nkpt because the parallelism over k-point is the most efficient (it requires low communication between MPI processes).<br />Then for the bands the deal is to have nband/npband = integer. In your case nband=167 is a really bad number because it cannot be divided by anything but 167... nband=168 is much better because it can be divided by 2, 4, 6, 8 and 21, which can thus be used as values for npband.<br />Parallelizing beyond npband=16 bands will start to give a less good speedup (this should be tested on your system and machine to see up to which npband value you still have a speedup) and so in your case good values for npband are 2, 4, 6 or 8 if you set nband=168.<br /><br />The number of CPU of your job should always be equal to npkpt*npband*npfft.<br /><br />If you have to go further with more CPU numbers, you can start to switch on the parallelism over fft-grid points by having npfft&gt;1.<br /><br />Another possibility is to use the OpenMP parallelism through bandpp flag (if you have compiled Abinit with OpenMP flag) if you want to use threading, let me know if you want to use it on the top of MPI.<br /><br />Best wishes,<br />Eric</div>
			
			
			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p11590" class="post has-profile bg2 offline">
		<div class="inner">

		<dl class="postprofile" id="profile11590">
			<dt class="no-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlistd669.html?mode=viewprofile&amp;u=2115" class="username">baisxun</a>							</dt>

									
		<dd class="profile-posts"><strong>Posts:</strong> <a href="searchbc31.html?author_id=2115&amp;sr=posts">6</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> Fri Mar 30, 2018 5:10 am</dd>		
		
						
						
		</dl>

		<div class="postbody">
						<div id="post_content11590">

						<h3 ><a href="#p11590">Re: mpi issues</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting50ea.html?mode=quote&amp;f=9&amp;p=11590" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author">
									<a class="unread" href="viewtopice65c.html?p=11590#p11590" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlistd669.html?mode=viewprofile&amp;u=2115" class="username">baisxun</a></strong> &raquo; </span>Tue May 08, 2018 7:32 pm
			</p>
			
			
			
			<div class="content"><blockquote><div><cite>ebousquet wrote:</cite>Dear Shixun,<br />Lets first suppose we parallelize only on bands and kpoints (i.e. npfft=1).<br />The best is first to have npkpt=nkpt because the parallelism over k-point is the most efficient (it requires low communication between MPI processes).<br />Then for the bands the deal is to have nband/npband = integer. In your case nband=167 is a really bad number because it cannot be divided by anything but 167... nband=168 is much better because it can be divided by 2, 4, 6, 8 and 21, which can thus be used as values for npband.<br />Parallelizing beyond npband=16 bands will start to give a less good speedup (this should be tested on your system and machine to see up to which npband value you still have a speedup) and so in your case good values for npband are 2, 4, 6 or 8 if you set nband=168.<br /><br />The number of CPU of your job should always be equal to npkpt*npband*npfft.<br /><br />If you have to go further with more CPU numbers, you can start to switch on the parallelism over fft-grid points by having npfft&gt;1.<br /><br />Another possibility is to use the OpenMP parallelism through bandpp flag (if you have compiled Abinit with OpenMP flag) if you want to use threading, let me know if you want to use it on the top of MPI.<br /><br />Best wishes,<br />Eric</div></blockquote><br /><br /><br />Eric,<br /><br />Thank you! That helped a lot! I am so new at this at I didn't even know nband is something you can manually redefine, how embarrassing...<br /><br />According to our cluster manager, he did compile ABINIT with OpenMP. So is that why I get the message &quot;you should set the number of threads to something close to 1&quot; ? In the trial runs I either set bandpp = 1 or don't specify anything for bandpp, so intuitively I shouldn't get that message, I suppose?<br /><br />Best,<br /><br />Shixun</div>
			
			
			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p11592" class="post has-profile bg1 offline">
		<div class="inner">

		<dl class="postprofile" id="profile11592">
			<dt class="no-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlist58ee.html?mode=viewprofile&amp;u=682" class="username">ebousquet</a>							</dt>

									
		<dd class="profile-posts"><strong>Posts:</strong> <a href="search82c3.html?author_id=682&amp;sr=posts">469</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> Tue Apr 19, 2011 11:13 am</dd>		
		
											<dd class="profile-custom-field profile-phpbb_location"><strong>Location:</strong> University of Liege, Belgium</dd>
							
						
		</dl>

		<div class="postbody">
						<div id="post_content11592">

						<h3 ><a href="#p11592">Re: mpi issues&nbsp;&nbsp;<span style="color: #006600">[SOLVED]</span></a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="postingfb67.html?mode=quote&amp;f=9&amp;p=11592" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author">
									<a class="unread" href="viewtopic9697-2.html?p=11592#p11592" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlist58ee.html?mode=viewprofile&amp;u=682" class="username">ebousquet</a></strong> &raquo; </span>Wed May 09, 2018 6:26 pm
			</p>
			
			
			
			<div class="content">Hi Shixun,<br />Don't be embarrassed, we always have to start from some point  <img class="smilies" src="images/smilies/icon_e_wink.gif" alt=";)" title="Wink" /> <br />You can thus indeed define nband manually.<br /><br />OK for the compilation of Abinit with OpenMP. If you don't use the OpenMP parallelization in your job, then don't define bandpp in your input and be sure that the OMP_NUM_THREADS of your system is set to 1 (to enforce that no threading will be used).<br /><br />If you want to use threading, it is a bit more complicated but the advise is to set bandpp=nband, put npfft=1 (the OpenMP threading is not, yet, compatible with fft parallelization), npband=1 and npkpt as before, i.e. =nkpt. Then you have to set OMP_NUM_THREADS to a value that is compatible with bandpp, i.e. bandpp/OMP_NUM_THREADS is an integer (as before with bandpp and nband in the MPI case). <br />Then the number of &quot;processors&quot; should be equal to npkpt and the total number of CPU to request will be equal to nkpt*OMP_NUM_THREADS. <br /><br />Lets suppose we have a system with kpt=10 and nband set to 80 we have the following input flags:<br />nband=80<br />npkpt=10<br />npfft=1<br />npband=1<br />bandpp=80<br /><br />And in a PBS job script you should have something like that (it is an example, but other possibilities are possible that depends on the architecture of the machine you are running on) if we want to run on 8 threads:<br /><br />...<br />#PBS -l select=10:ncpus=8:mpiprocs=1:ompthreads=8:vmem=21000mb<br />...<br />export MKL_NUM_THREADS=8<br />export OMP_NUM_THREADS=8<br /><br />Where here I'm running on 10 nodes for MPI parallelism of k-points (for each k-points that requires low communication) and on each node I request 8 cpu that I all use for threading. <br /><br />If all of that is quite obscure to you, ask to your machine cluster manager, he should know all about these technicalities.<br /><br />Best wishes,<br />Eric</div>
			
			
			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p11593" class="post has-profile bg2 offline">
		<div class="inner">

		<dl class="postprofile" id="profile11593">
			<dt class="no-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlistd669.html?mode=viewprofile&amp;u=2115" class="username">baisxun</a>							</dt>

									
		<dd class="profile-posts"><strong>Posts:</strong> <a href="searchbc31.html?author_id=2115&amp;sr=posts">6</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> Fri Mar 30, 2018 5:10 am</dd>		
		
						
						
		</dl>

		<div class="postbody">
						<div id="post_content11593">

						<h3 ><a href="#p11593">Re: mpi issues</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting2cb8.html?mode=quote&amp;f=9&amp;p=11593" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author">
									<a class="unread" href="viewtopice6fa.html?p=11593#p11593" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlistd669.html?mode=viewprofile&amp;u=2115" class="username">baisxun</a></strong> &raquo; </span>Wed May 09, 2018 9:47 pm
			</p>
			
			
			
			<div class="content"><blockquote><div><cite>ebousquet wrote:</cite>Hi Shixun,<br />Don't be embarrassed, we always have to start from some point  <img class="smilies" src="images/smilies/icon_e_wink.gif" alt=";)" title="Wink" /> <br />You can thus indeed define nband manually.<br /><br />OK for the compilation of Abinit with OpenMP. If you don't use the OpenMP parallelization in your job, then don't define bandpp in your input and be sure that the OMP_NUM_THREADS of your system is set to 1 (to enforce that no threading will be used).<br /><br />If you want to use threading, it is a bit more complicated but the advise is to set bandpp=nband, put npfft=1 (the OpenMP threading is not, yet, compatible with fft parallelization), npband=1 and npkpt as before, i.e. =nkpt. Then you have to set OMP_NUM_THREADS to a value that is compatible with bandpp, i.e. bandpp/OMP_NUM_THREADS is an integer (as before with bandpp and nband in the MPI case). <br />Then the number of &quot;processors&quot; should be equal to npkpt and the total number of CPU to request will be equal to nkpt*OMP_NUM_THREADS. <br /><br />Lets suppose we have a system with kpt=10 and nband set to 80 we have the following input flags:<br />nband=80<br />npkpt=10<br />npfft=1<br />npband=1<br />bandpp=80<br /><br />And in a PBS job script you should have something like that (it is an example, but other possibilities are possible that depends on the architecture of the machine you are running on) if we want to run on 8 threads:<br /><br />...<br />#PBS -l select=10:ncpus=8:mpiprocs=1:ompthreads=8:vmem=21000mb<br />...<br />export MKL_NUM_THREADS=8<br />export OMP_NUM_THREADS=8<br /><br />Where here I'm running on 10 nodes for MPI parallelism of k-points (for each k-points that requires low communication) and on each node I request 8 cpu that I all use for threading. <br /><br />If all of that is quite obscure to you, ask to your machine cluster manager, he should know all about these technicalities.<br /><br />Best wishes,<br />Eric</div></blockquote><br /><br /><br />Thank you Eric, I'm sure this settles everything.<br /><br />Best,<br /><br />Shixun</div>
			
			
			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
	

	<div class="action-bar bar-bottom">
	
			<a href="postingb19e.html?mode=reply&amp;f=9&amp;t=3837" class="button" title="This topic is locked, you cannot edit posts or make further replies.">
							<span>Locked</span> <i class="icon fa-lock fa-fw" aria-hidden="true"></i>
					</a>
		
		<div class="dropdown-container dropdown-button-control topic-tools">
		<span title="Topic tools" class="button button-secondary dropdown-trigger dropdown-select">
			<i class="icon fa-wrench fa-fw" aria-hidden="true"></i>
			<span class="caret"><i class="icon fa-sort-down fa-fw" aria-hidden="true"></i></span>
		</span>
		<div class="dropdown">
			<div class="pointer"><div class="pointer-inner"></div></div>
			<ul class="dropdown-contents">
																												<li>
					<a href="viewtopicd44b-2.html?f=9&amp;t=3837&amp;view=print" title="Print view" accesskey="p">
						<i class="icon fa-print fa-fw" aria-hidden="true"></i><span>Print view</span>
					</a>
				</li>
											</ul>
		</div>
	</div>

			<form method="post" action="https://forum.abinit.org/viewtopic.php?f=9&amp;t=3837">
		<div class="dropdown-container dropdown-container-left dropdown-button-control sort-tools">
	<span title="Display and sorting options" class="button button-secondary dropdown-trigger dropdown-select">
		<i class="icon fa-sort-amount-asc fa-fw" aria-hidden="true"></i>
		<span class="caret"><i class="icon fa-sort-down fa-fw" aria-hidden="true"></i></span>
	</span>
	<div class="dropdown hidden">
		<div class="pointer"><div class="pointer-inner"></div></div>
		<div class="dropdown-contents">
			<fieldset class="display-options">
							<label>Display: <select name="st" id="st"><option value="0" selected="selected">All posts</option><option value="1">1 day</option><option value="7">7 days</option><option value="14">2 weeks</option><option value="30">1 month</option><option value="90">3 months</option><option value="180">6 months</option><option value="365">1 year</option></select></label>
								<label>Sort by: <select name="sk" id="sk"><option value="a">Author</option><option value="t" selected="selected">Post time</option><option value="s">Subject</option></select></label>
				<label>Direction: <select name="sd" id="sd"><option value="a" selected="selected">Ascending</option><option value="d">Descending</option></select></label>
								<hr class="dashed" />
				<input type="submit" class="button2" name="sort" value="Go" />
						</fieldset>
		</div>
	</div>
</div>
		</form>
	
	
	
			<div class="pagination">
			7 posts
							&bull; Page <strong>1</strong> of <strong>1</strong>
					</div>
	</div>


<div class="action-bar actions-jump">
		<p class="jumpbox-return">
		<a href="viewforumfdc5.html?f=9" class="left-box arrow-left" accesskey="r">
			<i class="icon fa-angle-left fa-fw icon-black" aria-hidden="true"></i><span>Return to “Ground state”</span>
		</a>
	</p>
	
		<div class="jumpbox dropdown-container dropdown-container-right dropdown-up dropdown-left dropdown-button-control" id="jumpbox">
			<span title="Jump to" class="button button-secondary dropdown-trigger dropdown-select">
				<span>Jump to</span>
				<span class="caret"><i class="icon fa-sort-down fa-fw" aria-hidden="true"></i></span>
			</span>
		<div class="dropdown">
			<div class="pointer"><div class="pointer-inner"></div></div>
			<ul class="dropdown-contents">
																				<li><a href="viewforumffeb.html?f=20" class="jumpbox-forum-link"> <span> News &amp; Announcements</span></a></li>
																<li><a href="viewforum8011.html?f=23" class="jumpbox-forum-link"> <span> Jobs and Other Announcements</span></a></li>
																<li><a href="viewforum58da.html?f=1" class="jumpbox-cat-link"> <span> Building ABINIT</span></a></li>
																<li><a href="viewforum4d6b.html?f=3" class="jumpbox-sub-link"><span class="spacer"></span> <span>&#8627; &nbsp; Configuring and compiling ABINIT</span></a></li>
																<li><a href="viewforum31e6.html?f=4" class="jumpbox-cat-link"> <span> Running Abinit</span></a></li>
																<li><a href="viewforumfdc5.html?f=9" class="jumpbox-sub-link"><span class="spacer"></span> <span>&#8627; &nbsp; Ground state</span></a></li>
																<li><a href="viewforum15ca.html?f=10" class="jumpbox-sub-link"><span class="spacer"></span> <span>&#8627; &nbsp; Response calculations</span></a></li>
																<li><a href="viewforum8a83.html?f=11" class="jumpbox-sub-link"><span class="spacer"></span> <span>&#8627; &nbsp; Many-body perturbation theory</span></a></li>
																<li><a href="viewforum01c9.html?f=12" class="jumpbox-sub-link"><span class="spacer"></span> <span>&#8627; &nbsp; Other tools and postprocessing in ABINIT</span></a></li>
																<li><a href="viewforum345c.html?f=24" class="jumpbox-sub-link"><span class="spacer"></span> <span>&#8627; &nbsp; Python interfacing : Abipy ecosystem</span></a></li>
																<li><a href="viewforum9780.html?f=14" class="jumpbox-sub-link"><span class="spacer"></span> <span>&#8627; &nbsp; Link to other codes</span></a></li>
																<li><a href="viewforume774.html?f=5" class="jumpbox-cat-link"> <span> Developing Abinit</span></a></li>
																<li><a href="viewforum218b.html?f=19" class="jumpbox-sub-link"><span class="spacer"></span> <span>&#8627; &nbsp; Improving ABINIT</span></a></li>
											</ul>
		</div>
	</div>

	</div>


			</div>


<div id="page-footer" class="page-footer" role="contentinfo">
	<div class="navbar navbar-bottom" role="navigation">
	<div class="inner">

	<ul id="nav-footer" class="nav-footer linklist" role="menubar">
		<li class="breadcrumbs">
									<span class="crumb"><a href="index-2.html" data-navbar-reference="index"><i class="icon fa-home fa-fw" aria-hidden="true"></i><span>Board index</span></a></span>					</li>
		
				
							<li class="rightside">
				<a href="ucp033a.html?mode=delete_cookies" data-ajax="true" data-refresh="true" role="menuitem">
					<i class="icon fa-trash fa-fw" aria-hidden="true"></i><span>Delete cookies</span>
				</a>
			</li>
				
		<li class="rightside" data-last-responsive="true"><a href="app.php/aboutus.html" role="menuitem"><i class="icon fa-info-circle fa-fw" aria-hidden="true"></i><span>About us</span></a></li>			</ul>

	</div>
</div>

	<div class="copyright">
		<script type="text/javascript">
copyright=new Date();

update=copyright.getFullYear();

document.write("Copyright\u0020\u0026copy\u003B 2009 - "+ update +	" ABINIT Discussion Forums All\u0020rights\u0020reserved.");

</script>
<br /><br />		<p class="footer-row">
			<span class="footer-copyright">Flat Style by <a href="http://phpbbstyles.oo.gd/">Ian Bradley</a></span>
		</p>
        <p class="footer-row">
			<span class="footer-copyright">Powered by <a href="https://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Limited</span>
		</p>
						<p class="footer-row">
			<a class="footer-link" href="ucp4d86.html?mode=privacy" title="Privacy" role="menuitem">
				<span class="footer-link-text">Privacy</span>
			</a>
			|
			<a class="footer-link" href="ucp226b.html?mode=terms" title="Terms" role="menuitem">
				<span class="footer-link-text">Terms</span>
			</a>
		</p>
					</div>

	<div id="darkenwrapper" class="darkenwrapper" data-ajax-error-title="AJAX error" data-ajax-error-text="Something went wrong when processing your request." data-ajax-error-text-abort="User aborted request." data-ajax-error-text-timeout="Your request timed out; please try again." data-ajax-error-text-parsererror="Something went wrong with the request and the server returned an invalid reply.">
		<div id="darken" class="darken">&nbsp;</div>
	</div>

	<div id="phpbb_alert" class="phpbb_alert" data-l-err="Error" data-l-timeout-processing-req="Request timed out.">
		<a href="#" class="alert_close">
			<i class="icon fa-times-circle fa-fw" aria-hidden="true"></i>
		</a>
		<h3 class="alert_title">&nbsp;</h3><p class="alert_text"></p>
	</div>
	<div id="phpbb_confirm" class="phpbb_alert">
		<a href="#" class="alert_close">
			<i class="icon fa-times-circle fa-fw" aria-hidden="true"></i>
		</a>
		<div class="alert_text"></div>
	</div>
</div>

</div>

<div>
	<a id="bottom" class="anchor" accesskey="z"></a>
	</div>

<script src="assets/javascript/jquery.minaea1.js?assets_version=57"></script>
<script src="assets/javascript/coreaea1.js?assets_version=57"></script>



<script>
	(function() {
		var cx = '017804512478788106347\u003Atlftx8kncg4';
		var gcse = document.createElement('script');
		gcse.type = 'text/javascript';
		gcse.async = true;
		gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
			'//cse.google.com/cse.js?cx=' + cx;
		var s = document.getElementsByTagName('script')[0];
		s.parentNode.insertBefore(gcse, s);
	})();
</script>
<script type="text/javascript">
(function($) {  // Avoid conflicts with other libraries

'use strict';
	
	phpbb.addAjaxCallback('reporttosfs', function(data) {
		if (data.postid !== "undefined") {
			$('#sfs' + data.postid).hide();
			phpbb.closeDarkenWrapper(5000);
		}
	});

})(jQuery);
</script>
<script src="ext/hifikabin/clock/styles/all/template/js/js_clockaea1.js?assets_version=57"></script>
<script src="ext/phpbb/collapsiblecategories/styles/all/template/js/collapsiblecategoriesaea1.js?assets_version=57"></script>
<script src="styles/prosilver/template/forum_fnaea1.js?assets_version=57"></script>
<script src="styles/prosilver/template/ajaxaea1.js?assets_version=57"></script>



</body>

<!-- Mirrored from forum.abinit.org/viewtopic.php?t=3837 by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 21 Sep 2024 00:11:08 GMT -->
</html>
