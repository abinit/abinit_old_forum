<!DOCTYPE html>
<html dir="ltr" lang="en-gb">

<!-- Mirrored from forum.abinit.org/viewtopic.php?p=5263 by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 20 Sep 2024 22:02:15 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1" />

<title>Bug: MPI-IO hang in WffReadWrite_mpio - ABINIT Discussion Forums</title>


	<link rel="canonical" href="viewtopice64c.html?t=1667">

<!--
	phpBB style name: Flat Style
	Based on style:   prosilver (this is the default phpBB3 style)
	Original author:  Tom Beddard ( http://www.subBlue.com/ )
	Modified by:      Ian Bradley
-->

<link href="assets/css/font-awesome.minaea1.css?assets_version=57" rel="stylesheet">
<link href="styles/flat-style/theme/stylesheetaea1.css?assets_version=57" rel="stylesheet">
<link href="styles/flat-style/theme/en/stylesheetaea1.css?assets_version=57" rel="stylesheet">




<!--[if lte IE 9]>
	<link href="./styles/flat-style/theme/tweaks.css?assets_version=57" rel="stylesheet">
<![endif]-->

<meta name="google-site-verification" content="PLdTN48UENWHvJ5ViWhDTahZKzoMyw5e1QZgw1IECVw" />
<link rel="alternate" type="application/atom+xml" title="ATOM" href="app.php/smartfeed/feed.html" />
<link rel="alternate" type="application/rss+xml" title="RSS" href="app.php/smartfeed/feed9830.html?y=2" />

<link href="ext/crizzo/aboutus/styles/prosilver/theme/aboutusaea1.css?assets_version=57" rel="stylesheet" media="screen" />
<link href="ext/dmzx/topicageday/styles/prosilver/theme/topicagedayaea1.css?assets_version=57" rel="stylesheet" media="screen" />
<link href="ext/hifikabin/clock/styles/all/theme/clockaea1.css?assets_version=57" rel="stylesheet" media="screen" />
<link href="ext/hifikabin/googlesearch/styles/prosilver/theme/googlesearchaea1.css?assets_version=57" rel="stylesheet" media="screen" />
<link href="ext/kinerity/bestanswer/styles/prosilver/theme/bestansweraea1.css?assets_version=57" rel="stylesheet" media="screen" />
<link href="ext/phpbb/collapsiblecategories/styles/all/theme/collapsiblecategoriesaea1.css?assets_version=57" rel="stylesheet" media="screen" />
<link href="ext/phpbbservices/smartfeed/styles/prosilver/theme/customaea1.css?assets_version=57" rel="stylesheet" media="screen" />
<link href="ext/senky/userstatistics/styles/prosilver/theme/userstatisticsaea1.css?assets_version=57" rel="stylesheet" media="screen" />
<link href="ext/tierra/topicsolved/styles/prosilver/theme/buttonsaea1.css?assets_version=57" rel="stylesheet" media="screen" />



</head>
<body id="phpbb" class="nojs notouch section-viewtopic ltr ">


<div id="wrap" class="wrap">
	<a id="top" class="top-anchor" accesskey="t"></a>
	<div id="page-header">
		<div class="headerbar" role="banner">
					<div class="inner">

			<div id="site-description">
				<a id="logo" class="logo" href="index-2.html" title="Board index"><span class="site_logo"></span></a>
				<div  class="site-description">
					<h1>ABINIT Discussion Forums</h1>
					<p>The meeting place for ABINIT users and developers</p>
					<p class="skiplink"><a href="#start_here">Skip to content</a></p>
				</div>
			</div>

			</div>
					</div>
				<div class="navbar navbar-top" role="navigation">
	<div class="inner">

	<ul id="nav-main" class="nav-main linklist" role="menubar">

		<li id="quick-links" class="quick-links dropdown-container responsive-menu" data-skip-responsive="true">
			<a href="#" class="dropdown-trigger">
				<i class="icon fa-bars fa-fw" aria-hidden="true"></i><span>Quick links</span>
			</a>
			<div class="dropdown">
				<div class="pointer"><div class="pointer-inner"></div></div>
				<ul class="dropdown-contents" role="menu">
					
											<li class="separator"></li>
																									<li>
								<a href="search33a7.html?search_id=unanswered" role="menuitem">
									<i class="icon fa-file fa-fw" aria-hidden="true"></i><span>Unanswered topics</span>
								</a>
							</li>
							<li>
								<a href="search526f.html?search_id=active_topics" role="menuitem">
									<i class="icon fa-file fa-fw" aria-hidden="true"></i><span>Active topics</span>
								</a>
							</li>
							<li class="separator"></li>
							<li>
								<a href="search.html" role="menuitem">
									<i class="icon fa-search fa-fw" aria-hidden="true"></i><span>Search</span>
								</a>
							</li>
					
										
										<li class="separator"></li>

									</ul>
			</div>
		</li>

			<li class="small-icon icon-smartfeed no-bulletin"><a href="app.php/smartfeed/ui.html">Smartfeed</a></li>		<li data-skip-responsive="true">
			<a href="app.php/help/faq.html" rel="help" title="Frequently Asked Questions" role="menuitem">
				<i class="icon fa-question-circle fa-fw" aria-hidden="true"></i><span>FAQ</span>
			</a>
		</li>
								<li data-last-responsive="true">
				<a href="https://www.abinit.org/" title="" role="menuitem" target="_blank">
				<i class="icon fa-home fa-fw" aria-hidden="true"></i><span>Main Site</span>
				</a>
			</li>
								<li data-last-responsive="true">
				<a href="https://www.abinit.org/packages" title="" role="menuitem" target="_blank">
				<i class="icon fa-download fa-fw" aria-hidden="true"></i><span>Download</span>
				</a>
			</li>
								<li data-last-responsive="true">
				<a href="https://docs.abinit.org/" title="" role="menuitem" target="_blank">
				<i class="icon fa-book fa-fw" aria-hidden="true"></i><span>Documentations</span>
				</a>
			</li>
								<li data-last-responsive="true">
				<a href="https://docs.abinit.org/tutorial/" title="" role="menuitem" target="_blank">
				<i class="icon fa-graduation-cap fa-fw" aria-hidden="true"></i><span>Tutorials</span>
				</a>
			</li>
							
			<li class="rightside"  data-skip-responsive="true">
			<a href="ucp26c3.html?mode=login" title="Login" accesskey="x" role="menuitem">
				<i class="icon fa-power-off fa-fw" aria-hidden="true"></i><span>Login</span>
			</a>
		</li>
						</ul>
    </div>
</div>

<div class="navbar" role="navigation">
	<div class="inner">
	<ul id="nav-breadcrumbs" class="nav-breadcrumbs linklist navlinks" role="menubar">
								<li class="breadcrumbs" itemscope itemtype="http://schema.org/BreadcrumbList">
										<span class="crumb"  itemtype="http://schema.org/ListItem" itemprop="itemListElement" itemscope><a href="index-2.html" itemtype="https://schema.org/Thing" itemprop="item" accesskey="h" data-navbar-reference="index"><i class="icon fa-home fa-fw"></i><span itemprop="name">Board index</span></a><meta itemprop="position" content="1" /></span>
											<span class="crumb"  itemtype="http://schema.org/ListItem" itemprop="itemListElement" itemscope data-forum-id="5"><a href="viewforume774.html?f=5" itemtype="https://schema.org/Thing" itemprop="item"><span itemprop="name">Developing Abinit</span></a><meta itemprop="position" content="2" /></span>
															<span class="crumb"  itemtype="http://schema.org/ListItem" itemprop="itemListElement" itemscope data-forum-id="19"><a href="viewforum218b.html?f=19" itemtype="https://schema.org/Thing" itemprop="item"><span itemprop="name">Improving ABINIT</span></a><meta itemprop="position" content="3" /></span>
												</li>
		<li class="rightside responsive-hide">
	<div id="show-clock">
		<div id="liveclock" class="outer_face">
			<div class="marker oneseven"></div>
			<div class="marker twoeight"></div>
			<div class="marker fourten"></div>
			<div class="marker fiveeleven"></div>
			<div class="inner_face">
				<div class="hand hour"></div>
				<div class="hand minute"></div>
				<div class="hand second"></div>
			</div>
		</div>
	</div>
</li><!--[if !IE]><!-->
<li id="g-search-box" class="search-box rightside responsive-hide">
	<form action="https://forum.abinit.org/app.php/googlesearch">
	<fieldset>
		<input name="cx" type="hidden" value="017804512478788106347:tlftx8kncg4">
		<input name="q" type="search" maxlength="255" class="inputbox search tiny" value="" placeholder="Google Search ...">
		<button class="button button-search-google" type="submit" name="sitesearch" title="Google Search">
		<i class="icon fa-search fa-fw" aria-hidden="true"></i>
		</button>
	</fieldset>
</form>
</li>
<!--<![endif]-->

							<li id="search-box" class="rightside search-box responsive-hide" role="search">
				<form action="https://forum.abinit.org/search.php" method="get" id="search">
				<fieldset>
					<input name="keywords" id="keywords" type="search" maxlength="128" title="Search for keywords" class="inputbox search tiny" size="20" value="" placeholder="Search…" />
					<button class="button button-search" type="submit" title="Search">
						<i class="icon fa-search fa-fw" aria-hidden="true"></i><span class="sr-only">Search</span>
					</button>
					<a href="search.html" class="button button-search-end" title="Advanced search">
						<i class="icon fa-cog fa-fw" aria-hidden="true"></i><span class="sr-only">Advanced search</span>
					</a>
					
				</fieldset>
				</form>
			</li>

			<li class="rightside responsive-search">
				<a href="search.html" title="View the advanced search options" role="menuitem">
					<i class="icon fa-search fa-fw" aria-hidden="true"></i><span class="sr-only">Search</span>
				</a>
			</li>
					</ul>

	</div>
</div>
	</div>

	
	<a id="start_here" class="anchor"></a>
	<div id="page-body" class="page-body" role="main">
		
		﻿
<h2 class="topic-title"><a href="viewtopicbc16.html?f=19&amp;t=1667">Bug: MPI-IO hang in WffReadWrite_mpio</a></h2>
<!-- NOTE: remove the style="display: none" when you want to have the forum description on the topic body -->
<div style="display: none !important;">Documentation, Web site and code modifications<br /></div>
<p>
	<strong>Moderators:</strong> <a href="memberlist4183.html?mode=viewprofile&amp;u=1676" class="username">baguetl</a>, <a href="memberlistccd1.html?mode=viewprofile&amp;u=2257" class="username">routerov</a>
</p>


<div class="action-bar bar-top">
	
			<a href="postingf258.html?mode=reply&amp;f=19&amp;t=1667" class="button" title="This topic is locked, you cannot edit posts or make further replies.">
							<span>Locked</span> <i class="icon fa-lock fa-fw" aria-hidden="true"></i>
					</a>
	
			<div class="dropdown-container dropdown-button-control topic-tools">
		<span title="Topic tools" class="button button-secondary dropdown-trigger dropdown-select">
			<i class="icon fa-wrench fa-fw" aria-hidden="true"></i>
			<span class="caret"><i class="icon fa-sort-down fa-fw" aria-hidden="true"></i></span>
		</span>
		<div class="dropdown">
			<div class="pointer"><div class="pointer-inner"></div></div>
			<ul class="dropdown-contents">
																												<li>
					<a href="viewtopic3a1c.html?f=19&amp;t=1667&amp;view=print" title="Print view" accesskey="p">
						<i class="icon fa-print fa-fw" aria-hidden="true"></i><span>Print view</span>
					</a>
				</li>
											</ul>
		</div>
	</div>
	
			<div class="search-box" role="search">
			<form method="get" id="topic-search" action="https://forum.abinit.org/search.php">
			<fieldset>
				<input class="inputbox search tiny"  type="search" name="keywords" id="search_keywords" size="20" placeholder="Search this topic…" />
				<button class="button button-search" type="submit" title="Search">
					<i class="icon fa-search fa-fw" aria-hidden="true"></i><span class="sr-only">Search</span>
				</button>
				<a href="search.html" class="button button-search-end" title="Advanced search">
					<i class="icon fa-cog fa-fw" aria-hidden="true"></i><span class="sr-only">Advanced search</span>
				</a>
				<input type="hidden" name="t" value="1667" />
<input type="hidden" name="sf" value="msgonly" />

			</fieldset>
			</form>
		</div>
	
			<div class="pagination">
			4 posts
							&bull; Page <strong>1</strong> of <strong>1</strong>
					</div>
		</div>




			<div id="p5189" class="post has-profile bg2 offline">
		<div class="inner">

		<dl class="postprofile" id="profile5189">
			<dt class="no-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlistaf78.html?mode=viewprofile&amp;u=209" class="username">kaneod</a>							</dt>

									
		<dd class="profile-posts"><strong>Posts:</strong> <a href="search66ac.html?author_id=209&amp;sr=posts">42</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> Wed Mar 10, 2010 11:47 am</dd>		
		
						
						
		</dl>

		<div class="postbody">
						<div id="post_content5189">

						<h3 class="first"><a href="#p5189">Bug: MPI-IO hang in WffReadWrite_mpio</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="postinga0c9.html?mode=quote&amp;f=19&amp;p=5189" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author">
									<a class="unread" href="viewtopice2eb.html?p=5189#p5189" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlistaf78.html?mode=viewprofile&amp;u=209" class="username">kaneod</a></strong> &raquo; </span>Thu May 10, 2012 2:11 pm
			</p>
			
			
			
			<div class="content">Hi all,<br /><br />We're getting a MPI-IO hang when MPI_FILE_WRITE_ALL is called on line 229 of the wffreadwrite_mpio.F90 routine in Abinit 6.12.3. The file to be written is on a GPFS file system and we only get the hang when we run across multiple nodes on our (infiniband-connected) cluster. It's been rather difficult to isolate the problem so far, so I've included an input file below that causes the hang and a case that doesn't. <br /><br />We've found this occurs with both OpenMPI (1.4.5) and MVAPICH2 (1.8) and one of the cluster sysadmins has run ROMIO tests, we seem to have no problem with the drivers and so on. strace reveals the hang consists of repeated POLL events but that's as far as we can go ourselves as I'm not that experienced with valgrind. <br /><br />We use gfortran 4.6, fftw3 and openblas.<br /><br />A case that hangs:<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code># porphin molecule<br /><br /># Setting this to 1 will cause the job to hang, 0 to not hang!<br />prtwf&nbsp; &nbsp; &nbsp; &nbsp;1<br /><br /># Parallelization - set for 16 processors. Use over at least two nodes to see the hang.<br />paral_kgb&nbsp; &nbsp; &nbsp; &nbsp;1<br />npkpt&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1<br />npband&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 8<br />npfft&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2&nbsp; &nbsp; &nbsp; &nbsp;<br />bandpp&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2<br /><br /># SCF parameters<br /><br />ecut&nbsp; &nbsp; &nbsp; &nbsp; 4.0<br />pawecutdg&nbsp; &nbsp;12.0<br />tolvrs&nbsp; &nbsp; &nbsp; 1.0d-1 # deliberately bad to quickly get to the output stage outwf.F90<br />nstep&nbsp; &nbsp; &nbsp; &nbsp;200<br />istwfk&nbsp; &nbsp; &nbsp; 2<br />occopt&nbsp; &nbsp; &nbsp; 7<br />tsmear&nbsp; &nbsp; &nbsp; 0.02<br />diemix&nbsp; &nbsp; &nbsp; 0.33<br />diemac&nbsp; &nbsp; &nbsp; 2.0&nbsp; &nbsp; &nbsp;<br /><br /># Kpoints<br />kptopt&nbsp; &nbsp; &nbsp; 1<br />ngkpt&nbsp; &nbsp; &nbsp; &nbsp;1&nbsp; &nbsp;1&nbsp; &nbsp;1<br />nshiftk&nbsp; &nbsp; &nbsp;1<br />shiftk<br />&nbsp; &nbsp; 0.0 0.0 0.0<br />nband 80<br /><br /># Geometry<br /><br />acell&nbsp; &nbsp; &nbsp; &nbsp;24.0&nbsp; &nbsp; 24.0&nbsp; &nbsp; 14.0&nbsp; &nbsp; &nbsp;angstrom<br />natom&nbsp; &nbsp; &nbsp; &nbsp;38<br />ntypat&nbsp; &nbsp; &nbsp; 3<br />znucl&nbsp; &nbsp; &nbsp; &nbsp;6 7 1<br />typat&nbsp; &nbsp; &nbsp; &nbsp;1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1 1 1 1 2 2 2 2 3 3 3 3 3 3 3 3 <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 3 3 3 3 3 3<br />xangst<br />14.43267826697125&nbsp; &nbsp; &nbsp;9.54719469654066&nbsp; &nbsp; &nbsp;6.98679555192892<br />9.56971890234498&nbsp; &nbsp; &nbsp;9.55740143113795&nbsp; &nbsp; &nbsp;6.98136687410452<br />9.57830669996704&nbsp; &nbsp; 14.45323690496433&nbsp; &nbsp; &nbsp;6.99729471155192<br />14.44063286032851&nbsp; &nbsp; 14.44280830865907&nbsp; &nbsp; &nbsp;7.00065218638275<br />13.09053535559251&nbsp; &nbsp; &nbsp;9.13328020797658&nbsp; &nbsp; &nbsp;6.98306316607677<br />12.67923156052460&nbsp; &nbsp; &nbsp;7.73168327773270&nbsp; &nbsp; &nbsp;6.97936199186946<br />11.31569250083367&nbsp; &nbsp; &nbsp;7.73433869282024&nbsp; &nbsp; &nbsp;6.97757649970769<br />10.90999275359248&nbsp; &nbsp; &nbsp;9.13761393307977&nbsp; &nbsp; &nbsp;6.98028668551213<br />9.09554011542721&nbsp; &nbsp; 10.87314035126708&nbsp; &nbsp; &nbsp;6.98561843864410<br />7.72903461616869&nbsp; &nbsp; 11.31936915287400&nbsp; &nbsp; &nbsp;6.98735375088374<br />7.73139760192924&nbsp; &nbsp; 12.69760130406586&nbsp; &nbsp; &nbsp;6.99113573510774<br />9.09938031597771&nbsp; &nbsp; 13.13925447483067&nbsp; &nbsp; &nbsp;6.99243851467787<br />10.92010300631924&nbsp; &nbsp; 14.86758534532777&nbsp; &nbsp; &nbsp;7.00085421660784<br />11.33151776548370&nbsp; &nbsp; 16.26917592327966&nbsp; &nbsp; &nbsp;7.00566526340061<br />12.69511949460426&nbsp; &nbsp; 16.26616429625911&nbsp; &nbsp; &nbsp;7.00672787336548<br />13.10041479027480&nbsp; &nbsp; 14.86264378806152&nbsp; &nbsp; &nbsp;7.00242954254950<br />14.91526145037882&nbsp; &nbsp; 13.12729369433697&nbsp; &nbsp; &nbsp;6.99679680639886<br />16.28188688560975&nbsp; &nbsp; 12.68157456405687&nbsp; &nbsp; &nbsp;6.99612434170756<br />16.28001488882063&nbsp; &nbsp; 11.30329858626045&nbsp; &nbsp; &nbsp;6.99265482691192<br />14.91210592507385&nbsp; &nbsp; 10.86110781146765&nbsp; &nbsp; &nbsp;6.99071674837176<br />14.13078870987637&nbsp; &nbsp; 11.99535250594183&nbsp; &nbsp; &nbsp;6.99326588288911<br />9.88047357875540&nbsp; &nbsp; 12.00482853795923&nbsp; &nbsp; &nbsp;6.98882891763749<br />12.00192233673013&nbsp; &nbsp; &nbsp;9.96929220396100&nbsp; &nbsp; &nbsp;6.98329443280378<br />12.00837527590531&nbsp; &nbsp; 14.03130874233860&nbsp; &nbsp; &nbsp;6.99948340730862<br />15.20432290532285&nbsp; &nbsp; 15.22540747831387&nbsp; &nbsp; &nbsp;7.00200372856651<br />15.19313884171311&nbsp; &nbsp; &nbsp;8.76129846997055&nbsp; &nbsp; &nbsp;6.98744336798576<br />8.80561700326767&nbsp; &nbsp; &nbsp;8.77507783974137&nbsp; &nbsp; &nbsp;6.97949471039301<br />8.81771718378007&nbsp; &nbsp; 15.23885330665432&nbsp; &nbsp; &nbsp;6.99845713352080<br />13.37257765050554&nbsp; &nbsp; 17.11992092452597&nbsp; &nbsp; &nbsp;7.01033475042726<br />10.65751847151932&nbsp; &nbsp; 17.12561065649051&nbsp; &nbsp; &nbsp;7.00718932911153<br />17.14387397433472&nbsp; &nbsp; 13.34609132569375&nbsp; &nbsp; &nbsp;6.99830189384125<br />17.14042276570114&nbsp; &nbsp; 10.63682513020204&nbsp; &nbsp; &nbsp;6.99118969243677<br />13.35278112781582&nbsp; &nbsp; &nbsp;6.87498761980712&nbsp; &nbsp; &nbsp;6.97878434452385<br />10.63876867003055&nbsp; &nbsp; &nbsp;6.88026233515408&nbsp; &nbsp; &nbsp;6.97553810680641<br />6.87131218204644&nbsp; &nbsp; 13.36438702790796&nbsp; &nbsp; &nbsp;6.99316119368211<br />6.86695286671293&nbsp; &nbsp; 10.65501172582219&nbsp; &nbsp; &nbsp;6.98633580459881<br />10.90483155436783&nbsp; &nbsp; 12.00301405431957&nbsp; &nbsp; &nbsp;6.99005188546697<br />13.10645914541739&nbsp; &nbsp; 11.99653337020754&nbsp; &nbsp; &nbsp;6.99332769226049</code></pre></div><br /><br />A case that doesn't hang:<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code># Simple diamond<br /><br /># Again, settings are low to skip to the important hang part.<br /><br /># SCF/Paral - set for 16 procs over 2 nodes here. Note that on my system<br /># if I set bandpp 2 or 4, I get some nasty MPI errors also (a problem to<br /># look forward to!).<br /><br />paral_kgb&nbsp; &nbsp;1<br />npkpt&nbsp; &nbsp; &nbsp; &nbsp;2<br />npband&nbsp; &nbsp; &nbsp; 8<br />npfft&nbsp; &nbsp; &nbsp; &nbsp;2<br />bandpp&nbsp; &nbsp; &nbsp; 1<br /><br />nband&nbsp; &nbsp; &nbsp; &nbsp;32<br /><br />ecut&nbsp; &nbsp; 6.0<br />pawecutdg 15.0<br />toldfe&nbsp; 1.0d-2<br /><br /># Cell geometry<br />acell&nbsp; &nbsp; &nbsp; &nbsp;3.57 3.57 3.57 angstrom<br />natom&nbsp; &nbsp; &nbsp; &nbsp;2<br />ntypat&nbsp; &nbsp; &nbsp; 1<br />typat&nbsp; &nbsp; &nbsp; &nbsp;1 1<br />znucl&nbsp; &nbsp; &nbsp; &nbsp;6<br />rprim<br />&nbsp; &nbsp; 0.0 0.5 0.5<br />&nbsp; &nbsp; 0.5 0.0 0.5<br />&nbsp; &nbsp; 0.5 0.5 0.0<br />xred<br />&nbsp; &nbsp; 0.0 0.0 0.0<br />&nbsp; &nbsp; 0.25 0.25 0.25<br /><br /># MP sampling<br />kptopt&nbsp; &nbsp; &nbsp; 1<br />ngkpt&nbsp; &nbsp; &nbsp; &nbsp;2 2 2<br />nshiftk&nbsp; &nbsp; &nbsp;4<br />shiftk<br />&nbsp; &nbsp; 0.5 0.5 0.5<br />&nbsp; &nbsp; 0.5 0.0 0.0<br />&nbsp; &nbsp; 0.0 0.5 0.0<br />&nbsp; &nbsp; 0.0 0.0 0.5<br /></code></pre></div><br /><br />I believe this hang might be at least one of the reasons people have reported MPI-IO problems. We're continuing analysis here and will post stuff as we can come up with it.</div>
			
			
			
									
									<div id="sig5189" class="signature">Dr Kane O'Donnell<br />Postdoctoral Research Fellow<br />Australian Synchrotron</div>
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p5263" class="post has-profile bg1 offline">
		<div class="inner">

		<dl class="postprofile" id="profile5263">
			<dt class="no-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlist32d1.html?mode=viewprofile&amp;u=72" class="username">mverstra</a>							</dt>

									
		<dd class="profile-posts"><strong>Posts:</strong> <a href="search1bef.html?author_id=72&amp;sr=posts">655</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> Wed Aug 19, 2009 12:01 pm</dd>		
		
						
						
		</dl>

		<div class="postbody">
						<div id="post_content5263">

						<h3 ><a href="#p5263">Re: Bug: MPI-IO hang in WffReadWrite_mpio</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="postingaee7.html?mode=quote&amp;f=19&amp;p=5263" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author">
									<a class="unread" href="viewtopic92a5.html?p=5263#p5263" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlist32d1.html?mode=viewprofile&amp;u=72" class="username">mverstra</a></strong> &raquo; </span>Sun Jun 10, 2012 6:08 pm
			</p>
			
			
			
			<div class="content">Hi Kane,<br /><br />thanks for the very detailed debugging. This is indeed delicate, and despite your checks might be due to the specific mpi-io implementation and not abinit (stress _might_). I have had lots of problems running across nodes with certain versions of openmpi - usually older versions like 1.2.6 were better. Could also be due to the io... The fact that mvapich also crashes is suspicious, however. Does anyone know if recent versions implement stricter versions of mpi-io?<br /><br />cheers<br /><br />Matthieu</div>
			
			
			
									
									<div id="sig5263" class="signature">Matthieu Verstraete<br />University of Liege, Belgium</div>
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p5274" class="post has-profile bg2 offline">
		<div class="inner">

		<dl class="postprofile" id="profile5274">
			<dt class="no-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlistaf78.html?mode=viewprofile&amp;u=209" class="username">kaneod</a>							</dt>

									
		<dd class="profile-posts"><strong>Posts:</strong> <a href="search66ac.html?author_id=209&amp;sr=posts">42</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> Wed Mar 10, 2010 11:47 am</dd>		
		
						
						
		</dl>

		<div class="postbody">
						<div id="post_content5274">

						<h3 ><a href="#p5274">Re: Bug: MPI-IO hang in WffReadWrite_mpio</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting8f5d.html?mode=quote&amp;f=19&amp;p=5274" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author">
									<a class="unread" href="viewtopic045a.html?p=5274#p5274" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlistaf78.html?mode=viewprofile&amp;u=209" class="username">kaneod</a></strong> &raquo; </span>Tue Jun 12, 2012 7:53 am
			</p>
			
			
			
			<div class="content">Hi Matthieu,<br /><br />We've made some progress in this recently but we have not yet isolated the problematic sequence of events. It appears the problem is that different MPI threads are blocking each others attempts at writing during the MPI_FILE_WRITE_ALL call. We don't know exactly how yet. It only happens across infiniband and not on a single node, but the ROMIO implementation passes all conventional tests across nodes.<br /><br />All we can say for sure at the moment is that this is a thread safety/file locking problem. The WFK write is not a speed-critical element compared to the other sections of the code so one long-term strategy might be to have a safe gather policy and only write from the master process. My problem is that I need KGB parallelization and mpi-io is a prerequisite - otherwise I'd not compile it in.<br /><br />Since file locking is the problem, our guy working on this has come up with a partial workaround that prevents the MPI-IO hang. Once he's happy that he understands the problem and how his solution fixes it, we'll patch my private dev branch and test. Might be a while!<br /><br />Kane</div>
			
			
			
									
									<div id="sig5274" class="signature">Dr Kane O'Donnell<br />Postdoctoral Research Fellow<br />Australian Synchrotron</div>
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p7100" class="post has-profile bg1 offline">
		<div class="inner">

		<dl class="postprofile" id="profile7100">
			<dt class="no-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlist32d1.html?mode=viewprofile&amp;u=72" class="username">mverstra</a>							</dt>

									
		<dd class="profile-posts"><strong>Posts:</strong> <a href="search1bef.html?author_id=72&amp;sr=posts">655</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> Wed Aug 19, 2009 12:01 pm</dd>		
		
						
						
		</dl>

		<div class="postbody">
						<div id="post_content7100">

						<h3 ><a href="#p7100">Re: Bug: MPI-IO hang in WffReadWrite_mpio</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting777d.html?mode=quote&amp;f=19&amp;p=7100" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author">
									<a class="unread" href="viewtopic89b5.html?p=7100#p7100" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlist32d1.html?mode=viewprofile&amp;u=72" class="username">mverstra</a></strong> &raquo; </span>Fri Aug 09, 2013 11:25 pm
			</p>
			
			
			
			<div class="content">Hi Kane,<br /><br />any news on this (and perhaps fixes which appeared in 7.2)?</div>
			
			
			
									
									<div id="sig7100" class="signature">Matthieu Verstraete<br />University of Liege, Belgium</div>
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
	

	<div class="action-bar bar-bottom">
	
			<a href="postingf258.html?mode=reply&amp;f=19&amp;t=1667" class="button" title="This topic is locked, you cannot edit posts or make further replies.">
							<span>Locked</span> <i class="icon fa-lock fa-fw" aria-hidden="true"></i>
					</a>
		
		<div class="dropdown-container dropdown-button-control topic-tools">
		<span title="Topic tools" class="button button-secondary dropdown-trigger dropdown-select">
			<i class="icon fa-wrench fa-fw" aria-hidden="true"></i>
			<span class="caret"><i class="icon fa-sort-down fa-fw" aria-hidden="true"></i></span>
		</span>
		<div class="dropdown">
			<div class="pointer"><div class="pointer-inner"></div></div>
			<ul class="dropdown-contents">
																												<li>
					<a href="viewtopic3a1c.html?f=19&amp;t=1667&amp;view=print" title="Print view" accesskey="p">
						<i class="icon fa-print fa-fw" aria-hidden="true"></i><span>Print view</span>
					</a>
				</li>
											</ul>
		</div>
	</div>

			<form method="post" action="https://forum.abinit.org/viewtopic.php?f=19&amp;t=1667">
		<div class="dropdown-container dropdown-container-left dropdown-button-control sort-tools">
	<span title="Display and sorting options" class="button button-secondary dropdown-trigger dropdown-select">
		<i class="icon fa-sort-amount-asc fa-fw" aria-hidden="true"></i>
		<span class="caret"><i class="icon fa-sort-down fa-fw" aria-hidden="true"></i></span>
	</span>
	<div class="dropdown hidden">
		<div class="pointer"><div class="pointer-inner"></div></div>
		<div class="dropdown-contents">
			<fieldset class="display-options">
							<label>Display: <select name="st" id="st"><option value="0" selected="selected">All posts</option><option value="1">1 day</option><option value="7">7 days</option><option value="14">2 weeks</option><option value="30">1 month</option><option value="90">3 months</option><option value="180">6 months</option><option value="365">1 year</option></select></label>
								<label>Sort by: <select name="sk" id="sk"><option value="a">Author</option><option value="t" selected="selected">Post time</option><option value="s">Subject</option></select></label>
				<label>Direction: <select name="sd" id="sd"><option value="a" selected="selected">Ascending</option><option value="d">Descending</option></select></label>
								<hr class="dashed" />
				<input type="submit" class="button2" name="sort" value="Go" />
						</fieldset>
		</div>
	</div>
</div>
		</form>
	
	
	
			<div class="pagination">
			4 posts
							&bull; Page <strong>1</strong> of <strong>1</strong>
					</div>
	</div>


<div class="action-bar actions-jump">
		<p class="jumpbox-return">
		<a href="viewforum218b.html?f=19" class="left-box arrow-left" accesskey="r">
			<i class="icon fa-angle-left fa-fw icon-black" aria-hidden="true"></i><span>Return to “Improving ABINIT”</span>
		</a>
	</p>
	
		<div class="jumpbox dropdown-container dropdown-container-right dropdown-up dropdown-left dropdown-button-control" id="jumpbox">
			<span title="Jump to" class="button button-secondary dropdown-trigger dropdown-select">
				<span>Jump to</span>
				<span class="caret"><i class="icon fa-sort-down fa-fw" aria-hidden="true"></i></span>
			</span>
		<div class="dropdown">
			<div class="pointer"><div class="pointer-inner"></div></div>
			<ul class="dropdown-contents">
																				<li><a href="viewforumffeb.html?f=20" class="jumpbox-forum-link"> <span> News &amp; Announcements</span></a></li>
																<li><a href="viewforum8011.html?f=23" class="jumpbox-forum-link"> <span> Jobs and Other Announcements</span></a></li>
																<li><a href="viewforum58da.html?f=1" class="jumpbox-cat-link"> <span> Building ABINIT</span></a></li>
																<li><a href="viewforum4d6b.html?f=3" class="jumpbox-sub-link"><span class="spacer"></span> <span>&#8627; &nbsp; Configuring and compiling ABINIT</span></a></li>
																<li><a href="viewforum31e6.html?f=4" class="jumpbox-cat-link"> <span> Running Abinit</span></a></li>
																<li><a href="viewforumfdc5.html?f=9" class="jumpbox-sub-link"><span class="spacer"></span> <span>&#8627; &nbsp; Ground state</span></a></li>
																<li><a href="viewforum15ca.html?f=10" class="jumpbox-sub-link"><span class="spacer"></span> <span>&#8627; &nbsp; Response calculations</span></a></li>
																<li><a href="viewforum8a83.html?f=11" class="jumpbox-sub-link"><span class="spacer"></span> <span>&#8627; &nbsp; Many-body perturbation theory</span></a></li>
																<li><a href="viewforum01c9.html?f=12" class="jumpbox-sub-link"><span class="spacer"></span> <span>&#8627; &nbsp; Other tools and postprocessing in ABINIT</span></a></li>
																<li><a href="viewforum345c.html?f=24" class="jumpbox-sub-link"><span class="spacer"></span> <span>&#8627; &nbsp; Python interfacing : Abipy ecosystem</span></a></li>
																<li><a href="viewforum9780.html?f=14" class="jumpbox-sub-link"><span class="spacer"></span> <span>&#8627; &nbsp; Link to other codes</span></a></li>
																<li><a href="viewforume774.html?f=5" class="jumpbox-cat-link"> <span> Developing Abinit</span></a></li>
																<li><a href="viewforum218b.html?f=19" class="jumpbox-sub-link"><span class="spacer"></span> <span>&#8627; &nbsp; Improving ABINIT</span></a></li>
											</ul>
		</div>
	</div>

	</div>


			</div>


<div id="page-footer" class="page-footer" role="contentinfo">
	<div class="navbar navbar-bottom" role="navigation">
	<div class="inner">

	<ul id="nav-footer" class="nav-footer linklist" role="menubar">
		<li class="breadcrumbs">
									<span class="crumb"><a href="index-2.html" data-navbar-reference="index"><i class="icon fa-home fa-fw" aria-hidden="true"></i><span>Board index</span></a></span>					</li>
		
				
							<li class="rightside">
				<a href="ucp033a.html?mode=delete_cookies" data-ajax="true" data-refresh="true" role="menuitem">
					<i class="icon fa-trash fa-fw" aria-hidden="true"></i><span>Delete cookies</span>
				</a>
			</li>
				
		<li class="rightside" data-last-responsive="true"><a href="app.php/aboutus.html" role="menuitem"><i class="icon fa-info-circle fa-fw" aria-hidden="true"></i><span>About us</span></a></li>			</ul>

	</div>
</div>

	<div class="copyright">
		<script type="text/javascript">
copyright=new Date();

update=copyright.getFullYear();

document.write("Copyright\u0020\u0026copy\u003B 2009 - "+ update +	" ABINIT Discussion Forums All\u0020rights\u0020reserved.");

</script>
<br /><br />		<p class="footer-row">
			<span class="footer-copyright">Flat Style by <a href="http://phpbbstyles.oo.gd/">Ian Bradley</a></span>
		</p>
        <p class="footer-row">
			<span class="footer-copyright">Powered by <a href="https://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Limited</span>
		</p>
						<p class="footer-row">
			<a class="footer-link" href="ucp4d86.html?mode=privacy" title="Privacy" role="menuitem">
				<span class="footer-link-text">Privacy</span>
			</a>
			|
			<a class="footer-link" href="ucp226b.html?mode=terms" title="Terms" role="menuitem">
				<span class="footer-link-text">Terms</span>
			</a>
		</p>
					</div>

	<div id="darkenwrapper" class="darkenwrapper" data-ajax-error-title="AJAX error" data-ajax-error-text="Something went wrong when processing your request." data-ajax-error-text-abort="User aborted request." data-ajax-error-text-timeout="Your request timed out; please try again." data-ajax-error-text-parsererror="Something went wrong with the request and the server returned an invalid reply.">
		<div id="darken" class="darken">&nbsp;</div>
	</div>

	<div id="phpbb_alert" class="phpbb_alert" data-l-err="Error" data-l-timeout-processing-req="Request timed out.">
		<a href="#" class="alert_close">
			<i class="icon fa-times-circle fa-fw" aria-hidden="true"></i>
		</a>
		<h3 class="alert_title">&nbsp;</h3><p class="alert_text"></p>
	</div>
	<div id="phpbb_confirm" class="phpbb_alert">
		<a href="#" class="alert_close">
			<i class="icon fa-times-circle fa-fw" aria-hidden="true"></i>
		</a>
		<div class="alert_text"></div>
	</div>
</div>

</div>

<div>
	<a id="bottom" class="anchor" accesskey="z"></a>
	</div>

<script src="assets/javascript/jquery.minaea1.js?assets_version=57"></script>
<script src="assets/javascript/coreaea1.js?assets_version=57"></script>



<script>
	(function() {
		var cx = '017804512478788106347\u003Atlftx8kncg4';
		var gcse = document.createElement('script');
		gcse.type = 'text/javascript';
		gcse.async = true;
		gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
			'//cse.google.com/cse.js?cx=' + cx;
		var s = document.getElementsByTagName('script')[0];
		s.parentNode.insertBefore(gcse, s);
	})();
</script>
<script type="text/javascript">
(function($) {  // Avoid conflicts with other libraries

'use strict';
	
	phpbb.addAjaxCallback('reporttosfs', function(data) {
		if (data.postid !== "undefined") {
			$('#sfs' + data.postid).hide();
			phpbb.closeDarkenWrapper(5000);
		}
	});

})(jQuery);
</script>
<script src="ext/hifikabin/clock/styles/all/template/js/js_clockaea1.js?assets_version=57"></script>
<script src="ext/phpbb/collapsiblecategories/styles/all/template/js/collapsiblecategoriesaea1.js?assets_version=57"></script>
<script src="styles/prosilver/template/forum_fnaea1.js?assets_version=57"></script>
<script src="styles/prosilver/template/ajaxaea1.js?assets_version=57"></script>



</body>

<!-- Mirrored from forum.abinit.org/viewtopic.php?p=5263 by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 20 Sep 2024 22:02:15 GMT -->
</html>
