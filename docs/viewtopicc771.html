<!DOCTYPE html>
<html dir="ltr" lang="en-gb">

<!-- Mirrored from forum.abinit.org/viewtopic.php?f=3&t=5268&view=print by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 20 Sep 2024 15:04:46 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="robots" content="noindex" />

<title>ABINIT Discussion Forums &bull; Running Abinit in virtual box Ubuntu</title>

<link href="styles/flat-style/theme/print.css" rel="stylesheet">
<link href="styles/flat-style/theme/bidi.css" rel="stylesheet">
</head>
<body id="phpbb" class="ltr">
<div id="wrap" class="wrap">
	<a id="top" class="top-anchor" accesskey="t"></a>

	<div id="page-header">
		<h1>ABINIT Discussion Forums</h1>
		<p>The meeting place for ABINIT users and developers<br /><a href="index.html">https://forum.abinit.org/</a></p>

		<h2>Running Abinit in virtual box Ubuntu</h2>
		<p><a href="viewtopic9427.html?f=3&amp;t=5268">https://forum.abinit.org/viewtopic.php?f=3&amp;t=5268</a></p>
	</div>

	<div id="page-body" class="page-body">
		<div class="page-number">Page <strong>1</strong> of <strong>1</strong></div>
					<div class="post">
				<h3>Running Abinit in virtual box Ubuntu&nbsp;&nbsp;<span style="color: #006600">[SOLVED]</span></h3>
				<div class="date">Posted: <strong>Tue Jan 19, 2021 11:39 pm</strong></div>
				<div class="author">by <strong>xbai33</strong></div>
				<div class="content">Dear All,<br>
<br>
By following the tutorial, I was able to compile all the dependence and Abinit from scratch in a virtual box Ubuntu on my Windows workstation. I can run Abinit to check version information. However, when performing "make test_fast", I receive a "SIGILL" error. The error message, my cpu info and build info at presented below. Could you help me to resolve this issue? Thank you!<br>
<br>
Best,<br>
Xiaojian Bai<br>

<blockquote class="uncited"><div>
================================================================================<br>
<br>
=== [ionmov= 2] Broyden-Fletcher-Goldfard-Shanno method (forces)            <br>
================================================================================<br>
<br>
--- Iteration: (1/5) Internal Cycle: (1/1)<br>
--------------------------------------------------------------------------------<br>
<br>
 Cartesian coordinates (xcart) [bohr]<br>
 -7.27544561160973E-01  0.00000000000000E+00  0.00000000000000E+00<br>
  7.27544561160973E-01  0.00000000000000E+00  0.00000000000000E+00<br>
 Reduced coordinates (xred)<br>
 -6.06287134300811E-02  0.00000000000000E+00  0.00000000000000E+00<br>
  6.06287134300811E-02  0.00000000000000E+00  0.00000000000000E+00<br>
<br>
---SELF-CONSISTENT-FIELD CONVERGENCE--------------------------------------------<br>
<br>
 getcut: wavevector=  0.0000  0.0000  0.0000  ngfft=  24  20  20<br>
         ecut(hartree)=      4.500   =&gt; boxcut(ratio)=   2.09440<br>
<br>
 1/G**2 cut-off applied in the following step : cutoff-mode = CRYSTAL<br>
<br>
 1/G**2 cut-off applied in the following step : cutoff-mode = CRYSTAL<br>
<br>
 1/G**2 cut-off applied in the following step : cutoff-mode = CRYSTAL<br>
<br>
--- !WARNING<br>
src_file: m_drivexc.F90<br>
src_line: 707<br>
message: |<br>
    Density went too small (lower than xc_denpos) at 2454 points<br>
    and was set to xc_denpos =   1.00E-14. Lowest was  -0.14E-06.<br>
    Likely due to too low boxcut or too low ecut for pseudopotential core charge.<br>
<br>
Program received signal SIGILL: Illegal instruction.<br>
<br>
Backtrace for this error:<br>
#0  0x7fdce950ed01 in ???<br>
#1  0x7fdce950ded5 in ???<br>
#2  0x7fdce915b20f in ???<br>
#3  0x7fdce9ae9212 in ???<br>
#4  0x7fdce998e5d9 in ???<br>
#5  0x7fdce98e909a in ???<br>
#6  0x55f5910f5d03 in __m_cgtools_MOD_cg_zgemv<br>
at ../../../src/44_abitools/m_cgtools.F90:898<br>
#7  0x55f5910f61f3 in __m_cgtools_MOD_projbd<br>
at ../../../src/44_abitools/m_cgtools.F90:3274<br>
#8  0x55f5909d68c7 in __m_cgwf_MOD_cgwf<br>
at ../../../src/67_common/m_cgwf.F90:690<br>
#9  0x55f5903d0764 in __m_vtowfk_MOD_vtowfk<br>
at ../../../src/79_seqpar_mpi/m_vtowfk.F90:411<br>
#10  0x55f5903b9874 in __m_vtorho_MOD_vtorho<br>
at ../../../src/79_seqpar_mpi/m_vtorho.F90:961<br>
#11  0x55f590348a89 in __m_scfcv_core_MOD_scfcv_core<br>
at ../../../src/94_scfcv/m_scfcv_core.F90:1572<br>
#12  0x55f59033d29e in scfcv_scfcv<br>
at ../../../src/94_scfcv/m_scfcv.F90:712<br>
#13  0x55f5903353b5 in __m_mover_MOD_mover<br>
at ../../../src/95_drive/m_mover.F90:604<br>
#14  0x55f590326e73 in __m_gstate_MOD_gstate<br>
at ../../../src/95_drive/m_gstate.F90:1297<br>
#15  0x55f59023079e in __m_gstateimg_MOD_gstateimg<br>
at ../../../src/95_drive/m_gstateimg.F90:562<br>
#16  0x55f59021cf00 in __m_driver_MOD_driver<br>
at ../../../src/95_drive/m_driver.F90:783<br>
#17  0x55f59020a425 in abinit<br>
at ../../../src/98_main/abinit.F90:391<br>
#18  0x55f59020ff3c in main<br>
at ../../../src/98_main/abinit.F90:88
</div></blockquote>

Here is what I get when running "lscpu"
<blockquote class="uncited"><div>Architecture:                    x86_64 <br>
CPU op-mode(s):                  32-bit, 64-bit<br>
Byte Order:                      Little Endian<br>
Address sizes:                   46 bits physical, 48 bits virtual<br>
CPU(s):                          20<br>
On-line CPU(s) list:             0-19<br>
Thread(s) per core:              1<br>
Core(s) per socket:              20<br>
Socket(s):                       1<br>
NUMA node(s):                    1<br>
Vendor ID:                       GenuineIntel<br>
CPU family:                      6<br>
Model:                           85<br>
Model name:                      Intel(R) Xeon(R) Silver 4214 CPU @ 2.20GHz<br>
Stepping:                        7<br>
CPU MHz:                         2194.500<br>
BogoMIPS:                        4389.00<br>
Hypervisor vendor:               KVM<br>
Virtualization type:             full<br>
L1d cache:                       640 KiB<br>
L1i cache:                       640 KiB<br>
L2 cache:                        20 MiB<br>
L3 cache:                        330 MiB<br>
NUMA node0 CPU(s):               0-19<br>
Vulnerability Itlb multihit:     KVM: Mitigation: VMX unsupported<br>
Vulnerability L1tf:              Not affected<br>
Vulnerability Mds:               Not affected<br>
Vulnerability Meltdown:          Not affected<br>
Vulnerability Spec store bypass: Vulnerable<br>
Vulnerability Spectre v1:        Mitigation; usercopy/swapgs barriers and __use<br>
                                 r pointer sanitization<br>
Vulnerability Spectre v2:        Mitigation; Full generic retpoline, STIBP disa<br>
                                 bled, RSB filling<br>
Vulnerability Srbds:             Not affected<br>
Vulnerability Tsx async abort:   Mitigation; TSX disabled<br>
Flags:                           fpu vme de pse tsc msr pae mce cx8 apic sep mt<br>
                                 rr pge mca cmov pat pse36 clflush mmx fxsr sse<br>
                                  sse2 ht syscall nx rdtscp lm constant_tsc rep<br>
                                 _good nopl xtopology nonstop_tsc cpuid tsc_kno<br>
                                 wn_freq pni pclmulqdq ssse3 cx16 pcid sse4_1 s<br>
                                 se4_2 x2apic movbe popcnt aes xsave avx rdrand<br>
                                  hypervisor lahf_lm abm 3dnowprefetch invpcid_<br>
                                 single fsgsbase avx2 invpcid rdseed clflushopt<br>
                                  md_clear flush_l1d arch_capabilities
</div></blockquote>

Here is what I get when running "abinit -b"
<blockquote class="uncited"><div>=== Build Information === <br>
  Version       : 9.2.2<br>
  Build target  : x86_64_linux_gnu9.3<br>
  Build date    : 20210119<br>
<br>
 === Compiler Suite === <br>
  C compiler       : gnu9.3<br>
  C++ compiler     : gnu9.3<br>
  Fortran compiler : gnu9.3<br>
  CFLAGS           : -g -O2 -mtune=native -march=native<br>
  CXXFLAGS         : -g -O2 -mtune=native -march=native<br>
  FCFLAGS          : -g -ffree-line-length-none     -I/home/xbq/local/include  -I/home/xbq/local/include<br>
  FC_LDFLAGS       : <br>
<br>
 === Optimizations === <br>
  Debug level        : basic<br>
  Optimization level : standard<br>
  Architecture       : intel_xeon<br>
<br>
 === Multicore === <br>
  Parallel build : /home/xbq/local/<br>
  Parallel I/O   : <br>
  openMP support : no<br>
  GPU support    : <br>
<br>
 === Connectors / Fallbacks === <br>
  LINALG flavor  : openblas<br>
  FFT flavor     : fftw3<br>
  HDF5           : yes<br>
  NetCDF         : yes<br>
  NetCDF Fortran : yes<br>
  LibXC          : yes<br>
  Wannier90      : no<br>
<br>
 === Experimental features === <br>
  Exports             : <br>
  GW double-precision : <br>
<br>
 ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++<br>
<br>
<br>
 ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++<br>
 Default optimizations:<br>
   -O2 -mtune=native -march=native<br>
<br>
<br>
 Optimizations for 43_ptgroups:<br>
   -O0<br>
<br>
<br>
 ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
</div></blockquote></div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Running Abinit in virtual box Ubuntu</h3>
				<div class="date">Posted: <strong>Wed Jan 20, 2021 12:35 am</strong></div>
				<div class="author">by <strong>gmatteo</strong></div>
				<div class="content"><blockquote class="uncited"><div>
#5 0x7fdce98e909a in ???<br>
#6 0x55f5910f5d03 in __m_cgtools_MOD_cg_zgemv<br>
at ../../../src/44_abitools/m_cgtools.F90:898
</div></blockquote>

This part of the backtrace indicates that SIGILL is raised by ZGEMV (matrix-vector multiplication provided by openblas).<br>
I would suggest to recheck the compilation of openblas and the flags passed to the compiler. You may want to disable architecture-dependent optimization flags. <br>
<br>
From <a href="https://docs.abinit.org/tutorial/compilation/#troubleshooting" class="postlink">https://docs.abinit.org/tutorial/compil ... leshooting</a><br>

<blockquote class="uncited"><div>
If the code raises the SIGILL signal, it means that the CPU attempted to execute an instruction it didn’t understand. Very likely, your executables/libraries have been compiled for the wrong architecture. This may happen on clusters when the CPU family available on the frontend differs from the one available on the compute node and aggressive optimization options (-O3, -march, -xHost, etc) are used. Removing the optimization options and using the much safer -O2 level may help. Alternatively, one can configure and compile the source directly on the compute node or use compilation options compatible both with the frontend and the compute node (ask your sysadmin for details).
</div></blockquote></div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Running Abinit in virtual box Ubuntu</h3>
				<div class="date">Posted: <strong>Wed Jan 20, 2021 2:49 pm</strong></div>
				<div class="author">by <strong>xbai33</strong></div>
				<div class="content">Thank you very much for your reply. It is indeed a problem with running Openblas in virtualbox. I recompiled it with "make -j2 TARGET=SANDYBRIDGE". The program can now finish the calculation, but a different error occurs with IO. Please see the error information below. I can't find anything about this error about "H5ACmpio.c" on the internet. Do you have some idea what might cause this?<br>

<blockquote class="uncited"><div>                                                                                                                          <br>
   fftdatar_write: About to write data to: testin_fasto_TIM1_DEN with iomode: IO_MODE_FORTRAN<br>
 IO operation completed. cpu:  0.00 [s] , wall:  0.00 [s] &lt;&lt;&lt; TIME<br>
abinit: H5ACmpio.c<img alt=":1100:" class="emoji smilies" draggable="false" src="http://twemoji.maxcdn.com/2/svg/1100.svg"> H5AC__log_moved_entry: Assertion `!entry_dirty' failed.<br>
<br>
Program received signal SIGABRT: Process abort signal.<br>
<br>
Backtrace for this error:<br>
#0  0x7f94d04b0d01 in ???<br>
#1  0x7f94d04afed5 in ???<br>
#2  0x7f94d00e620f in ???<br>
#3  0x7f94d00e618b in ???<br>
#4  0x7f94d00c5858 in ???<br>
#5  0x7f94d00c5728 in ???<br>
#6  0x7f94d00d6f35 in ???<br>
#7  0x7f94cfa1739e in H5AC__log_moved_entry<br>
        at /home/xbai33/local/src/hdf5-1.12.0/src/H5ACmpio.c:1100<br>
#8  0x7f94cf5d0c22 in H5AC_move_entry<br>
        at /home/xbai33/local/src/hdf5-1.12.0/src/H5AC.c:1100<br>
#9  0x7f94cf77f61f in H5HF__man_iblock_root_double<br>
        at /home/xbai33/local/src/hdf5-1.12.0/src/H5HFiblock.c:580<br>
#10  0x7f94cf778b37 in H5HF__hdr_update_iter<br>
        at /home/xbai33/local/src/hdf5-1.12.0/src/H5HFhdr.c:1055<br>
#11  0x7f94cf775ec4 in H5HF__man_dblock_new<br>
        at /home/xbai33/local/src/hdf5-1.12.0/src/H5HFdblock.c:397<br>
#12  0x7f94cf785bde in H5HF__man_insert<br>
        at /home/xbai33/local/src/hdf5-1.12.0/src/H5HFman.c:137<br>
#13  0x7f94cf7623a9 in H5HF_insert<br>
        at /home/xbai33/local/src/hdf5-1.12.0/src/H5HF.c:394<br>
#14  0x7f94cf73bee0 in H5G__dense_insert<br>
        at /home/xbai33/local/src/hdf5-1.12.0/src/H5Gdense.c:426<br>
#15  0x7f94cf7556fd in H5G_obj_insert<br>
        at /home/xbai33/local/src/hdf5-1.12.0/src/H5Gobj.c:594<br>
#16  0x7f94cf7b0773 in H5L__link_cb<br>
        at /home/xbai33/local/src/hdf5-1.12.0/src/H5L.c:1887<br>
#17  0x7f94cf760f39 in H5G__traverse_real<br>
        at /home/xbai33/local/src/hdf5-1.12.0/src/H5Gtraverse.c:629<br>
#18  0x7f94cf761d21 in H5G_traverse<br>
        at /home/xbai33/local/src/hdf5-1.12.0/src/H5Gtraverse.c:854<br>
#19  0x7f94cf7a8118 in H5L__create_real<br>
        at /home/xbai33/local/src/hdf5-1.12.0/src/H5L.c:2044<br>
#20  0x7f94cf7b27ce in H5L_link_object<br>
        at /home/xbai33/local/src/hdf5-1.12.0/src/H5L.c:1803<br>
#21  0x7f94cf67ef6c in H5D__create_named<br>
        at /home/xbai33/local/src/hdf5-1.12.0/src/H5Dint.c:410<br>
#22  0x7f94cf9e8816 in H5VL__native_dataset_create<br>
        at /home/xbai33/local/src/hdf5-1.12.0/src/H5VLnative_dataset.c:74<br>
#23  0x7f94cf9c1d73 in H5VL__dataset_create<br>
        at /home/xbai33/local/src/hdf5-1.12.0/src/H5VLcallback.c:1834<br>
#24  0x7f94cf9cc41d in H5VL_dataset_create<br>
        at /home/xbai33/local/src/hdf5-1.12.0/src/H5VLcallback.c:1868<br>
#25  0x7f94cf642aa6 in H5Dcreate2<br>
        at /home/xbai33/local/src/hdf5-1.12.0/src/H5D.c:150<br>
#26  0x7f94cff938b8 in ???<br>
#27  0x7f94cff94f5d in ???<br>
#28  0x7f94cff957d9 in ???<br>
#29  0x7f94cff97f76 in ???<br>
#30  0x7f94cff98c3f in ???<br>
#31  0x7f94cff986c4 in ???<br>
#32  0x7f94cff985ce in ???<br>
#33  0x7f94cff39a26 in ???<br>
#34  0x7f94d07d0424 in __netcdf_MOD_nf90_enddef<br>
        at /home/xbai33/local/src/netcdf-fortran-4.5.3/fortran/netcdf_file.f90:82<br>
#35  0x7f94d28273e1 in __m_nctk_MOD_nctk_set_datamode<br>
        at ../../../../../shared/common/src/27_toolbox_oop/m_nctk.F90:1020<br>
#36  0x7f94d2830845 in __m_nctk_MOD_nctk_defnwrite_dpvars<br>
        at ../../../../../shared/common/src/27_toolbox_oop/m_nctk.F90:1898<br>
#37  0x7f94d22eb6b8 in __m_energies_MOD_energies_ncwrite<br>
        at ../../../src/44_abitypes_defs/m_energies.F90:619<br>
#38  0x7f94d22eeb74 in __m_results_gs_MOD_results_gs_ncwrite<br>
        at ../../../src/44_abitypes_defs/m_results_gs.F90:780<br>
#39  0x7f94d1578cc3 in __m_outscfcv_MOD_outscfcv<br>
        at ../../../src/94_scfcv/m_outscfcv.F90:619<br>
#40  0x7f94d15631df in __m_scfcv_core_MOD_scfcv_core<br>
        at ../../../src/94_scfcv/m_scfcv_core.F90:2165<br>
#41  0x7f94d1559f7e in scfcv_scfcv<br>
        at ../../../src/94_scfcv/m_scfcv.F90:712<br>
#42  0x7f94d1552085 in __m_mover_MOD_mover<br>
        at ../../../src/95_drive/m_mover.F90:604<br>
#43  0x7f94d1543b6b in __m_gstate_MOD_gstate<br>
        at ../../../src/95_drive/m_gstate.F90:1297<br>
#44  0x7f94d144d7de in __m_gstateimg_MOD_gstateimg<br>
        at ../../../src/95_drive/m_gstateimg.F90:562<br>
#45  0x7f94d1439f40 in __m_driver_MOD_driver<br>
        at ../../../src/95_drive/m_driver.F90:783<br>
#46  0x7f94d1427425 in abinit<br>
        at ../../../src/98_main/abinit.F90:391<br>
#47  0x7f94d142cf3c in main<br>
        at ../../../src/98_main/abinit.F90:88
               </div></blockquote></div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Running Abinit in virtual box Ubuntu</h3>
				<div class="date">Posted: <strong>Wed Jan 20, 2021 11:32 pm</strong></div>
				<div class="author">by <strong>xbai33</strong></div>
				<div class="content">Dear Gmatteo,<br>
<br>
Thank you very much for you input. It is a problem with Openblas on virtualbox. After some search, I found that in order for Openblas to function properly, the "TARGET" option needs to be specified. Following command works for me
<blockquote class="uncited"><div>make -j2 TARGET=SANDYBRIDGE</div></blockquote>

I then encountered a second problem related to IO. The error message is shown below. After some pain, I figured out that the error occurs because the most recent version of hdf5 1.12.0 was used. After reverting to an earlier version of 1.10.7, everything runs smoothly. <strong class="text-strong">Current tutorial does not indicate what version of hdf5 was used. It would be great to add that information and help other new users avoid this issue. </strong> Thank you~<br>

<blockquote class="uncited"><div>abinit: H5ACmpio.c<img alt=":1100:" class="emoji smilies" draggable="false" src="http://twemoji.maxcdn.com/2/svg/1100.svg"> H5AC__log_moved_entry: Assertion `!entry_dirty' failed.<br>
<br>
Program received signal SIGABRT: Process abort signal.<br>
<br>
Backtrace for this error:<br>
#0  0x7ffff3bc33ff in ???<br>
#1  0x7ffff3bc3387 in ???<br>
#2  0x7ffff3bc4a77 in ???<br>
#3  0x7ffff3bbc1a5 in ???<br>
#4  0x7ffff3bbc251 in ???<br>
#5  0x7ffff629bf3b in H5AC__log_moved_entry<br>
	at /storage/home/hcoda1/8/xbai33/p-mmourigal6-0/local/src/hdf5-1.12.0/src/H5ACmpio.c:1100<br>
#6  0x7ffff5e70e89 in H5AC_move_entry</div></blockquote></div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Running Abinit in virtual box Ubuntu</h3>
				<div class="date">Posted: <strong>Sat Jan 23, 2021 10:48 am</strong></div>
				<div class="author">by <strong>jbeuken</strong></div>
				<div class="content">Hi,<br>
<br>
You can find this information :<br>
<br>
1) on the ABINIT website :<br>
<br>
<a href="https://www.abinit.org/fallbacks" class="postlink">https://www.abinit.org/fallbacks</a><br>
<br>
2) in the tarball : config/specs/fbversion.conf<br>

<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>[9.2]
atompaw = 4.1.0.6
bigdft = abinit-1.7.1.28
hdf5 = 1.10.6
libpsml = 1.1.7
libxc = 4.3.4
lapack = abinit_6.10
netcdf4 = 4.6.3
netcdf4_fortran = 4.5.2
wannier90 = 2.0.1.1
xmlf90 = 1.5.3.1</code></pre></div>

Best,<br>
jmb</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Running Abinit in virtual box Ubuntu</h3>
				<div class="date">Posted: <strong>Mon May 03, 2021 5:30 pm</strong></div>
				<div class="author">by <strong>mverstra</strong></div>
				<div class="content">Hi all,<br>
<br>
it's very strange that the hdf small version is not backwards compatible. I have encountered the same thing on an old cluster of ours with the (new) hdf 1.12 and netcdf 4.7.4. They should ensure API and binary compatibility at least until version 2!</div>
			</div>
			<hr />
			</div>

	<div id="page-footer" class="page-footer">
		<div class="page-number">All times are <span title="Europe/Brussels">UTC+02:00</span><br />Page <strong>1</strong> of <strong>1</strong></div>
			<div class="copyright">
				<p>Powered by <a href="https://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Limited
				</p>
							</div>
	</div>
</div>

</body>

<!-- Mirrored from forum.abinit.org/viewtopic.php?f=3&t=5268&view=print by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 20 Sep 2024 15:04:46 GMT -->
</html>
