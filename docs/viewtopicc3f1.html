<!DOCTYPE html>
<html dir="ltr" lang="en-gb">

<!-- Mirrored from forum.abinit.org/viewtopic.php?f=10&t=3758&view=print by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 20 Sep 2024 15:56:56 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="robots" content="noindex" />

<title>ABINIT Discussion Forums &bull; Strange divergence in phonon calculation</title>

<link href="styles/flat-style/theme/print.css" rel="stylesheet">
<link href="styles/flat-style/theme/bidi.css" rel="stylesheet">
</head>
<body id="phpbb" class="ltr">
<div id="wrap" class="wrap">
	<a id="top" class="top-anchor" accesskey="t"></a>

	<div id="page-header">
		<h1>ABINIT Discussion Forums</h1>
		<p>The meeting place for ABINIT users and developers<br /><a href="index.html">https://forum.abinit.org/</a></p>

		<h2>Strange divergence in phonon calculation</h2>
		<p><a href="viewtopic188b.html?f=10&amp;t=3758">https://forum.abinit.org/viewtopic.php?f=10&amp;t=3758</a></p>
	</div>

	<div id="page-body" class="page-body">
		<div class="page-number">Page <strong>1</strong> of <strong>1</strong></div>
					<div class="post">
				<h3>Strange divergence in phonon calculation</h3>
				<div class="date">Posted: <strong>Fri Jan 05, 2018 9:35 am</strong></div>
				<div class="author">by <strong>phzting</strong></div>
				<div class="content">Hi all:<br /><br />   I'm calculating phonon dispersion of a layered magnetic compound MnPS3, in monolayer configuration with abinit-8.6.3. The compound should be with a monolayer graphene-like structure and Mn ions should be in anti-ferromagnetic state. <br />   I followed the example inputs trf1_5.in , used PAW method and LDA+U to perform the calculation.  However the phonon calculation gives divergent result, like follows in the output file:<br /><br /><blockquote class="uncited"><div>================================================================<br />     Perturbation : displacement of atom   1   along direction   1<br /> The set of symmetries contains only one element for this perturbation.<br /> symkpt : not enough symmetry to change the number of k points.<br /><br />--------------------------------------------------------------------------------<br /><br />-inwffil : will read wavefunctions from disk file phona1.testo_DS1_WFK<br />--------------------------------------------------------------------------------<br /><br /> dfpt_looppert : total number of electrons, from k and k+q<br />  fully or partially occupied states are    7.600000E+01 and    7.600000E+01.<br /> Initialisation of the first-order wave-functions :<br />  ireadwf=   0<br /><br />     iter   2DEtotal(Ha)        deltaE(Ha) residm    vres2<br />-ETOT  1   7167.5504061318      2.619E+03 1.317E+02 2.007E+11<br /> ETOT  2   305.48083104257     -6.862E+03 3.955E+01 2.159E+13<br /> ETOT  3   377.44886725607      7.197E+01 3.318E+01 5.674E+12<br /> ETOT  4   471.50757914298      9.406E+01 3.290E+00 1.330E+12<br /> ETOT  5   320.43231190237     -1.511E+02 1.466E+00 5.275E+11<br /> ETOT  6   252.70262695518     -6.773E+01 8.865E-01 2.793E+11<br /> ETOT  7   287.48459987003      3.478E+01 3.864E-01 5.329E+10<br /> ETOT  8   222.23664347908     -6.525E+01 3.279E-01 1.037E+11<br /> ETOT  9   160.62096681120     -6.162E+01 5.488E-01 1.525E+11<br /> ETOT 10   63.593755919068     -9.703E+01 1.950E+00 1.022E+11<br /> ETOT 11   42.755461990855     -2.084E+01 8.121E-01 2.407E+11<br /> ETOT 12   63.722890709370      2.097E+01 4.094E-01 4.122E+11<br /> ETOT 13   72.750704358300      9.028E+00 6.766E-01 3.290E+11<br /> ETOT 14   95.786405000161      2.304E+01 4.816E-01 3.742E+11<br /> ETOT 15   102.95874079429      7.172E+00 2.086E+00 5.150E+11<br /> ETOT 16   22.089956513602     -8.087E+01 7.047E+00 2.736E+12<br /> ETOT 17   13.788263878807     -8.302E+00 7.712E+00 3.927E+12<br /> ETOT 18   13.852400143228      6.414E-02 1.772E+01 2.187E+12<br /> ETOT 19   11.129500301152     -2.723E+00 1.185E+01 4.512E+12<br /> ETOT 20   16.960862267823      5.831E+00 9.159E+00 1.734E+12<br /> ETOT 21   14.366825257905     -2.594E+00 7.919E+00 4.032E+12<br /> ETOT 22  -15.124069487488     -2.949E+01 1.100E+01 2.222E+13<br /> ETOT 23 -0.35638714424840      1.477E+01 1.499E+01 1.602E+13<br /> ETOT 24  -12.505121461679     -1.215E+01 3.889E+01 1.826E+13<br /> ETOT 25  -15.147458189434     -2.642E+00 8.135E+01 2.395E+13<br /> ETOT 26  -7.4180051639387      7.729E+00 7.601E+01 2.291E+13<br /> ETOT 27  -12.067688509579     -4.650E+00 5.134E+01 2.967E+13<br /> ETOT 28  -11.139771015524      9.279E-01 1.964E+02 2.406E+13<br /> ETOT 29  -279.45541574554     -2.683E+02 3.979E+02 2.034E+14<br /> ETOT 30  -228.18401417459      5.127E+01 5.316E+02 2.407E+14<br /> ETOT 31  -200.39934347656      2.778E+01 3.076E+02 2.029E+14<br /> ETOT 32  -326.59547022255     -1.262E+02 1.918E+02 2.794E+14<br /> ETOT 33  -292.40322661116      3.419E+01 7.041E+02 2.972E+14<br /> ETOT 34  -253.52183404913      3.888E+01 9.349E+02 3.168E+14<br /> ETOT 35  -564.21983432659     -3.107E+02 9.427E+02 4.568E+14<br /> ETOT 36  -863.09070107264     -2.989E+02 4.037E+03 7.591E+14<br /> ETOT 37  -4633.3420518241     -3.770E+03 8.036E+03 3.480E+15<br /> ETOT 38  -1513.0033390165      3.120E+03 8.968E+03 2.301E+15<br /> ETOT 39  -4399.2813039931     -2.886E+03 1.099E+04 3.799E+15<br /> ETOT 40  -5454.4249788683     -1.055E+03 1.017E+04 5.853E+15<br /> ETOT 41  -4721.8874717351      7.325E+02 1.024E+04 6.192E+15<br /> ETOT 42  -8584.4852174690     -3.863E+03 1.289E+04 7.102E+15<br /> ETOT 43  -17054.340309335     -8.470E+03 1.863E+04 1.457E+16<br /> ETOT 44  -42236.186972691     -2.518E+04 3.491E+04 3.469E+16<br /> ETOT 45  -36642.786163661      5.593E+03 6.571E+04 3.856E+16<br /> ETOT 46  -18134.575607560      1.851E+04 1.488E+05 2.276E+16<br /> ETOT 47  -106286.83565704     -8.815E+04 1.200E+05 9.638E+16<br /> ETOT 48  -189756.03641500     -8.347E+04 4.654E+05 1.905E+17<br /> ETOT 49  -156655.16690390      3.310E+04 3.650E+05 1.620E+17<br /> ETOT 50  -203714.23103715     -4.706E+04 2.020E+05 2.013E+17<br /> ETOT 51  -506810.69637836     -3.031E+05 5.910E+05 4.244E+17<br /> ETOT 52  -946226.32434246     -4.394E+05 1.129E+06 8.196E+17<br /> ETOT 53  -1277829.3872822     -3.316E+05 2.086E+06 1.058E+18<br /> ETOT 54  -722001.13604763      5.558E+05 5.545E+06 8.444E+17<br /> ETOT 55  -3281372.1622114     -2.559E+06 5.271E+06 2.826E+18<br />...<br />============================================================<br /></div></blockquote><br />        <br />    I'm quite puzzled about the divergent result. I tried different k-mesh 16x16x1 and 16x16x4 (since the system is a 2-dimensional one) but the problem remains. I noticed in the log file there are warnings:<br /><br /><blockquote class="uncited"><div>--- !WARNING<br />src_file: mkdenpos.F90<br />src_line: 176<br />message: |<br />    Density went too small (lower than xc_denpos) at 1100264 points<br />    and was set to xc_denpos =   1.00E-14. Lowest was  -0.34E-06.<br />    Likely due to too low boxcut or too low ecut for pseudopotential core charge.<br />...<br /></div></blockquote><br /><br />and <br /><br /><blockquote class="uncited"><div> **** Psp strength  Dij(1) in Ha (atom      1) *****<br /> Component up:<br /> -59.80433  15.12065  -0.00763  -0.01266   0.04484   0.00609   0.01011  -0.03508  -0.00600   0.00032  -0.00439  -0.00029 ...<br />  15.12065  -2.28890   0.00179   0.00298  -0.00920  -0.00065  -0.00104   0.00739   0.00089   0.00004   0.00059   0.00004 ...<br />  -0.00763   0.00179 -64.84196  -0.00012  -0.00469  58.50365   0.00004   0.00356   0.03019   0.00246  -0.00878  -0.00347 ...<br />  -0.01266   0.00298  -0.00012 -64.84755  -0.00022   0.00004  58.50791   0.00016  -0.00347  -0.01984  -0.01600   0.02803 ...<br />   0.04484  -0.00920  -0.00469  -0.00022 -64.84242   0.00356   0.00016  58.50400  -0.00335  -0.00347  -0.01946  -0.01643 ...<br />   0.00609  -0.00065  58.50365   0.00004   0.00356 -34.48395  -0.00058  -0.00139  -0.02068  -0.00051   0.00127   0.00087 ...<br />   0.01011  -0.00104   0.00004  58.50791   0.00016  -0.00058 -34.48488  -0.00006   0.00087   0.00675   0.00726  -0.01794 ...<br />  -0.03508   0.00739   0.00356   0.00016  58.50400  -0.00139  -0.00006 -34.48409   0.00251   0.00087   0.01370   0.00961 ...<br />  -0.00600   0.00089   0.03019  -0.00347  -0.00335  -0.02068   0.00087   0.00251 -59.82635  -0.00046  -0.00085   0.00142 ...<br />   0.00032   0.00004   0.00246  -0.01984  -0.00347  -0.00051   0.00675   0.00087  -0.00046 -59.83832  -0.00150  -0.00854 ...<br />  -0.00439   0.00059  -0.00878  -0.01600  -0.01946   0.00127   0.00726   0.01370  -0.00085  -0.00150 -59.82941   0.00540 ...<br />  -0.00029   0.00004  -0.00347   0.02803  -0.01643   0.00087  -0.01794   0.00961   0.00142  -0.00854   0.00540 -59.83445 ...<br />   ...  only 12  components have been written...<br /> pawio_print_ij: WARNING -<br />  The matrix seems to have high value(s) !<br />  ( 14 components have a value greater than   50.0).<br />  It can cause instabilities during SCF convergence.<br />  Action: you should check your atomic dataset (psp file)<br />          and look for &quot;high&quot; projector functions...<br /></div></blockquote><br /><br />which may due to the low ecut or something, however I'm using Mn.LDA_PW-JTH.xml, P.LDA_PW-JTH.xml and S.LDA_PW-JTH.xml provided by <!-- m --><a class="postlink" href="http://www.abinit.org/">http://www.abinit.org</a><!-- m -->, and the &quot;high&quot; quality requires at most 20 Ha, while I'm using 28 Ha. I'm not sure if the input files are correct, and I attach them in the attachments (the input, output and log files for scf calculation and phonon calculations, respectively). If anyone has the experience on this problem, and can point out the mistakes in my input files, I'll be very appreciate for the help!<br /><br />Regards<br /><br />Zhang Ting</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Strange divergence in phonon calculation</h3>
				<div class="date">Posted: <strong>Tue Apr 17, 2018 9:47 pm</strong></div>
				<div class="author">by <strong>Boris</strong></div>
				<div class="content">Hi<br /><br />I would try first to NOT calculate the d/dk. Just read the GS wavefunctions, run the DFPT and see if that works.<br /><br />Also, try using a more up to date version of abinit, as there might have been a few changes in the phonon part since 8.6.3</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Strange divergence in phonon calculation</h3>
				<div class="date">Posted: <strong>Thu Sep 06, 2018 1:33 pm</strong></div>
				<div class="author">by <strong>mverstra</strong></div>
				<div class="content">You can also try <br />1) other PAW potentials (eg GBRV or the latest JTH which are coming out soon)<br />2) to precondition the SCF cycle, as for the ground state, with diemac (say a value below 10 to avoid charge sloshing in the vacuum)</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Strange divergence in phonon calculation</h3>
				<div class="date">Posted: <strong>Mon Nov 02, 2020 3:59 am</strong></div>
				<div class="author">by <strong>andyamygto</strong></div>
				<div class="content">Hi,<br>
<br>
I met the same problem in the latest product version 9.2.1<br>
Is there any suggestion or information about this error?<br>
I was using the newest JTH PSP from the Abinit site.<br>
<br>
Regards,<br>
Andy</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Strange divergence in phonon calculation</h3>
				<div class="date">Posted: <strong>Mon Nov 02, 2020 8:45 am</strong></div>
				<div class="author">by <strong>ebousquet</strong></div>
				<div class="content">Dear Andy, <br>
Same error on the same system?<br>
Regards,<br>
Eric</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Strange divergence in phonon calculation</h3>
				<div class="date">Posted: <strong>Mon Nov 02, 2020 9:39 am</strong></div>
				<div class="author">by <strong>andyamygto</strong></div>
				<div class="content">Dear Eric,<br>
<br>
The system is CrI3 monolayer but the error is the same, which is the weird divergence when doing perturbation.<br>
I have test for both GGA and LDA with JTH-LDA-atomicdata-1.1<br>
I have no idea what is causing the problem.<br>
<br>
Here is my input (I was still using the files file in 9.2.1 LUL)<br>
In my input, The dataset was skipping the dataset 2 since I was trying the solution suggest at top, but it doesn't work.<br>
<br>
Regards,<br>
Andy</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Strange divergence in phonon calculation</h3>
				<div class="date">Posted: <strong>Tue Nov 03, 2020 11:16 am</strong></div>
				<div class="author">by <strong>ebousquet</strong></div>
				<div class="content">Dear Andy,<br>
Is your system metallic or insulator (CrI3 is not clear depending on the magnetism, structure, etc)? <br>
You use a metallic occupation with the default tsmear, which might be too large for your system?<br>
Best wishes,<br>
Eric</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Strange divergence in phonon calculation</h3>
				<div class="date">Posted: <strong>Wed Nov 04, 2020 9:14 pm</strong></div>
				<div class="author">by <strong>andyamygto</strong></div>
				<div class="content">Dear Eric,<br>
<br>
Sorry for the late response.<br>
<br>
Thanks for suggesting that the tsmear might be large for my calculation. <br>
However, the divergence also happened when I use the occopt=1 with spinmagntarget = 0 to define the AFM polarize for my system.<br>
<br>
I wonder if it is the PAW's problem or there are some sort of bug in the code?<br>
<br>
Best wishes,<br>
Andy</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Strange divergence in phonon calculation</h3>
				<div class="date">Posted: <strong>Thu Nov 12, 2020 12:18 pm</strong></div>
				<div class="author">by <strong>ebousquet</strong></div>
				<div class="content">Dear Andy,<br>
Did you use a larger tsmear finally and this does not help?<br>
Hard to say where the problem can come from, did you try with a different set of atomic data for example (GBRV <a href="http://www.physics.rutgers.edu/gbrv/" class="postlink">http://www.physics.rutgers.edu/gbrv/</a> PAW data set for example) to see if this is related to the pseudo?<br>
Also, how the ground state converge, do you have very good precision regarding the residual of total energy, WF, or potential?<br>
Best wishes,<br>
Eric</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Strange divergence in phonon calculation</h3>
				<div class="date">Posted: <strong>Fri Nov 13, 2020 5:58 pm</strong></div>
				<div class="author">by <strong>andyamygto</strong></div>
				<div class="content">Dear Eric,<br>
<br>
No matter I use high or low tsmear (0.0001 to 0.1). the divergence will happened.<br>
 <br>
Also, I have tried the GBRV PAW data set before, but the GRBV PAW data set doesn't include the spin polarize info in their dataset, so I wonder if that may cause the problem?<br>
<br>
All the ground state converged has been tested (cut, kpoint...etc)<br>
<br>
Regards,<br>
Andy</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Strange divergence in phonon calculation</h3>
				<div class="date">Posted: <strong>Sat Nov 14, 2020 2:46 pm</strong></div>
				<div class="author">by <strong>andyamygto</strong></div>
				<div class="content">Dear Eric,<br>
<br>
Some update..<br>
<br>
Same divergence happened even when I use the Atomic PAW from GPAW<br>
<a href="https://wiki.fysik.dtu.dk/gpaw/setups/setups.html" class="postlink">https://wiki.fysik.dtu.dk/gpaw/setups/setups.html</a><br>
<br>
So I think this might be the bug for the PAW+DFPT calculation?<br>
<br>
However, In another case SnO2 rutile, the PAW + DFPT working well.<br>
So, form my perspective, either the error coming from the code or the the PSP cannot describe the Cr or I correctly.<br>
<br>
Regards,<br>
Andy</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Strange divergence in phonon calculation</h3>
				<div class="date">Posted: <strong>Tue Nov 17, 2020 3:57 pm</strong></div>
				<div class="author">by <strong>ebousquet</strong></div>
				<div class="content">Dear Andy,<br>
Another remark: you put 35 bands in your calculation this means, at least with JTH pseudos, that you'll not have any empty bands. If you use metallic occupation, you'll better put more bands (maybe 5-10 more) to be sure things are OK.<br>
Could test this option?<br>
Eric</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Strange divergence in phonon calculation</h3>
				<div class="date">Posted: <strong>Fri Nov 20, 2020 9:31 pm</strong></div>
				<div class="author">by <strong>andyamygto</strong></div>
				<div class="content">Dear Eric,<br>
<br>
I have tested the nbands from 35 to 95 with 10 nbands increase every time.<br>
Seems like the issue still remains.<br>
<br>
Also, I have tested the relativity high energy cutoff with the PAW dataset (up to 45 Ha with pawecutdg=90)<br>
The problem still exists.<br>
<br>
And there is something that might help.<br>
I just tested that when I use the PAW on the same material (CrI3), but in bulk structure(in R3 bar symmetry), the divergence will not happen. So I assume that the JTH pseudos are working just fine (I am not an expert on the pseudos so I cannot tell if it is good or not.)<br>
<br>
Here is my following concern. Is the DFPT with PAW working stably on 2D system?<br>
<br>
Finally, I want to thank you for helping me going though all this problem and hope that we can figure something helpful out!<br>
<br>
Best wishes,<br>
Andy</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Strange divergence in phonon calculation</h3>
				<div class="date">Posted: <strong>Tue Dec 01, 2020 3:54 pm</strong></div>
				<div class="author">by <strong>ebousquet</strong></div>
				<div class="content">Dear Andy,<br>
OK, thank you for testing that, it is good to see that it works for bulk but not with vacuum... <br>
I cannot tell you more at this stage, I'll have to test it myself to see what can be wrong or what can be done to get convergence.<br>
I' told about this problem to the developers, lets see...<br>
Best wishes,<br>
Eric</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Strange divergence in phonon calculation</h3>
				<div class="date">Posted: <strong>Fri Dec 04, 2020 7:02 am</strong></div>
				<div class="author">by <strong>andyamygto</strong></div>
				<div class="content">Dear Eric,<br>
<br>
Thanks for helping report the issue. I look forward the upcoming update.<br>
<br>
Best wishes,<br>
Andy</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Strange divergence in phonon calculation</h3>
				<div class="date">Posted: <strong>Wed Dec 16, 2020 11:15 am</strong></div>
				<div class="author">by <strong>aleeds</strong></div>
				<div class="content">Hi everyone, <br>
<br>
I have attempted the same type of calculation on CrI3, using norm conserving pseudo potentials from Pseudo dojo and I run into the same problem.</div>
			</div>
			<hr />
			</div>

	<div id="page-footer" class="page-footer">
		<div class="page-number">All times are <span title="Europe/Brussels">UTC+02:00</span><br />Page <strong>1</strong> of <strong>1</strong></div>
			<div class="copyright">
				<p>Powered by <a href="https://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Limited
				</p>
							</div>
	</div>
</div>

</body>

<!-- Mirrored from forum.abinit.org/viewtopic.php?f=10&t=3758&view=print by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 20 Sep 2024 15:56:56 GMT -->
</html>
