<!DOCTYPE html>
<html dir="ltr" lang="en-gb">

<!-- Mirrored from forum.abinit.org/viewtopic.php?f=11&t=3797&view=print by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 20 Sep 2024 20:25:03 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="robots" content="noindex" />

<title>ABINIT Discussion Forums &bull; Screening crashed at some q-points</title>

<link href="styles/flat-style/theme/print.css" rel="stylesheet">
<link href="styles/flat-style/theme/bidi.css" rel="stylesheet">
</head>
<body id="phpbb" class="ltr">
<div id="wrap" class="wrap">
	<a id="top" class="top-anchor" accesskey="t"></a>

	<div id="page-header">
		<h1>ABINIT Discussion Forums</h1>
		<p>The meeting place for ABINIT users and developers<br /><a href="index.html">https://forum.abinit.org/</a></p>

		<h2>Screening crashed at some q-points</h2>
		<p><a href="viewtopic407f.html?f=11&amp;t=3797">https://forum.abinit.org/viewtopic.php?f=11&amp;t=3797</a></p>
	</div>

	<div id="page-body" class="page-body">
		<div class="page-number">Page <strong>1</strong> of <strong>1</strong></div>
					<div class="post">
				<h3>Screening crashed at some q-points</h3>
				<div class="date">Posted: <strong>Mon Mar 12, 2018 8:55 am</strong></div>
				<div class="author">by <strong>thanusit</strong></div>
				<div class="content">Dear all<br /><br />I have tried to carry out my gw calculation by following the procedure given in tutoparal/tmbt_x. There were four steps in the calculation: gs_DEN, WFK, srceening, and sigma. There was no problem in the first two steps. But in the screening part, in which I performed at one q-point at a time, the runs crashed at 5 q-points (out of total of 35). The input file, the error message in &quot;__ABI_MPIABORTFILE__&quot; and the log file, and as well as the build information are given as follows. (Similar issue has been posted in this forum but there isn't any answer yet.)<br /><br />I don't know where I got it wrong. All suggestions to solve or get around the problem will be greatly appreciated.<br /><br />Best regards,<br />Thanusit<br /><br /># input file<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code># Crystalline Ga4P3Ti<br /># Calculation of the GW-corrected band structure.<br /><br /># Part-3: Screening Calculation&nbsp; <br />&nbsp;optdriver&nbsp; &nbsp;3&nbsp; &nbsp;# Screening calculation<br />&nbsp; &nbsp;irdwfk&nbsp; &nbsp; 1<br />&nbsp; &nbsp; symchi&nbsp; &nbsp;1&nbsp; &nbsp;# Use symmetries to speedup the BZ integration<br /><br />&nbsp;gwcalctyp&nbsp; &nbsp;2&nbsp; &nbsp;# GW calculation using numerical integration (contour deformation method)<br />&nbsp; &nbsp; spmeth&nbsp; &nbsp;1&nbsp; &nbsp; # Enable the spectral method.<br />&nbsp; nomegasf&nbsp; &nbsp;100&nbsp; # Number of points for the spectral function. <br />&nbsp; &nbsp; gwpara&nbsp; &nbsp;2&nbsp; &nbsp;# Parallelization over bands<br />&nbsp; &nbsp; &nbsp; awtr&nbsp; &nbsp;1&nbsp; &nbsp;# Take advantage of time-reversal. Mandatory when gwpara=2 is used.<br /><br />&nbsp; &nbsp;ecutwfn&nbsp; &nbsp;12&nbsp; # Cutoff for the wavefunctions.<br />&nbsp; &nbsp;ecuteps&nbsp; &nbsp;12&nbsp; # Cutoff for the polarizability.<br />&nbsp; &nbsp; &nbsp;nband&nbsp; &nbsp;60&nbsp; # Number of bands in the RPA expression (16 occupied + 16 empty bands)<br />&nbsp; &nbsp;inclvkb&nbsp; &nbsp;2&nbsp; &nbsp;# Correct treatment of the optical limit.<br /><br />&nbsp; &nbsp;nfreqim&nbsp; &nbsp;5<br />&nbsp; &nbsp;nfreqre&nbsp; &nbsp;20<br />&nbsp;freqremax&nbsp; &nbsp;40 eV<br /><br />&nbsp; &nbsp;nqptdm&nbsp; &nbsp;1<br />&nbsp; &nbsp; qptdm&nbsp; <br />#&nbsp; &nbsp; &nbsp;1)&nbsp; &nbsp; &nbsp;0.00000000E+00&nbsp; 0.00000000E+00&nbsp; 0.00000000E+00<br />#&nbsp; &nbsp; &nbsp;2)&nbsp; &nbsp; &nbsp;1.25000000E-01&nbsp; 0.00000000E+00&nbsp; 0.00000000E+00<br />#&nbsp; &nbsp; &nbsp;3)&nbsp; &nbsp; &nbsp;2.50000000E-01&nbsp; 0.00000000E+00&nbsp; 0.00000000E+00<br />#&nbsp; &nbsp; &nbsp;4)&nbsp; &nbsp; &nbsp;3.75000000E-01&nbsp; 0.00000000E+00&nbsp; 0.00000000E+00<br />#&nbsp; &nbsp; &nbsp;5)&nbsp; &nbsp; &nbsp;5.00000000E-01&nbsp; 0.00000000E+00&nbsp; 0.00000000E+00 <br />#&nbsp; &nbsp; &nbsp;6)&nbsp; &nbsp; &nbsp;1.25000000E-01&nbsp; 1.25000000E-01&nbsp; 0.00000000E+00<br />#&nbsp; &nbsp; &nbsp;7)&nbsp; &nbsp; &nbsp;2.50000000E-01&nbsp; 1.25000000E-01&nbsp; 0.00000000E+00<br />#&nbsp; &nbsp; &nbsp;8)&nbsp; &nbsp; &nbsp;3.75000000E-01&nbsp; 1.25000000E-01&nbsp; 0.00000000E+00<br />#&nbsp; &nbsp; &nbsp;9)&nbsp; &nbsp; &nbsp;5.00000000E-01&nbsp; 1.25000000E-01&nbsp; 0.00000000E+00<br />#&nbsp; &nbsp; 10)&nbsp; &nbsp; &nbsp;2.50000000E-01&nbsp; 2.50000000E-01&nbsp; 0.00000000E+00<br />#&nbsp; &nbsp; 11)&nbsp; &nbsp; &nbsp;3.75000000E-01&nbsp; 2.50000000E-01&nbsp; 0.00000000E+00<br />#&nbsp; &nbsp; 12)&nbsp; &nbsp; &nbsp;5.00000000E-01&nbsp; 2.50000000E-01&nbsp; 0.00000000E+00<br />#&nbsp; &nbsp; 13)&nbsp; &nbsp; &nbsp;3.75000000E-01&nbsp; 3.75000000E-01&nbsp; 0.00000000E+00<br />#&nbsp; &nbsp; 14)&nbsp; &nbsp; &nbsp;5.00000000E-01&nbsp; 3.75000000E-01&nbsp; 0.00000000E+00<br />#&nbsp; &nbsp; 15)&nbsp; &nbsp; &nbsp;5.00000000E-01&nbsp; 5.00000000E-01&nbsp; 0.00000000E+00<br />#&nbsp; &nbsp; 16)&nbsp; &nbsp; &nbsp;1.25000000E-01&nbsp; 1.25000000E-01&nbsp; 1.25000000E-01<br />#&nbsp; &nbsp; 17)&nbsp; &nbsp; &nbsp;2.50000000E-01&nbsp; 1.25000000E-01&nbsp; 1.25000000E-01<br />#&nbsp; &nbsp; 18)&nbsp; &nbsp; &nbsp;3.75000000E-01&nbsp; 1.25000000E-01&nbsp; 1.25000000E-01<br />#&nbsp; &nbsp; 19)&nbsp; &nbsp; &nbsp;5.00000000E-01&nbsp; 1.25000000E-01&nbsp; 1.25000000E-01<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2.50000000E-01&nbsp; 2.50000000E-01&nbsp; 1.25000000E-01<br />#&nbsp; &nbsp; 21)&nbsp; &nbsp; &nbsp;3.75000000E-01&nbsp; 2.50000000E-01&nbsp; 1.25000000E-01<br />#&nbsp; &nbsp; 22)&nbsp; &nbsp; &nbsp;5.00000000E-01&nbsp; 2.50000000E-01&nbsp; 1.25000000E-01<br />#&nbsp; &nbsp; 23)&nbsp; &nbsp; &nbsp;3.75000000E-01&nbsp; 3.75000000E-01&nbsp; 1.25000000E-01<br />#&nbsp; &nbsp; 24)&nbsp; &nbsp; &nbsp;5.00000000E-01&nbsp; 3.75000000E-01&nbsp; 1.25000000E-01<br />#&nbsp; &nbsp; 25)&nbsp; &nbsp; &nbsp;5.00000000E-01&nbsp; 5.00000000E-01&nbsp; 1.25000000E-01<br />#&nbsp; &nbsp; 26)&nbsp; &nbsp; &nbsp;2.50000000E-01&nbsp; 2.50000000E-01&nbsp; 2.50000000E-01<br />#&nbsp; &nbsp; 27)&nbsp; &nbsp; &nbsp;3.75000000E-01&nbsp; 2.50000000E-01&nbsp; 2.50000000E-01<br />#&nbsp; &nbsp; 28)&nbsp; &nbsp; &nbsp;5.00000000E-01&nbsp; 2.50000000E-01&nbsp; 2.50000000E-01<br />#&nbsp; &nbsp; 29)&nbsp; &nbsp; &nbsp;3.75000000E-01&nbsp; 3.75000000E-01&nbsp; 2.50000000E-01<br />#&nbsp; &nbsp; 30)&nbsp; &nbsp; &nbsp;5.00000000E-01&nbsp; 3.75000000E-01&nbsp; 2.50000000E-01<br />#&nbsp; &nbsp; 31)&nbsp; &nbsp; &nbsp;5.00000000E-01&nbsp; 5.00000000E-01&nbsp; 2.50000000E-01<br />#&nbsp; &nbsp; 32)&nbsp; &nbsp; &nbsp;3.75000000E-01&nbsp; 3.75000000E-01&nbsp; 3.75000000E-01<br />#&nbsp; &nbsp; 33)&nbsp; &nbsp; &nbsp;5.00000000E-01&nbsp; 3.75000000E-01&nbsp; 3.75000000E-01<br />#&nbsp; &nbsp; 34)&nbsp; &nbsp; &nbsp;5.00000000E-01&nbsp; 5.00000000E-01&nbsp; 3.75000000E-01<br />#&nbsp; &nbsp; 35)&nbsp; &nbsp; &nbsp;5.00000000E-01&nbsp; 5.00000000E-01&nbsp; 5.00000000E-01<br /><br />########################################<br />#Common input variables<br /><br />#Definition iof the unit cell<br />&nbsp; &nbsp;acell&nbsp; 3*1.0306603546E+01&nbsp; &nbsp;# From structural optimization with optcell2, iscf7 <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# ionmove3, occopt3, ngkpt888, tsmear0.01, ecut28, nband54, tolmxf-9, toldfe-12<br />&nbsp; &nbsp;rprim&nbsp; 1.0 0.0 0.0&nbsp; &nbsp; &nbsp; # Cartesian components of primitive vectors <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0 1.0 0.0&nbsp; &nbsp; &nbsp; # of the simple cubic lattice<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0 0.0 1.0&nbsp; &nbsp;<br /><br />#Definition of the atomic types, number, and and positions<br />&nbsp; ntypat&nbsp; 3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# There are three types of atom in a unit cell<br />&nbsp; &nbsp;znucl&nbsp; 31 15 22&nbsp; &nbsp; # the atomic number of Ga, P and Ti, respectively.<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # The pseudopotentials mentioned in the &quot;files&quot; file must correspond<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # to the types of atom.<br />&nbsp; &nbsp;natom&nbsp; 8&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# There are 4 Ga, 3 P and 1 Ti atoms.<br />&nbsp; &nbsp;typat 1 1 1 1 3 2 2 2&nbsp; # 1=Ga, 2=P, 3=Ti (doping position)<br />&nbsp; &nbsp; xred&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-1.7296466397E-02 -1.7296466397E-02 -1.7296466397E-02<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 5.1729646640E-01&nbsp; 5.1729646640E-01 -1.7296466397E-02<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 5.1729646640E-01 -1.7296466397E-02&nbsp; 5.1729646640E-01<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-1.7296466397E-02&nbsp; 5.1729646640E-01&nbsp; 5.1729646640E-01<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2.5000000000E-01&nbsp; 2.5000000000E-01&nbsp; 2.5000000000E-01<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2.5000000000E-01&nbsp; 7.5000000000E-01&nbsp; 7.5000000000E-01<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 7.5000000000E-01&nbsp; 2.5000000000E-01&nbsp; 7.5000000000E-01<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 7.5000000000E-01&nbsp; 7.5000000000E-01&nbsp; 2.5000000000E-01<br /><br />#State occupation<br />&nbsp; occopt&nbsp; 3&nbsp; &nbsp; &nbsp;#metallic&nbsp; &nbsp; <br />&nbsp; tsmear&nbsp; 0.01<br /><br />#Default k-points grid for k-centered wfk, scr, sigma calculations<br />&nbsp; &nbsp; kptopt&nbsp; 1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # Option for the automatic generation of k points, taking<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # into account the symmetry<br />&nbsp; &nbsp; &nbsp;ngkpt&nbsp; 8 8 8&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# Density of k point grids<br />&nbsp; &nbsp;nshiftk&nbsp; 1<br />&nbsp; &nbsp; shiftk&nbsp; 0.0 0.0 0.0&nbsp; # This grid contains the Gamma point, which is the point at which<br />&nbsp; &nbsp; istwfk *1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # For the GW computations, do not take advantage of the <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # specificities of k points to reduce the number of components of the<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # wavefunction.<br /><br />#Include non-symmorphic operations<br />&nbsp;symmorphi&nbsp; 1&nbsp; &nbsp; #This is just to emphasize using of the default value.<br /><br />#Exchange-correlation functional<br />&nbsp; &nbsp; &nbsp; &nbsp;ixc&nbsp; 1&nbsp; &nbsp; # coresponding to the pspnc used<br /><br />#Definition of the planewave basis set<br />&nbsp; &nbsp; &nbsp; ecut&nbsp; 32&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # Maximal kinetic energy cut-off, in Hartree<br />&nbsp; &nbsp; ecutsm&nbsp; 0.5<br />&nbsp; &nbsp;dilatmx&nbsp; 1.2<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br /># add to conserve old &lt; 6.7.2 behavior for calculating forces at each SCF step<br />&nbsp;optforces 1<br /><br />#data printing option<br />&nbsp; &nbsp; prtvol 1<br />&nbsp;</code></pre></div><br /><br /># Excecuting cmd: mpirun -n 7 abinit&lt;Ga4P3Ti_lda_gw_band-3.files&gt;&amp; log<br /><br />#Error message in _ABI_MPIABORTFILE__  (Similar errors, with different values of my_wr, occurred in the other falied runs)<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>--- !BUG<br />src_file: m_chi0.F90<br />src_line: 2037<br />mpi_rank: 6<br />message: |<br /><br />&nbsp; &nbsp; &nbsp;Indices out of boundary<br />&nbsp; &nbsp; &nbsp; my_wl = 2 iomegal = 1<br />&nbsp; &nbsp; &nbsp; my_wr = 100 iomegar = 2<br />...<br /><br /></code></pre></div><br /><br />#log file (see attachment)<br />#part of the log file that seems to relate to the error message above<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>=== Info on the real frequency mesh for spectral method ===<br />&nbsp; maximum frequency =&nbsp; &nbsp;30.453 &#91;eV&#93;<br />&nbsp; nomegasf =&nbsp; &nbsp;100<br />&nbsp; domegasf =&nbsp; 0.31369 &#91;eV&#93;<br />&nbsp;Using linear mesh for Im chi0<br />&nbsp;my_wl and my_wr: 4 73<br />&nbsp;memory required per spectral point:&nbsp; &nbsp; 67.8693 &#91;Mb&#93;<br />&nbsp;memory required by sf_chi0:&nbsp; &nbsp; &nbsp;4.6395 &#91;Gb&#93;<br /><br />--- !WARNING<br />src_file: cchi0.F90<br />src_line: 398<br />message: |<br />&nbsp; &nbsp; Memory required for sf_chi0 is larger than 2.0 Gb!<br />...<br /></code></pre></div><br /><br />#Build version and platform<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>- Abinit-8.6.3<br />- Intel Xenon under Ubuntu 16.04.4 LTS (GNU/Linux 4.4.0-112-generic x86_64) with gcc-5.4.0 and openmpi-1.10.3 (local built)<br />- locally-built external libs: netcdf-4.3.1 (with hdf5-1.8.12), fftw-3.3.4, atlast-3.10.1(with lapack-3.5.0), gsl-1.16, levmar-2.5<br /></code></pre></div><br /><br />#build config.ac<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>prefix=&quot;/data2/thanusit/local/apps/abinit-8.6.3&quot;<br />enable_exports=&quot;yes&quot;<br />enable_64bit_flags=&quot;yes&quot;<br />enable_gw_dpc=&quot;yes&quot;<br />enable_mpi=&quot;yes&quot;<br />enable_mpi_io=&quot;yes&quot;<br />enable_bse_unpacked=&quot;yes&quot;<br />with_mpi_prefix=&quot;/data2/thanusit/local/apps/openmpi-1.10.3&quot;<br />with_trio_flavor=&quot;netcdf&quot;<br />with_netcdf_incs=&quot;-I/data2/thanusit/local/apps/netcdfmpi/include&quot;<br />with_netcdf_libs=&quot;-L/data2/thanusit/local/apps/netcdfmpi/lib -lnetcdf -lnetcdff&quot;<br />with_fft_flavor=&quot;fftw3&quot;<br />with_fft_incs=&quot;-I/data2/thanusit/local/apps/fftw-3.3.4/include&quot;<br />with_fft_libs=&quot;-L/data2/thanusit/local/apps/fftw-3.3.4/lib -lfftw3 -lfftw3f&quot;<br />#with_fft_incs=&quot;-I/usr/include&quot;<br />#with_fft_libs=&quot;-L/usr/lib/x86_64-linux-gnu -lfftw3 -lfftw3f&quot;<br />with_linalg_flavor=&quot;atlas&quot;<br />with_linalg_incs=&quot;-I/data2/thanusit/local/apps/atlas/include -I/data2/thanusit/local/apps/atlas/include/atlas&quot;<br />with_linalg_libs=&quot;-L/data2/thanusit/local/apps/atlas/lib -ltatlas -L/usr/lib -lblacs-openmpi -lblacsCinit-openmpi -lblacsF77init-openmpi&quot;<br />#with_linalg_incs=&quot;-I/usr/include&quot;<br />#with_linalg_libs=&quot;-L/usr/lib -llapack -lf77blas -lcblas -latlas&quot;<br />with_algo_flavor=&quot;levmar&quot;<br />with_algo_incs=&quot;-I/data2/thanusit/local/apps/levmar-2.5/include&quot;<br />with_algo_libs=&quot;-L/data2/thanusit/local/apps/levmar-2.5/lib -llevmar&quot;<br />with_math_flavor=&quot;gsl&quot;<br />with_math_incs=&quot;-I/data2/thanusit/local/apps/gsl-1.16/include/gsl&quot;<br />with_math_libs=&quot;-L/data2/thanusit/local/apps/gsl-1.16/lib -lgsl -lgslcblas -lm&quot;<br />with_dft_flavor=&quot;atompaw+bigdft+libxc+wannier90&quot;<br /></code></pre></div><br /><br /># config.log (see attachment)<br /><br /># Test results (../abinit-8.6.3/tests/runtest.py -n2 -j1 -t0)<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>failed &nbsp; &nbsp;passed &nbsp; &nbsp;succeeded &nbsp; &nbsp;skipped &nbsp; &nbsp;disabled<br />13 &nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;93 &nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;637 &nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 167 &nbsp; &nbsp;0<br />tot_etime = 49759.87<br />run_etime = 49611.25<br />no_pythreads = 1<br />no_MPI = 2<br />&#91;MPI setup&#93;<br />mpirun_np = mpirun -np<br /></code></pre></div></div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Screening crashed at some q-points</h3>
				<div class="date">Posted: <strong>Tue Mar 13, 2018 10:48 am</strong></div>
				<div class="author">by <strong>ebousquet</strong></div>
				<div class="content">Dear Thanusit,<br />I don't know about the GW part of Abinit, but in your automatic tests you have 13 tests that failed. This means that your compilation of Abinit breaks some tests and thus it is might not be safe to you use it, mostly if these wrong tests are the GW ones... Could you check which are these 13 automatic tests?<br />Best wishes,<br />Eric</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Screening crashed at some q-points</h3>
				<div class="date">Posted: <strong>Thu Mar 15, 2018 3:51 pm</strong></div>
				<div class="author">by <strong>thanusit</strong></div>
				<div class="content">Dear Eric and all<br /><br />Thank you for your reply. <br /><br />Among the 13 failed tests, there is one that is indeed related to GW calculation, v67mbpt_t19. A close look into the test report and as well as the output file t19.out, it appears that the test got the RPA energy in datatset#3 that is obviously inconsistent to that given in the reference file (~../Ref/t19.out), as shown below. Note that the RPA results the 1st, 2nd, 3rd, and 4th row of each group are corresponding to that from dataset#2, #3, #4, and #5, respectively.<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>(Test suite with np =2)<br />/Test_suite_full_-n2-j1-t0_13-failed_93-passed_637-succeeded/v67mbpt_t19$ grep &quot;RPA&quot; t19.out<br />&nbsp;RPA energy &#91;Ha&#93; :&nbsp; &nbsp; &nbsp;-0.32125626<br />&nbsp;RPA energy &#91;Ha&#93; :&nbsp; &nbsp; &nbsp;-0.00001626<br />&nbsp;RPA energy &#91;Ha&#93; :&nbsp; &nbsp; &nbsp;-0.41250684<br />&nbsp;RPA energy &#91;Ha&#93; :&nbsp; &nbsp; &nbsp;-0.21616125<br /><br />(../Ref/t19.out)<br />grep &quot;RPA&quot; /data2/thanusit/src_build/abinit-8.6.3/tests/v67mbpt/Refs/t19.out <br />&nbsp;RPA energy &#91;Ha&#93; :&nbsp; &nbsp; &nbsp;-0.32125626<br />&nbsp;RPA energy &#91;Ha&#93; :&nbsp; &nbsp; &nbsp;-0.32125626<br />&nbsp;RPA energy &#91;Ha&#93; :&nbsp; &nbsp; &nbsp;-0.41250684<br />&nbsp;RPA energy &#91;Ha&#93; :&nbsp; &nbsp; &nbsp;-0.21616125<br /></code></pre></div><br /><br />However, when I executed ../abinit-8.6.3/tests/runtest.py v67mbpt with only 1 proc (-n1 -j1 -t0), 3 tests in the set were passed while the remaining, including v67mbpt_t19, were all succeeded. Also, the RPA energies were all agree well with (within 1E10-7) that of the reference file, as shown below.<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>&nbsp;grep &quot;RPA&quot; ../Test_suite_v67mbpt_-n1_-j1_t0_0-failed/v67mbpt_t19/t19.out<br />&nbsp;RPA energy &#91;Ha&#93; :&nbsp; &nbsp; &nbsp;-0.32125627<br />&nbsp;RPA energy &#91;Ha&#93; :&nbsp; &nbsp; &nbsp;-0.32125627 <br />&nbsp;RPA energy &#91;Ha&#93; :&nbsp; &nbsp; &nbsp;-0.41250685 <br />&nbsp;RPA energy &#91;Ha&#93; :&nbsp; &nbsp; &nbsp;-0.21616125<br /></code></pre></div><br /><br />In addition, I tried running directly with mpirun the v67mbpt_t19 using various n-proc, i.e. -n =1, 2, 3, 4, 5, 6, 10. The outputs, listed below, show that the RPA energy in dataset#3 is consisitent to the reference file only when n-proc=1, otherwise it has different values for different n-proc.<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>/Test_v67mbpt_t19$ grep &quot;RPA&quot; v67mbpt_t19_np1/t19.out<br />&nbsp;RPA energy &#91;Ha&#93; :&nbsp; &nbsp; &nbsp;-0.32125627<br />&nbsp;RPA energy &#91;Ha&#93; :&nbsp; &nbsp; &nbsp;-0.32125627 <br />&nbsp;RPA energy &#91;Ha&#93; :&nbsp; &nbsp; &nbsp;-0.41250685 <br />&nbsp;RPA energy &#91;Ha&#93; :&nbsp; &nbsp; &nbsp;-0.21616125<br /><br />/Test_v67mbpt_t19$ grep &quot;RPA&quot; v67mbpt_t19_np2/t19.out<br />&nbsp;RPA energy &#91;Ha&#93; :&nbsp; &nbsp; &nbsp;-0.32125626<br />&nbsp;RPA energy &#91;Ha&#93; :&nbsp; &nbsp; &nbsp;-0.00001626<br />&nbsp;RPA energy &#91;Ha&#93; :&nbsp; &nbsp; &nbsp;-0.41250684<br />&nbsp;RPA energy &#91;Ha&#93; :&nbsp; &nbsp; &nbsp;-0.21616125<br /><br />/Test_v67mbpt_t19$ grep &quot;RPA&quot; v67mbpt_t19_np3/t19.out<br />&nbsp;RPA energy &#91;Ha&#93; :&nbsp; &nbsp; &nbsp;-0.32125627<br />&nbsp;RPA energy &#91;Ha&#93; :&nbsp; &nbsp; &nbsp;-0.34181169<br />&nbsp;RPA energy &#91;Ha&#93; :&nbsp; &nbsp; &nbsp;-0.41250684<br />&nbsp;RPA energy &#91;Ha&#93; :&nbsp; &nbsp; &nbsp;-0.21616125<br /><br />/Test_v67mbpt_t19$ grep &quot;RPA&quot; v67mbpt_t19_np4/t19.out<br />&nbsp;RPA energy &#91;Ha&#93; :&nbsp; &nbsp; &nbsp;-0.32125626<br />&nbsp;RPA energy &#91;Ha&#93; :&nbsp; &nbsp; &nbsp;-0.00001626<br />&nbsp;RPA energy &#91;Ha&#93; :&nbsp; &nbsp; &nbsp;-0.41250684<br />&nbsp;RPA energy &#91;Ha&#93; :&nbsp; &nbsp; &nbsp;-0.21616125<br /><br />/Test_v67mbpt_t19_np1-10$ grep &quot;RPA&quot; v67mbpt_t19_np5/t19.out <br />&nbsp;RPA energy &#91;Ha&#93; :&nbsp; &nbsp; &nbsp;-0.32125626<br />&nbsp;RPA energy &#91;Ha&#93; :&nbsp; &nbsp; &nbsp;-0.53340146<br />&nbsp;RPA energy &#91;Ha&#93; :&nbsp; &nbsp; &nbsp;-0.41250684<br />&nbsp;RPA energy &#91;Ha&#93; :&nbsp; &nbsp; &nbsp;-0.21616125<br /><br />/Test_v67mbpt_t19_np1-10$ grep &quot;RPA&quot; v67mbpt_t19_np6/t19.out <br />&nbsp;RPA energy &#91;Ha&#93; :&nbsp; &nbsp; &nbsp;-0.32125626<br />&nbsp;RPA energy &#91;Ha&#93; :&nbsp; &nbsp; &nbsp;-0.02057168<br />&nbsp;RPA energy &#91;Ha&#93; :&nbsp; &nbsp; &nbsp;-0.41250684<br />&nbsp;RPA energy &#91;Ha&#93; :&nbsp; &nbsp; &nbsp;-0.21616125<br /><br />/Test_v67mbpt_t19$ grep &quot;RPA&quot; v67mbpt_t19_np10/t19.out<br />&nbsp;RPA energy &#91;Ha&#93; :&nbsp; &nbsp; &nbsp;-0.32125626<br />&nbsp;RPA energy &#91;Ha&#93; :&nbsp; &nbsp; &nbsp;-0.23271688<br />&nbsp;RPA energy &#91;Ha&#93; :&nbsp; &nbsp; &nbsp;-0.41250684<br />&nbsp;RPA energy &#91;Ha&#93; :&nbsp; &nbsp; &nbsp;-0.21616125<br /><br /></code></pre></div><br /><br />I don't know what are these results suggesting and I'm not sure if this relates to the crashed runs in question above. Is it still save to use this my build of abinit-8.6.3 for production, especially concerning GW work. Hope to get some  advice.<br /><br />Kind regards,<br />Thanusit</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Screening crashed at some q-points</h3>
				<div class="date">Posted: <strong>Fri Mar 16, 2018 4:00 pm</strong></div>
				<div class="author">by <strong>ebousquet</strong></div>
				<div class="content">Dear Thanusit,<br />There is something wrong with the parallel compilation.<br />Could you add the following in your config file to be sure no extra flags are used:<br />enable_optim=&quot;standard&quot;<br /><br />Can't you install a more recent version of openmpi?<br /><br />All the best,<br />Eric</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Screening crashed at some q-points</h3>
				<div class="date">Posted: <strong>Mon Mar 19, 2018 8:01 am</strong></div>
				<div class="author">by <strong>thanusit</strong></div>
				<div class="content">Dear Eric and all<br /><br />1. Regarding the failed-test t19 of v67mbpt, I tried adding enable_optim=&quot;standard&quot; in the config option. Runtest of v67mbpt with -n2 -j1 -t0 still failed with exactly the same result as before. I will try using a newer version of openmpi to see if that can help on the issue.<br /><br />2. For the crashed screening runs, the problem was fixed if I set nband=56 for n-proc=7. The trial was just to make n-proc divides nband. I'm not sure if this is the proper solution to the problem.<br /><br />Kind regards<br />Thanusit</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Screening crashed at some q-points</h3>
				<div class="date">Posted: <strong>Mon Mar 19, 2018 11:33 pm</strong></div>
				<div class="author">by <strong>ebousquet</strong></div>
				<div class="content"><blockquote><div><cite>thanusit wrote:</cite>1. Regarding the failed-test t19 of v67mbpt, I tried adding enable_optim=&quot;standard&quot; in the config option. Runtest of v67mbpt with -n2 -j1 -t0 still failed with exactly the same result as before. I will try using a newer version of openmpi to see if that can help on the issue.<br /></div></blockquote><br />OK, I have to look a bit further then because with a quick look I don't see what could be wrong in your compilation. Sorry for the openmpi version, you have a version that is OK, I went too fast in reading your post and read 1.1 instead of 1.10... <br /><blockquote><div><cite>thanusit wrote:</cite>2. For the crashed screening runs, the problem was fixed if I set nband=56 for n-proc=7. The trial was just to make n-proc divides nband. I'm not sure if this is the proper solution to the problem.<br /></div></blockquote><br />OK, good, it is always better to adapt the number of bands w.r.t. the number of CPU/kpoints.</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Screening crashed at some q-points</h3>
				<div class="date">Posted: <strong>Thu Mar 22, 2018 2:43 am</strong></div>
				<div class="author">by <strong>thanusit</strong></div>
				<div class="content">Dear Eric and all<br /><blockquote class="uncited"><div> Eric wrote :<br />Sorry for the openmpi version, you have a version that is OK...<br /></div></blockquote><br />Thank you for the update. Anyway, I did try building abinit-8.6.3 with openmpi-2.1.3. Still get the same failed test results of v67mbpt.<br /><br />For the screening calculations, the _SCR files of each q-point were obtained and successfully merged with &quot;mrgscr&quot; utility. The merged _SCR<br />has been input for a sigma calculation, which is running at the moment. Hope these are good signs of getting things right. Wait to see if the sigma run get <br />through successfully.<br /><br />Kind regards,<br />Thanusit</div>
			</div>
			<hr />
			</div>

	<div id="page-footer" class="page-footer">
		<div class="page-number">All times are <span title="Europe/Brussels">UTC+02:00</span><br />Page <strong>1</strong> of <strong>1</strong></div>
			<div class="copyright">
				<p>Powered by <a href="https://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Limited
				</p>
							</div>
	</div>
</div>

</body>

<!-- Mirrored from forum.abinit.org/viewtopic.php?f=11&t=3797&view=print by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 20 Sep 2024 20:25:03 GMT -->
</html>
