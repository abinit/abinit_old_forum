<!DOCTYPE html>
<html dir="ltr" lang="en-gb">

<!-- Mirrored from forum.abinit.org/viewtopic.php?f=14&t=1926&view=print by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 21 Sep 2024 01:45:13 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="robots" content="noindex" />

<title>ABINIT Discussion Forums &bull; Issues with etsf-io and POT files</title>

<link href="styles/flat-style/theme/print.css" rel="stylesheet">
<link href="styles/flat-style/theme/bidi.css" rel="stylesheet">
</head>
<body id="phpbb" class="ltr">
<div id="wrap" class="wrap">
	<a id="top" class="top-anchor" accesskey="t"></a>

	<div id="page-header">
		<h1>ABINIT Discussion Forums</h1>
		<p>The meeting place for ABINIT users and developers<br /><a href="index.html">https://forum.abinit.org/</a></p>

		<h2>Issues with etsf-io and POT files</h2>
		<p><a href="viewtopic15c6.html?f=14&amp;t=1926">https://forum.abinit.org/viewtopic.php?f=14&amp;t=1926</a></p>
	</div>

	<div id="page-body" class="page-body">
		<div class="page-number">Page <strong>1</strong> of <strong>1</strong></div>
					<div class="post">
				<h3>Issues with etsf-io and POT files</h3>
				<div class="date">Posted: <strong>Thu Dec 20, 2012 2:03 pm</strong></div>
				<div class="author">by <strong>carsten.fortmann</strong></div>
				<div class="content"><strong class="text-strong">summary:</strong> cut3d crashes when attempting to read *-etsf.nc potential files.<br /><br />---------------------------------------<br /><br /><strong class="text-strong">description</strong><br />abinit version: 6.12.3 built from sources w/ etsf-io fallback connector<br />platform: linux x86-64 3.2.x kernel<br /><br />for several reasons i rely on the etsf-io capability, so my typical input files look like this one:<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>acell 1 1 1 angstrom<br />&nbsp; &nbsp; rprim&nbsp; 0.00000000&nbsp; 2.71530000&nbsp; 2.71530000<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2.71530000&nbsp; 0.00000000&nbsp; 2.71530000<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2.71530000&nbsp; 2.71530000&nbsp; 0.00000000<br /><br /># Atomic type information<br />ntypat 1<br />typat 1 1<br />znucl 14<br /><br /># Atomic positions<br />natom 2<br />xred 0.0000 0.0000 0.0000<br />&nbsp; &nbsp; &nbsp;0.2500 0.2500 0.2500<br /><br /><br /># Exchange Correlation Parameters<br />ixc -001009<br />nsppol 1<br />nspinor 1<br />nspden 1<br /><br /># Iteration Control Parameters<br />iscf 17<br />nstep 40<br />npulayit 5<br />iprcel 0<br />toldfe 1e-06<br /><br /># Numerical Accuracy Parameters<br />tphysel 0<br />ngkpt 3 3 3<br /><br /># Basis Set Parameters<br />nband 16<br />ecut 20<br /><br /># Additional Parameters<br />chksymbreak 0<br />chkprim 0<br /><br /># Output control<br /># Print results to *-etsf.nc netcdf files.<br />accesswff 3<br />istwfk *1<br />prteig 1<br />prtpot 1<br /></code></pre></div><br />abinit successfully returns  and generates a couple of *-etsf.nc netcdf files, e.g. output_POT-etsf.nc. <br />i open the POT using the ase.io.pupynere module (python script):<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>#file readpot.py<br />import ase.io.pupynere as ase_pupynere<br />import numpy<br />potfile = ase_pupynere.NetCDFFile('output_POT-etsf.nc','r')<br /># 'exchange_correlation_potential' is the only 3D scalar field variable in the file,<br /># so i figure it is the eff. potential.<br />potential = potfile.variables&#91;'exchange_correlation_potential'&#93;.data<br />print potential&#91;0,0,0,0&#93;<br /></code></pre></div><br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>$&gt; python readpot.py<br />9.96920997e+36<br /></code></pre></div><br />same for all other indices. <img class="smilies" src="images/smilies/icon_e_sad.gif" alt=":(" title="Sad" /> <br /><br /> <img class="smilies" src="images/smilies/icon_idea.gif" alt=":idea:" title="Idea" /> ok, maybe i should not read the file directly but use cut3d, instead.<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>$&gt; cut3d<br />&nbsp; What is the name of the 3D function (density, potential or wavef) file ?<br />output_POT-etsf.nc<br />&nbsp; =&gt; Your 3D function file is : output_POT-etsf.nc<br />&nbsp;<br />&nbsp; Does this file contain formatted 3D ASCII data (=0)&nbsp; <br />&nbsp; &nbsp;or unformatted binary header + 3D data&nbsp; &nbsp; &nbsp; &nbsp; (=1) ?<br />&nbsp; &nbsp;or ETSF binary&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (=2) ?<br />2<br />&nbsp; 2 =&gt; Your file contains ETSF data<br />&nbsp; The information it contains should be sufficient.<br />&nbsp;WffOpen: opening output_POT-etsf.nc on unit 3<br />&nbsp; cut3d : read file output_POT-etsf.nc.<br />&nbsp;<br />&nbsp;hdr_io_etsf: accessing ABINIT specific data from unit 3<br /><br />&nbsp;hdr_io_etsf.F90:186:WARNING<br />&nbsp; &nbsp;Backtrace&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : etsf_io_low_read_dim()<br />&nbsp; Action performed&nbsp; &nbsp;: inquire dimension ID<br />&nbsp; Target (name)&nbsp; &nbsp; &nbsp; : rhoijdim2<br />&nbsp; Error message&nbsp; &nbsp; &nbsp; : NetCDF: Invalid dimension ID or name<br />&nbsp; Error id&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: -46<br /><br /><br />&nbsp;hdr_io_etsf.F90:240:ERROR<br />&nbsp; &nbsp;Backtrace&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : read_var_integer_1D()<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;read_var_infos_name()<br />&nbsp; Action performed&nbsp; &nbsp;: inquire variable ID<br />&nbsp; Target (name)&nbsp; &nbsp; &nbsp; : number_of_wavelets<br />&nbsp; Error message&nbsp; &nbsp; &nbsp; : NetCDF: Variable not found<br />&nbsp; Error id&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: -49<br /><br /><br />&nbsp;hdr_io_etsf.F90:240:ERROR<br />&nbsp; &nbsp;Backtrace&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : read_var_integer_1D()<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;read_var_infos_name()<br />&nbsp; Action performed&nbsp; &nbsp;: inquire variable ID<br />&nbsp; Target (name)&nbsp; &nbsp; &nbsp; : number_of_wavelets<br />&nbsp; Error message&nbsp; &nbsp; &nbsp; : NetCDF: Variable not found<br />&nbsp; Error id&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: -49<br /><br /><br />&nbsp;leave_new : decision taken to exit ...<br /></code></pre></div><br /><img class="smilies" src="images/smilies/icon_question.gif" alt=":?:" title="Question" />  ase.io.pupynere reads the file but it does not contain sensible data and cut3d cannot read it.<br /><br />finally, i resort to remove the lines accesswff 3 and istwfk *1 from the input file, so that abinit writes unformatted binary files. cut3d then successfully reads the potential file (output_POT).<br /><br />running the original input file but replacing &quot;prtpot&quot; by e.g. &quot;prtvxc&quot; or &quot;prtvha&quot;, so as to obtain the exchange-correlation and hartree potentials, respectively, i receive etsf.nc files that now contain valid potential data but that are again not readable by cut3d. same result if i have &quot;prtvxc 1&quot; and &quot;prtvha 1&quot; both enabled at the same time.  as a check, i also write to unformatted VXC and VHA binary files, read them using cut3d, and the data are identical to the corresponding NetCDFFile().variables['exchange_correlation_potential'].data objects.<br />last, by enabling &quot;prtpot 1&quot; additionaly, all three etsf.nc files (VXC, VHA, and POT) now contain the same non-sense large numbers as described above and are (as always) not readable by cut3d.<br /><br />any ideas? need more info? should this be filed as a bug?<br /><br />i'm open to any suggestions.<br /><br />thanks, carsten</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Issues with etsf-io and POT files</h3>
				<div class="date">Posted: <strong>Thu May 16, 2013 2:45 pm</strong></div>
				<div class="author">by <strong>rangel</strong></div>
				<div class="content">There might be an issue with the netcdf format. <br />I have never used this option, so I cannot help much.<br /><br />But one should be able to use the standard binary format and cut3d.<br />There are several options with cut3d (e.g., to obtain the full potential all along the box, or along a vector, xmgrace format, etc..).<br />Do they all give wrong results?<br /><br />Best wishes, <br />Tonatiuh Rangel</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Issues with etsf-io and POT files</h3>
				<div class="date">Posted: <strong>Tue May 28, 2013 12:33 pm</strong></div>
				<div class="author">by <strong>dcaliste</strong></div>
				<div class="content">I confirm that the POT file is empty, while the DEN file is OK. I'll investigate.<br /><br />After investigation, it looks like a on-purpose restriction, quoting 95_drive/outscfcv.F90:671<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>!&nbsp; &nbsp; MJV note: why is accessfil forced to 0???? This disables the writing of ETSF<br />!&nbsp; &nbsp; format potentials!<br />!&nbsp; &nbsp; <br />!&nbsp; &nbsp; set to 1 for netcdf output<br />&nbsp; &nbsp; &nbsp;accessfil = 0<br /></code></pre></div><br /><br />Why is it like that, I've no idea. Removing this <div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>accessfil = 0</code></pre></div> statement should solve the problem.</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Issues with etsf-io and POT files</h3>
				<div class="date">Posted: <strong>Fri Jun 21, 2013 8:25 am</strong></div>
				<div class="author">by <strong>simpak</strong></div>
				<div class="content"><blockquote><div><cite>carsten.fortmann wrote:</cite><strong class="text-strong">summary:</strong> cut3d crashes when attempting to read *-etsf.nc potential files.<br /><br />---------------------------------------<br /><br /><strong class="text-strong">description</strong><br /><a href="http://hundefuttertests.de/" class="postlink"><span style="color: #000000">abinit</span></a> version: 6.12.3 built from sources w/ etsf-io fallback connector<br />platform: linux x86-64 3.2.x kernel<br /><br />for several reasons i rely on the etsf-io capability, so my typical input files look like this one:<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>acell 1 1 1 angstrom<br />&nbsp; &nbsp; rprim&nbsp; 0.00000000&nbsp; 2.71530000&nbsp; 2.71530000<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2.71530000&nbsp; 0.00000000&nbsp; 2.71530000<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2.71530000&nbsp; 2.71530000&nbsp; 0.00000000<br /><br /># Atomic type information<br />ntypat 1<br />typat 1 1<br />znucl 14<br /><br /># Atomic positions<br />natom 2<br />xred 0.0000 0.0000 0.0000<br />&nbsp; &nbsp; &nbsp;0.2500 0.2500 0.2500<br /><br /><br /># Exchange Correlation Parameters<br />ixc -001009<br />nsppol 1<br />nspinor 1<br />nspden 1<br /><br /># Iteration Control Parameters<br />iscf 17<br />nstep 40<br />npulayit 5<br />iprcel 0<br />toldfe 1e-06<br /><br /># Numerical Accuracy Parameters<br />tphysel 0<br />ngkpt 3 3 3<br /><br /># Basis Set Parameters<br />nband 16<br />ecut 20<br /><br /># Additional Parameters<br />chksymbreak 0<br />chkprim 0<br /><br /># Output control<br /># Print results to *-etsf.nc netcdf files.<br />accesswff 3<br />istwfk *1<br />prteig 1<br />prtpot 1<br /></code></pre></div><br />abinit successfully returns  and generates a couple of *-etsf.nc netcdf files, e.g. output_POT-etsf.nc. <br />i open the POT using the ase.io.pupynere module (python script):<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>#file readpot.py<br />import ase.io.pupynere as ase_pupynere<br />import numpy<br />potfile = ase_pupynere.NetCDFFile('output_POT-etsf.nc','r')<br /># 'exchange_correlation_potential' is the only 3D scalar field variable in the file,<br /># so i figure it is the eff. potential.<br />potential = potfile.variables&#91;'exchange_correlation_potential'&#93;.data<br />print potential&#91;0,0,0,0&#93;<br /></code></pre></div><br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>$&gt; python readpot.py<br />9.96920997e+36<br /></code></pre></div><br />same for all other indices. <img class="smilies" src="images/smilies/icon_e_sad.gif" alt=":(" title="Sad" /> <br /><br /> <img class="smilies" src="images/smilies/icon_idea.gif" alt=":idea:" title="Idea" /> ok, maybe i should not read the file directly but use cut3d, instead.<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>$&gt; cut3d<br />&nbsp; What is the name of the 3D function (density, potential or wavef) file ?<br />output_POT-etsf.nc<br />&nbsp; =&gt; Your 3D function file is : output_POT-etsf.nc<br />&nbsp;<br />&nbsp; Does this file contain formatted 3D ASCII data (=0)&nbsp; <br />&nbsp; &nbsp;or unformatted binary header + 3D data&nbsp; &nbsp; &nbsp; &nbsp; (=1) ?<br />&nbsp; &nbsp;or ETSF binary&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (=2) ?<br />2<br />&nbsp; 2 =&gt; Your file contains ETSF data<br />&nbsp; The information it contains should be sufficient.<br />&nbsp;WffOpen: opening output_POT-etsf.nc on unit 3<br />&nbsp; cut3d : read file output_POT-etsf.nc.<br />&nbsp;<br />&nbsp;hdr_io_etsf: accessing ABINIT specific data from unit 3<br /><br />&nbsp;hdr_io_etsf.F90:186:WARNING<br />&nbsp; &nbsp;Backtrace&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : etsf_io_low_read_dim()<br />&nbsp; Action performed&nbsp; &nbsp;: inquire dimension ID<br />&nbsp; Target (name)&nbsp; &nbsp; &nbsp; : rhoijdim2<br />&nbsp; Error message&nbsp; &nbsp; &nbsp; : NetCDF: Invalid dimension ID or name<br />&nbsp; Error id&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: -46<br /><br /><br />&nbsp;hdr_io_etsf.F90:240:ERROR<br />&nbsp; &nbsp;Backtrace&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : read_var_integer_1D()<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;read_var_infos_name()<br />&nbsp; Action performed&nbsp; &nbsp;: inquire variable ID<br />&nbsp; Target (name)&nbsp; &nbsp; &nbsp; : number_of_wavelets<br />&nbsp; Error message&nbsp; &nbsp; &nbsp; : NetCDF: Variable not found<br />&nbsp; Error id&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: -49<br /><br /><br />&nbsp;hdr_io_etsf.F90:240:ERROR<br />&nbsp; &nbsp;Backtrace&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : read_var_integer_1D()<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;read_var_infos_name()<br />&nbsp; Action performed&nbsp; &nbsp;: inquire variable ID<br />&nbsp; Target (name)&nbsp; &nbsp; &nbsp; : number_of_wavelets<br />&nbsp; Error message&nbsp; &nbsp; &nbsp; : NetCDF: Variable not found<br />&nbsp; Error id&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: -49<br /><br /><br />&nbsp;leave_new : decision taken to exit ...<br /></code></pre></div><br /><img class="smilies" src="images/smilies/icon_question.gif" alt=":?:" title="Question" />  ase.io.pupynere reads the file but it does not contain sensible data and cut3d cannot read it.<br /><br />finally, i resort to remove the lines accesswff 3 and istwfk *1 from the input file, so that abinit writes unformatted binary files. cut3d then successfully reads the potential file (output_POT).<br /><br />running the original input file but replacing &quot;prtpot&quot; by e.g. &quot;prtvxc&quot; or &quot;prtvha&quot;, so as to obtain the exchange-correlation and hartree potentials, respectively, i receive etsf.nc files that now contain valid potential data but that are again not readable by cut3d. same result if i have &quot;prtvxc 1&quot; and &quot;prtvha 1&quot; both enabled at the same time.  as a check, i also write to unformatted VXC and VHA binary files, read them using cut3d, and the data are identical to the corresponding NetCDFFile().variables['exchange_correlation_potential'].data objects.<br />last, by enabling &quot;prtpot 1&quot; additionaly, all three etsf.nc files (VXC, VHA, and POT) now contain the same non-sense large numbers as described above and are (as always) not readable by cut3d.<br /><br />any ideas? need more info? should this be filed as a bug?<br /><br />i'm open to any suggestions.<br /><br />thanks, carsten</div></blockquote><br /><br /><br />this is really hard Man, <img class="smilies" src="images/smilies/icon_e_smile.gif" alt=":)" title="Smile" /></div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Issues with etsf-io and POT files</h3>
				<div class="date">Posted: <strong>Mon Oct 14, 2013 10:59 am</strong></div>
				<div class="author">by <strong>carsten.fortmann</strong></div>
				<div class="content">simpak, i know, MAN.<br /><br />but thanks for the hint, dcaliste, i'll try it out.</div>
			</div>
			<hr />
			</div>

	<div id="page-footer" class="page-footer">
		<div class="page-number">All times are <span title="Europe/Brussels">UTC+02:00</span><br />Page <strong>1</strong> of <strong>1</strong></div>
			<div class="copyright">
				<p>Powered by <a href="https://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Limited
				</p>
							</div>
	</div>
</div>

</body>

<!-- Mirrored from forum.abinit.org/viewtopic.php?f=14&t=1926&view=print by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 21 Sep 2024 01:45:13 GMT -->
</html>
