<!DOCTYPE html>
<html dir="ltr" lang="en-gb">

<!-- Mirrored from forum.abinit.org/viewtopic.php?f=19&t=1533 by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 20 Sep 2024 17:32:49 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1" />

<title>Bug Report: OpenMP in 6.12.1 - ABINIT Discussion Forums</title>


	<link rel="canonical" href="viewtopic04b7.html?t=1533">

<!--
	phpBB style name: Flat Style
	Based on style:   prosilver (this is the default phpBB3 style)
	Original author:  Tom Beddard ( http://www.subBlue.com/ )
	Modified by:      Ian Bradley
-->

<link href="assets/css/font-awesome.minaea1.css?assets_version=57" rel="stylesheet">
<link href="styles/flat-style/theme/stylesheetaea1.css?assets_version=57" rel="stylesheet">
<link href="styles/flat-style/theme/en/stylesheetaea1.css?assets_version=57" rel="stylesheet">




<!--[if lte IE 9]>
	<link href="./styles/flat-style/theme/tweaks.css?assets_version=57" rel="stylesheet">
<![endif]-->

<meta name="google-site-verification" content="PLdTN48UENWHvJ5ViWhDTahZKzoMyw5e1QZgw1IECVw" />
<link rel="alternate" type="application/atom+xml" title="ATOM" href="app.php/smartfeed/feed.html" />
<link rel="alternate" type="application/rss+xml" title="RSS" href="app.php/smartfeed/feed9830.html?y=2" />

<link href="ext/crizzo/aboutus/styles/prosilver/theme/aboutusaea1.css?assets_version=57" rel="stylesheet" media="screen" />
<link href="ext/dmzx/topicageday/styles/prosilver/theme/topicagedayaea1.css?assets_version=57" rel="stylesheet" media="screen" />
<link href="ext/hifikabin/clock/styles/all/theme/clockaea1.css?assets_version=57" rel="stylesheet" media="screen" />
<link href="ext/hifikabin/googlesearch/styles/prosilver/theme/googlesearchaea1.css?assets_version=57" rel="stylesheet" media="screen" />
<link href="ext/kinerity/bestanswer/styles/prosilver/theme/bestansweraea1.css?assets_version=57" rel="stylesheet" media="screen" />
<link href="ext/phpbb/collapsiblecategories/styles/all/theme/collapsiblecategoriesaea1.css?assets_version=57" rel="stylesheet" media="screen" />
<link href="ext/phpbbservices/smartfeed/styles/prosilver/theme/customaea1.css?assets_version=57" rel="stylesheet" media="screen" />
<link href="ext/senky/userstatistics/styles/prosilver/theme/userstatisticsaea1.css?assets_version=57" rel="stylesheet" media="screen" />
<link href="ext/tierra/topicsolved/styles/prosilver/theme/buttonsaea1.css?assets_version=57" rel="stylesheet" media="screen" />



</head>
<body id="phpbb" class="nojs notouch section-viewtopic ltr ">


<div id="wrap" class="wrap">
	<a id="top" class="top-anchor" accesskey="t"></a>
	<div id="page-header">
		<div class="headerbar" role="banner">
					<div class="inner">

			<div id="site-description">
				<a id="logo" class="logo" href="index-2.html" title="Board index"><span class="site_logo"></span></a>
				<div  class="site-description">
					<h1>ABINIT Discussion Forums</h1>
					<p>The meeting place for ABINIT users and developers</p>
					<p class="skiplink"><a href="#start_here">Skip to content</a></p>
				</div>
			</div>

			</div>
					</div>
				<div class="navbar navbar-top" role="navigation">
	<div class="inner">

	<ul id="nav-main" class="nav-main linklist" role="menubar">

		<li id="quick-links" class="quick-links dropdown-container responsive-menu" data-skip-responsive="true">
			<a href="#" class="dropdown-trigger">
				<i class="icon fa-bars fa-fw" aria-hidden="true"></i><span>Quick links</span>
			</a>
			<div class="dropdown">
				<div class="pointer"><div class="pointer-inner"></div></div>
				<ul class="dropdown-contents" role="menu">
					
											<li class="separator"></li>
																									<li>
								<a href="search33a7.html?search_id=unanswered" role="menuitem">
									<i class="icon fa-file fa-fw" aria-hidden="true"></i><span>Unanswered topics</span>
								</a>
							</li>
							<li>
								<a href="search526f.html?search_id=active_topics" role="menuitem">
									<i class="icon fa-file fa-fw" aria-hidden="true"></i><span>Active topics</span>
								</a>
							</li>
							<li class="separator"></li>
							<li>
								<a href="search.html" role="menuitem">
									<i class="icon fa-search fa-fw" aria-hidden="true"></i><span>Search</span>
								</a>
							</li>
					
										
										<li class="separator"></li>

									</ul>
			</div>
		</li>

			<li class="small-icon icon-smartfeed no-bulletin"><a href="app.php/smartfeed/ui.html">Smartfeed</a></li>		<li data-skip-responsive="true">
			<a href="app.php/help/faq.html" rel="help" title="Frequently Asked Questions" role="menuitem">
				<i class="icon fa-question-circle fa-fw" aria-hidden="true"></i><span>FAQ</span>
			</a>
		</li>
								<li data-last-responsive="true">
				<a href="https://www.abinit.org/" title="" role="menuitem" target="_blank">
				<i class="icon fa-home fa-fw" aria-hidden="true"></i><span>Main Site</span>
				</a>
			</li>
								<li data-last-responsive="true">
				<a href="https://www.abinit.org/packages" title="" role="menuitem" target="_blank">
				<i class="icon fa-download fa-fw" aria-hidden="true"></i><span>Download</span>
				</a>
			</li>
								<li data-last-responsive="true">
				<a href="https://docs.abinit.org/" title="" role="menuitem" target="_blank">
				<i class="icon fa-book fa-fw" aria-hidden="true"></i><span>Documentations</span>
				</a>
			</li>
								<li data-last-responsive="true">
				<a href="https://docs.abinit.org/tutorial/" title="" role="menuitem" target="_blank">
				<i class="icon fa-graduation-cap fa-fw" aria-hidden="true"></i><span>Tutorials</span>
				</a>
			</li>
							
			<li class="rightside"  data-skip-responsive="true">
			<a href="ucp26c3.html?mode=login" title="Login" accesskey="x" role="menuitem">
				<i class="icon fa-power-off fa-fw" aria-hidden="true"></i><span>Login</span>
			</a>
		</li>
						</ul>
    </div>
</div>

<div class="navbar" role="navigation">
	<div class="inner">
	<ul id="nav-breadcrumbs" class="nav-breadcrumbs linklist navlinks" role="menubar">
								<li class="breadcrumbs" itemscope itemtype="http://schema.org/BreadcrumbList">
										<span class="crumb"  itemtype="http://schema.org/ListItem" itemprop="itemListElement" itemscope><a href="index-2.html" itemtype="https://schema.org/Thing" itemprop="item" accesskey="h" data-navbar-reference="index"><i class="icon fa-home fa-fw"></i><span itemprop="name">Board index</span></a><meta itemprop="position" content="1" /></span>
											<span class="crumb"  itemtype="http://schema.org/ListItem" itemprop="itemListElement" itemscope data-forum-id="5"><a href="viewforume774.html?f=5" itemtype="https://schema.org/Thing" itemprop="item"><span itemprop="name">Developing Abinit</span></a><meta itemprop="position" content="2" /></span>
															<span class="crumb"  itemtype="http://schema.org/ListItem" itemprop="itemListElement" itemscope data-forum-id="19"><a href="viewforum218b.html?f=19" itemtype="https://schema.org/Thing" itemprop="item"><span itemprop="name">Improving ABINIT</span></a><meta itemprop="position" content="3" /></span>
												</li>
		<li class="rightside responsive-hide">
	<div id="show-clock">
		<div id="liveclock" class="outer_face">
			<div class="marker oneseven"></div>
			<div class="marker twoeight"></div>
			<div class="marker fourten"></div>
			<div class="marker fiveeleven"></div>
			<div class="inner_face">
				<div class="hand hour"></div>
				<div class="hand minute"></div>
				<div class="hand second"></div>
			</div>
		</div>
	</div>
</li><!--[if !IE]><!-->
<li id="g-search-box" class="search-box rightside responsive-hide">
	<form action="https://forum.abinit.org/app.php/googlesearch">
	<fieldset>
		<input name="cx" type="hidden" value="017804512478788106347:tlftx8kncg4">
		<input name="q" type="search" maxlength="255" class="inputbox search tiny" value="" placeholder="Google Search ...">
		<button class="button button-search-google" type="submit" name="sitesearch" title="Google Search">
		<i class="icon fa-search fa-fw" aria-hidden="true"></i>
		</button>
	</fieldset>
</form>
</li>
<!--<![endif]-->

							<li id="search-box" class="rightside search-box responsive-hide" role="search">
				<form action="https://forum.abinit.org/search.php" method="get" id="search">
				<fieldset>
					<input name="keywords" id="keywords" type="search" maxlength="128" title="Search for keywords" class="inputbox search tiny" size="20" value="" placeholder="Search…" />
					<button class="button button-search" type="submit" title="Search">
						<i class="icon fa-search fa-fw" aria-hidden="true"></i><span class="sr-only">Search</span>
					</button>
					<a href="search.html" class="button button-search-end" title="Advanced search">
						<i class="icon fa-cog fa-fw" aria-hidden="true"></i><span class="sr-only">Advanced search</span>
					</a>
					
				</fieldset>
				</form>
			</li>

			<li class="rightside responsive-search">
				<a href="search.html" title="View the advanced search options" role="menuitem">
					<i class="icon fa-search fa-fw" aria-hidden="true"></i><span class="sr-only">Search</span>
				</a>
			</li>
					</ul>

	</div>
</div>
	</div>

	
	<a id="start_here" class="anchor"></a>
	<div id="page-body" class="page-body" role="main">
		
		﻿
<h2 class="topic-title"><a href="viewtopic205d.html?f=19&amp;t=1533">Bug Report: OpenMP in 6.12.1</a></h2>
<!-- NOTE: remove the style="display: none" when you want to have the forum description on the topic body -->
<div style="display: none !important;">Documentation, Web site and code modifications<br /></div>
<p>
	<strong>Moderators:</strong> <a href="memberlist4183.html?mode=viewprofile&amp;u=1676" class="username">baguetl</a>, <a href="memberlistccd1.html?mode=viewprofile&amp;u=2257" class="username">routerov</a>
</p>


<div class="action-bar bar-top">
	
			<a href="posting0bf9.html?mode=reply&amp;f=19&amp;t=1533" class="button" title="This topic is locked, you cannot edit posts or make further replies.">
							<span>Locked</span> <i class="icon fa-lock fa-fw" aria-hidden="true"></i>
					</a>
	
			<div class="dropdown-container dropdown-button-control topic-tools">
		<span title="Topic tools" class="button button-secondary dropdown-trigger dropdown-select">
			<i class="icon fa-wrench fa-fw" aria-hidden="true"></i>
			<span class="caret"><i class="icon fa-sort-down fa-fw" aria-hidden="true"></i></span>
		</span>
		<div class="dropdown">
			<div class="pointer"><div class="pointer-inner"></div></div>
			<ul class="dropdown-contents">
																												<li>
					<a href="viewtopic8e48.html?f=19&amp;t=1533&amp;view=print" title="Print view" accesskey="p">
						<i class="icon fa-print fa-fw" aria-hidden="true"></i><span>Print view</span>
					</a>
				</li>
											</ul>
		</div>
	</div>
	
			<div class="search-box" role="search">
			<form method="get" id="topic-search" action="https://forum.abinit.org/search.php">
			<fieldset>
				<input class="inputbox search tiny"  type="search" name="keywords" id="search_keywords" size="20" placeholder="Search this topic…" />
				<button class="button button-search" type="submit" title="Search">
					<i class="icon fa-search fa-fw" aria-hidden="true"></i><span class="sr-only">Search</span>
				</button>
				<a href="search.html" class="button button-search-end" title="Advanced search">
					<i class="icon fa-cog fa-fw" aria-hidden="true"></i><span class="sr-only">Advanced search</span>
				</a>
				<input type="hidden" name="t" value="1533" />
<input type="hidden" name="sf" value="msgonly" />

			</fieldset>
			</form>
		</div>
	
			<div class="pagination">
			6 posts
							&bull; Page <strong>1</strong> of <strong>1</strong>
					</div>
		</div>




			<div id="p4790" class="post has-profile bg2 offline">
		<div class="inner">

		<dl class="postprofile" id="profile4790">
			<dt class="no-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlistaf78.html?mode=viewprofile&amp;u=209" class="username">kaneod</a>							</dt>

									
		<dd class="profile-posts"><strong>Posts:</strong> <a href="search66ac.html?author_id=209&amp;sr=posts">42</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> Wed Mar 10, 2010 11:47 am</dd>		
		
						
						
		</dl>

		<div class="postbody">
						<div id="post_content4790">

						<h3 class="first"><a href="#p4790">Bug Report: OpenMP in 6.12.1</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting5a47.html?mode=quote&amp;f=19&amp;p=4790" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author">
									<a class="unread" href="viewtopic7c46.html?p=4790#p4790" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlistaf78.html?mode=viewprofile&amp;u=209" class="username">kaneod</a></strong> &raquo; </span>Tue Feb 14, 2012 5:44 am
			</p>
			
			
			
			<div class="content">Since it was reported in the previous equivalent thread that OpenMP is (possibly) much better in 6.12, thought I'd post some of the OpenMP bugs here to help clean it up. All these are reported as errors by gfortran-4.6.3 on the Intel x86_64 platform. Compilation used the flags &quot;-O3 -march=native -funroll-loops -floop-block -flto -fopenmp&quot; and whatever else the build system adds by itself (something like -m64 -g -ffree-line-length-none).<br /><br />43_ffts/fourwf.F90 line 787: the !$OMP END PARALLEL DO statement has to actually end after a &quot;end do&quot;! Moving it up one line (before the end if) fixes.<br /><br />56_mixing/dotprodm_vn.F90: there are repetitions of PRIVATE variables in the directives at lines 272-274, 312-313. Remove them.<br /><br />56_xc/rhohxc.F90: derived types (blah%moreblah) can't be used in OpenMP directives! Remove dtset%ixc from the directive cluster at line 699. It's only a single integer so copying it across the different OpenMP threads will not destroy performance. In the future, assign dtset%ixc to a local variable and use the local variable name in the SHARED directive instead.<br /><br />56_xc/xcden.F90 and xcpot.F90: there are PARALLEL DO loops here which don't start with a Fortran DO statement - need to move ifft = 0 assignment outside the loop (it will still be copied to all the individual threads as 0 in the first place).<br /><br />65_nonlocal/mkffnl.F90: Line 466 is missing a trailing continuation &amp; after the OMP directive. Line 467: Typo, variable &quot;wf_ffnl1&quot; in the SHARED directive should be wk_ffnl1.<br /><br />65_nonlocal/mkkpg.F90: Line 105, what is variable kkpg doing in the OMP directive? It doesn't exist! Remove to get working. Line 93: two_pi isn't a variable, it's a parameter.<br /><br />65_nonlocal/opernlb_ylm.F90: Lines 178 and 179 are missing &amp; continuations. Why is the OpenMP styling so inconsistent across the files even within the same folder? Is there not a style guide for this project?<br /><br /><br />65_nonlocal/opernla_ylm.F90: Missing continuations in the block near line 166.<br /><br />The biggest danger of these missing continuations is that they only come up (by default) as *warnings*, hence the parallelization is incomplete in the final build.</div>
			
			
			
									
									<div id="sig4790" class="signature">Dr Kane O'Donnell<br />Postdoctoral Research Fellow<br />Australian Synchrotron</div>
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p4791" class="post has-profile bg1 offline">
		<div class="inner">

		<dl class="postprofile" id="profile4791">
			<dt class="no-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlistaf78.html?mode=viewprofile&amp;u=209" class="username">kaneod</a>							</dt>

									
		<dd class="profile-posts"><strong>Posts:</strong> <a href="search66ac.html?author_id=209&amp;sr=posts">42</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> Wed Mar 10, 2010 11:47 am</dd>		
		
						
						
		</dl>

		<div class="postbody">
						<div id="post_content4791">

						<h3 ><a href="#p4791">Re: Bug Report: OpenMP in 6.12.1</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting606b.html?mode=quote&amp;f=19&amp;p=4791" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author">
									<a class="unread" href="viewtopic2517.html?p=4791#p4791" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlistaf78.html?mode=viewprofile&amp;u=209" class="username">kaneod</a></strong> &raquo; </span>Wed Feb 15, 2012 12:27 am
			</p>
			
			
			
			<div class="content">Further to the previous post, here is a patch that corrects all the OpenMP directive errors (placement, contents) I've found in the abinit 6.12.1 source tree. It will also create a config.ac file (called m2-login1.ac) in ~abinit that lists the build options I used.<br /><br />Note that my corrections for derived types (blah%moreblah) are suboptimal - where a derived type is in a SHARED directive, really either the whole derived type (dtset, say) should be made SHARED or the particular component (dtset%nspden) should be assigned to a local variable, say, nspden, and that can then be SHARED. Since the things that are being shared in almost all cases are essentially just integers to give the max limit of a parallel DO loop, the latter is probably better. I see that in some places in the code these assignments have been made.</div>
			
			
			
									
									<div id="sig4791" class="signature">Dr Kane O'Donnell<br />Postdoctoral Research Fellow<br />Australian Synchrotron</div>
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p4792" class="post has-profile bg2 offline">
		<div class="inner">

		<dl class="postprofile" id="profile4792">
			<dt class="no-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlistaf78.html?mode=viewprofile&amp;u=209" class="username">kaneod</a>							</dt>

									
		<dd class="profile-posts"><strong>Posts:</strong> <a href="search66ac.html?author_id=209&amp;sr=posts">42</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> Wed Mar 10, 2010 11:47 am</dd>		
		
						
						
		</dl>

		<div class="postbody">
						<div id="post_content4792">

						<h3 ><a href="#p4792">Re: Bug Report: OpenMP in 6.12.1</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="postingf4f2.html?mode=quote&amp;f=19&amp;p=4792" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author">
									<a class="unread" href="viewtopiccde3.html?p=4792#p4792" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlistaf78.html?mode=viewprofile&amp;u=209" class="username">kaneod</a></strong> &raquo; </span>Wed Feb 15, 2012 12:29 am
			</p>
			
			
			
			<div class="content">Ok, patches are apparently banned - moderator, email me (kane dot odonnell at synchrotron dot org dot au) if you want the patch.</div>
			
			
			
									
									<div id="sig4792" class="signature">Dr Kane O'Donnell<br />Postdoctoral Research Fellow<br />Australian Synchrotron</div>
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p4796" class="post has-profile bg1 offline">
		<div class="inner">

		<dl class="postprofile" id="profile4796">
			<dt class="no-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlist32d1.html?mode=viewprofile&amp;u=72" class="username">mverstra</a>							</dt>

									
		<dd class="profile-posts"><strong>Posts:</strong> <a href="search1bef.html?author_id=72&amp;sr=posts">655</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> Wed Aug 19, 2009 12:01 pm</dd>		
		
						
						
		</dl>

		<div class="postbody">
						<div id="post_content4796">

						<h3 ><a href="#p4796">Re: Bug Report: OpenMP in 6.12.1</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="postingf011.html?mode=quote&amp;f=19&amp;p=4796" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author">
									<a class="unread" href="viewtopic29f9.html?p=4796#p4796" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlist32d1.html?mode=viewprofile&amp;u=72" class="username">mverstra</a></strong> &raquo; </span>Wed Feb 15, 2012 2:38 pm
			</p>
			
			
			
			<div class="content">Hello kaneod,<br /><br />this is great thanks! The patch is not banned, you just have to use a suffix that the forum likes, such as .txt<br /><br />OpenMP is being revamped in abinit as we speak, to I will forward your patch to the appropriate developers (or better point them to this conversation).<br /><br />cheers<br /><br />Matthieu</div>
			
			
			
									
									<div id="sig4796" class="signature">Matthieu Verstraete<br />University of Liege, Belgium</div>
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p4801" class="post has-profile bg2 offline">
		<div class="inner">

		<dl class="postprofile" id="profile4801">
			<dt class="no-profile-rank has-avatar">
				<div class="avatar-container">
																<a href="memberlist6f62.html?mode=viewprofile&amp;u=61" class="avatar"><img class="avatar" src="download/file96d1.jpg?avatar=61_1392074789.jpg" width="92" height="79" alt="User avatar" /></a>														</div>
								<a href="memberlist6f62.html?mode=viewprofile&amp;u=61" class="username">gmatteo</a>							</dt>

									
		<dd class="profile-posts"><strong>Posts:</strong> <a href="search9f23.html?author_id=61&amp;sr=posts">291</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> Sun Aug 16, 2009 5:40 pm</dd>		
		
						
						
		</dl>

		<div class="postbody">
						<div id="post_content4801">

						<h3 ><a href="#p4801">Re: Bug Report: OpenMP in 6.12.1</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting96f0.html?mode=quote&amp;f=19&amp;p=4801" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author">
									<a class="unread" href="viewtopic79f4.html?p=4801#p4801" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlist6f62.html?mode=viewprofile&amp;u=61" class="username">gmatteo</a></strong> &raquo; </span>Wed Feb 15, 2012 4:20 pm
			</p>
			
			
			
			<div class="content">Hello kaneod,<br /><br />Thank you very much for reporting these problems.<br />I've already solved most of them in my development version but unfortunately <br />these bug fixes have not been included in version 6.12. They will be made available in version 6.13<br /><br />I would strongly discourage the use of OpenMP in version 6.12 since there are several<br />problems and inefficiencies that we are still trying to solve.  In particular, the OMP sections <br />used for the application of the non-local part of the potential are completely wrong.   <br />The orthogonalization algorithm should be rewritten with BLAS3 routines in order to achieve better parallel efficiency.<br /><br /><blockquote class="uncited"><div>Why is the OpenMP styling so inconsistent across the files even within the same folder? Is there not a style guide for this project?</div></blockquote><br /><br />No, as far as I know. Note that most of the OMP sections were coded long time ago, and then disabled since the core developers<br />prefer to concentrate most of effort on the pure MPI version.<br />Now OpenMP is being revamped in abinit (in particular in the GW code), since we are trying to improve the scalability of the code <br />by using a hybrid MPI-OpenMP implementation.<br /><br />Contributions and bug fixes are obviously welcome. <br />The main problem, however, is that I'm rewriting most of the OMP sections and this will complicate the merge of<br /> patches done on top of version 6.12.<br />The best solution would be to create a development branch and then use bazaar to manage the different contributions.<br /><br />People who want to contribute to the development of the OMP parallelism can contact me by mail.<br /><br />Best regards,<br />Matteo Giantomassi</div>
			
			
			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p4803" class="post has-profile bg1 offline">
		<div class="inner">

		<dl class="postprofile" id="profile4803">
			<dt class="no-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlistaf78.html?mode=viewprofile&amp;u=209" class="username">kaneod</a>							</dt>

									
		<dd class="profile-posts"><strong>Posts:</strong> <a href="search66ac.html?author_id=209&amp;sr=posts">42</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> Wed Mar 10, 2010 11:47 am</dd>		
		
						
						
		</dl>

		<div class="postbody">
						<div id="post_content4803">

						<h3 ><a href="#p4803">Re: Bug Report: OpenMP in 6.12.1</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting3178.html?mode=quote&amp;f=19&amp;p=4803" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author">
									<a class="unread" href="viewtopic9906.html?p=4803#p4803" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlistaf78.html?mode=viewprofile&amp;u=209" class="username">kaneod</a></strong> &raquo; </span>Thu Feb 16, 2012 12:34 am
			</p>
			
			
			
			<div class="content">Thanks for the replies! Well, having OpenMP working for me is only an interest rather than a necessity - the bands parallelism in abinit seems quite effective at getting good speedup for molecular systems (nkpts=1) across MPI. I imagine in the long term though, the scalability will be better for a code with well-integrated OpenMP/MPI hybrid routines where only one thread per node actually communicates via MPI. <br /><br />It's all a bit academic as I get segfaults (constantly) with the executable that compiles cleanly with -fopenmp in gfortran 4.6.3. I guess this is stack issue, I will explore whether expanding OMP_STACKSIZE helps. <br /><br />With regards to posting the patch - I did try using a .txt extension and it still said I wasn't allowed to upload it. I'll put it on my github (github.com/kaneod) in the &quot;bits of python for physics&quot; repo for devs that are interested. <br /><br />Kane</div>
			
			
			
									
									<div id="sig4803" class="signature">Dr Kane O'Donnell<br />Postdoctoral Research Fellow<br />Australian Synchrotron</div>
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
	

	<div class="action-bar bar-bottom">
	
			<a href="posting0bf9.html?mode=reply&amp;f=19&amp;t=1533" class="button" title="This topic is locked, you cannot edit posts or make further replies.">
							<span>Locked</span> <i class="icon fa-lock fa-fw" aria-hidden="true"></i>
					</a>
		
		<div class="dropdown-container dropdown-button-control topic-tools">
		<span title="Topic tools" class="button button-secondary dropdown-trigger dropdown-select">
			<i class="icon fa-wrench fa-fw" aria-hidden="true"></i>
			<span class="caret"><i class="icon fa-sort-down fa-fw" aria-hidden="true"></i></span>
		</span>
		<div class="dropdown">
			<div class="pointer"><div class="pointer-inner"></div></div>
			<ul class="dropdown-contents">
																												<li>
					<a href="viewtopic8e48.html?f=19&amp;t=1533&amp;view=print" title="Print view" accesskey="p">
						<i class="icon fa-print fa-fw" aria-hidden="true"></i><span>Print view</span>
					</a>
				</li>
											</ul>
		</div>
	</div>

			<form method="post" action="https://forum.abinit.org/viewtopic.php?f=19&amp;t=1533">
		<div class="dropdown-container dropdown-container-left dropdown-button-control sort-tools">
	<span title="Display and sorting options" class="button button-secondary dropdown-trigger dropdown-select">
		<i class="icon fa-sort-amount-asc fa-fw" aria-hidden="true"></i>
		<span class="caret"><i class="icon fa-sort-down fa-fw" aria-hidden="true"></i></span>
	</span>
	<div class="dropdown hidden">
		<div class="pointer"><div class="pointer-inner"></div></div>
		<div class="dropdown-contents">
			<fieldset class="display-options">
							<label>Display: <select name="st" id="st"><option value="0" selected="selected">All posts</option><option value="1">1 day</option><option value="7">7 days</option><option value="14">2 weeks</option><option value="30">1 month</option><option value="90">3 months</option><option value="180">6 months</option><option value="365">1 year</option></select></label>
								<label>Sort by: <select name="sk" id="sk"><option value="a">Author</option><option value="t" selected="selected">Post time</option><option value="s">Subject</option></select></label>
				<label>Direction: <select name="sd" id="sd"><option value="a" selected="selected">Ascending</option><option value="d">Descending</option></select></label>
								<hr class="dashed" />
				<input type="submit" class="button2" name="sort" value="Go" />
						</fieldset>
		</div>
	</div>
</div>
		</form>
	
	
	
			<div class="pagination">
			6 posts
							&bull; Page <strong>1</strong> of <strong>1</strong>
					</div>
	</div>


<div class="action-bar actions-jump">
		<p class="jumpbox-return">
		<a href="viewforum218b.html?f=19" class="left-box arrow-left" accesskey="r">
			<i class="icon fa-angle-left fa-fw icon-black" aria-hidden="true"></i><span>Return to “Improving ABINIT”</span>
		</a>
	</p>
	
		<div class="jumpbox dropdown-container dropdown-container-right dropdown-up dropdown-left dropdown-button-control" id="jumpbox">
			<span title="Jump to" class="button button-secondary dropdown-trigger dropdown-select">
				<span>Jump to</span>
				<span class="caret"><i class="icon fa-sort-down fa-fw" aria-hidden="true"></i></span>
			</span>
		<div class="dropdown">
			<div class="pointer"><div class="pointer-inner"></div></div>
			<ul class="dropdown-contents">
																				<li><a href="viewforumffeb.html?f=20" class="jumpbox-forum-link"> <span> News &amp; Announcements</span></a></li>
																<li><a href="viewforum8011.html?f=23" class="jumpbox-forum-link"> <span> Jobs and Other Announcements</span></a></li>
																<li><a href="viewforum58da.html?f=1" class="jumpbox-cat-link"> <span> Building ABINIT</span></a></li>
																<li><a href="viewforum4d6b.html?f=3" class="jumpbox-sub-link"><span class="spacer"></span> <span>&#8627; &nbsp; Configuring and compiling ABINIT</span></a></li>
																<li><a href="viewforum31e6.html?f=4" class="jumpbox-cat-link"> <span> Running Abinit</span></a></li>
																<li><a href="viewforumfdc5.html?f=9" class="jumpbox-sub-link"><span class="spacer"></span> <span>&#8627; &nbsp; Ground state</span></a></li>
																<li><a href="viewforum15ca.html?f=10" class="jumpbox-sub-link"><span class="spacer"></span> <span>&#8627; &nbsp; Response calculations</span></a></li>
																<li><a href="viewforum8a83.html?f=11" class="jumpbox-sub-link"><span class="spacer"></span> <span>&#8627; &nbsp; Many-body perturbation theory</span></a></li>
																<li><a href="viewforum01c9.html?f=12" class="jumpbox-sub-link"><span class="spacer"></span> <span>&#8627; &nbsp; Other tools and postprocessing in ABINIT</span></a></li>
																<li><a href="viewforum345c.html?f=24" class="jumpbox-sub-link"><span class="spacer"></span> <span>&#8627; &nbsp; Python interfacing : Abipy ecosystem</span></a></li>
																<li><a href="viewforum9780.html?f=14" class="jumpbox-sub-link"><span class="spacer"></span> <span>&#8627; &nbsp; Link to other codes</span></a></li>
																<li><a href="viewforume774.html?f=5" class="jumpbox-cat-link"> <span> Developing Abinit</span></a></li>
																<li><a href="viewforum218b.html?f=19" class="jumpbox-sub-link"><span class="spacer"></span> <span>&#8627; &nbsp; Improving ABINIT</span></a></li>
											</ul>
		</div>
	</div>

	</div>


			</div>


<div id="page-footer" class="page-footer" role="contentinfo">
	<div class="navbar navbar-bottom" role="navigation">
	<div class="inner">

	<ul id="nav-footer" class="nav-footer linklist" role="menubar">
		<li class="breadcrumbs">
									<span class="crumb"><a href="index-2.html" data-navbar-reference="index"><i class="icon fa-home fa-fw" aria-hidden="true"></i><span>Board index</span></a></span>					</li>
		
				
							<li class="rightside">
				<a href="ucp033a.html?mode=delete_cookies" data-ajax="true" data-refresh="true" role="menuitem">
					<i class="icon fa-trash fa-fw" aria-hidden="true"></i><span>Delete cookies</span>
				</a>
			</li>
				
		<li class="rightside" data-last-responsive="true"><a href="app.php/aboutus.html" role="menuitem"><i class="icon fa-info-circle fa-fw" aria-hidden="true"></i><span>About us</span></a></li>			</ul>

	</div>
</div>

	<div class="copyright">
		<script type="text/javascript">
copyright=new Date();

update=copyright.getFullYear();

document.write("Copyright\u0020\u0026copy\u003B 2009 - "+ update +	" ABINIT Discussion Forums All\u0020rights\u0020reserved.");

</script>
<br /><br />		<p class="footer-row">
			<span class="footer-copyright">Flat Style by <a href="http://phpbbstyles.oo.gd/">Ian Bradley</a></span>
		</p>
        <p class="footer-row">
			<span class="footer-copyright">Powered by <a href="https://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Limited</span>
		</p>
						<p class="footer-row">
			<a class="footer-link" href="ucp4d86.html?mode=privacy" title="Privacy" role="menuitem">
				<span class="footer-link-text">Privacy</span>
			</a>
			|
			<a class="footer-link" href="ucp226b.html?mode=terms" title="Terms" role="menuitem">
				<span class="footer-link-text">Terms</span>
			</a>
		</p>
					</div>

	<div id="darkenwrapper" class="darkenwrapper" data-ajax-error-title="AJAX error" data-ajax-error-text="Something went wrong when processing your request." data-ajax-error-text-abort="User aborted request." data-ajax-error-text-timeout="Your request timed out; please try again." data-ajax-error-text-parsererror="Something went wrong with the request and the server returned an invalid reply.">
		<div id="darken" class="darken">&nbsp;</div>
	</div>

	<div id="phpbb_alert" class="phpbb_alert" data-l-err="Error" data-l-timeout-processing-req="Request timed out.">
		<a href="#" class="alert_close">
			<i class="icon fa-times-circle fa-fw" aria-hidden="true"></i>
		</a>
		<h3 class="alert_title">&nbsp;</h3><p class="alert_text"></p>
	</div>
	<div id="phpbb_confirm" class="phpbb_alert">
		<a href="#" class="alert_close">
			<i class="icon fa-times-circle fa-fw" aria-hidden="true"></i>
		</a>
		<div class="alert_text"></div>
	</div>
</div>

</div>

<div>
	<a id="bottom" class="anchor" accesskey="z"></a>
	</div>

<script src="assets/javascript/jquery.minaea1.js?assets_version=57"></script>
<script src="assets/javascript/coreaea1.js?assets_version=57"></script>



<script>
	(function() {
		var cx = '017804512478788106347\u003Atlftx8kncg4';
		var gcse = document.createElement('script');
		gcse.type = 'text/javascript';
		gcse.async = true;
		gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
			'//cse.google.com/cse.js?cx=' + cx;
		var s = document.getElementsByTagName('script')[0];
		s.parentNode.insertBefore(gcse, s);
	})();
</script>
<script type="text/javascript">
(function($) {  // Avoid conflicts with other libraries

'use strict';
	
	phpbb.addAjaxCallback('reporttosfs', function(data) {
		if (data.postid !== "undefined") {
			$('#sfs' + data.postid).hide();
			phpbb.closeDarkenWrapper(5000);
		}
	});

})(jQuery);
</script>
<script src="ext/hifikabin/clock/styles/all/template/js/js_clockaea1.js?assets_version=57"></script>
<script src="ext/phpbb/collapsiblecategories/styles/all/template/js/collapsiblecategoriesaea1.js?assets_version=57"></script>
<script src="styles/prosilver/template/forum_fnaea1.js?assets_version=57"></script>
<script src="styles/prosilver/template/ajaxaea1.js?assets_version=57"></script>



</body>

<!-- Mirrored from forum.abinit.org/viewtopic.php?f=19&t=1533 by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 20 Sep 2024 17:33:04 GMT -->
</html>
