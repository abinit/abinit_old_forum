# pv - optomize unitcell for mg structure with 1 fe atom (low spin) 
#nodes 288
#pseudos O.LDA.paw Mg.LDA.paw  Si.LDA.paw Fe.LDA.paw
#walltime 140:00:00
#pmem 6000mb

#########################
###  Thermodyn State  ###
#########################
#Pressure - [1 Ha/Bohr**3 = 29421.033d0 GPa]
strtarget 3*-4.07871471E-3  3*0   #Target stress is 120 GPa
#Chemistry - atom types
ntypat 4          
znucl  8    12    14    26  
#     1=O  2=Mg  3=Si  4=Fe
natom 160
# (Mg,Fe)SiO3 Pv - Mg31,Fe1
typat  4 3 1 1 2 3 1 1 2 3 1 1 2 3 1 1 1 1 1 1 2 3 1 1 2 3 1 1 2 3 1 1 2 3 1 1 1 1 1 1 2 3 1 1 2 
 3 1 1 2 3 1 1 2 3 1 1 1 1 1 1 2 3 1 1 2 3 1 1 2 3 1 1 2 3 1 1 1 1 1 1 2 3 1 1 2 3 1 1 2 3 1 1 2 
 3 1 1 1 1 1 1 2 3 1 1 2 3 1 1 2 3 1 1 2 3 1 1 1 1 1 1 2 3 1 1 2 3 1 1 2 3 1 1 2 3 1 1 1 1 1 1 2 
 3 1 1 2 3 1 1 2 3 1 1 2 3 1 1 1 1 1 1
 
#typat    4  3  1  1  2  3  1  1  2  3  1  1  2  3  1  1  1  1  1  1
#parameters concerning spin of Fe would go here...
nsppol 1  #unpolarized calculation


#########################
###     Accuracy      ###
#########################
ecut 55          #This results in better than .1 mHa accuracy! 
pawecutdg 110
ecutsm 0.5       #standard value for smearing of ecut
dilatmx 1.1      #use small dilatmx since abc values are close 
# SCF Procedure
toldff 5d-6      #tol on successive diff of forces (should be 10x smaller than tolmxf) ... don't use toldfe for struct opt.
nstep 100        # Max number of SCF cycles
diemac 3.0       # Precondition SCF cycle (insulators have values of a few)

#Definition of the k-point grid from kptrlen (decently efficient kpt grid)
#  creates 8 kpts
kptopt 1          # Option for the automatic generation of k points, taking
                  # into account the symmetry --- STANDARD VALUE
kptrlatt 6  0  0
         0  6  0
         0  0  4
nshiftk 1
shiftk .5 .5  .5
#kptrlen 80     #set the largest wavefn sampling dist to this number of unitcells 
#prtkpt 1       #print out the resulting kpt grids


#########################
###    Optimization   ###
#########################
ndtset 2
ionmov 2      #ions move with BFGS approach
ntime 100     #max number of timesteps for structural relaxation
tolmxf 5d-5   #Tol on max forces for structural optimization
optcell1  0   #First optimize ionic positions within unitcell
optcell2  2   #next optimize abc lattice params  (generic setting)


#########################
###  Parallelization  ###
#########################
nband 540
#nband 535 [default value]
paral_kgb 1
npkpt 36
npband 4 
npfft 2
bandpp 1

# WARNING in invars1m For dataset=   2  a possible choice for less than  800 processors is:
#  nproc    npkpt    npband     npfft    bandpp    weight
#   720      36       10         2          2           1.25
#   720      36       20         1          1           1.00
#   720      36        5         4          4           0.25
#   648      36        6         3          2           0.50
### 648      36        9         2          4           1.00 ###
#   648      36       18         1          2           1.00
#   576      36        4         4          1           0.25
#   540      36       15         1          4           1.00
### 540      36        5         3          4           0.25 ###
#   432      36        4         3          1           0.25
#   432      36       12         1          1           1.00
### 432      36        6         2          2           0.75 ###
### 360      36       10         1          2           1.00
#   360      36        5         2          4           0.50
#   324      36        9         1          4           1.00
### 324      36        3         3          4           0.25
### 288      36        4         2          1           0.50 ##
#   216      36        3         2          4           0.25
### 216      36        6         1          2           1.00 ###
#   180      36        5         1          4           1.00
#   144      36        2         2          2           0.25
#   144      36        4         1          1           1.00
#   108      36        3         1          4           1.00
#    72      36        2         1          2           1.00
getcell -1
getxred -1
getwfk -1



##############################
###  Geometry & Positions  ###
##############################
#First define the symmetery
#spgroup 62
#spgaxor 2  #This is crucial! it tells the difference between Pbnm and Pnma
           #  -This creates the vacancies required by the Pbnm structure
# Set these flags if primitive unit cell is not the conventional unit cell 
#  -In that case rprim ~= to cartesian unit vectors
rprim 1 0 0
      0 1 0
      0 0 1
#chkprim 0
#brvltt -1

# Output from pure Mg pv run
#acell   8.0831760666E+00  8.6383314958E+00  1.1826133623E+01 Bohr
# Scaled output from supercell.py
acell   1.61663521332E+01   1.72766629916E+01   2.36522672460E+01

# Output from pure Mg pv run scaled/repeated using supercell.py
xred
   2.62980554580E-01   2.89551963960E-01   1.25000000000E-01
   2.50000000000E-01   5.00000000000E-01   2.50000000000E-01
   5.89430866050E-02   2.33263695100E-01   1.25000000000E-01
   9.07781891700E-02   9.59717895550E-02   2.78976757045E-01
   1.29805545795E-02   4.60448036040E-01   3.75000000000E-01
   1.54074395550E-33   2.50000000000E-01   2.50000000000E-01
   3.08943086605E-01   1.67363048980E-02   3.75000000000E-01
   3.40778189170E-01   1.54028210445E-01   2.21023242955E-01
   2.37019445420E-01   2.10448036040E-01   3.75000000000E-01
   2.50000000000E-01   5.00000000000E-01   5.00000000000E-01
   4.41056913395E-01   2.66736304900E-01   3.75000000000E-01
   4.09221810830E-01   4.04028210445E-01   2.89767570455E-02
   4.87019445420E-01   3.95519639585E-02   1.25000000000E-01
   1.54074395550E-33   2.50000000000E-01   5.00000000000E-01
   1.91056913395E-01   4.83263695100E-01   1.25000000000E-01
   1.59221810830E-01   3.45971789555E-01   4.71023242955E-01
   4.09221810830E-01   4.04028210445E-01   2.21023242955E-01
   1.59221810830E-01   3.45971789555E-01   2.78976757045E-01
   9.07781891700E-02   9.59717895550E-02   4.71023242955E-01
   3.40778189170E-01   1.54028210445E-01   2.89767570455E-02
   2.62980554580E-01   2.89551963960E-01   6.25000000000E-01
   2.50000000000E-01   5.00000000000E-01   7.50000000000E-01
   5.89430866050E-02   2.33263695100E-01   6.25000000000E-01
   9.07781891700E-02   9.59717895550E-02   7.78976757045E-01
   1.29805545795E-02   4.60448036040E-01   8.75000000000E-01
   1.54074395550E-33   2.50000000000E-01   7.50000000000E-01
   3.08943086605E-01   1.67363048980E-02   8.75000000000E-01
   3.40778189170E-01   1.54028210445E-01   7.21023242955E-01
   2.37019445420E-01   2.10448036040E-01   8.75000000000E-01
   2.50000000000E-01   5.00000000000E-01   1.00000000000E+00
   4.41056913395E-01   2.66736304900E-01   8.75000000000E-01
   4.09221810830E-01   4.04028210445E-01   5.28976757045E-01
   4.87019445420E-01   3.95519639585E-02   6.25000000000E-01
   1.54074395550E-33   2.50000000000E-01   1.00000000000E+00
   1.91056913395E-01   4.83263695100E-01   6.25000000000E-01
   1.59221810830E-01   3.45971789555E-01   9.71023242955E-01
   4.09221810830E-01   4.04028210445E-01   7.21023242955E-01
   1.59221810830E-01   3.45971789555E-01   7.78976757045E-01
   9.07781891700E-02   9.59717895550E-02   9.71023242955E-01
   3.40778189170E-01   1.54028210445E-01   5.28976757045E-01
   2.62980554580E-01   7.89551963960E-01   1.25000000000E-01
   2.50000000000E-01   1.00000000000E+00   2.50000000000E-01
   5.89430866050E-02   7.33263695100E-01   1.25000000000E-01
   9.07781891700E-02   5.95971789555E-01   2.78976757045E-01
   1.29805545795E-02   9.60448036040E-01   3.75000000000E-01
   1.54074395550E-33   7.50000000000E-01   2.50000000000E-01
   3.08943086605E-01   5.16736304898E-01   3.75000000000E-01
   3.40778189170E-01   6.54028210445E-01   2.21023242955E-01
   2.37019445420E-01   7.10448036040E-01   3.75000000000E-01
   2.50000000000E-01   1.00000000000E+00   5.00000000000E-01
   4.41056913395E-01   7.66736304900E-01   3.75000000000E-01
   4.09221810830E-01   9.04028210445E-01   2.89767570455E-02
   4.87019445420E-01   5.39551963959E-01   1.25000000000E-01
   1.54074395550E-33   7.50000000000E-01   5.00000000000E-01
   1.91056913395E-01   9.83263695100E-01   1.25000000000E-01
   1.59221810830E-01   8.45971789555E-01   4.71023242955E-01
   4.09221810830E-01   9.04028210445E-01   2.21023242955E-01
   1.59221810830E-01   8.45971789555E-01   2.78976757045E-01
   9.07781891700E-02   5.95971789555E-01   4.71023242955E-01
   3.40778189170E-01   6.54028210445E-01   2.89767570455E-02
   2.62980554580E-01   7.89551963960E-01   6.25000000000E-01
   2.50000000000E-01   1.00000000000E+00   7.50000000000E-01
   5.89430866050E-02   7.33263695100E-01   6.25000000000E-01
   9.07781891700E-02   5.95971789555E-01   7.78976757045E-01
   1.29805545795E-02   9.60448036040E-01   8.75000000000E-01
   1.54074395550E-33   7.50000000000E-01   7.50000000000E-01
   3.08943086605E-01   5.16736304898E-01   8.75000000000E-01
   3.40778189170E-01   6.54028210445E-01   7.21023242955E-01
   2.37019445420E-01   7.10448036040E-01   8.75000000000E-01
   2.50000000000E-01   1.00000000000E+00   1.00000000000E+00
   4.41056913395E-01   7.66736304900E-01   8.75000000000E-01
   4.09221810830E-01   9.04028210445E-01   5.28976757045E-01
   4.87019445420E-01   5.39551963959E-01   6.25000000000E-01
   1.54074395550E-33   7.50000000000E-01   1.00000000000E+00
   1.91056913395E-01   9.83263695100E-01   6.25000000000E-01
   1.59221810830E-01   8.45971789555E-01   9.71023242955E-01
   4.09221810830E-01   9.04028210445E-01   7.21023242955E-01
   1.59221810830E-01   8.45971789555E-01   7.78976757045E-01
   9.07781891700E-02   5.95971789555E-01   9.71023242955E-01
   3.40778189170E-01   6.54028210445E-01   5.28976757045E-01
   7.62980554580E-01   2.89551963960E-01   1.25000000000E-01
   7.50000000000E-01   5.00000000000E-01   2.50000000000E-01
   5.58943086605E-01   2.33263695100E-01   1.25000000000E-01
   5.90778189170E-01   9.59717895550E-02   2.78976757045E-01
   5.12980554579E-01   4.60448036040E-01   3.75000000000E-01
   5.00000000000E-01   2.50000000000E-01   2.50000000000E-01
   8.08943086605E-01   1.67363048980E-02   3.75000000000E-01
   8.40778189170E-01   1.54028210445E-01   2.21023242955E-01
   7.37019445420E-01   2.10448036040E-01   3.75000000000E-01
   7.50000000000E-01   5.00000000000E-01   5.00000000000E-01
   9.41056913395E-01   2.66736304900E-01   3.75000000000E-01
   9.09221810830E-01   4.04028210445E-01   2.89767570455E-02
   9.87019445420E-01   3.95519639585E-02   1.25000000000E-01
   5.00000000000E-01   2.50000000000E-01   5.00000000000E-01
   6.91056913395E-01   4.83263695100E-01   1.25000000000E-01
   6.59221810830E-01   3.45971789555E-01   4.71023242955E-01
   9.09221810830E-01   4.04028210445E-01   2.21023242955E-01
   6.59221810830E-01   3.45971789555E-01   2.78976757045E-01
   5.90778189170E-01   9.59717895550E-02   4.71023242955E-01
   8.40778189170E-01   1.54028210445E-01   2.89767570455E-02
   7.62980554580E-01   2.89551963960E-01   6.25000000000E-01
   7.50000000000E-01   5.00000000000E-01   7.50000000000E-01
   5.58943086605E-01   2.33263695100E-01   6.25000000000E-01
   5.90778189170E-01   9.59717895550E-02   7.78976757045E-01
   5.12980554579E-01   4.60448036040E-01   8.75000000000E-01
   5.00000000000E-01   2.50000000000E-01   7.50000000000E-01
   8.08943086605E-01   1.67363048980E-02   8.75000000000E-01
   8.40778189170E-01   1.54028210445E-01   7.21023242955E-01
   7.37019445420E-01   2.10448036040E-01   8.75000000000E-01
   7.50000000000E-01   5.00000000000E-01   1.00000000000E+00
   9.41056913395E-01   2.66736304900E-01   8.75000000000E-01
   9.09221810830E-01   4.04028210445E-01   5.28976757045E-01
   9.87019445420E-01   3.95519639585E-02   6.25000000000E-01
   5.00000000000E-01   2.50000000000E-01   1.00000000000E+00
   6.91056913395E-01   4.83263695100E-01   6.25000000000E-01
   6.59221810830E-01   3.45971789555E-01   9.71023242955E-01
   9.09221810830E-01   4.04028210445E-01   7.21023242955E-01
   6.59221810830E-01   3.45971789555E-01   7.78976757045E-01
   5.90778189170E-01   9.59717895550E-02   9.71023242955E-01
   8.40778189170E-01   1.54028210445E-01   5.28976757045E-01
   7.62980554580E-01   7.89551963960E-01   1.25000000000E-01
   7.50000000000E-01   1.00000000000E+00   2.50000000000E-01
   5.58943086605E-01   7.33263695100E-01   1.25000000000E-01
   5.90778189170E-01   5.95971789555E-01   2.78976757045E-01
   5.12980554579E-01   9.60448036040E-01   3.75000000000E-01
   5.00000000000E-01   7.50000000000E-01   2.50000000000E-01
   8.08943086605E-01   5.16736304898E-01   3.75000000000E-01
   8.40778189170E-01   6.54028210445E-01   2.21023242955E-01
   7.37019445420E-01   7.10448036040E-01   3.75000000000E-01
   7.50000000000E-01   1.00000000000E+00   5.00000000000E-01
   9.41056913395E-01   7.66736304900E-01   3.75000000000E-01
   9.09221810830E-01   9.04028210445E-01   2.89767570455E-02
   9.87019445420E-01   5.39551963959E-01   1.25000000000E-01
   5.00000000000E-01   7.50000000000E-01   5.00000000000E-01
   6.91056913395E-01   9.83263695100E-01   1.25000000000E-01
   6.59221810830E-01   8.45971789555E-01   4.71023242955E-01
   9.09221810830E-01   9.04028210445E-01   2.21023242955E-01
   6.59221810830E-01   8.45971789555E-01   2.78976757045E-01
   5.90778189170E-01   5.95971789555E-01   4.71023242955E-01
   8.40778189170E-01   6.54028210445E-01   2.89767570455E-02
   7.62980554580E-01   7.89551963960E-01   6.25000000000E-01
   7.50000000000E-01   1.00000000000E+00   7.50000000000E-01
   5.58943086605E-01   7.33263695100E-01   6.25000000000E-01
   5.90778189170E-01   5.95971789555E-01   7.78976757045E-01
   5.12980554579E-01   9.60448036040E-01   8.75000000000E-01
   5.00000000000E-01   7.50000000000E-01   7.50000000000E-01
   8.08943086605E-01   5.16736304898E-01   8.75000000000E-01
   8.40778189170E-01   6.54028210445E-01   7.21023242955E-01
   7.37019445420E-01   7.10448036040E-01   8.75000000000E-01
   7.50000000000E-01   1.00000000000E+00   1.00000000000E+00
   9.41056913395E-01   7.66736304900E-01   8.75000000000E-01
   9.09221810830E-01   9.04028210445E-01   5.28976757045E-01
   9.87019445420E-01   5.39551963959E-01   6.25000000000E-01
   5.00000000000E-01   7.50000000000E-01   1.00000000000E+00
   6.91056913395E-01   9.83263695100E-01   6.25000000000E-01
   6.59221810830E-01   8.45971789555E-01   9.71023242955E-01
   9.09221810830E-01   9.04028210445E-01   7.21023242955E-01
   6.59221810830E-01   8.45971789555E-01   7.78976757045E-01
   5.90778189170E-01   5.95971789555E-01   9.71023242955E-01
   8.40778189170E-01   6.54028210445E-01   5.28976757045E-01
# Output (partial) from previous attempt that timed out pv_120gpa_111_mg_fe1_LS.in
#xred
#   5.16673076077149E-01  5.52850589990679E-01  2.50000000000000E-01
#   5.00082484214180E-01 -3.16321462019721E-03  4.99242322989034E-01
#   1.12669972630802E-01  4.62566969715109E-01  2.50000000000000E-01
#   1.83195730376486E-01  1.95117042928013E-01  5.57426372896949E-01
#   2.56283014679204E-02  9.25058179368075E-01  7.50000000000000E-01
#  -1.88935275974997E-04  5.03025888381531E-01  5.00325316823966E-01
#   6.17704322615054E-01  3.54016121029320E-02  7.50000000000000E-01
#   6.81101976431253E-01  3.08745987869316E-01  4.42607348886725E-01
#   4.73552240836255E-01  4.20408482141265E-01  7.50000000000000E-01
#   5.00082484214180E-01 -3.16321462019721E-03  7.57677010966272E-04
#   8.81456732552143E-01  5.34866667126161E-01  7.50000000000000E-01
#   8.25674758706029E-01  8.14339747036615E-01  5.47791947074719E-02
#   9.74057136590137E-01  7.81742723227087E-02  2.50000000000000E-01
#  -1.88935275974997E-04  5.03025888381531E-01 -3.25316823966389E-04
#   3.81432244449850E-01  9.66896531084560E-01  2.50000000000000E-01
#   3.18546971937867E-01  6.93822896475479E-01  9.40100383491387E-01
#   8.25674758706029E-01  8.14339747036615E-01  4.45220805292528E-01
#   3.18546971937867E-01  6.93822896475479E-01  5.59899616508613E-01
#   1.83195730376486E-01  1.95117042928013E-01  9.42573627103051E-01
#   6.81101976431253E-01  3.08745987869316E-01  5.73926511132753E-02

# Output from pure Mg single unitcell run
#xred                 5.2596110916E-01  5.7910392792E-01  2.5000000000E-01
#                     5.0000000000E-01 -1.3877787808E-16  5.0000000000E-01
#                     1.1788617321E-01  4.6652739020E-01  2.5000000000E-01
#                     1.8155637834E-01  1.9194357911E-01  5.5795351409E-01
#                     2.5961109159E-02  9.2089607208E-01  7.5000000000E-01
#                     3.0814879110E-33  5.0000000000E-01  5.0000000000E-01
#                     6.1788617321E-01  3.3472609796E-02  7.5000000000E-01
#                     6.8155637834E-01  3.0805642089E-01  4.4204648591E-01
#                     4.7403889084E-01  4.2089607208E-01  7.5000000000E-01
#                     5.0000000000E-01 -1.3877787808E-16 -1.3877787808E-17
#                     8.8211382679E-01  5.3347260980E-01  7.5000000000E-01
#                     8.1844362166E-01  8.0805642089E-01  5.7953514091E-02
#                     9.7403889084E-01  7.9103927917E-02  2.5000000000E-01
#                     3.0814879110E-33  5.0000000000E-01 -1.3877787808E-17
#                     3.8211382679E-01  9.6652739020E-01  2.5000000000E-01
#                     3.1844362166E-01  6.9194357911E-01  9.4204648591E-01
#                     8.1844362166E-01  8.0805642089E-01  4.4204648591E-01
#                     3.1844362166E-01  6.9194357911E-01  5.5795351409E-01
#                     1.8155637834E-01  1.9194357911E-01  9.4204648591E-01
#                     6.8155637834E-01  3.0805642089E-01  5.7953514091E-02

#xred              # This keyword indicate that the location of the atoms
#                  # will follow, one triplet of number for each atom
#       0.521999586362      0.573963611537      0.250000000000
#       0.500000000000      0.000000000000      0.500000000000
#       0.115857735665      0.468955329920      0.250000000000
#       0.185084020332      0.192168507317      0.557231270638
#       0.021999586362      0.926036388463      0.750000000000
#       0.000000000000      0.500000000000      0.500000000000
#       0.615857735665      0.031044670080      0.750000000000
#       0.685084020332      0.307831492683      0.442768729362
#       0.478000413638      0.426036388463      0.750000000000
#       0.500000000000      0.000000000000      0.000000000000
#       0.884142264335      0.531044670080      0.750000000000
#       0.814915979668      0.807831492683      0.057231270638
#       0.978000413638      0.073963611537      0.250000000000
#       0.000000000000      0.500000000000      0.000000000000
#       0.384142264335      0.968955329920      0.250000000000
#       0.314915979668      0.692168507317      0.942768729362
#       0.814915979668      0.807831492683      0.442768729362
#       0.314915979668      0.692168507317      0.557231270638
#       0.185084020332      0.192168507317      0.942768729362
#       0.685084020332      0.307831492683      0.057231270638

#Initial xred values from cif file
   #0.51410 0.55600 1/4      # Mg1
   #1/2     0.0     1/2      # Si1
   #0.10180 0.46650 1/4      # O1
   #0.19620 0.20130 0.55260  # O2




